SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   1
CAOS46  Z80

    1                   ;*************************************************
    2                   ;**						**
    3                   ;**	CAOS 4.6   (c) KC-Club 2015		**
    4                   ;**						**
    5                   ;*************************************************
    6                   ;**						**
    7                   ;**	Entwickler:				**
    8                   ;**		Mario Leubner			**
    9                   ;**		Daniel Elstner (CAOS 4.5)	**
   10                   ;**						**
   11                   ;**	CAOS-Versionen:				**
   12                   ;**	13.04.1994 - CAOS 4.2 Reassemblierung	**
   13                   ;**	17.02.1995 - CAOS 4.3			**
   14                   ;**	09.02.2003 - CAOS 4.4			**
   15                   ;**	06.09.2010 - CAOS 4.5			**
   16                   ;**	04.02.2015 - CAOS 4.6 beta1		**
   17                   ;**						**
   18                   ;*************************************************
   19                   ;**	05.03.2016 - CAOS 4.6 beta2		**
   20                   ;*************************************************
   21                   
   22         0001      beta	equ	1		; 0 fuer Vollversion, 1 fuer beta-Version
   23                   DATUM	MACRO
   24                   	DB	'05.03.2016'	; Versionsdatum nur hier aendern!
   25                   	ENDM
   26                   
   27                   ; Uebersetzen ohne Erzeugen eines Listings:
   28                   ;	SLRZ80 CAOS45.@@Z/F
   29                   ; oder:	Z80ASM CAOS45.@@Z/F
   30                   ;	REN CAOS45.COM CAOS45.KCC
   31                   
   32                   ; Uebersetzen mit Erzeugen eines Listings:
   33                   ;	SLRZ80 CAOS45/F
   34                   ; oder:	Z80ASM CAOS45/F
   35                   ;	REN CAOS45.COM CAOS45.KCC
   36                   
   37                   ; Hardware:	(KC85/5)
   38                   ;
   39                   ;256 KByte interner RAM (RAM0,RAM4,RAM8)
   40                   ; 64 KByte IRM (2 unabhaengige Bilder)
   41                   ; 16 KByte CAOS-ROM C000-FFFF
   42                   ; 32 KByte USER-ROM C000-DFFF (4 Ebenen)
   43                   
   44                   ;---------------------------------------------------------------------
   45                   
   46                   ;**	Speicheruebersicht, Belegung der CAOS-ROMs	**
   47                   
   48                   ;ROM-C:
   49                   ;C000	IRM-Defaulttabelle
   50                   ;	System-Initialisierung, Portinittabellen
   51                   ;	SYSTEM-Check, Modulcheck
   52                   ;	Modulschaltung (SWITCH)
   53                   ;	F-Tastenbelegung (KEY, KEYLIST)
   54                   ;	Farben setztn (COLOR)
   55                   ;	Fensterfunktionen (WINDOW, WINAK, WININ)
   56                   ;	Grafikfunktionen (LINE, PUSE, CIRCLE, PUDE)
   57                   ;	Speicherfunktionen (DISPLAY, MODIFY)
   58                   ;	Initialisierung Druckerausgabe, Duplexbetrieb

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   2
CAOS46  Z80

   59                   ;	allgemeine Druckroutine mit Protokoll, Screen- oder Hardcopy
   60                   ;	V.24-Initialisierungstabellen
   61                   ;	Byteweise Kassettenroutinen (MBOUT, MBIN)
   62                   ;	Tabelle der Modulnamen
   63                   
   64                   ;ROM-D:
   65                   ;D000	DISK-Sprungverteiler und Floppy-Routinen
   66                   ;	BASEX-Erweiterung fuer BASIC
   67                   ;	Pixelausgabe fuer IBM-Zeichensatz
   68                   ;	Fensterscrolling, Zeile loeschen
   69                   ;	FLOAD, FSAVE, DIR, STAT, REN, ERA, SETRO, SETWR
   70                   ;	DRIVE, TYPE, DUMP, INIT
   71                   ;	Datum und Uhrzeit anzeigen (TIME)
   72                   ;	Wurzelberechnung, Multiplikation (SQR, MULT)
   73                   ;	Speichercheck VIEW
   74                   ;	Druck-Kommando PRINT
   75                   ;	CAOS-Versionsanzeige (help)
   76                   ;	M001-Initialisierungstabelle fuer Centronics
   77                   ;	Defaulttabelle fuer Joystick-Belegung
   78                   ;	IBM-Codierungen fuer Druckerausgabe
   79                   ;DAB8	IBM-Zeichensatz
   80                   
   81                   ;ROM-E:
   82                   ;E000	RESET, BASIC-Verteiler
   83                   ;	CRT-Treiber (PADR, DABR, WPIX)
   84                   ;	Tastaturtreiber mit ISR CTC Kanal 3, PIO-B, SIO-B
   85                   ;	Joysticktreiber fuer M008/M021
   86                   ;	Kassetten-Routinen Eingabe/Ausgabe
   87                   ;	BASIC-Erweiterungen
   88                   ;	Initialisierungstabelle fuer M021
   89                   ;	Tabelle der ESC-Funktionen
   90                   ;EDFF	CAOS-Versionsnummer
   91                   ;EE00	Zeichenbildtabelle Grossbuchstaben
   92                   
   93                   ;ROM-F:
   94                   ;F000	Power-ON, Programmverteiler, IRMON, IRMOF, RCALL
   95                   ;	Kommandos SWITCH und JUMP
   96                   ;	Kommandointerpreter, MENU
   97                   ;	WAIT
   98                   ;	Zeichenaus-/eingabe (HLHX, AHEX, OCHR, INTB ...)
   99                   ;	Tastatureingabe KBD, INLIN
  100                   ;	Kommando go
  101                   ;	Hex-Zahlen/Argumente erfassen (RHEX, GARG)
  102                   ;	Ports initialisieren (INIEA, INIMEX)
  103                   ;	Kassettenkommandos (SAVE, VERIFY, LOAD)
  104                   ;	Kommandos COLOR, DISPLAY, MODIFY
  105                   ;	Kommandos WINDOW, KEY (mit Keylist)
  106                   ;	Cursordarstellung, Grafikroutinen
  107                   ;	Kommando SYSTEM
  108                   ;	BASIC-I/O-Verteiler
  109                   ;	Zeichenkette anzeigen (ZKOUT)
  110                   ;	Tonausgabe (TON)
  111                   ;	ESC-Programme
  112                   ;	Drucker-, und Duplexroutinen (M001, M021, V.24-Modul)
  113                   ;	SIO-Empfangsinterrupt (Tastatur, ESC...)
  114                   ;	Umschaltroutine fuer CAOS-ROM-C
  115                   ;	I/O-UP-Nummer-Tabelle
  116                   ;	Unterprogrammtabelle fuer SUTAB

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   3
CAOS46  Z80

  117                   ;	Tastencodetabelle KTAB
  118                   ;	ISRTAB	Interrupttabelle
  119                   ;	CRTTAB	Steuerfunktionstabelle
  120                   ;	TOKTAB	BASIC-Token mit Sprungtabelle
  121                   ;FDF0	BASIC-Unterprogrammtabelle
  122                   ;FDF8	Bittabelle fuer Punktroutinen
  123                   ;FE00	Zeichenbildtabelle Kleinbuchstaben
  124                   
  125                   ;---------------------------------------------------------------------
  126                   
  127                   ; CAOS-Vorblock:
  128                   
  129 0100  43 41 4F 53 	DB	'CAOS46  KCC'
  130 010B  00 00 00 00 	DS	5,0
  131 0110  02          	DB	2		; 2 Adressen
  132 0111  4000        	DW	4000H		; AADR
  133 0113  8000        	DW	8000H		; EADR+1
  134 0115  00 00 00 00 	DS	107,0
  135                   
  136                   	INCLUDE	EQU46.INC	; Vereinbarungen, Uebersicht
    1                   ;*****************************************
    2                   ;**	CAOS 4.6			**
    3                   ;**					**
    4                   ;**	Macros und Vereinbarungen	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 05.03.2016	**
    7                   ;*****************************************
    8                   
    9                   MESSAGE	MACRO	MSG1,N,MSG2
   10                   	 .PRINTX MSG1 N MSG2
   11                   	ENDM
   12                   
   13                   ; Mit FF auffuellen, bis die absolute Adresse LOC erreicht ist:
   14                   ABSFILL	MACRO	LOC,WHAT
   15                   	 IF $ GT LOC
   16                   	  MESSAGE <Fehler! LOC:>,% $ - LOC,<Byte zu viel vor WHAT>
   17                   	 ELSE
   18                   	  IF2
   19                   	   MESSAGE <LOC:>,% LOC - $,<Byte frei vor WHAT>
   20                   	  ENDIF
   21                   	  DS	LOC - $,0FFh
   22                   	 ENDIF
   23                   	ENDM
   24                   
   25                   ; Undokumentierter Opcode:
   26                   ;	IN	F,(C)
   27                   INFC	MACRO
   28                   	 DB	0EDh,70h
   29                   	ENDM
   30                   
   31                   ; Undokumentierter Opcode:	Hinweis von KaiOr:
   32                   ;	OUT	(C),0		ED 71 ------- OUT (C),f
   33                   ;				bewirkt:
   34                   ;				NMOS-Z80 ---> OUT (C),0
   35                   ;				CMOS-Z80 ---> OUT (C),255
   36                   ;				Z380 -------> OUT (C),n -> Ausg. des nachfolgenden Bytes
   37                   ;
   38                   ;OUTC0	MACRO

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   4
EQU46   INC

   39                   ;	 DB	0EDh,71h
   40                   ;	ENDM
   41                   ; nicht mehr verwendet ab 05.03.2016 !
   42                   
   43                   ; Undokumentierter Opcode:
   44                   ;	RES	BI,(IX+DISP),A
   45                   RESIXA	MACRO	BI,DISP
   46                   	 DB	0DDh,0CBh,DISP
   47                   	 DB	BI SHL 3 OR 10000111b
   48                   	ENDM
   49                   
   50                   ; Undokumentierter Opcode:
   51                   ;	SET	BI,(IX+DISP),A
   52                   SETIXA	MACRO	BI,DISP
   53                   	 DB	0DDh,0CBh,DISP
   54                   	 DB	BI SHL 3 OR 11000111b
   55                   	ENDM
   56                   
   57                   ; Setze Bit 7 des ersten Zeichens fuer BASIC-Token:
   58                   TOKEN	MACRO	STRING
   59                   Y	 DEFL	80h
   60                   	 IRPC	X,STRING
   61                   	  DB	'&X' + Y
   62                   Y	  DEFL	0
   63                   	 ENDM
   64                   	ENDM
   65                   
   66                   ;---------------------------------------
   67                   
   68                   ; Portadressen im Grundgeraet:
   69                   
   70         0088      PIOAD	EQU	88H	; PIO-A, Datenbyte
   71         0089      PIOBD	EQU	89H	; PIO-B, Datenbyte
   72         008A      PIOAS	EQU	8AH	; PIO-A, Steuerbyte
   73         008B      PIOBS	EQU	8BH	; PIO-B, Steuerbyte
   74         008C      CTC0	EQU	8CH	; CTC Kanal 0
   75         008D      CTC1	EQU	8DH	; CTC Kanal 1
   76         008E      CTC2	EQU	8EH	; CTC Kanal 2
   77         008F      CTC3	EQU	8FH	; CTC Kanal 3
   78                   
   79                   ; von den BASIC-Erweiterungen genutzte Arbeitszellen im RAM:
   80                   
   81         0307      IOCHNL	EQU	0307H	; Ein-/Ausgabekanal
   82         0309      ININD	EQU	0309H	; IN-Index
   83         031B      RNDVR3	EQU	031BH	; Zufallszahl
   84         034E      ANF	EQU	034EH	; erste Zeilennummer
   85         0350      ENDE	EQU	0350H	; letzte Zeilennummer
   86         0352      NANF	EQU	0352H	; neue erste Zeilennummer
   87         0354      DISTAN	EQU	0354H	; Zeilennummernabstand
   88         035E      DATFLG	EQU	035EH	; List-, Editierschutz wenn <> 0
   89         035F      PSTBEG	EQU	035FH	; Programmstartadresse (Standardwert = 0401H)
   90         037E      COLRET	EQU	037EH	; Ablage Farbbyte
   91         03C0      STRDAT	EQU	03C0H	; 4 Byte: Laenge und Adresse des aktuellen Strings
   92         03D7      SVARPT	EQU	03D7H	; Adresse der Liste der einfachen und Stringvariablen
   93         03EA      INTPRB	EQU	03EAH	; Druckpuffer=Dateiname
   94         03FD      PRTFLG	EQU	03FDH	; PRINT-Erweiterung
   95                   
   96                   ; von den BASIC-Erweiterungen genutzte Routinen aus dem BASIC-ROM:

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   5
EQU46   INC

   97                   
   98         C00D      PRIST	EQU	0C00DH	; BASIC-Interpreter Kaltstart
   99         C08C      SECST	EQU	0C08CH	; BASIC-Interpreter Warmstart
  100         C327      TMEMO	EQU	0C327H	; Test, ob RAM fuer naechste Operationen reicht
  101         C348      SNER	EQU	0C348H	; Sprung zu SN-ERROR
  102         C356      ERROO	EQU	0C356H	; Ausgebe Fehlercode
  103         C442      LIN13	EQU	0C442H	; Zeiger auf Zeile mit naechstgroesserer Nummer stellen
  104         C44D      ULER	EQU	0C44DH	; Sprung zu UL-ERROR
  105         C450      LIN6	EQU	0C450H	; Zeile in Programm einsortieren	
  106         C48A      LIN10	EQU	0C48AH
  107         C493      LIN11	EQU	0C493H
  108         C4BB      ZPOIT	EQU	0C4BBH	; Zeiger auf Anfang naechste Zeile stellen
  109         C4BE      ZPOIT1	EQU	0C4BEH
  110         C689      CPREG	EQU	0C689H
  111         C8B7      DLI22	EQU	0C8B7H	; Ansprung Tokenverarbeitung
  112         C8BD      TCHAR	EQU	0C8BDH	; naechstes Zeichen holen
  113         C8BE      TCHAR1	EQU	0C8BEH
  114         C8CC      CPSTX	EQU	0C8CCH	; erwartetes Zeichen folgt als DB ..
  115         C8D6      CPCOMM	EQU	0C8D6H	; Komma?
  116         C8DB      CPBRGT	EQU	0C8DBH	; Klammer zu?
  117         C967      FCER	EQU	0C967H	; Sprung zu FC-ERROR
  118         C96F      EPRVL3	EQU	0C96FH	; Wert bestimmen
  119         C96C      EPRVL4	EQU	0C96CH
  120         C986      DCHEX	EQU	0C986H	; Zeilennummer pruefen und in Hexzahl wandeln
  121         C987      DCHEX1	EQU	0C987H
  122         CB03      PRINT2	EQU	0CB03H
  123         CD36      SNALY6	EQU	0CD36H
  124         CD3A      SNALY	EQU	0CD3AH
  125         CDE1      SNLY14	EQU	0CDE1H	; Syntax-Check '('
  126         CDF3      SNLY16	EQU	0CDF3H	; Syntax-Check ')'
  127         D0C0      POS1	EQU	0D0C0H
  128         D17B      STADTB	EQU	0D17BH
  129         D17E      SADTB1	EQU	0D17EH
  130         D1A9      SLEN3	EQU	0D1A9H
  131         D1E1      STROP	EQU	0D1E1H	; String-Arithmetik
  132         D2F2      STRMV1	EQU	0D2F2H
  133         D302      STRZS3	EQU	0D302H
  134         D330      LEN1	EQU	0D330H	; Laenge holen
  135         D421      ARGVL1	EQU	0D421H	; Wert abholen
  136         D424      ARGVL2	EQU	0D424H
  137         D6AE      SGN1	EQU	0D6AEH
  138         D834      NUMKON	EQU	0D834H
  139         DCB2      CASS1	EQU	0DCB2H	; Dateiname aufbereiten
  140         DDC8      TESTCO	EQU	0DDC8H
  141         DDD5      CO	EQU	0DDD5H	; Ausgabe eines Zeichens (ASCII)
  142         DDE4      CI	EQU	0DDE4H	; Eingabe eines Zeichens (ASCII)
  143         DE25      OUTCHL	EQU	0DE25H	; Ausgabe zu Kanal
  144         DE5F      INCHNL	EQU	0DE5FH	; Eingabe von Kanal
  145                   
  146                   ; Steuerzeichen:
  147                   
  148         000A      LF	EQU	0AH
  149         000D      CR	EQU	0DH
  150         001B      ESC	EQU	1BH
  151                   
  152                   ; IRM-Belegung:
  153                   
  154         A800      V24PL	EQU	0A800H	; Steckplatz V.24-Modul

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   6
EQU46   INC

  155                   ;INTV1		0A801H	; Initialisierungsdaten V.24-Druckausgabe
  156                   ;INTV2		0A809H	; Initialisierungsdaten V.24-duplex
  157                   
  158         A894      JOYIRM	EQU	0A894H	; Joystick-Tabelle (noch nicht endgueltig)
  159                   	; bis	0A89Fh
  160                   ;		0A8A0H	; Ablage IRM-Inhalt unter Mauspfeil (96 Byte)
  161                   	; bis	0A8FFH
  162                   
  163         A900      DEVTAB	EQU	0A900H	; Tabelle der 8 Geraetetreiber: 8*32=256 Byte gross
  164         AA00      SUT_IRM	EQU	0AA00H	; SUTAB per Default im IRM
  165                   	; bis	0AA91h
  166         AD00      VRAM1	EQU	0AD00H	; ASCII-RAM Bild 1
  167         B200      VRAM0	EQU	0B200H	; ASCII-RAM Bild 0
  168         B700      CASS	EQU	0B700H	; 128 Byte Kassettenpuffer
  169                   	; bis	0B77FH
  170         B780      ARGC	EQU	0B780H	; Argument-Nr.
  171         B781      ARGN	EQU	0B781H	; Anzahl Argumente
  172         B782      ARG1	EQU	0B782H	; Argument 1
  173         B784      ARG2	EQU	0B784H	;    "	   2
  174         B786      ARG3	EQU	0B786H	;    "	   3
  175         B788      ARG4	EQU	0B788H	;    "	   4
  176         B78A      ARG5	EQU	0B78AH	;    "	   5
  177         B78C      ARG6	EQU	0B78CH	;    "	   6
  178         B78E      ARG7	EQU	0B78EH	;    "	   7
  179         B790      ARG8	EQU	0B790H	;    "	   8
  180         B792      ARG9	EQU	0B792H	;    "	   9
  181         B794      ARG10	EQU	0B794H	;    "	  10
  182         B796      NUMNX	EQU	0B796H	; Anzahl Zeichen
  183         B797      NUMVX	EQU	0B797H	; Wert HEX-Zahl
  184         B799      HCADR	EQU	0B799H	; Hardcopy-Aufruf
  185         B79B      WINNR	EQU	0B79BH	; Fenster-Nr.
  186         B79C      WINON	EQU	0B79CH	; Fenster-Anfang
  187         B79E      WINLG	EQU	0B79EH	; Fenster-Groesse
  188         B7A0      CURSO	EQU	0B7A0H	; Cursor-Position
  189         B7A2      STBT	EQU	0B7A2H	; BS-Steuerbyte
  190         B7A3      COLOR	EQU	0B7A3H	; Farbe
  191         B7A4      WEND	EQU	0B7A4H	; Adresse fuer Scrolling-Routine
  192         B7A6      CCTL0	EQU	0B7A6H	; Zeichentabelle 0
  193         B7A8      CCTL1	EQU	0B7A8H	;	"	 1
  194         B7AA      CCTL2	EQU	0B7AAH	;	"	 2
  195         B7AC      CCTL3	EQU	0B7ACH	;	"	 3
  196         B7AE      SYSP	EQU	0B7AEH	; System Stackpointer
  197         B7B0      SUTAB	EQU	0B7B0H	; UP-Tabelle
  198         B7B2      CTAB	EQU	0B7B2H	; CRT-Steuerprogramm
  199         B7B4      BJUMP	EQU	0B7B4H	; BASIC-Sprung
  200         B7B9      OUTAB	EQU	0B7B9H	; Zeiger Ausgabe
  201         B7BB      INTAB	EQU	0B7BBH	; Zeiger Eingabe
  202         B7BD      UOUT1	EQU	0B7BDH	; Sprung OUT#2
  203         B7C0      UIN1	EQU	0B7C0H	; Sprung IN#2
  204         B7C3      UOUT2	EQU	0B7C3H	; Sprung OUT#3
  205         B7C6      UIN2	EQU	0B7C6H	; Sprung IN#3
  206         B7C9      IOERR	EQU	0B7C9H	; BASIC-Error
  207         B7CB      VRAM	EQU	0B7CBH	; Adresse Video-RAM
  208         B7CD      ZOTAB	EQU	0B7CDH
  209         B7CF      ZWEND	EQU	0B7CFH	; WEND-Merker
  210         B7D1      FTAST	EQU	0B7D1H	; F-Tastenpointer
  211         B7D3      HOR	EQU	0B7D3H	; Grafik Horizontalposition
  212         B7D5      VERT	EQU	0B7D5H	; Grafik Vertikalposition

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   7
EQU46   INC

  213         B7D6      FARB	EQU	0B7D6H	; Grafik Farbe
  214         B7D7      MIXIT	EQU	0B7D7H	; IX-Merker
  215         B7D8      VORTN	EQU	0B7D8H	; Vortonlaenge fuer byteweise Kassettenausgabe
  216         B7DA      DTPTR	EQU	0B7DAH	; CASS-Pointer
  217         B7DB      CTCMD	EQU	0B7DBH	; CTC2-Modus
  218         B7DC      BLINK	EQU	0B7DCH	; Blinkfrequenz
  219         B7DD      L3TAB	EQU	0B7DDH	; ESC-Tabelle
  220         B7DF      L3SIZ	EQU	0B7DFH	; Anzahl ESC-Routinen
  221         B7E0      COUNT	EQU	0B7E0H	; Tastatur-Repeat
  222         B7E1      HCPZ	EQU	0B7E1H	; Druckersteuerbyte
  223                   		; Bit 0=0	Protokollfunktion
  224                   		; Bit 0=1	Hardcopyfunktion
  225                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  226                   		; Bit 2=0/1	SIO-Kanal A oder B
  227                   		; Bit 3		-
  228                   		; Bit 4..7	Druckertyp (0 bis F)
  229                   		; Bit 7=0	Matrixdrucker
  230                   		; Bit 7=1	Schreibmaschine
  231         B7E2      INTV1	EQU	0B7E2H	; Druckerinitialisierung
  232         B7E4      INTV1L	EQU	0B7E4H	;	"  -Laenge
  233         B7E5      INTV2	EQU	0B7E5H	; Duplexinitialisierung
  234         B7E7      INTV2L	EQU	0B7E7H	;	"  -Laenge
  235         B7E8      HCPZ2	EQU	0B7E8H	; Duplexsteuerbyte
  236                   		; Bit 0		-
  237                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  238                   		; Bit 2=0/1	SIO-Kanal A oder B
  239                   		; Bit 3		WR5 Bit 3: Senden ein/aus
  240                   		; Bit 4		-
  241                   		; Bit 5,6	WR5 Bit 5,6: 5-8 Bit pro Zeichen (Senden)
  242                   		; Bit 7		WR3 Bit 7: 7/8 Bit pro Zeichen (Empfang)
  243         B7E9      OFILT	EQU	0B7E9H	; Druckroutine (ungefiltert)
  244         B7EC      PROMPT	EQU	0B7ECH	; Systemprompt
  245         B7ED      LINTYP	EQU	0B7EDH	; Linientyp
  246         B7EE      CUMUST	EQU	0B7EEH	; ^Cursormuster
  247         B7F0      JOYTAB	EQU	0B7F0H	; Joystick-Tastencodes
  248                   ;		0B7F2H
  249                   ;		bis	; reservicert fuer Arbeitszellen von REAS und TEMO
  250                   ;		0B7FFH
  251         B800      MODST	EQU	0B800H	; Modulsteuerbytespeicher
  252                   	; bis	0B8FFH
  253                   
  254         B99C      WNDFN	EQU	0B99CH	; Fenstersvektorpeicher
  255                   	; bis	0B9FFH
  256                   
  257                   ; Portadressen des Koppel-RAM (D004):
  258                   
  259         00F1      ERRTX	EQU	000F1H	; Fehlertext			(ab DEP 2.0)
  260         80F1      STBYT2	EQU	080F1H	; 2. Steuerbyte:		(ab DEP 2.0)
  261                   			;	Bit 0 - Anforderung
  262                   			;	Bit 1 - Laufwerkswechsel
  263                   			;	Bit 2 - Userwechsel
  264                   			;	Bit 3..6 reserviert
  265                   			;	Bit 7 - Fehlerrueckmeldung
  266         81F1      LWANF	EQU	081F1H	; Laufwerk ('A', 'B', ... 'P')
  267         82F1      UANF	EQU	082F1H	; User-Bereich (00H ... 0FH)
  268         83F1      DEPVER	EQU	083F1H	; DEP-Version BCD
  269         84F1      DATE	EQU	084F1H	; Datum BCD			(ab DEP 3.0)
  270                   			;	Jahr (00..99)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   8
EQU46   INC

  271                   			;	Monat (1..12)
  272                   			;	Tag (1..31)
  273         87F1      TIME	EQU	087F1H	; Uhrzeit BCD			(ab DEP 3.0)
  274                   			;	Stunde (0..23)
  275                   			;	Minute (0..59)
  276                   			;	Sekunde (0..59)
  277                   
  278         80F2      FDATA	EQU	080F2H	; Daten- bzw. Sektorpuffer 128 Byte lang
  279         80F3      STBYT1	EQU	080F3H	; 1. Steuerbyte:
  280                   			;	Bit 0 - Anforderung
  281                   			;	Bit 1 - 1=schreiben/0=lesen
  282                   			;	Bit 3 - oeffnen
  283                   			;	Bit 6 - schliessen
  284                   			;	Bit 7 - Fehlerrueckmeldung
  285                   			;	Bit	5 4 2	Funktionsauswahl:
  286                   			;		0 0 0	Sektor lesen/schreiben
  287                   			;		0 0 1	DIR-Anforderung
  288                   			;		0 1 0	ERA
  289                   			;		0 1 1	STAT
  290                   			;		1 0 0	REN
  291                   			;		1 0 1	SETRO
  292                   			;		1 1 0	SETWR
  293                   			;		1 1 1	BASIC-Byte lesen/schreiben
  294         81F3      FCODE	EQU	081F3H	; Fehlercode
  295         82F3      DIRBUF	EQU	082F3H	; Puffer fuer Dateiname oder Directory
  296         8EF3      BASBYT	EQU	08EF3H	; Datenbyte fuer BASIC-Byte-Schnittstelle
  297         B3F3      UROK	EQU	0B3F3H	; Betriebsart
  298                   
  299                   ; Belegung der IX - Zellen:
  300                   
  301                   ; IX+0	Zeitkonstante fuer Kassettenroutinen
  302                   ; IX+1	Merkzelle fuer Ausgabeport 84H
  303                   ; IX+2	gelesene Blocknummer (Kassette)
  304                   ; IX+3	erwartete Blocknummer (Kassette)
  305                   ; IX+4	Merkzelle fuer Ausgabeport 86H
  306                   ; IX+5	Ein- Ausgabepufferadresse (low)
  307                   ; IX+6	Ein- Ausgabepufferadresse (high)
  308                   ; IX+7	Kennbyte fuer LOAD/VERIFY
  309                   ;	 BIT 0: =1 ->LOAD  =0 ->VERIFY
  310                   ;	 BIT 1: =1 kein Selbstart bei LOAD (in BASIC Kennung fuer 1. Block)
  311                   ;	 BIT 2-4 : Anzahl Argumente (bei SAVE)/ARGN>3 (Startoffset)
  312                   ;	 BIT 5-7 : BASIC: fuer CLOAD/CSAVE 
  313                   ; IX+8	Kennbyte Tastatur
  314                   ;	 BIT 0: gueltiges Byte (ASCII) in IX+13
  315                   ;	 BIT 1: Tonausgabe laeuft
  316                   ;	 BIT 2-4: aktuelles Speichergeraet
  317                   ;		  0=Kassette, 1=Diskette, 2=USB (M052), 3=Netzwerk (M052)
  318                   ;		  4=Headersave, 5..7 frei
  319                   ;	 BIT 5: Tastenclick ein/aus
  320                   ;	 BIT 6: Code kommt von F-Taste
  321                   ;	 BIT 7: 0=Shiftlock
  322                   ; IX+9	Prologbyte (normal 7FH)
  323                   ; IX+10	Autorepeatzaehler (Tastatur)
  324                   ; IX+11	Merkzelle fuer Akku (bei BWS on/off mit Stackverlagerung)
  325                   ;	und Pruefsummenberechnung fuer MB-Eingabe
  326                   ; IX+12	7-Bit-Scancode von Tastatur
  327                   ; IX+13	ASCII-Code von Tastatur
  328                   ; IX+14	Tastaturcodetabelle low

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   9
EQU46   INC

  329                   ; IX+15	Tastaturcodetabelle high
  137                   
  138                   	.PHASE	0C000H
  139                   
  140                   	INCLUDE	CC46.INC	; ROM-C (C000-CFFF)
    1                   ;*****************************************
    2                   ;**	CAOS 4.6	ROM C		**
    3                   ;**					**
    4                   ;**	Adresse:  C000h bis CFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 04.03.2016	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0C000H
   10                   
   11                   ;
   12                   ; IRM-Defaulttabelle:
   13                   ;
   14 C000  F4CB        KCTAB1:	DW	NOOP		; Hardcopy-Adresse
   15 C002  00          WIN0:	DB	0		; WINNR
   16 C003  0000        	DW	0		; WINON
   17 C005  2028        	DW	2028H		; WINLG
   18 C007  0000        	DW	0		; CURSO
   19 C009  00          	DB	0		; STBT
   20 C00A  39          	DB	39H		; COLOR
   21 C00B  E26E        	DW	SCRLPG		; WEND
   22 C00D  EE00        WIN1:	DW	0EE00H		; CCTL0
   23 C00F  FE00        	DW	0FE00H		; CCTL1
   24 C011  EE00        	DW	0EE00H		; CCTL2
   25 C013  FE00        	DW	0FE00H		; CCTL3
   26 C015  01C4        	DW	1C4H		; SYSP
   27 C017  AA00        	DW	SUT_IRM		; SUTAB
   28 C019  FCB8        	DW	CRTTAB		; CTAB
   29 C01B  D3 88       	OUT	(PIOAD),A	; BJUMP
   30 C01D  C3 F012     	JP	0F012H
   31 C020  FC14        	DW	ZEI0		; OUTAB
   32 C022  FC18        	DW	ZEI4		; INTAB
   33 C024  C3 F4CB     	JP	NOOP		; UOUT1
   34 C027  C3 F4CB     	JP	NOOP		; UIN1
   35 C02A  C3 F4CB     	JP	NOOP		; UOUT2
   36 C02D  C3 F4CB     	JP	NOOP		; UIN2
   37 C030  DC82        	DW	0DC82H		; IOERR (BASIC)
   38 C032  B200        	DW	VRAM0		; VRAM=0B200H (Bild 0)
   39                   
   40 C034  47 0C       KCTAB2:	DB	47H,0CH		; CTC2 (blinken)
   41 C036  FC9C        	DW	ESCTAB		; L3TAB
   42 C038  0E          	DB	14		; L3SIZ (0-D)
   43 C039  05          	DB	5		; COUNT
   44 C03A  00          	DB	0		; HCPZ
   45 C03B  A801        	DW	0A801H		; INTV1
   46 C03D  08          	DB	8		; INTV1L
   47 C03E  A809        	DW	0A809H		; INTV2
   48 C040  09          	DB	9		; INTV2L
   49 C041  EE          	DB	11101110b	; HCPZ2 (8 Bit, Senden ein)
   50 C042  C3 F4CB     	JP	NOOP		; OFILT
   51 C045  25          	DB	'%'		; PROMPT
   52 C046  FF          	DB	0FFH		; LINTYP
   53 C047  EFD8        	DW	0EFD8H		; CUMUST

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  10
CC46    INC

   54 C049  A894        	DW	JOYIRM		; JOYTAB
   55                   
   56                   ; Modulschaltzustaende (interne Module):
   57                   
   58 C04B  03          KCTAB3:	DB	3	; RAM0
   59 C04C  01          	DB	1	; IRM
   60 C04D  00          	DB	0	; USER-ROMC
   61 C04E  03          	DB	3	; RAM8
   62 C04F  03          	DB	3	; RAM4
   63 C050  00          	DB	0	; CAOSC
   64 C051              KCTAB4:
   65                   ;
   66                   ; Grundinitialisierung ohne Speicher loeschen, ausser:
   67                   ; VRAM0/1, Kassettenpuffer, Monitor-RAM, Modulsteuerwortspeicher
   68                   ; Joystick wird hier neu initialisiert (bei RESET nicht)
   69                   ;
   70 C051  7F7F        	DW	7F7Fh
   71 C053  4E 45 57 20 	DB	'NEW ',1	; Menuewort versteckt, IRM ein
   72 C058  F3          	DI
   73 C059  31 B900     	LD	SP,MODST+100H	; Loeschbereich AD00h..B8FFh
   74 C05C  01 0600     	LD	BC,600h		; Anzahl = 6 * 256 Wort = 0C00h
   75 C05F  18 07       	JR	PWRC0
   76                   ;
   77                   ; Power-ON Initialisierung:
   78                   ;
   79 C061  F3          PWRONC:	DI
   80 C062  31 C000     	LD	SP,0C000H	; Loeschbereich 0..BFFFh
   81 C065  01 6000     	LD	BC,6000H	; Anzahl = 60h * 256 Wort = C000h
   82 C068  61          PWRC0:	LD	H,C
   83 C069  69          	LD	L,C		; HL=0
   84 C06A  E5          PWRC1:	PUSH	HL		; schnelles Speicher loeschen
   85 C06B  0D          	DEC	C
   86 C06C  20 FC       	JR	NZ,PWRC1
   87 C06E  10 FA       	DJNZ	PWRC1
   88 C070  31 01C4     	LD	SP,01C4H	; System-Stackpointer
   89 C073  0E 80       	LD	C,80h		; alle Module abschalten (B=0 von DJNZ)
   90 C075  ED 69       PWRC2:	OUT	(C),L		; L=0 vom vorhergehenden Speicherloeschen
   91                   				; war vorher ED 71 = OUT (C),0
   92 C077  10 FC       	DJNZ	PWRC2
   93 C079  CD C0A1     	CALL	SYSI		; Systeminitialisierung (Rueckkehr mit EI)
   94 C07C  21 D94E     	LD	HL,JOYTBD	; vorbereitete Joystick-Tabelle
   95 C07F  11 A894     	LD	DE,JOYIRM	; JOYTAB-Standardadresse im IRM
   96 C082  01 000C     	LD	BC,12
   97 C085  ED B0       	LDIR			; Tabelle in den IRM kopieren
   98 C087  AF          	XOR	A		; Fenster Nr. 0
   99 C088  32 B79B     PWRC3:	LD	(WINNR),A	; Nr. eintragen
  100 C08B  CD C5BB     	CALL	WCOPY		; Fenstervektorspeicher initialisieren
  101 C08E  3C          	INC	A
  102 C08F  FE 0A       	CP	10		; fuer 10 Fenster (0-9)
  103 C091  38 F5       	JR	C,PWRC3
  104 C093  CD F97F     	CALL	ESC3		; Anzeige Bild 0, Zugriff Bild 1
  105 C096  3E 0C       	LD	A,0CH
  106 C098  CD E091     	CALL	CRT		; Bild 1: CLS
  107 C09B  CD F975     	CALL	ESC1		; Anzeige+Zugriff Bild 0
  108 C09E  C3 F170     	JP	PWR4		; weiter im ROM-F ...
  109                   ;
  110                   ; System-Initialisierung (bei PWRON und RESET):
  111                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  11
CC46    INC

  112 C0A1  F3          SYSI:	DI
  113 C0A2  ED 5E       	IM	2
  114 C0A4  21 D91A     	LD	HL,IOTAB1	; PIO A,B und 84H/86H
  115 C0A7  CD F564     	CALL	INIMEX		; Ports initialisieren
  116 C0AA  DD 21 01F0  	LD	IX,1F0H
  117 C0AE  DD 36 01 28 	LD	(IX+1),28H	; OUT84-Merker
  118 C0B2  DD 36 04 E3 	LD	(IX+4),0E3H	; OUT86-Merker
  119 C0B6  DD 36 08 80 	LD	(IX+8),80H	; Defaultbelegung (Kassette, kein CAPS-Lock)
  120 C0BA  11 B799     	LD	DE,HCADR
  121 C0BD  21 C000     	LD	HL,KCTAB1	; Defaulttabelle
  122 C0C0  01 0034     	LD	BC,KCTAB2-KCTAB1; fuer IRM-Arbeitszellen
  123 C0C3  ED B0       	LDIR			; 1. Teil in IRM kopieren
  124 C0C5  1E DB       	LD	E,LOW(CTCMD)	; (D war 0B7h)
  125 C0C7  0E 17       	LD	C,KCTAB3-KCTAB2	; (B war 0)
  126 C0C9  ED B0       	LDIR			; 2. Teil in IRM kopieren
  127 C0CB  11 B800     	LD	DE,MODST	; Modulsteuerbytespeicher
  128 C0CE  3A B804     	LD	A,(MODST+4)	; RAM4 aktueller Schaltzustand
  129 C0D1  E6 04       	AND	4		; RAM4-Ebene herausloesen
  130 C0D3  0E 06       	LD	C,KCTAB4-KCTAB3	; (B war 0)
  131 C0D5  ED B0       	LDIR			; 3. Teil in IRM kopieren
  132 C0D7  21 B804     	LD	HL,MODST+4
  133 C0DA  B6          	OR	(HL)		; RAM4 bisherige Ebene wieder einbauen
  134 C0DB  77          	LD	(HL),A
  135 C0DC  3E 01       	LD	A,1		; Standardwert fuer IXH- und I-Register
  136 C0DE  F5          SIXC:	PUSH	AF
  137                   
  138                   ; CAOS 4.6 - SUTAB vom ROM in den IRM kopieren:
  139                   
  140 C0DF  11 AA00     	ld	de,SUT_IRM	; SUTAB im IRM
  141 C0E2  21 D844     	ld	hl,SUTB		; SUTAB im ROM
  142 C0E5  0E 96       	ld	c,SUEND-SUTB	; Laenge (B war 0)
  143 C0E7  ED B0       	LDIR			; SUTAB zur Nutzung in den IRM kopieren
  144                   
  145                   ; CAOS 4.6 - Device-Treibertabellen erzeugen
  146                   
  147 C0E9  11 A900     	LD	DE,DEVTAB	; Treibertabelle(n) im IRM aufbauen
  148 C0EC  3E 08       	LD	A,8		; fuer 8 Treiber
  149 C0EE  21 D8DA     DINIT:	LD	HL,DRV0		; zunaechst den Kassettentreiber
  150 C0F1  01 0020     	LD	BC,32		; je 32 Byte (Groesse festgeschrieben)
  151 C0F4  ED B0       	LDIR			; kopieren
  152 C0F6  3D          	DEC	A		; alle 8 Treiber auf Kassette initialisieren
  153 C0F7  20 F5       	JR	NZ,DINIT
  154 C0F9  32 A900     	LD	(DEVTAB),A	; Tape-Treiber mit '0' aktivieren
  155                   
  156                   ; Suche D004 mit CAOS-Betriebsart (Treiber 1):
  157                   
  158 C0FC  01 FC80     	LD	BC,0FC80H	; Modulsteckplatz FC
  159 C0FF  ED 78       	IN	A,(C)
  160 C101  FE A7       	CP	0A7H		; Floppy vorhanden?
  161 C103  20 20       	JR	NZ,NODISK
  162 C105  3E 04       	LD	A,4		; nur Kopplung einschalten
  163 C107  32 B8FC     	LD	(MODST+0FCH),A	; in Modulsteuerbytespeicher eintragen
  164 C10A  ED 79       	OUT	(C),A		; und schalten
  165 C10C  01 B3F3     	LD	BC,UROK		; 0B3F3H
  166 C10F  ED 78       	IN	A,(C)
  167 C111  FE 05       	CP	5		; CAOS-Betriebsart?
  168 C113  20 10       	JR	NZ,NODISK
  169 C115  21 D8FA     	LD	HL,DRV1		; Floppy-Treiber

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  12
CC46    INC

  170 C118  11 A920     	LD	DE,DEVTAB+32	; als Treiber Nr. 1
  171 C11B  01 0020     	LD	BC,32
  172 C11E  ED B0       	LDIR			; in Treibertabelle kopieren
  173 C120  3E 01       	LD	A,1
  174 C122  CD D676     	CALL	SET_DD		; und gleich aktivieren!
  175 C125  F1          NODISK:	POP	AF
  176                   ;	LD	A,1		; Standardwert fuer IXH- und I-Register
  177 C126  21 D95A     	LD	HL,ISRTAB
  178 C129  F3          	DI
  179 C12A  32 B7D7     	LD	(MIXIT),A	; neuer Wert fuer IXH- und I-Register
  180 C12D  1E E0       	LD	E,0E0H
  181 C12F  57          	LD	D,A
  182 C130  01 0010     	LD	BC,10H		; Interrupttabelle
  183 C133  ED B0       	LDIR			; kopieren aus dem ROM nach xxE0h bis xxF0h
  184 C135  DD 66 01    	LD	H,(IX+1)	; alte Merker
  185 C138  DD 6E 04    	LD	L,(IX+4)	; mitnehmen
  186 C13B  D5          	PUSH	DE		; neuer Wert fuer IX = xxF0h
  187 C13C  DD E1       	POP	IX
  188 C13E  DD 7E 08    	LD	A,(IX+8)
  189 C141  E6 1C       	and	00011100b	; DEVICE-Nr. erhalten
  190 C143  F6 80       	or	10000000b	; kein CAPS-Lock
  191 C145  DD 77 08    	LD	(IX+8),A
  192 C148  DD 74 01    	LD	(IX+1),H	; mitgenommene Merker neu eintragen
  193 C14B  DD 75 04    	LD	(IX+4),L
  194 C14E  DD 36 0E 1C 	LD	(IX+14),LOW(KTAB)
  195 C152  DD 36 0F FC 	LD	(IX+15),HIGH(KTAB)
  196 C156  DD 36 09 7F 	LD	(IX+9),7FH	; Standard-Prologbyte
  197 C15A  ED 5E       	IM	2
  198 C15C  3A B7D7     	LD	A,(MIXIT)
  199 C15F  ED 47       	LD	I,A		; I-Register aktualisieren
  200 C161  21 D934     	LD	HL,IOTAB2	; PIO A,B und CTC
  201 C164  CD F564     	CALL	INIMEX		; Ports neu initialisieren
  202 C167  21 EDCD     	LD	HL,CENINI
  203 C16A  CD F564     	CALL	INIMEX		; M021 initialisieren
  204 C16D  CD F552     	CALL	KPUFF		; Kassettenpuffer definieren
  205 C170  FB          	EI
  206 C171  C9          	RET
  207                   
  208                   ; Systemcheck oder Modulkontrollanzeige (interne Module):
  209                   
  210 C172              SYSTC:
  211                   ;	PUSH	DE
  212 C172  CD F0CE     	CALL	OSTR
  213 C175  2D 2D 20 2D 	DB	'-- -- -- CAOSE',0
  214 C184  DB 88       	IN	A,(PIOAD)
  215 C186  E6 01       	AND	1		; CY=0, Z=?
  216 C188  CD D3B4     	CALL	WONOF		; Bit 0
  217 C18B  2E 00       	LD	L,0		; ab Platz 0
  218 C18D  3E 01       SYST0:	LD	A,1		; lesen
  219 C18F  CD C36D     	CALL	MODUC
  220 C192  CD C24B     	CALL	LHD		; Anzeige Steckplatz, Kennbyte, Steuerbyte
  221                   
  222 C195  7D          	LD	A,L		; nach Steckplatz verzweigen
  223 C196  A7          	AND	A
  224 C197  20 12       	JR	NZ,SYST1
  225                   ; 0
  226 C199  CD F0CE     	CALL	OSTR
  227 C19C  52 41 4D 30 	DB	'RAM0',0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  13
CC46    INC

  228 C1A1  DB 88       	IN	A,(PIOAD)
  229 C1A3  E6 0F       	AND	00001111b
  230 C1A5  FE 08       	CP	00001000b	; CY=NOT(Bit 3)
  231 C1A7  CB 4F       	BIT	1,A		; Schaltzustand
  232 C1A9  18 1D       	JR	WONOF1
  233                   ; 1
  234 C1AB  3D          SYST1:	DEC	A
  235 C1AC  20 1C       	JR	NZ,SYST2
  236 C1AE  CD F0CE     	CALL	OSTR
  237 C1B1  42 49 4C 44 	DB	'BILD ',0
  238 C1B7  DD 7E 01    	LD	A,(IX+1)
  239 C1BA  E6 04       	AND	00000100b	; Zugriffs-Bit
  240 C1BC  0F          	RRCA		
  241 C1BD  0F          	RRCA
  242 C1BE  C6 30       	ADD	A,'0'
  243 C1C0  CD F3E5     	CALL	OCHR		; Bildnummer
  244 C1C3  3A B801     	LD	A,(MODST+1)
  245 C1C6  E6 01       	AND	1		; IRM on?
  246 C1C8  18 76       WONOF1:	JR	SYST6
  247                   ; 2
  248 C1CA  3D          SYST2:	DEC	A
  249 C1CB  20 1C       	JR	NZ,SYST3
  250 C1CD  CD F0CE     	CALL	OSTR
  251 C1D0  55 53 45 52 	DB	'USER ',0
  252 C1D6  DD 7E 04    	LD	A,(IX+4)
  253 C1D9  07          	RLCA			; Bits 5,6
  254 C1DA  07          	RLCA
  255 C1DB  07          	RLCA			; nach Bits 0,1
  256 C1DC  E6 03       	AND	3
  257 C1DE  EE 33       	XOR	'3'
  258 C1E0  CD F3E5     	CALL	OCHR		; Ebene ausgeben
  259 C1E3  DB 88       	IN	A,(PIOAD)
  260 C1E5  E6 80       	AND	10000000b	; CY=0, Z=NOT(Bit 7)
  261 C1E7  18 57       	JR	SYST6
  262                   ; 3
  263 C1E9  3D          SYST3:	DEC	A
  264 C1EA  20 22       	JR	NZ,SYST4
  265 C1EC  CD F0CE     	CALL	OSTR
  266 C1EF  52 41 4D 38 	DB	'RAM8',0
  267 C1F4  3E 20       	LD	A,' '
  268 C1F6  CD F3E5     	CALL	OCHR
  269 C1F9  DD 7E 01    	LD	A,(IX+1)
  270 C1FC  0F          	RRCA			; Bits 4,5,6,7
  271 C1FD  0F          	RRCA
  272 C1FE  0F          	RRCA
  273 C1FF  0F          	RRCA			; nach 0,1,2,3
  274                   ;	AND	0FH		; redundant: bereits in AHEX0
  275 C200  D6 02       	SUB	2
  276 C202  CD F3DD     	CALL	AHEX0		; Ebene ausgeben
  277 C205  DB 89       	IN	A,(PIOBD)
  278 C207  CB 6F       	BIT	5,A		; Schaltzustand
  279 C209  07          	RLCA			; Schreibschutz (Bit 6)
  280 C20A  07          	RLCA			; ins Carry-Flag rotieren
  281 C20B  3F          	CCF			; und invertieren
  282 C20C  18 32       	JR	SYST6
  283                   ; 4
  284 C20E  3D          SYST4:	DEC	A
  285 C20F  20 21       	JR	NZ,SYST5

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  14
CC46    INC

  286 C211  CD F0CE     	CALL	OSTR
  287 C214  52 41 4D 34 	DB	'RAM4',0
  288 C219  CD F3CC     	CALL	SPACE
  289 C21C  3A B804     	LD	A,(MODST+4)
  290 C21F  0F          	RRCA
  291 C220  0F          	RRCA			; Bit 2
  292 C221  E6 01       	AND	1
  293 C223  C6 30       	ADD	A,'0'
  294 C225  CD F3E5     	CALL	OCHR		; Ebene 0/1
  295 C228  DD 7E 04    	LD	A,(IX+4)
  296 C22B  CB 47       	BIT	0,A		; Schaltzustand
  297 C22D  0F          	RRCA			; Schreibschutz (Bit 1)
  298 C22E  0F          	RRCA			; ins Carry-Flag rotieren
  299 C22F  3F          	CCF			; und invertieren
  300 C230  18 0E       	JR	SYST6
  301                   ; 5
  302 C232  CD F0CE     SYST5:	CALL	OSTR
  303 C235  43 41 4F 53 	DB	'CAOSC',0
  304 C23B  3A B805     	LD	A,(MODST+5)
  305 C23E  E6 01       	AND	1
  306 C240  CD D3B4     SYST6:	CALL	WONOF
  307 C243  2C          	INC	L		; Steckplatz+1
  308 C244  3E 06       	LD	A,6
  309 C246  BD          	CP	L
  310 C247  C2 C18D     	JP	NZ,SYST0	; bei 06 abbrechen
  311                   ;	POP	DE
  312 C24A  C9          	RET
  313                   
  314                   ; Anzeige Steckplatz, Kennbyte, Steuerbyte
  315                   
  316 C24B  7D          LHD:	LD	A,L
  317 C24C  CD F3C9     	CALL	AHSPC		; Steckplatz
  318 C24F  7C          	LD	A,H
  319 C250  CD F3C9     	CALL	AHSPC		; Kennbyte
  320 C253  7A          	LD	A,D
  321 C254  C3 F3C9     	JP	AHSPC		; Steuerbyte
  322                   
  323                   ; Modulkontrollanzeige (externe Module):
  324                   
  325 C257              MODULC:
  326                   ;	PUSH	DE
  327 C257  AF          	XOR	A
  328 C258  D3 91       	OUT	(91h),A		; M008 PIO-B Daten
  329 C25A  DB 91       	IN	A,(91h)
  330 C25C  A7          	AND	A
  331 C25D  20 16       	JR	NZ,MODC0
  332 C25F  CD F0CE     	CALL	OSTR
  333 C262  2D 2D 20 2D 	DB	'-- -- -- JOY/CEN'
  334 C272  0D 0A 00    	DB	0Dh,0Ah,0
  335 C275  2E 07       MODC0:	LD	L,7		; ab Platz 7
  336 C277  E5          MODC1:	PUSH	HL
  337 C278  3E 01       	LD	A,1		; lesen
  338 C27A  CD C36D     	CALL	MODUC
  339 C27D  7C          	LD	A,H
  340 C27E  3C          	INC	A		; Kennbyte=FFh?
  341 C27F  28 36       	JR	Z,MODC2		; kein ext. Modul
  342                   
  343 C281  CD C24B     	CALL	LHD		; Anzeige Steckplatz, Kennbyte, Steuerbyte

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  15
CC46    INC

  344                   
  345 C284  4C          	LD	C,H
  346 C285  7C          	ld	a,h
  347 C286  FE F3       	cp	0f3h		; M062?
  348 C288  28 32       	jr	z,M062		; Test ob RAM- oder ROM-Version
  349 C28A  FE FB       	cp	0fbh		; Software-Modul?
  350 C28C  28 50       	jr	z,slot		; Inhalt analysieren!
  351 C28E  FE FD       	cp	0fdh		; M052?
  352 C290  CA C302     	jp	z,M052		; Test, welche Variante vorliegt
  353 C293  21 CFCD     	ld	hl,muser
  354 C296  FE C0       	cp	0c0h
  355 C298  38 04       	jr	c,modcd		; kleiner als C0
  356 C29A  FE D8       	cp	0d8h
  357 C29C  38 13       	jr	c,modca		; USER-Modul von C0-D7
  358 C29E  21 CEA4     modcd:	LD	HL,MTAB
  359 C2A1  7E          MODCC:	LD	A,(HL)
  360 C2A2  23          	INC	HL
  361 C2A3  FE FF       	CP	0FFH		; Tabelle durchsucht?
  362 C2A5  28 0A       	JR	Z,MODCA
  363 C2A7  B9          	CP	C		; Strukturbyte in Tabelle MTAB?
  364 C2A8  28 07       	JR	Z,MODCA		; Text gefunden
  365 C2AA  7E          MODCB:	LD	A,(HL)
  366 C2AB  23          	INC	HL
  367 C2AC  A7          	AND	A		; Stringende?
  368 C2AD  20 FB       	JR	NZ,MODCB
  369 C2AF  18 F0       	JR	MODCC
  370                   	;
  371 C2B1  CD F91D     MODCA:	CALL	ZKOUT		; Modulname
  372 C2B4  CD F4E7     slot7:	CALL	CRLF
  373 C2B7  E1          MODC2:	POP	HL
  374 C2B8  2C          	INC	L		; Steckplatz+1
  375 C2B9  20 BC       	JR	NZ,MODC1	; bis FFh
  376                   ;	POP	DE
  377 C2BB  C9          	RET
  378                   
  379                   ; Test, ob M062 als 8*8K ROM oder 4*8K RAM vorliegt.
  380                   ; Zur Unterscheidung wird ein RAM-Test durchgefuehrt
  381                   ;
  382                   ; PE:	L=Steckplatz	H=Kennbyte = 0FBH
  383                   
  384 C2BC  CD C341     M062:	call	SLOT1		; Modul auf 4000h einblenden
  385                   ;	ld	hl,4000h	; RAM-Inhalt lesen
  386 C2BF  7E          	ld	a,(hl)
  387 C2C0  34          	inc	(hl)		; Inhalt veraendern
  388 C2C1  BE          	cp	(hl)		; RAM oder ROM
  389 C2C2  77          	ld	(hl),a		; regenerieren
  390 C2C3  21 CFE7     	ld	hl,M062B	; ROM
  391 C2C6  28 03       	jr	z,slo2
  392 C2C8  21 CFDE     	ld	hl,M062A	; RAM
  393 C2CB  CD F91D     slo2:	call	zkout
  394                   	;
  395 C2CE  21 B804     slot5:	ld	hl,modst+4	; beginnend ab RAM4
  396 C2D1  56          slot6:	ld	d,(hl)		; gespeicherter Schaltzustand
  397 C2D2  E5          	push	hl
  398 C2D3  3E 02       	ld	a,2		; schalten
  399 C2D5  CD C36D     	call	MODUC		; Schaltzustaende nach Tabelle regenerieren
  400 C2D8  E1          	pop	hl
  401 C2D9  2C          	inc	l		; naechster Steckplatz

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  16
CC46    INC

  402 C2DA  20 F5       	jr	nz,slot6
  403 C2DC  18 D6       	jr	slot7
  404                   
  405                   ; Suche nach Inhalt der Softwaremodule M012, M026, M027 usw.
  406                   ; Es wird das erste Menwort gesucht, und dieses als Name angezeigt!
  407                   ; PE:	L=Steckplatz	H=Kennbyte = 0FBH
  408                   
  409 C2DE  CD C341     slot:	call	SLOT1		; Modul auf 4000h einblenden
  410                   ;	ld	hl,4000h	; Suchbereich Beginn
  411 C2E1  11 CFCC     	ld	de,MTAB2	; Vergleichskette 0-String
  412 C2E4  01 2000     	ld	bc,2000h	; 8K durchsuchen
  413 C2E7  CD F359     	call	zs0		; erstes Menuewort suchen
  414 C2EA  38 05       	jr	c,slot2		; Menuewort gefunden
  415 C2EC  21 CFC4     	ld	hl,mtab1	; ansonsten als "Software" anzeigen
  416 C2EF  18 07       	jr	slot4
  417                   	;
  418 C2F1  2B          slot2:	dec	hl
  419 C2F2  7E          	ld	a,(hl)
  420 C2F3  FE 7F       	cp	7fh		; zurueck bis zu Prologbyte
  421 C2F5  20 FA       	jr	nz,slot2
  422 C2F7  23          slot3:	inc	hl
  423 C2F8  7E          slot4:	ld	a,(hl)
  424 C2F9  FE 20       	cp	20h		; Epilog?
  425 C2FB  38 D1       	jr	c,slot5		; ja
  426 C2FD  CD F3E5     	call	ochr		; Menuewort anzeigen
  427 C300  18 F5       	jr	slot3
  428                   
  429                   ; Testen welche Variante des M052 vorliegt. Dazu werden die Datenports von der
  430                   ; Netzwerk-PIO gelesen und falls ein Wert ungleich FFh kommt, von einem
  431                   ; Kombimodul mit USB+Netzwerk ausgegangen.
  432                   ; M052-Portadressen: 28h..2Bh Netzwerk-PIO / 2Ch..2Fh USB-PIO
  433                   ;
  434                   ; PE:	L=Steckplatz	H=Kennbyte = 0FDH
  435                   
  436 C302  26 B8       M052:	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
  437 C304  7E          	ld	a,(hl)		; aktueller Zustand
  438 C305  CB D7       	set	2,a		; PIO's ein
  439 C307  45          	ld	b,l		; Steckplatz
  440 C308  0E 80       	ld	c,80h
  441 C30A  ED 79       	out	(c),a		; PIO's des M052 einschalten
  442                   ;	LD	d,(hl)		; aktueller Zustand
  443                   ;	set	2,d		; PIO's ein
  444                   ;	ld	a,2
  445                   ;	call	MODUC		; M052-PIO's einschalten
  446 C30C  21 CFD2     	ld	hl,M052A
  447 C30F  DB 28       	in	a,(28h)		; M052 PIO NET Daten A
  448 C311  3C          	inc	a
  449 C312  20 08       	jr	nz,M052N1	; Netzwerk-PIO gefunden
  450 C314  DB 29       	in	a,(29h)		; M052 PIO NET Daten B
  451 C316  3C          	inc	a
  452 C317  20 03       	jr	nz,M052N1	; Netzwerk-PIO gefunden
  453 C319  21 CFDA     	ld	hl,M052B
  454 C31C  18 AD       M052N1:	JR	SLO2		; Modulname anzeigen, Schaltzustaende regen.
  455                   
  456                   ; Module lesen und schalten (Menuewort):
  457                   
  458 C31E  53          SWIC:	LD	D,E		; Steuerbyte
  459 C31F  2D          	DEC	L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  17
CC46    INC

  460 C320  20 0C       	JR	NZ,SWI2		; nicht IRM
  461 C322  FE 01       	CP	1
  462 C324  28 08       	JR	Z,SWI2		; nur lesen
  463 C326  2C          	INC	L
  464 C327  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
  465 C329  72          	LD	(HL),D		; IRM eintragen!
  466 C32A  26 FF       	LD	H,0FFH
  467 C32C  18 04       	JR	SWI3
  468 C32E  2C          SWI2:	INC	L
  469 C32F  CD C36D     	CALL	MODUC		; lesen/schalten
  470 C332  7D          SWI3:	LD	A,L
  471 C333  CD F3C9     	CALL	AHSPC		; Platz anzeigen
  472 C336  7C          	LD	A,H
  473 C337  CD F3C9     	CALL	AHSPC		; Kennbyte
  474 C33A  7A          	LD	A,D
  475 C33B  CD F3D4     	CALL	AHEX		; Steuerbyte
  476 C33E  C3 F4E7     	JP	CRLF
  477                   
  478                   ; Modul auf Adresse 4000h einblenden
  479                   ; (fuer M012, M026, M027 und M062)
  480                   ; PA:	HL = 4000h fuer folgende Operationen
  481                   
  482 C341  16 00       SLOT1:	LD	D,0		; Modul abschalten
  483 C343  7D          	ld	a,l		; Steckplatz, der zu untersuchen ist
  484 C344  01 0880     	ld	bc,0880h	; alle Module von 8 bis L abschalten
  485 C347  ED 51       slo1:	OUT	(C),D		; D=0
  486                   				; war vorher ED 71 = OUT (C),0
  487 C349  04          	inc	b		; naechster Steckplatz
  488 C34A  B8          	cp	b
  489 C34B  20 FA       	jr	nz,slo1
  490 C34D  3E 41       	ld	a,41h		; Modul auf 4000h einschalten
  491 C34F  ED 79       	out	(c),a
  492                   	RESIXA	0,4		; RES 0,(IX+4),A
    1 C351  DD CB 04    	 DB	0DDh,0CBh,4
    2 C354  87          	 DB	0 SHL 3 OR 10000111b
  493 C355  D3 86       	OUT	(86H),A		; RAM4 aus!
  494 C357  21 4000     	LD	HL,4000h
  495 C35A  C9          	RET
  496                   
  497                   ; V.24-Modul suchen und einschalten:
  498                   ;
  499                   ; PE:	B	Steckplatz ab dem gesucht wird
  500                   ; PA:	B	Steckplatz des Moduls
  501                   ;	CY = 1	kein M003 vorhanden
  502                   ; VR:	AF, BC, D, HL
  503                   ;
  504 C35B  0E 80       V24SU:	LD	C,80h
  505 C35D  ED 78       V24S1:	IN	A,(C)
  506 C35F  FE EE       	CP	0EEH		; M003?
  507 C361  28 05       	JR	Z,V24S2		; ja
  508 C363  04          	INC	B
  509 C364  20 F7       	JR	NZ,V24S1
  510 C366  37          	SCF			; nicht gefunden
  511 C367  C9          	RET
  512 C368  68          V24S2:	LD	L,B
  513 C369  3E 02       	LD	A,2
  514 C36B  16 01       	LD	D,1
  515                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  18
CC46    INC

  516                   ; Module schalten:
  517                   ;
  518                   ; PE:	A=1	Modultyp lesen (Register L)
  519                   ;	A=2	Modul schalten (Register D und L)
  520                   ;	L	Modulsteckplatz
  521                   ;	D	Modulsteuerbyte neu
  522                   ; PA:	H	Modultyp (Strukturbyte)
  523                   ;	D	Modulsteuerbyte neu
  524                   ;	?	Modulsteuerbyte alt
  525                   ; VR:	AF, H, BC
  526                   
  527 C36D  26 B8       MODUC:	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
  528 C36F  0E 80       	LD	C,80H		; I/O-Adresse
  529 C371  45          	LD	B,L
  530 C372  FE 02       	CP	2		; Parameter?
  531 C374  30 04       	JR	NC,MODU1
  532 C376  56          	LD	D,(HL)		; Schaltzustand aus Steyerbytespeicher lesen
  533 C377  ED 60       RSTRB:	IN	H,(C)		; Strukturbyte aus Modul lesen
  534 C379  C9          	RET
  535                   
  536 C37A  7E          MODU1:	LD	A,(HL)		; alter Zustand
  537 C37B  72          	LD	(HL),D		; eintragen
  538 C37C  67          	LD	H,A		; fuer 2. RAM4
  539 C37D  7D          	LD	A,L
  540 C37E  FE 06       	CP	6		; interne Module?
  541 C380  38 04       	JR	C,MODU2
  542 C382  ED 51       	OUT	(C),D		; Senden Steuerbyte
  543 C384  18 F1       	JR	RSTRB
  544                   
  545 C386  45          MODU2:	LD	B,L		; Steckplatz
  546 C387  04          	INC	B
  547 C388  DB 88       	IN	A,(PIOAD)
  548 C38A  10 0D       	DJNZ	MODU3		; 0: RAM0?
  549 C38C  E6 F5       	AND	11110101b
  550 C38E  67          	LD	H,A
  551 C38F  7A          	LD	A,D
  552 C390  0F          	RRCA			; Bits 0,1 auf 7,0 rotieren
  553 C391  E6 81       	AND	10000001b	; CY = 0
  554 C393  17          	RLA			; 0 einfuegen, CY = Bit 7
  555 C394  17          	RLA			; Bit 0 = CY
  556 C395  07          	RLCA			; auf Bits 1,3 rotieren
  557 C396  B4          	OR	H
  558 C397  18 27       	JR	OUT88
  559                   
  560 C399  10 0A       MODU3:	DJNZ	MODU4		; 1: IRM?
  561 C39B  E6 FB       	AND	11111011b
  562 C39D  CB 42       	BIT	0,D
  563 C39F  28 1F       	JR	Z,OUT88
  564 C3A1  F6 04       	OR	00000100b
  565 C3A3  18 1B       	JR	OUT88
  566                   
  567 C3A5  10 1D       MODU4:	DJNZ	MODU5		; 2: ROMC?
  568 C3A7  7A          	LD	A,D
  569 C3A8  2F          	CPL			; negieren
  570 C3A9  07          	RLCA			; Bits 4..5 auf 5..6 rotieren
  571 C3AA  E6 60       	AND	01100000b	; ausfiltern
  572 C3AC  67          	LD	H,A
  573 C3AD  F3          	DI

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  19
CC46    INC

  574 C3AE  DD 7E 04    	LD	A,(IX+4)
  575 C3B1  E6 9F       	AND	10011111b
  576 C3B3  B4          	OR	H		; einbauen
  577 C3B4  DD 77 04    	LD	(IX+4),A
  578 C3B7  D3 86       	OUT	(86H),A
  579 C3B9  FB          	EI
  580 C3BA  7A          	LD	A,D
  581 C3BB  0F          	RRCA			; CY = Bit 0
  582 C3BC  DB 88       	IN	A,(PIOAD)
  583 C3BE  17          	RLA			; als Bit 0 einschieben
  584 C3BF  0F          	RRCA			; und auf Bit 7 rotieren
  585 C3C0  D3 88       OUT88:	OUT	(PIOAD),A
  586 C3C2  18 27       	JR	STBFF
  587                   
  588 C3C4  10 28       MODU5:	DJNZ	MODU6		; 3: RAM8?
  589 C3C6  3E 03       	LD	A,00000011b
  590 C3C8  A2          	AND	D
  591 C3C9  0F          	RRCA			; Bits 0..1 auf 5..6 rotieren
  592 C3CA  0F          	RRCA
  593 C3CB  0F          	RRCA
  594 C3CC  67          	LD	H,A
  595 C3CD  F3          	DI
  596 C3CE  DB 89       	IN	A,(PIOBD)
  597 C3D0  E6 9F       	AND	10011111b
  598 C3D2  B4          	OR	H
  599 C3D3  D3 89       	OUT	(PIOBD),A
  600 C3D5  FB          	EI
  601 C3D6  7A          	LD	A,D
  602 C3D7  07          	RLCA			; Bits 2..5 auf 4..7 rotieren
  603 C3D8  07          	RLCA
  604 C3D9  C6 20       	ADD	A,20h		; Segment-Verschiebung
  605 C3DB  E6 F0       	AND	0F0h
  606 C3DD  67          	LD	H,A
  607 C3DE  F3          	DI
  608 C3DF  DD 7E 01    	LD	A,(IX+1)
  609 C3E2  E6 0F       	AND	0Fh
  610 C3E4  B4          	OR	H		; RAM8-Segment
  611 C3E5  D3 84       	OUT	(84h),A
  612 C3E7  DD 77 01    	LD	(IX+1),A
  613 C3EA  FB          STBFFI:	EI
  614 C3EB  26 FF       STBFF:	LD	H,0FFh		; internes Modul melden
  615 C3ED  C9          	RET
  616                   
  617 C3EE  10 FB       MODU6:	DJNZ	STBFF		; 5=CAOSC
  618 C3F0  7A          	LD	A,D		; 4=RAM4
  619 C3F1  AC          	XOR	H
  620 C3F2  E6 04       	AND	4		; Aenderung?
  621 C3F4  F3          	DI
  622 C3F5  28 3F       	JR	Z,RAM41
  623 C3F7  DD 7E 04    	LD	A,(IX+4)
  624 C3FA  F6 03       	OR	3
  625 C3FC  D3 86       	OUT	(86H),A		; RAM4 on
  626 C3FE  D5          	PUSH	DE
  627 C3FF  E5          	PUSH	HL
  628 C400  DB 88       	IN	A,(PIOAD)
  629 C402  F5          	PUSH	AF
  630 C403  CB 87       	RES	0,A
  631 C405  D3 88       	OUT	(PIOAD),A	; CAOSE off

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  20
CC46    INC

  632 C407  DD 7E 01    	LD	A,(IX+1)
  633 C40A  F5          	PUSH	AF
  634 C40B  E6 F9       	AND	11111001b
  635 C40D  2E 03       	LD	L,3		; 3 IRM-Ebenen
  636 C40F  01 1000     	LD	BC,1000H	; 800H frei!
  637 C412  11 4000     	LD	DE,4000H
  638 C415  C6 02       R4IS:	ADD	A,2
  639 C417  D3 84       	OUT	(84H),A		; IRM-Ebene
  640 C419  67          	LD	H,A
  641 C41A  E5          	PUSH	HL
  642 C41B  21 A800     	LD	HL,0A800H
  643 C41E  1A          R4MV:	LD	A,(DE)
  644 C41F  ED A0       	LDI
  645 C421  2B          	DEC	HL
  646 C422  77          	LD	(HL),A
  647 C423  23          	INC	HL
  648 C424  EA C41E     	JP	PE,R4MV
  649 C427  E1          	POP	HL
  650 C428  7C          	LD	A,H
  651 C429  06 18       	LD	B,18H		; jetzt 1800H!
  652 C42B  2D          	DEC	L
  653 C42C  20 E7       	JR	NZ,R4IS
  654 C42E  F1          	POP	AF
  655 C42F  D3 84       	OUT	(84H),A		; IRM wie zuvor
  656 C431  F1          	POP	AF
  657 C432  D3 88       	OUT	(PIOAD),A	; CAOSE on
  658 C434  E1          	POP	HL
  659 C435  D1          	POP	DE
  660 C436  DD 7E 04    RAM41:	LD	A,(IX+4)
  661 C439  AA          	XOR	D
  662 C43A  E6 FC       	AND	11111100b	; Bits 0..1: a = (0 XOR d) = d
  663 C43C  AA          	XOR	D		; Bits 2..7: a = (a XOR d) XOR d
  664 C43D  DD 77 04    	LD	(IX+4),A
  665 C440  D3 86       	OUT	(86h),A
  666 C442  18 A6       	JR	STBFFI
  667                   
  668                   ; F-Taste belegen:
  669                   
  670 C444  21 B900     KEYC:	LD	HL,0B900H
  671 C447  A7          	AND	A
  672 C448  20 07       	JR	NZ,KEY0
  673 C44A  06 9C       	LD	B,9CH
  674 C44C  77          KEYCL:	LD	(HL),A		; loeschen
  675 C44D  2C          	INC	L
  676 C44E  10 FC       	DJNZ	KEYCL
  677 C450  C9          	RET
  678                   	;
  679 C451  FE 10       KEY0:	CP	16
  680 C453  D0          	RET	NC		; nur F1 bis FF
  681 C454  47          	LD	B,A
  682 C455  F6 F0       	OR	0F0H
  683 C457  4F          	LD	C,A
  684 C458  7E          KEY1:	LD	A,(HL)		; B Dummys auszaehlen
  685 C459  2C          	INC	L
  686 C45A  C8          	RET	Z
  687 C45B  A7          	AND	A
  688 C45C  20 FA       	JR	NZ,KEY1
  689 C45E  10 F8       	DJNZ	KEY1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  21
CC46    INC

  690 C460  7D          	LD	A,L
  691 C461  FE 9C       	CP	9CH
  692 C463  D0          	RET	NC
  693 C464  ED 5B B7A0  	LD	DE,(CURSO)
  694 C468  CD C521     	CALL	KEYDI		; praesentieren
  695 C46B  CD F400     KEY2:	CALL	INTB
  696 C46E  FE 13       	CP	13H
  697 C470  20 03       	JR	NZ,KEY3
  698 C472  04          	INC	B		; Umschaltung
  699 C473  18 F6       	JR	KEY2
  700                   	;
  701 C475  CB 40       KEY3:	BIT	0,B
  702 C477  28 0D       	JR	Z,KEY4		; interpretieren
  703 C479  FE 03       	CP	3
  704 C47B  28 70       	JR	Z,KEY12		; BRK=Abbruch
  705 C47D  FE 0D       	CP	CR
  706 C47F  28 0A       	JR	Z,KEY5		; Enter=belegen
  707 C481  CD F3E5     	CALL	OCHR
  708 C484  18 E5       	JR	KEY2
  709                   	;
  710 C486  CD F798     KEY4:	CALL	CSTBT
  711 C489  18 E0       	JR	KEY2
  712                   	;
  713 C48B  E5          KEY5:	PUSH	HL		; Pos. in Puffer
  714 C48C  CD E06D     	CALL	DABR
  715 C48F  EB          	EX	DE,HL
  716 C490  CD F4F7     	CALL	RHEX		; Fn lesen
  717 C493  E1          	POP	HL
  718 C494  38 06       	JR	C,KERR		; Formatfehler
  719 C496  3A B797     	LD	A,(NUMVX)
  720 C499  B9          	CP	C		; geaendert!
  721 C49A  28 06       	JR	Z,KEY6
  722 C49C  CD F4E7     KERR:	CALL	CRLF
  723 C49F  C3 F4DD     	JP	ERRM
  724                   	;
  725 C4A2  13          KEY6:	INC	DE
  726 C4A3  13          	INC	DE
  727 C4A4  06 9B       	LD	B,9BH
  728 C4A6  2F          	CPL
  729 C4A7  A7          	AND	A
  730 C4A8  28 21       	JR	Z,KEY8		; KEY F
  731 C4AA  3C          	INC	A
  732 C4AB  47          	LD	B,A
  733 C4AC  4D          	LD	C,L
  734 C4AD  7E          KEY7:	LD	A,(HL)
  735 C4AE  2C          	INC	L
  736 C4AF  28 EB       	JR	Z,KERR		; Puffer voll!
  737 C4B1  A7          	AND	A
  738 C4B2  20 F9       	JR	NZ,KEY7
  739 C4B4  10 F7       	DJNZ	KEY7		; Ende suchen
  740 C4B6  2D          	DEC	L
  741 C4B7  7D          	LD	A,L
  742 C4B8  FE 9C       	CP	9CH
  743 C4BA  30 E0       	JR	NC,KERR		; Puffer voll!
  744 C4BC  44          	LD	B,H
  745 C4BD  C5          	PUSH	BC
  746 C4BE  91          	SUB	C
  747 C4BF  4F          	LD	C,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  22
CC46    INC

  748 C4C0  06 00       	LD	B,0
  749 C4C2  D5          	PUSH	DE
  750 C4C3  11 B99B     	LD	DE,0B99BH
  751 C4C6  ED B8       	LDDR			; Rest hinter
  752 C4C8  43          	LD	B,E
  753 C4C9  D1          	POP	DE
  754 C4CA  E1          	POP	HL
  755 C4CB  4F          KEY8:	LD	C,A
  756 C4CC  2D          KEY9:	DEC	L
  757 C4CD  7E          	LD	A,(HL)
  758 C4CE  A7          	AND	A
  759 C4CF  20 FB       	JR	NZ,KEY9		; zurueck bis 0
  760 C4D1  2C          KEY10:	INC	L
  761 C4D2  1A          	LD	A,(DE)
  762 C4D3  13          	INC	DE
  763 C4D4  77          	LD	(HL),A		; belegen
  764 C4D5  B7          	OR	A
  765 C4D6  28 08       	JR	Z,KEY11
  766 C4D8  78          	LD	A,B
  767 C4D9  95          	SUB	L
  768 C4DA  20 F5       	JR	NZ,KEY10
  769 C4DC  36 00       	LD	(HL),0
  770 C4DE  18 BC       	JR	KERR
  771                   	;
  772 C4E0  79          KEY11:	LD	A,C
  773 C4E1  A7          	AND	A
  774 C4E2  28 09       	JR	Z,KEY12		; KEY F
  775 C4E4  04          	INC	B
  776 C4E5  2C          	INC	L
  777 C4E6  5D          	LD	E,L
  778 C4E7  54          	LD	D,H
  779 C4E8  68          	LD	L,B
  780 C4E9  06 00       	LD	B,0
  781 C4EB  ED B0       	LDIR			; Rest nach vorn
  782 C4ED  C3 F4E7     KEY12:	JP	CRLF
  783                   
  784                   ; Anzeige belegter F-Tasten:
  785                   
  786 C4F0  21 B901     KEYLIC:	LD	HL,0B901H
  787 C4F3  01 00F1     	LD	BC,0F1H
  788 C4F6  7E          KEYLC1:	LD	A,(HL)
  789 C4F7  A7          	AND	A
  790 C4F8  28 07       	JR	Z,KEYLC2
  791 C4FA  CD C521     	CALL	KEYDI		; Belegung
  792 C4FD  CD F4E7     	CALL	CRLF
  793 C500  04          	INC	B		; Zaehler
  794 C501  2C          KEYLC2:	INC	L
  795 C502  7D          	LD	A,L
  796 C503  FE 9C       	CP	9CH
  797 C505  30 03       	JR	NC,KEYLC3
  798 C507  0C          	INC	C
  799 C508  20 EC       	JR	NZ,KEYLC1	; F1 bis FF
  800 C50A  04          KEYLC3:	INC	B
  801 C50B  05          	DEC	B
  802 C50C  C0          	RET	NZ
  803 C50D  CD F0CE     	CALL	OSTR
  804 C510  46 2D 54 61 	DB	'F-Tasten leer'
  805 C51D  0D 0A 00    	DB	CR,LF,0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  23
CC46    INC

  806 C520  C9          	RET
  807                   
  808 C521  3E 02       KEYDI:	LD	A,2
  809 C523  CD F3E5     	CALL	OCHR		; Zeile loeschen
  810 C526  79          	LD	A,C
  811 C527  CD F0CB     	CALL	AHOSTR		; Fn
  812 C52A  20 3A 00    	DB	' :',0
  813 C52D  7E          KEYD1:	LD	A,(HL)
  814 C52E  B7          	OR	A
  815 C52F  C8          	RET	Z
  816 C530  CD F798     	CALL	CSTBT
  817 C533  23          	INC	HL
  818 C534  7D          	LD	A,L
  819 C535  FE 9C       	CP	9CH
  820 C537  D0          	RET	NC
  821 C538  18 F3       	JR	KEYD1
  822                   
  823                   ; COLOR-Menuewort:
  824                   
  825 C53A  A7          COLRC:	AND	A		; Anzahl Parameter
  826 C53B  20 17       	JR	NZ,SETCO	; 1 oder 2 -> Farben einstellen
  827 C53D  3A B7A3     	LD	A,(COLOR)	; 0 = aktuelle Farben anzeigen
  828 C540  6F          	LD	L,A
  829 C541  0F          	RRCA
  830 C542  0F          	RRCA
  831 C543  0F          	RRCA
  832 C544  E6 1F       	AND	1FH
  833 C546  CD F3C9     	CALL	AHSPC		; Anzeige Vordergrundfarbe
  834 C549  7D          	LD	A,L
  835 C54A  E6 07       	AND	7
  836 C54C  CD F3D4     	CALL	AHEX		; Anzeige Hintergrundfarbe
  837 C54F  CD F4E7     	CALL	CRLF
  838 C552  18 18       	JR	COLRC2
  839                   
  840                   ; COLOR-Unterprogramm = Farbe setzen (aus L und E)
  841                   
  842 C554  3E 1F       SETCO:	LD	A,1FH		; 1 oder 2 
  843 C556  A5          	AND	L
  844 C557  17          	RLA
  845 C558  17          	RLA
  846 C559  17          	RLA
  847 C55A  6F          	LD	L,A
  848 C55B  3A B781     	LD	A,(ARGN)
  849 C55E  FE 02       	CP	2
  850 C560  7B          	LD	A,E
  851 C561  30 03       	JR	NC,COLRC1
  852 C563  3A B7A3     	LD	A,(COLOR)	; Hintergrund
  853 C566  E6 07       COLRC1:	AND	7
  854 C568  B5          	OR	L
  855 C569  32 B7A3     	LD	(COLOR),A
  856 C56C  C3 FBBA     COLRC2:	JP	COFF
  857                   
  858                   ; WINDOW-Menuewort
  859                   
  860 C56F  A7          WINDC:	AND	A		; Kein Argument?
  861 C570  28 20       	JR	Z,WINC0		; Standardfenster initialisieren
  862 C572  3D          	DEC	A		; 1 Arg?
  863 C573  7D          	LD	A,L		; nr

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  24
CC46    INC

  864 C574  28 28       	JR	Z,WINAKC	; Aufruf No.L
  865 C576  65          	LD	H,L		; za
  866 C577  69          	LD	L,C		; sa
  867 C578  53          	LD	D,E		; zn
  868 C579  3A B788     	LD	A,(ARG4)
  869 C57C  5F          	LD	E,A		; sn
  870 C57D  3A B781     	LD	A,(ARGN)
  871 C580  FE 04       	CP	4
  872 C582  38 0B       	JR	C,WINCJE	; 2..3 Arg
  873 C584  3E 00       	LD	A,0
  874 C586  28 03       	JR	Z,WINC1		; 4 Arg
  875 C588  3A B78A     	LD	A,(ARG5)	; nr
  876 C58B  CD C5CE     WINC1:	CALL	WININC
  877 C58E  D0          	RET	NC
  878 C58F  C3 F4DD     WINCJE:	JP	ERRM
  879                   
  880 C592  11 B79B     WINC0:	LD	DE,WINNR	; von Fensternummer
  881 C595  21 C002     	LD	HL,WIN0		; bis WEND-Adresse
  882 C598  01 000B     	LD	BC,WIN1-WIN0	; mit Standardwerten aus ROM
  883 C59B  ED B0       	LDIR			; Fenster 0 neu initialisieren
  884 C59D  C9          	RET
  885                   
  886                   ; definiertes Fenster aufrufen:
  887                   
  888 C59E  CD C5BB     WINAKC:	CALL	WCOPY
  889 C5A1  32 B79B     	LD	(WINNR),A
  890 C5A4  CD C5AE     	CALL	PART		; Fenster A
  891 C5A7  D8          	RET	C		; holen
  892 C5A8  EB          	EX	DE,HL
  893 C5A9  11 B79C     	LD	DE,WINON
  894 C5AC  18 1A       	JR	WCOP1
  895                   
  896                   ; Testet A und berechnet Position in Fenstervektorspeicher =DE
  897                   
  898 C5AE  C6 F6       PART:	ADD	A,0F6H
  899 C5B0  D8          	RET	C		; zu gross
  900 C5B1  87          	ADD	A,A
  901 C5B2  5F          	LD	E,A
  902 C5B3  87          	ADD	A,A
  903 C5B4  87          	ADD	A,A
  904 C5B5  83          	ADD	A,E
  905 C5B6  5F          	LD	E,A
  906 C5B7  16 B9       	LD	D,0B9H
  907 C5B9  A7          	AND	A		; CY=0
  908 C5BA  C9          	RET
  909                   
  910                   ; Fenster (WINNR) retten
  911                   
  912 C5BB  F5          WCOPY:	PUSH	AF
  913 C5BC  3A B79B     	LD	A,(WINNR)
  914 C5BF  CD C5AE     	CALL	PART
  915 C5C2  38 3D       	JR	C,WINIE		; Fehler
  916 C5C4  F1          	POP	AF
  917 C5C5  21 B79C     	LD	HL,WINON
  918 C5C8  01 000A     WCOP1:	LD	BC,10
  919 C5CB  ED B0       	LDIR
  920 C5CD  C9          	RET
  921                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  25
CC46    INC

  922                   ; Initialisierung eines Fensters
  923                   
  924 C5CE  F5          WININC:	PUSH	AF
  925 C5CF  FE 0A       	CP	10		; No.
  926 C5D1  30 2E       	JR	NC,WINIE	; nur 10 Fenster moeglich
  927 C5D3  7A          	LD	A,D		; Zeilen
  928 C5D4  A7          	AND	A
  929 C5D5  28 2A       	JR	Z,WINIE		; Zeilenanzahl=0 -> ERROR
  930 C5D7  84          	ADD	A,H
  931 C5D8  38 27       	JR	C,WINIE		; Anzahl+Anfang>256 -> ERROR
  932 C5DA  FE 21       	CP	21H
  933 C5DC  30 23       	JR	NC,WINIE	; Anzahl+Anfang>32 -> ERROR
  934 C5DE  7B          	LD	A,E		; Spalten
  935 C5DF  A7          	AND	A
  936 C5E0  28 1F       	JR	Z,WINIE		; Spaltenanzahl=0 -> ERROR
  937 C5E2  85          	ADD	A,L
  938 C5E3  38 1C       	JR	C,WINIE		; Anzahl+Anfang>256 -> ERROR
  939 C5E5  FE 29       	CP	29H
  940 C5E7  30 18       	JR	NC,WINIE	; Anzahl+Anfang>40 -> ERROR
  941 C5E9  F1          	POP	AF
  942 C5EA  D5          	PUSH	DE
  943 C5EB  E5          	PUSH	HL
  944 C5EC  CD C5BB     	CALL	WCOPY		; retten
  945 C5EF  E1          	POP	HL
  946 C5F0  D1          	POP	DE
  947 C5F1  22 B79C     	LD	(WINON),HL
  948 C5F4  ED 53 B79E  	LD	(WINLG),DE
  949 C5F8  ED 43 B7A0  	LD	(CURSO),BC	; BC=0
  950 C5FC  32 B79B     	LD	(WINNR),A
  951 C5FF  A7          	AND	A		; CY=0
  952 C600  C9          	RET
  953                   	;
  954 C601  F1          WINIE:	POP	AF		; Fehlerende
  955 C602  37          	SCF
  956 C603  C9          	RET
  957                   
  958                   ; Linie zeichnen von	(ARG1)/(ARG2) nach (ARG3)/(ARG4)
  959                   
  960 C604  ED 5B B784  LINEC:	 LD	DE,(ARG2)	; YANF
  961 C608  2A B788     	 LD	HL,(ARG4)	; YEND
  962 C60B  D9          	 EXX
  963 C60C  ED 5B B782  	LD	DE,(ARG1)	; XANF
  964 C610  D5          	PUSH	DE
  965 C611  2A B786     	LD	HL,(ARG3)	; XEND
  966 C614  3E 08       	LD	A,8		; X=Master
  967 C616  B7          	OR	A
  968 C617  ED 52       	SBC	HL,DE		; HL=XSTEPS
  969 C619  30 06       	JR	NC,LINC1	; vorwaerts
  970 C61B  19          	ADD	HL,DE
  971 C61C  EB          	EX	DE,HL
  972 C61D  F6 01       	OR	1		; rueckwaerts
  973 C61F  ED 52       	SBC	HL,DE
  974 C621  D9          LINC1:	 EXX
  975 C622  D5          	 PUSH	DE		; YANF
  976 C623  ED 52       	 SBC	HL,DE		; HL'=YSTEPS
  977 C625  30 06       	 JR	NC,LINC2	; steigend
  978 C627  19          	 ADD	HL,DE
  979 C628  EB          	 EX	DE,HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  26
CC46    INC

  980 C629  F6 02       	 OR	2		; fallend
  981 C62B  ED 52       	 SBC	HL,DE
  982 C62D  E5          LINC2:	 PUSH	HL		; YSTEPS
  983 C62E  D9          	 EXX			; HL=XSTEPS
  984 C62F  C1          	POP	BC		; BC=YSTEPS
  985 C630  E5          	PUSH	HL
  986 C631  ED 42       	SBC	HL,BC		; flach/steil?
  987 C633  E1          	POP	HL
  988 C634  C5          	PUSH	BC
  989 C635  30 05       	JR	NC,LINC3	; flach
  990 C637  E3          	EX	(SP),HL
  991 C638  CB 9F       	RES	3,A		; X=Slave
  992 C63A  CB D7       	SET	2,A		; Y=Master
  993 C63C  E5          LINC3:	PUSH	HL		; HL=MAX(STEPS)
  994 C63D  44          	LD	B,H
  995 C63E  4D          	LD	C,L		; Pixelzaehler
  996 C63F  D9          	 EXX
  997 C640  C1          	 POP	BC		; BC'=MAX(...)
  998 C641  D1          	 POP	DE		; DE'=MIN(...)
  999 C642  60          	 LD	H,B
 1000 C643  69          	 LD	L,C
 1001 C644  CB 3C       	 SRL	H		; Slave mit 1/2
 1002 C646  CB 1D       	 RR 	L		; HL=1/2*MAX(...)
 1003 C648  D9          	 EXX
 1004 C649  D1          	POP	DE		; DE=YANF
 1005 C64A  E1          	POP	HL		; HL=XANF
 1006                   
 1007                   ; Hauptschleife
 1008                   ; AF Bitregister
 1009                   ; HL lfd. X-Koordinate	HL' Slave
 1010                   ; DE lfd. Y-Koordinate	DE' -Master
 1011                   ; BC Punktezaehler	BC' +Master
 1012                   
 1013 C64B  F5          LINCS:	PUSH	AF
 1014 C64C  08          	EX	AF,AF'		; Bitreg merken
 1015 C64D  F1          	POP	AF
 1016 C64E  E5          	PUSH	HL
 1017 C64F  21 B7ED     	LD	HL,LINTYP
 1018 C652  CB 06       	RLC	(HL)
 1019 C654  E1          	POP	HL
 1020 C655  DC C704     	CALL	C,SHLDE		; Punkt setzen
 1021 C658  D9          	 EXX
 1022 C659  A7          	 AND	A
 1023 C65A  ED 52       	 SBC	HL,DE		; -Master subtrahieren
 1024 C65C  30 01       	 JR	NC,LINC4	; kein Uebertrag - kein Sprung!
 1025 C65E  09          	 ADD	HL,BC		; +Master addieren (CY bleibt =1)
 1026 C65F  D9          LINC4:	 EXX
 1027 C660  30 02       	JR	NC,LINC5
 1028 C662  F6 0C       	OR	0CH		; X und Y!
 1029 C664  CB 5F       LINC5:	BIT	3,A		; X?
 1030 C666  28 07       	JR	Z,LINC6
 1031 C668  23          	INC	HL
 1032 C669  CB 47       	BIT	0,A
 1033 C66B  28 02       	JR	Z,LINC6
 1034 C66D  2B          	DEC	HL
 1035 C66E  2B          	DEC	HL
 1036 C66F  CB 57       LINC6:	BIT	2,A		; Y?
 1037 C671  28 07       	JR	Z,LINC7

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  27
CC46    INC

 1038 C673  13          	INC	DE
 1039 C674  CB 4F       	BIT	1,A
 1040 C676  28 02       	JR	Z,LINC7
 1041 C678  1B          	DEC	DE
 1042 C679  1B          	DEC	DE
 1043 C67A  78          LINC7:	LD	A,B
 1044 C67B  B1          	OR	C		; letzter Punkt?
 1045 C67C  C8          	RET	Z
 1046 C67D  0B          	DEC	BC
 1047 C67E  08          	EX	AF,AF'		; Bitreg
 1048 C67F  18 CA       	JR	LINCS
 1049                   
 1050                   ; Punkt setzen:
 1051                   
 1052 C681  E5          PUSEC:	PUSH	HL
 1053 C682  D5          	PUSH	DE
 1054 C683  C5          	PUSH	BC
 1055 C684  CD C77C     	CALL	CALHV		; berechnen
 1056 C687  D4 C711     	CALL	NC,PUSET	; & setzen
 1057 C68A  C3 F3FC     	JP	POP3		; POP	BC,DE,HL   RET
 1058                   
 1059                   ; Kreis zeichnen:
 1060                   
 1061 C68D  3A B786     CIRCLC:	LD	A,(ARG3)
 1062 C690  4F          	LD	C,A
 1063 C691  69          	LD	L,C
 1064 C692  AF          	XOR	A
 1065 C693  06 08       	LD	B,8
 1066 C695  CB 1D       	RR 	L
 1067 C697  30 01       CIR1:	JR	NC,CIR2
 1068 C699  81          	ADD	A,C
 1069 C69A  1F          CIR2:	RRA
 1070 C69B  CB 1D       	RR 	L
 1071 C69D  10 F8       	DJNZ	CIR1
 1072 C69F  67          	LD	H,A		; Achtelkreis berechnen
 1073 C6A0  54          	LD	D,H
 1074 C6A1  5D          	LD	E,L
 1075 C6A2  79          	LD	A,C
 1076 C6A3  CB 21       	SLA	C
 1077 C6A5  CB 10       	RL 	B
 1078 C6A7  0B          	DEC	BC
 1079 C6A8  C5          	PUSH	BC
 1080 C6A9  01 0001     	LD	BC,1
 1081 C6AC  D9          	EXX
 1082 C6AD  4F          	LD	C,A
 1083 C6AE  06 00       	LD	B,0H
 1084 C6B0  E5          CIR3:	PUSH	HL
 1085 C6B1  21 B7ED     	LD	HL,LINTYP
 1086 C6B4  CB 06       	RLC	(HL)
 1087 C6B6  E1          	POP	HL
 1088 C6B7  30 06       	JR	NC,CIRN
 1089 C6B9  CD C6DE     	CALL	CIRUP		; und jeweils 8
 1090 C6BC  CD C6DE     	CALL	CIRUP		; Punkte setzen
 1091 C6BF  D9          CIRN:	EXX
 1092 C6C0  A7          	AND	A
 1093 C6C1  ED 42       	SBC	HL,BC
 1094 C6C3  03          	INC	BC
 1095 C6C4  03          	INC	BC

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  28
CC46    INC

 1096 C6C5  ED 52       	SBC	HL,DE
 1097 C6C7  19          	ADD	HL,DE
 1098 C6C8  D9          	EXX
 1099 C6C9  30 0C       	JR	NC,CIR4
 1100 C6CB  D9          	EXX
 1101 C6CC  E3          	EX	(SP),HL
 1102 C6CD  EB          	EX	DE,HL
 1103 C6CE  A7          	AND	A
 1104 C6CF  ED 52       	SBC	HL,DE
 1105 C6D1  1B          	DEC	DE
 1106 C6D2  1B          	DEC	DE
 1107 C6D3  EB          	EX	DE,HL
 1108 C6D4  E3          	EX	(SP),HL
 1109 C6D5  D9          	EXX
 1110 C6D6  0D          	DEC	C
 1111 C6D7  04          CIR4:	INC	B
 1112 C6D8  79          	LD	A,C
 1113 C6D9  B8          	CP	B
 1114 C6DA  30 D4       	JR	NC,CIR3
 1115 C6DC  F1          	POP	AF
 1116 C6DD  C9          	RET
 1117                   
 1118                   ; setzt 4 Punkte um Mittelpunkt
 1119                   
 1120 C6DE  78          CIRUP:	LD	A,B
 1121 C6DF  41          	LD	B,C
 1122 C6E0  4F          	LD	C,A
 1123 C6E1  AF          	XOR	A
 1124 C6E2  57          	LD	D,A
 1125 C6E3  2A B784     	LD	HL,(ARG2)
 1126 C6E6  E5          	PUSH	HL
 1127 C6E7  59          	LD	E,C
 1128 C6E8  19          	ADD	HL,DE
 1129 C6E9  CD C6F2     	CALL	CIRUP1
 1130 C6EC  AF          	XOR	A
 1131 C6ED  57          	LD	D,A
 1132 C6EE  E1          	POP	HL
 1133 C6EF  59          	LD	E,C
 1134 C6F0  ED 52       	SBC	HL,DE
 1135 C6F2  E5          CIRUP1:	PUSH	HL
 1136 C6F3  2A B782     	LD	HL,(ARG1)
 1137 C6F6  58          	LD	E,B
 1138 C6F7  A7          	AND	A
 1139 C6F8  ED 52       	SBC	HL,DE
 1140 C6FA  D1          	POP	DE
 1141 C6FB  CD C704     	CALL	SHLDE
 1142 C6FE  D5          	PUSH	DE
 1143 C6FF  57          	LD	D,A
 1144 C700  58          	LD	E,B
 1145 C701  19          	ADD	HL,DE
 1146 C702  19          	ADD	HL,DE
 1147 C703  D1          	POP	DE
 1148                   	;
 1149 C704              SHLDE:	;setzt Punkt auf Pos. HL/DE (wenn moeglich)
 1150 C704  E5          	PUSH	HL
 1151 C705  D5          	PUSH	DE
 1152 C706  C5          	PUSH	BC
 1153 C707  F5          	PUSH	AF

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  29
CC46    INC

 1154 C708  CD C785     	CALL	CALXY		; berechnen
 1155 C70B  D4 C711     	CALL	NC,PUSET	; & setzen
 1156 C70E  C3 E09C     	JP	POP4		; POP	AF,BC,DE,HL   RET
 1157                   	;
 1158 C711  DD CB 01 5E PUSET:	BIT	3,(IX+1)
 1159 C715  28 26       	JR	Z,HIRES		; HiRes
 1160 C717  CB 4A       	BIT	1,D
 1161 C719  20 1E       	JR	NZ,PUERA
 1162 C71B  CB 42       	BIT	0,D
 1163 C71D  20 03       	JR	NZ,PUXOR
 1164 C71F  B6          	OR	(HL)		; setzen
 1165 C720  18 03       	JR	PUCOL
 1166 C722  AE          PUXOR:	XOR	(HL)		; alternierend
 1167 C723  CB 82       	RES	0,D
 1168 C725  77          PUCOL:	LD	(HL),A
 1169 C726  DD 7E 01    	LD	A,(IX+1)
 1170 C729  5F          	LD	E,A
 1171 C72A  EE 02       	XOR	2		; Farbebene
 1172 C72C  F3          	DI
 1173 C72D  D3 84       	OUT	(84H),A
 1174 C72F  7E          	LD	A,(HL)
 1175 C730  E6 07       	AND	7
 1176 C732  B2          	OR	D
 1177 C733  77          	LD	(HL),A		; neue vFarbe
 1178 C734  7B          	LD	A,E
 1179 C735  D3 84       	OUT	(84H),A
 1180 C737  FB          	EI
 1181 C738  C9          	RET
 1182 C739  2F          PUERA:	CPL
 1183 C73A  A6          	AND	(HL)		; loeschen
 1184 C73B  77          	LD	(HL),A
 1185 C73C  C9          	RET
 1186                   	;
 1187 C73D  47          HIRES:	LD	B,A
 1188 C73E  B6          	OR	(HL)		; Bit setzen in
 1189 C73F  CB 5A       	BIT	3,D		; Pixelebene?
 1190 C741  20 01       	JR	NZ,HIR1
 1191 C743  A8          	XOR	B		; wieder loeschen
 1192 C744  77          HIR1:	LD	(HL),A
 1193 C745  DD 7E 01    	LD	A,(IX+1)
 1194 C748  4F          	LD	C,A
 1195 C749  EE 02       	XOR	2
 1196 C74B  F3          	DI
 1197 C74C  D3 84       	OUT	(84H),A
 1198 C74E  78          	LD	A,B
 1199 C74F  B6          	OR	(HL)		; Bit setzen in
 1200 C750  CB 62       	BIT	4,D		; Farbebene?
 1201 C752  20 01       	JR	NZ,HIR2
 1202 C754  A8          	XOR	B		; wieder loeschen
 1203 C755  77          HIR2:	LD	(HL),A
 1204 C756  79          	LD	A,C
 1205 C757  D3 84       	OUT	(84H),A
 1206 C759  FB          	EI
 1207 C75A  C9          	RET
 1208                   
 1209                   ; Punkt loeschen, PA: A=Farbbyte
 1210                   
 1211 C75B  E5          PUDEC:	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  30
CC46    INC

 1212 C75C  D5          	PUSH	DE
 1213 C75D  C5          	PUSH	BC
 1214 C75E  CD C77C     	CALL	CALHV
 1215 C761  38 16       	JR	C,PUDEE		; ausserhalb
 1216 C763  47          	LD	B,A		; Bit
 1217 C764  4E          	LD	C,(HL)
 1218 C765  2F          	CPL
 1219 C766  A1          	AND	C
 1220 C767  77          	LD	(HL),A		; loeschen
 1221 C768  DD 7E 01    	LD	A,(IX+1)
 1222 C76B  5F          	LD	E,A
 1223 C76C  EE 02       	XOR	2
 1224 C76E  F3          	DI
 1225 C76F  D3 84       	OUT	(84H),A
 1226 C771  56          	LD	D,(HL)		; Farbbyte
 1227 C772  7B          	LD	A,E
 1228 C773  D3 84       	OUT	(84H),A
 1229 C775  FB          	EI
 1230 C776  78          	LD	A,B		; Z=1: Punkt
 1231 C777  A1          	AND	C		; war geloescht
 1232 C778  7A          	LD	A,D		; Farbbyte
 1233 C779  C3 F3FC     PUDEE:	JP	POP3		; POP	BC,DE,HL   RET
 1234                   
 1235                   ; Grafikposition berechnen
 1236                   ; HL=X-Koor., DE=Y-Koor.
 1237                   ; PA:	CY=1	ausserhalb
 1238                   ; HL=IRM-Adr, A=Bitmaske, D=Farb
 1239                   
 1240 C77C  2A B7D3     CALHV:	LD	HL,(HOR)
 1241 C77F  ED 5B B7D5  	LD	DE,(VERT)
 1242 C783  16 00       	LD	D,0
 1243 C785  C5          CALXY:	PUSH	BC
 1244 C786  01 FDF8     	LD	BC,BITTAB
 1245 C789  7D          	LD	A,L
 1246 C78A  E6 07       	AND	7
 1247 C78C  81          	ADD	A,C
 1248 C78D  4F          	LD	C,A		; Bit
 1249 C78E  7D          	LD	A,L
 1250 C78F  CB 3C       	SRL	H
 1251 C791  1F          	RRA
 1252 C792  CB 3C       	SRL	H
 1253 C794  1F          	RRA
 1254 C795  CB 3C       	SRL	H
 1255 C797  1F          	RRA			; Spalte
 1256 C798  FE 28       	CP	28H
 1257 C79A  30 11       	JR	NC,CALEN
 1258 C79C  F6 80       	OR	80H		; IRM
 1259 C79E  67          	LD	H,A
 1260 C79F  3E FF       	LD	A,0FFH
 1261 C7A1  82          	ADD	A,D
 1262 C7A2  38 09       	JR	C,CALEN
 1263 C7A4  AB          	XOR	E		; CY=0!
 1264 C7A5  6F          	LD	L,A		; Zeile
 1265 C7A6  3A B7D6     	LD	A,(FARB)
 1266 C7A9  57          	LD	D,A
 1267 C7AA  0A          	LD	A,(BC)		; MASKE fuer X
 1268 C7AB  C1          	POP	BC
 1269 C7AC  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  31
CC46    INC

 1270 C7AD  C1          CALEN:	POP	BC		; ausserhalb
 1271 C7AE  37          	SCF
 1272 C7AF  C9          	RET
 1273                   
 1274                   ; Ausgabe einer Displayzeile
 1275                   ; HL=Adresse, C=Anzahl Bytes
 1276                   
 1277 C7B0  CD F3C4     DPMEMO:	CALL	HLHX		; Adresse
 1278 C7B3  E5          DPME0:	PUSH	HL		; Hier Einsprung von DUMP-Routine
 1279 C7B4  41          	LD	B,C
 1280 C7B5  CD FB9E     DPME1:	CALL	LDAME		; Byte holen
 1281 C7B8  23          	INC	HL
 1282 C7B9  CD F3C9     	CALL	AHSPC		; anzeigen
 1283 C7BC  10 F7       	DJNZ	DPME1		; C*
 1284 C7BE  E1          	POP	HL
 1285 C7BF  41          	LD	B,C
 1286 C7C0  3E 09       	LD	A,9
 1287 C7C2  CD F3E5     	CALL	OCHR		; CUR
 1288 C7C5  CD FB9E     DPME2:	CALL	LDAME		; Byte holen
 1289 C7C8  23          	INC	HL
 1290 C7C9  CD F798     	CALL	CSTBT		; als ASCII
 1291 C7CC  10 F7       	DJNZ	DPME2		; C*
 1292 C7CE  C9          	RET
 1293                   
 1294                   ; Anzeige Speicherbereich:
 1295                   ; HL=Adresse, E=Listblocklaenge
 1296                   ; C=Anzahl Bytes pro Zeile
 1297                   ; A=Anzahl Argumente
 1298                   
 1299 C7CF  FE 03       DISPC:	CP	3
 1300 C7D1  30 08       	JR	NC,DISP1
 1301 C7D3  0E 08       	LD	C,8		; default = 8 Bytes/Zeile
 1302 C7D5  FE 02       	CP	2
 1303 C7D7  30 02       	JR	NC,DISP1
 1304 C7D9  1E 04       	LD	E,4		; default = 4 Zeilen
 1305 C7DB  D5          DISP1:	PUSH	DE
 1306 C7DC  CD C7B0     DISP2:	CALL	DPMEMO		; 1 Zeile
 1307 C7DF  CD F4E7     	CALL	CRLF
 1308 C7E2  CD E379     	CALL	BRKT
 1309 C7E5  38 06       	JR	C,DISP4
 1310 C7E7  1D          	DEC	E
 1311 C7E8  20 F2       	JR	NZ,DISP2	; E*
 1312 C7EA  CD F400     DISP3:	CALL	INTB		; Warten auf Tastenbetaetigung
 1313 C7ED  D1          DISP4:	POP	DE
 1314 C7EE  FE 03       	CP	3		; BRK?
 1315 C7F0  C8          	RET	Z
 1316 C7F1  FE 0F       	CP	0FH
 1317 C7F3  20 05       	JR	NZ,DISP5
 1318 C7F5  CD F3E5     	CALL	OCHR		; Hardcopy
 1319 C7F8  18 F0       	JR	DISP3
 1320                   	;
 1321 C7FA  FE 13       DISP5:	CP	13H		; STOP?
 1322 C7FC  20 DD       	JR	NZ,DISP1
 1323 C7FE  18 07       	JR	MODI1
 1324                   
 1325                   ; Anzeige/Veraendern Speicherbereich
 1326                   ; HL=Adresse, E=Anzahl Bytes pro Zeile
 1327                   ; A=Anzahl Argumente

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  32
CC46    INC

 1328                   
 1329 C800  4B          MODIC:	LD	C,E		; Breite
 1330 C801  FE 02       	CP	2
 1331 C803  30 02       	JR	NC,MODI1
 1332 C805  0E 01       	LD	C,1		; default
 1333 C807  CD C7B0     MODI1:	CALL	DPMEMO
 1334 C80A  3E 05       	LD	A,5
 1335 C80C  32 B7A0     	LD	(CURSO),A
 1336 C80F  CD F4A5     	CALL	INLIN
 1337 C812  D8          	RET	C		; BRK
 1338 C813  E5          	PUSH	HL
 1339 C814  CD F4F7     	CALL	RHEX		; Adresse
 1340 C817  7E          	LD	A,(HL)
 1341 C818  E1          	POP	HL
 1342 C819  38 56       	JR	C,MODI9		; Fehler
 1343 C81B  A7          	AND	A
 1344 C81C  28 E9       	JR	Z,MODI1
 1345 C81E  2A B797     	LD	HL,(NUMVX)
 1346 C821  E5          MODI2:	PUSH	HL
 1347 C822  CD F4F7     	CALL	RHEX		; Datenbyte
 1348 C825  7E          	LD	A,(HL)
 1349 C826  A7          	AND	A		; kein Zeichen
 1350 C827  23          	INC	HL		; einlesbar?
 1351 C828  7E          	LD	A,(HL)
 1352 C829  E1          	POP	HL
 1353 C82A  28 04       	JR	Z,MODI4
 1354 C82C  CD FB8E     MODI3:	CALL	LDMAE		; eintragen
 1355 C82F  23          	INC	HL
 1356 C830  1A          MODI4:	LD	A,(DE)
 1357 C831  FE 2E       	CP	'.'		; Abschluss?
 1358 C833  C8          	RET	Z
 1359 C834  FE 2C       	CP	','		; 1 Zeichen?
 1360 C836  20 05       	JR	NZ,MODI5
 1361 C838  13          	INC	DE
 1362 C839  1A          	LD	A,(DE)		; vom Video-RAM
 1363 C83A  13          	INC	DE
 1364 C83B  18 EF       	JR	MODI3		; eintragen
 1365                   	;
 1366 C83D  FE 3A       MODI5:	CP	':'		; Rueckschritt?
 1367 C83F  20 06       	JR	NZ,MODI6
 1368 C841  06 00       	LD	B,0
 1369 C843  ED 42       	SBC	HL,BC		; C Bytes zurueck
 1370 C845  18 C0       	JR	MODI1
 1371                   	;
 1372 C847  FE 2F       MODI6:	CP	'/'		; neue Adresse?
 1373 C849  20 0B       	JR	NZ,MODI0
 1374 C84B  13          	INC	DE
 1375 C84C  CD F4F7     	CALL	RHEX
 1376 C84F  38 20       	JR	C,MODI9
 1377 C851  2A B797     	LD	HL,(NUMVX)
 1378 C854  18 B1       	JR	MODI1
 1379                   	;
 1380 C856  FE 27       MODI0:	CP	27H		; Zeichenkette?
 1381 C858  20 10       	JR	NZ,MODI8
 1382 C85A  13          	INC	DE
 1383 C85B  1A          MODI7:	LD	A,(DE)		; Zeichen holen
 1384 C85C  13          	INC	DE
 1385 C85D  A7          	AND	A		; Dummy-Ende?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  33
CC46    INC

 1386 C85E  28 A7       	JR	Z,MODI1
 1387 C860  FE 27       	CP	27H		; Ende Kette?
 1388 C862  28 CC       	JR	Z,MODI4
 1389 C864  CD FB8E     	CALL	LDMAE		; eintragen
 1390 C867  23          	INC	HL
 1391 C868  18 F1       	JR	MODI7
 1392                   	;
 1393 C86A  A7          MODI8:	AND	A		; Ende Zeile?
 1394 C86B  28 9A       	JR	Z,MODI1
 1395 C86D  FE 20       	CP	' '		; Leerzeichen?
 1396 C86F  28 B0       	JR	Z,MODI2
 1397 C871  CD F4DD     MODI9:	CALL	ERRM		; sonst ERROR
 1398 C874  18 91       	JR	MODI1
 1399                   
 1400                   ; Initialisierung der Druckerausgabe:
 1401                   ;
 1402                   ; PE:	(ARGN)	0..5 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1403                   ;	(ARG1)	Steckplatz	(0 = M021)
 1404                   ;	(ARG2)	SIO-Kanal	(0..1 = A, 2 = B)
 1405                   ;	(ARG3)	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1406                   ;	(ARG4)	ShCLR-Reaktion	(0 = keine, 1 = Protokoll, 2 = Hardcopy)
 1407                   ;	(ARG5)	Druckertyp	(0..12)
 1408                   ; PA:	-
 1409                   ; VR:	AF, BC, DE, HL
 1410                   ;
 1411 C876  CD F609     LSTC:	CALL	LARG		; Arg's laden
 1412 C879  CD C8C1     	CALL	LSTCA		; Druckerinitialisierung (intern)
 1413 C87C  DA F4DD     	JP	C,ERRM
 1414 C87F  3E 0D       	LD	A,CR		; CR+LF drucken
 1415 C881  CD B7E9     	CALL	OFILT
 1416 C884  3E 0A       	LD	A,LF
 1417 C886  C3 B7E9     	JP	OFILT
 1418                   
 1419 C889  3A B7E1     LSTC1:	LD	A,(HCPZ)	; bisheriges Steuerbyte
 1420 C88C  E6 F0       	AND	0F0h		; Druckertyp uebernehmen
 1421 C88E  0F          	RRCA			; und auf Bits 1..4 rotieren
 1422 C88F  0F          	RRCA
 1423 C890  0F          	RRCA
 1424 C891  18 3D       	JR	LSTC6
 1425                   
 1426 C893  CD C92E     LSTC2:	CALL	USRARG		; Steuerwort aus Argumenten bilden (CY war 0)
 1427 C896  AF          	XOR	A
 1428 C897  D3 91       	OUT	(91h),A		; M021 PIO-B Daten
 1429 C899  DB 91       	IN	A,(91h)
 1430 C89B  C6 FF       	ADD	A,-1		; 0 zurueckgelesen?
 1431 C89D  D8          	RET	C		; sonst kein M021 vorhanden
 1432 C89E  C5          	PUSH	BC
 1433 C89F  21 FA2F     	LD	HL,M021PR
 1434 C8A2  18 57       	JR	LSTC7
 1435                   
 1436 C8A4  2E 07       LSTC3:	LD	L,7		; ab Steckplatz 7
 1437 C8A6  CD C924     LSTC4:	CALL	SIOARG		; Steuerwort aus Argumenten bilden
 1438 C8A9  C5          	PUSH	BC		; Adresse ShCLR-Reaktionsprogramm
 1439 C8AA  45          	LD	B,L
 1440 C8AB  CD C35B     	CALL	V24SU		; M003 suchen
 1441 C8AE  50          	LD	D,B		; Steckplatz in D zurueckgeben
 1442 C8AF  38 70       	JR	C,IOEPOP	; nicht gefunden
 1443 C8B1  3A B7E4     	LD	A,(INTV1L)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  34
CC46    INC

 1444 C8B4  47          	LD	B,A
 1445 C8B5  2A B7E2     	LD	HL,(INTV1)
 1446 C8B8  7B          	LD	A,E		; Steuerbyte
 1447 C8B9  CD C9AC     	CALL	INISIO
 1448 C8BC  21 FA47     	LD	HL,V24PR
 1449 C8BF  18 3A       	JR	LSTC7
 1450                   
 1451                   ; Initialisierung der Druckerausgabe (intern):
 1452                   ;
 1453                   ; PE:	A	0..5 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1454                   ;	L	Steckplatz	(0 = M021)
 1455                   ;	E	SIO-Kanal	(0..1 = A, 2 = B)
 1456                   ;	C	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1457                   ;	(ARG4)	ShCLR-Reaktion	(0 = keine, 1 = Protokoll, 2 = Hardcopy)
 1458                   ;	(ARG5)	Druckertyp	(0..12)
 1459                   ; PA:	D	Steckplatz M003	(nur gueltig fuer A = 0)
 1460                   ;	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1461                   ; VR:	AF, BC, DE, HL
 1462                   ;
 1463 C8C1  67          LSTCA:	LD	H,A
 1464 C8C2  3E 05       	LD	A,5
 1465 C8C4  BC          	CP	H		; (ARGN) <= 5?
 1466 C8C5  D8          	RET	C
 1467 C8C6  20 C1       	JR	NZ,LSTC1
 1468 C8C8  3A B78A     LSTC5:	LD	A,(ARG5)	; neuer Druckertyp
 1469 C8CB  FE 0D       	CP	13		; (ARG5) < 13?
 1470 C8CD  30 53       	JR	NC,IOERET
 1471 C8CF  87          	ADD	A,A		; 0 fuer Bit 3 einschieben
 1472 C8D0  57          LSTC6:	LD	D,A
 1473 C8D1  7C          	LD	A,H
 1474 C8D2  A7          	AND	A		; Steckplatz angegeben?
 1475 C8D3  28 CF       	JR	Z,LSTC3
 1476 C8D5  7D          	LD	A,L
 1477 C8D6  A7          	AND	A		; Steckplatz = 0?
 1478 C8D7  28 BA       	JR	Z,LSTC2		; M021
 1479 C8D9  C5          	PUSH	BC
 1480 C8DA  45          	LD	B,L
 1481 C8DB  0E 80       	LD	C,80h
 1482 C8DD  ED 78       	IN	A,(C)
 1483 C8DF  C1          	POP	BC
 1484 C8E0  D6 EE       	SUB	0EEh		; M003?
 1485 C8E2  28 C2       	JR	Z,LSTC4
 1486 C8E4  3D          	DEC	A		; M001?
 1487 C8E5  20 3B       	JR	NZ,IOERET
 1488                   
 1489 C8E7  CD C92E     	CALL	USRARG		; Steuerwort aus Argumenten bilden (CY war 0)
 1490 C8EA  C5          	PUSH	BC		; Adresse ShCLR-Reaktionsprogramm
 1491 C8EB  3E 02       	LD	A,2
 1492 C8ED  16 01       	LD	D,1
 1493 C8EF  CD C36D     	CALL	MODUC		; M001 einschalten
 1494 C8F2  21 D942     	LD	HL,DIOINI
 1495 C8F5  CD C9DF     	CALL	IMEXDI		; PIO konfigurieren
 1496 C8F8  21 FA1E     	LD	HL,M001PR
 1497 C8FB  22 B7EA     LSTC7:	LD	(OFILT + 1),HL
 1498 C8FE  E1          	POP	HL
 1499 C8FF  22 B799     	LD	(HCADR),HL	; ShCLR-Reaktionsprogramm setzen
 1500 C902  7B          	LD	A,E
 1501 C903  32 B7E1     	LD	(HCPZ),A	; Steuerbyte eintragen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  35
CC46    INC

 1502 C906  21 FA0D     	LD	HL,PRINT
 1503 C909  01 F4CB     	LD	BC,NOOP
 1504 C90C  A7          	AND	A		; CY = 0
 1505                   ;
 1506                   ; Eintragen der Sprungadressen eines I/O-Kanals:
 1507                   ;
 1508                   ; PE:	E = Steuerwort
 1509                   ;	BC = Sprungadresse fuer Eingabe
 1510                   ;	HL = Sprungadresse fuer Ausgabe
 1511                   ; PA:	-
 1512                   ; VR:	F
 1513                   ;
 1514 C90D  CB 4B       SETUIO:	BIT	1,E		; Ausgabekanal #2 oder #3?
 1515 C90F  20 08       	JR	NZ,SETU2
 1516 C911  22 B7BE     	LD	(UOUT1 + 1),HL
 1517 C914  ED 43 B7C1  	LD	(UIN1  + 1),BC
 1518 C918  C9          	RET
 1519 C919  22 B7C4     SETU2:	LD	(UOUT2 + 1),HL
 1520 C91C  ED 43 B7C7  	LD	(UIN2  + 1),BC
 1521 C920  C9          	RET
 1522                   
 1523 C921  E1          IOEPOP:	POP	HL
 1524 C922  37          IOERET:	SCF
 1525 C923  C9          	RET
 1526                   
 1527                   ; Auswertung der Argumente 2..4 fuer I/O-Initialisierung:
 1528                   ;
 1529                   ; PE:	H	Argumentzahl
 1530                   ;	E	SIO-Kanal	(0..1 = A, 2 = B)
 1531                   ;	C	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1532                   ;	(ARG4)	ShCLR-Reaktion
 1533                   ;	D	Steuerwort
 1534                   ; PA:	E	Steuerwort	(3 neue Bits von rechts einrotiert)
 1535                   ;	BC	Adresse ShCLR-Reaktionsprogramm
 1536                   ;	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1537                   ; VR:	AF, BC, DE, SP
 1538                   ;
 1539                   ; Stack-Unwinding: Im Fehlerfall wird die eigentliche Ruecksprungadresse vom
 1540                   ; Stack genommen, und dann ein RET ausgefuehrt.  Die aufrufende Routine darf
 1541                   ; keine Daten auf dem Stack zu liegen haben!
 1542                   ;
 1543 C924  3E 01       SIOARG:	LD	A,1
 1544 C926  BC          	CP	H
 1545 C927  30 05       	JR	NC,USRARG
 1546 C929  1D          	DEC	E		; (ARG2): SIO-Kanal
 1547 C92A  93          	SUB	E		; 1 <= (ARG2) <= 2?
 1548 C92B  38 F4       	JR	C,IOEPOP
 1549 C92D  BB          	CP	E		; CY = 1 wenn K2
 1550 C92E  5A          USRARG:	LD	E,D
 1551 C92F  CB 13       	RL	E		; Bit 2 einschieben
 1552 C931  3E 02       	LD	A,2
 1553 C933  57          	LD	D,A
 1554 C934  BC          	CP	H
 1555 C935  30 06       	JR	NC,NOARG3
 1556 C937  79          	LD	A,C		; (ARG3): User-I/O-Kanal
 1557 C938  92          	SUB	D
 1558 C939  BA          	CP	D		; 2 <= (ARG3) <= 3?
 1559 C93A  30 E5       	JR	NC,IOEPOP

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  36
CC46    INC

 1560 C93C  0F          	RRCA			; CY = 1 wenn User-Kanal #3
 1561 C93D  CB 13       NOARG3:	RL	E		; Bit 1 einschieben
 1562 C93F  01 F4CB     	LD	BC,NOOP
 1563 C942  14          	INC	D		; D = 3
 1564 C943  7A          	LD	A,D
 1565 C944  BC          	CP	H
 1566 C945  30 0D       	JR	NC,NOARG4
 1567 C947  3A B788     	LD	A,(ARG4)	; Reaktion auf ShCLR
 1568 C94A  A7          	AND	A		; (ARG4) = 0?
 1569 C94B  28 07       	JR	Z,NOARG4
 1570 C94D  92          	SUB	D		; 0 <= (ARG4) <= 2?
 1571 C94E  30 D1       	JR	NC,IOEPOP
 1572 C950  01 F9E0     	LD	BC,HCPGM
 1573 C953  0F          	RRCA			; CY = 1 wenn Hardcopy
 1574 C954  CB 13       NOARG4:	RL	E		; Bit 0 einschieben
 1575 C956  C9          	RET
 1576                   
 1577                   ; Initialisierung V.24-Duplexbetrieb:
 1578                   ;
 1579                   ; PE:	(ARGN)	0..3 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1580                   ;	(ARG1)	Steckplatz
 1581                   ;	(ARG2)	SIO-Kanal	(0..1 = A, 2 = B)
 1582                   ;	(ARG3)	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1583                   ; PA:	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1584                   ; VR:	AF, BC, DE, HL
 1585                   ;
 1586 C957  CD F609     V24DC:	CALL	LARG		; Arg's laden
 1587 C95A  67          	LD	H,A
 1588 C95B  3E 03       	LD	A,3
 1589 C95D  BC          	CP	H		; (ARGN) <= 3?
 1590 C95E  D8          	RET	C		; mehr als 3 Argumente -> Fehler
 1591 C95F  16 00       	LD	D,0		; Steuerwort zunaechst leer
 1592 C961  CD C924     	CALL	SIOARG		; Steuerwort aus Argumenten 2-4 bilden
 1593 C964  E5          	PUSH	HL
 1594 C965  3A B7E7     	LD	A,(INTV2L)	; Laenge Duplexinitialisierung
 1595 C968  47          	LD	B,A
 1596 C969  2A B7E5     	LD	HL,(INTV2)	; Duplexinitialisierung
 1597 C96C  23          	INC	HL
 1598 C96D  18 17       	JR	V24DC5
 1599                   
 1600 C96F  3E 80       V24DC1:	LD	A,10000000b	; Empfangseinstellungen (7/8 Bit)
 1601 C971  18 10       	JR	V24DC3
 1602                   
 1603 C973  7E          V24DC2:	LD	A,(HL)		; Initialisierungsdaten lesen
 1604 C974  E6 07       	AND	00000111b	; Registerauswahl?
 1605 C976  28 11       	JR	Z,V24DC6
 1606 C978  23          	INC	HL
 1607 C979  FE 03       	CP	3		; WR3?
 1608 C97B  28 F2       	JR	Z,V24DC1
 1609 C97D  FE 05       	CP	5		; WR5?
 1610 C97F  20 05       	JR	NZ,V24DC5
 1611 C981  3E 68       	LD	A,01101000b	; Sendeeinstellungen (5-8 Bit, ein/aus)
 1612 C983  A6          V24DC3:	AND	(HL)		; benoetigte Bits abtrennen
 1613 C984  B3          	OR	E		; und in Steuerbyte einbauen
 1614 C985  5F          V24DC4:	LD	E,A
 1615 C986  05          V24DC5:	DEC	B
 1616 C987  28 98       	JR	Z,IOEPOP	; fehlendes Initialisierungsbyte
 1617 C989  23          V24DC6:	INC	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  37
CC46    INC

 1618 C98A  10 E7       	DJNZ	V24DC2
 1619                   
 1620 C98C  E1          	POP	HL
 1621 C98D  7C          	LD	A,H
 1622 C98E  06 07       	LD	B,7		; Suche ab Steckplatz 7
 1623 C990  A7          	AND	A		; Steckplatz angegeben?
 1624 C991  28 01       	JR	Z,V24DC7
 1625 C993  45          	LD	B,L		; angegebener Steckplatz
 1626 C994  CD C35B     V24DC7:	CALL	V24SU
 1627 C997  D8          	RET	C		; Modul nicht gefunden
 1628 C998  21 FA5F     	LD	HL,V24OT
 1629 C99B  01 FA6A     	LD	BC,V24IN
 1630 C99E  CD C90D     	CALL	SETUIO		; I/O-Sprungadressen eintragen
 1631 C9A1  3A B7E7     V24DC8:	LD	A,(INTV2L)
 1632 C9A4  47          	LD	B,A
 1633 C9A5  2A B7E5     	LD	HL,(INTV2)
 1634 C9A8  7B          	LD	A,E		; Duplex-Steuerbyte
 1635 C9A9  32 B7E8     	LD	(HCPZ2),A	; eintragen
 1636                   
 1637                   ; SIO-Initialisierung:
 1638                   ;
 1639                   ; PE:	HL	Initialisierungstabelle
 1640                   ;	B	Laenge der Tabelle (>= 3)
 1641                   ;	A	Steuerbyte
 1642                   ; PA:	CY = 0
 1643                   ; VR:	AF, BC, HL
 1644                   ;
 1645 C9AC  E6 04       INISIO:	AND	00000100b
 1646 C9AE  0F          	RRCA
 1647 C9AF  0F          	RRCA
 1648 C9B0  C6 0C       	ADD	A,0Ch		; CTC-Port
 1649 C9B2  4F          	LD	C,A
 1650 C9B3  78          	LD	A,B
 1651 C9B4  06 02       	LD	B,2		; 2 Byte fuer CTC-Initialisierung
 1652 C9B6  90          	SUB	B
 1653 C9B7  F3          	DI
 1654 C9B8  ED B3       	OTIR			; CTC initialisieren
 1655 C9BA  47          	LD	B,A
 1656 C9BB  0D          	DEC	C		; SIO-Steuerport
 1657 C9BC  0D          	DEC	C
 1658 C9BD  ED B3       	OTIR			; SIO initialisieren
 1659 C9BF  FB          	EI
 1660 C9C0  A7          	AND	A		; CY = 0
 1661 C9C1  C9          	RET
 1662                   
 1663                   ; V.24-Modul initialisieren:
 1664                   ;	-Tabellen in IRM kopieren
 1665                   ;	-M003 suchen und einschalten
 1666                   ;	-M003-Steckplatz merken
 1667                   
 1668 C9C2  21 CD13     V24INI:	LD	HL,V24TAB	; vorbereitete V24-Tabelle
 1669 C9C5  11 A800     	LD	DE,V24PL	; Steckplatz (A800H)
 1670 C9C8  01 0012     	LD	BC,V24UMT - V24TAB
 1671 C9CB  ED B0       	LDIR			; in IRM kopieren
 1672 C9CD  AF          	XOR	A
 1673 C9CE  CD C8C1     	CALL	LSTCA		; SIO-A: Druckerinitialisierung
 1674 C9D1  D8          	RET	C		; kein M003 gefunden
 1675 C9D2  7A          	LD	A,D

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  38
CC46    INC

 1676 C9D3  32 A800     	LD	(V24PL),A	; Steckplatz eintragen
 1677 C9D6  21 FA5F     	LD	HL,V24OT	; Duplex-Ausgaberoutine
 1678 C9D9  22 B7C4     	LD	(UOUT2 + 1),HL	; fuer User-Kanal #3 eintragen
 1679 C9DC  21 CD25     	LD	HL,V24UMT	; SIO-B: Empfangs-Interrupt
 1680                   
 1681                   ; Initialisierung mehrerer Ports mit Sperren von Interrupts:
 1682                   ;
 1683                   ; PE:	HL	Initialisierungstabelle
 1684                   ;	(HL)	Anzahl der Kanaele
 1685                   ; PA:	-
 1686                   ; VR:	F, D, HL
 1687                   ;
 1688 C9DF  56          IMEXDI:	LD	D,(HL)		; Anzahl Kanaele
 1689 C9E0  23          	INC	HL
 1690 C9E1  C3 F56D     	JP	INIME		; Ports initialisieren
 1691                   
 1692                   ; allgemeine Druckroutine
 1693                   
 1694 C9E4  F5          PRINTC:	PUSH	AF
 1695 C9E5  3A B7E1     	LD	A,(HCPZ)
 1696 C9E8  CB 7F       	BIT	7,A
 1697 C9EA  28 29       	JR	Z,PRINT3	; Drucker
 1698                   	;Schreibmaschine
 1699 C9EC  E6 F0       	AND	0F0H
 1700 C9EE  FE 90       	CP	90H
 1701 C9F0  28 17       	JR	Z,S6005
 1702 C9F2  FE A0       	CP	0A0H
 1703 C9F4  20 1F       	JR	NZ,PRINT3
 1704 C9F6  F1          S6010:	POP	AF
 1705 C9F7  E5          	PUSH	HL
 1706 C9F8  C5          	PUSH	BC
 1707 C9F9  21 D96A     	LD	HL,ZIBM
 1708 C9FC  01 0007     	LD	BC,7
 1709 C9FF  ED B1       	CPIR
 1710 CA01  20 0F       	JR	NZ,PRINT1
 1711 CA03  0E 06       	LD	C,6
 1712 CA05  09          	ADD	HL,BC
 1713 CA06  7E          	LD	A,(HL)
 1714 CA07  18 09       	JR	PRINT1
 1715                   
 1716 CA09  F1          S6005:	POP	AF
 1717 CA0A  FE 7E       	CP	7EH
 1718 CA0C  20 08       	JR	NZ,PRINT4
 1719 CA0E  3E 83       	LD	A,83H
 1720 CA10  18 04       	JR	PRINT4
 1721 CA12  C1          PRINT1:	POP	BC
 1722 CA13  E1          	POP	HL
 1723 CA14  F5          	PUSH	AF
 1724 CA15  F1          PRINT3:	POP	AF
 1725 CA16  FE 09       PRINT4:	CP	9		; CUR
 1726 CA18  28 0D       	JR	Z,PRINT5
 1727 CA1A  F5          	PUSH	AF
 1728 CA1B  3A B7A2     	LD	A,(STBT)
 1729 CA1E  CB 5F       	BIT	3,A		; Steuerzeichen
 1730 CA20  28 0E       	JR	Z,PRINT7	; ausfuehren
 1731 CA22  F1          	POP	AF
 1732 CA23  FE 7F       	CP	7FH		; und 7Fh
 1733 CA25  20 02       	JR	NZ,PRINT6

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  39
CC46    INC

 1734 CA27  3E 20       PRINT5:	LD	A,20H		; nach SPC
 1735 CA29  FE 20       PRINT6:	CP	20H		; und Steuerzeichen
 1736 CA2B  30 04       	JR	NC,PRINT8
 1737 CA2D  3E 5F       	LD	A,'_'		; nach '_' wandeln
 1738 CA2F  F5          	PUSH	AF
 1739 CA30  F1          PRINT7:	POP	AF
 1740 CA31  C3 B7E9     PRINT8:	JP	OFILT		; in IRM
 1741                   
 1742                   ; ShCLR-Reaktionsprogramm
 1743                   
 1744 CA34  E5          HCPGMC:	PUSH	HL
 1745 CA35  D5          	PUSH	DE
 1746 CA36  3A B7E1     	LD	A,(HCPZ)
 1747 CA39  CB 47       	BIT	0,A		; Hardcopy?
 1748 CA3B  20 2C       	JR	NZ,COPIES
 1749                   
 1750                   ; Protokollfunktion
 1751                   
 1752 CA3D  2A B7B9     	LD	HL,(OUTAB)
 1753 CA40  5F          	LD	E,A		; E = (HCPZ)
 1754 CA41  7E          	LD	A,(HL)
 1755 CA42  A7          	AND	A		; CRT?
 1756 CA43  20 10       	JR	NZ,PROTO2
 1757 CA45  CB 4B       	BIT	1,E		; USER1/2?
 1758 CA47  21 FA0A     	LD	HL,ECHO		; CRT+PRINT
 1759 CA4A  11 FC17     	LD	DE,ZEI3		; UOUT2
 1760 CA4D  20 10       	JR	NZ,PROTO3
 1761 CA4F  1B          	DEC	DE		; UOUT1
 1762 CA50  22 B7BE     PROTO4:	LD	(UOUT1 + 1),HL
 1763 CA53  18 0D       	JR	PROTO5
 1764                   	;
 1765 CA55  21 FA0D     PROTO2:	LD	HL,PRINT	; Protokoll deaktivieren
 1766 CA58  11 FC14     	LD	DE,ZEI0		; CRT
 1767 CA5B  FE 02       	CP	2
 1768 CA5D  28 F1       	JR	Z,PROTO4
 1769 CA5F  22 B7C4     PROTO3:	LD	(UOUT2 + 1),HL
 1770 CA62  ED 53 B7B9  PROTO5:	LD	(OUTAB),DE	; Zeiger
 1771 CA66  D1          	POP	DE
 1772 CA67  E1          	POP	HL
 1773 CA68  C9          	RET
 1774                   
 1775                   ; Hard- oder Screencopy
 1776                   
 1777 CA69  C5          COPIES:	PUSH	BC
 1778 CA6A  F5          	PUSH	AF
 1779 CA6B  E6 F0       	AND	0F0H
 1780 CA6D  F2 CA94     	JP	P,HCOPYC	; Hardcopy
 1781                   
 1782                   ; Screencopy
 1783                   
 1784 CA70  2A B7CB     	LD	HL,(VRAM)
 1785 CA73  06 20       	LD	B,32
 1786 CA75  0E 28       SCOPY1:	LD	C,40
 1787 CA77  7E          SCOPY2:	LD	A,(HL)
 1788 CA78  23          	INC	HL
 1789 CA79  FE 20       	CP	20H
 1790 CA7B  30 02       	JR	NC,SCOPY4
 1791 CA7D  3E 20       	LD	A,' '		; statt Steuerzeichen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  40
CC46    INC

 1792 CA7F  CD FA0D     SCOPY4:	CALL	PRINT
 1793 CA82  0D          	DEC	C		; 40 Spalten
 1794 CA83  20 F2       	JR	NZ,SCOPY2
 1795 CA85  3E 0D       	LD	A,CR
 1796 CA87  CD CA16     	CALL	PRINT4
 1797 CA8A  3E 0A       	LD	A,LF
 1798 CA8C  CD CA16     	CALL	PRINT4
 1799 CA8F  10 E4       	DJNZ	SCOPY1		; 32 Zeilen
 1800 CA91  C3 E09C     HCEND:	JP	POP4		; POP	AF,BC,DE,HL   RET
 1801                   
 1802 CA94              HCOPYC:	;..nach Typ verzweigen
 1803 CA94  E6 F0       	AND	0F0H
 1804 CA96  FE 10       	CP	10H
 1805 CA98  CA CB62     	JP	Z,K6314		; ESC/P breit
 1806 CA9B  FE 20       	CP	20H
 1807 CA9D  CA CBA0     	JP	Z,K6311		; mit ANSI
 1808 CAA0  FE 30       	CP	30H
 1809 CAA2  CA CBCE     	JP	Z,K6312		; ANSI breit
 1810 CAA5  FE 50       	CP	50H
 1811 CAA7  28 3B       	JR	Z,HCMIN		; ESC/P2 (Mini)
 1812 CAA9  FE 70       	CP	70H
 1813 CAAB  28 67       	JR	Z,ESCP2		; ESC/P2 24 Nadel
 1814                   
 1815                   ; K6313, K6304, ESC/P2 mit 8 Nadeln
 1816                   
 1817 CAAD  26 00       K6313:	LD	H,0		; Zeile 0
 1818 CAAF  CD CC8E     K6313a:	CALL	PRZK		; Grafik init
 1819 CAB2  2E 00       	LD	L,0		; Spalte 0
 1820 CAB4  0E 08       K6313b:	LD	C,8
 1821 CAB6  CD CBFA     	CALL	CBYTES
 1822 CAB9  E5          	PUSH	HL
 1823 CABA  06 08       K6313c:	LD	B,8
 1824 CABC  21 B700     	LD	HL,CASS
 1825 CABF  CB 16       K6313d:	RL 	(HL)
 1826 CAC1  17          	RLA
 1827 CAC2  23          	INC	HL
 1828 CAC3  10 FA       	DJNZ	K6313d
 1829 CAC5  CD B7E9     	CALL	OFILT
 1830 CAC8  0D          	DEC	C
 1831 CAC9  20 EF       	JR	NZ,K6313c	; naechster Cursor
 1832 CACB  E1          	POP	HL
 1833 CACC  2C          	INC	L
 1834 CACD  3E 28       	LD	A,40
 1835 CACF  BD          	CP	L
 1836 CAD0  20 E2       	JR	NZ,K6313b
 1837 CAD2  7C          	LD	A,H
 1838 CAD3  C6 08       	ADD	A,8		; naechste Zeile
 1839 CAD5  67          	LD	H,A
 1840 CAD6  30 D7       	JR	NC,K6313a
 1841 CAD8  3E 0D       HCCRLF:	LD	A,CR
 1842 CADA  CD B7E9     	CALL	OFILT
 1843 CADD  3E 0A       	LD	A,LF
 1844 CADF  CD B7E9     	CALL	OFILT
 1845 CAE2  18 AD       	JR	HCEND
 1846                   
 1847                   ; ESC/P2 Miniformat
 1848                   
 1849 CAE4  21 0000     HCMIN:	LD	HL,0		; Zeile=0, Spalte=0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  41
CC46    INC

 1850 CAE7  CD CC8E     MINIa:	CALL	PRZK
 1851 CAEA  0E 18       MINIb:	LD	C,24		; 24 Pixel
 1852 CAEC  CD CBFA     	CALL	CBYTES
 1853 CAEF  CD CC6F     	CALL	S3PRS
 1854 CAF2  20 F6       	JR	NZ,MINIb
 1855 CAF4  7C          	LD	A,H
 1856 CAF5  C6 18       	ADD	A,24
 1857 CAF7  67          	LD	H,A
 1858 CAF8  2E 00       	LD	L,0		; Spalte=0
 1859 CAFA  FE F0       	CP	240
 1860 CAFC  20 E9       	JR	NZ,MINIa
 1861 CAFE  CD CC8E     	CALL	PRZK
 1862 CB01  0E 10       MINIc:	LD	C,16
 1863 CB03  CD CBFA     	CALL	CBYTES
 1864 CB06  06 08       	LD	B,8
 1865 CB08  AF          	XOR	A
 1866 CB09  12          MINId:	LD	(DE),A		; 8 Nadeln frei
 1867 CB0A  13          	INC	DE
 1868 CB0B  10 FC       	DJNZ	MINId
 1869 CB0D  CD CC6F     	CALL	S3PRS
 1870 CB10  20 EF       	JR	NZ,MINIc
 1871 CB12  18 C4       	JR	HCCRLF
 1872                   
 1873                   ; ESC/P2 mit 24 Nadeln
 1874                   
 1875 CB14  26 00       ESCP2:	LD	H,0		; Zeile 0
 1876 CB16  CD CC8E     ESCP2a:	CALL	PRZK
 1877 CB19  2E 00       	LD	L,0		; Spalte 0
 1878 CB1B  06 08       ESCP2b:	LD	B,8		; 8 Pixel
 1879 CB1D  E5          	PUSH	HL
 1880 CB1E  CD E051     	CALL	PADR
 1881 CB21  11 B700     	LD	DE,CASS
 1882 CB24  7E          ESCP2c:	LD	A,(HL)
 1883 CB25  12          	LD	(DE),A
 1884 CB26  13          	INC	DE
 1885 CB27  12          	LD	(DE),A		; 3 mal ablegen
 1886 CB28  13          	INC	DE
 1887 CB29  12          	LD	(DE),A
 1888 CB2A  13          	INC	DE
 1889 CB2B  2C          	INC	L
 1890 CB2C  10 F6       	DJNZ	ESCP2c
 1891 CB2E  0E 08       	LD	C,8
 1892 CB30  06 18       ESCP2d:	LD	B,24		; 3*8 Bytes
 1893 CB32  21 B700     	LD	HL,CASS
 1894 CB35  CB 16       ESCP2e:	RL	(HL)
 1895 CB37  CB 13       	RL	E
 1896 CB39  CB 12       	RL	D
 1897 CB3B  17          	RLA
 1898 CB3C  23          	INC	HL
 1899 CB3D  10 F6       	DJNZ	ESCP2e		; Wandlung
 1900 CB3F  77          	LD	(HL),A
 1901 CB40  06 03       	LD	B,3		; 3 mal drucken
 1902 CB42  7E          ESCP2f:	LD	A,(HL)
 1903 CB43  CD B7E9     	CALL	OFILT		; 1.
 1904 CB46  7A          	LD	A,D
 1905 CB47  CD B7E9     	CALL	OFILT		; 2.
 1906 CB4A  7B          	LD	A,E
 1907 CB4B  CD B7E9     	CALL	OFILT		; 3. Byte

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  42
CC46    INC

 1908 CB4E  10 F2       	DJNZ	ESCP2f
 1909 CB50  0D          	DEC	C
 1910 CB51  20 DD       	JR	NZ,ESCP2d
 1911 CB53  E1          	POP	HL
 1912 CB54  2C          	INC	L
 1913 CB55  3E 28       	LD	A,40		; Zeilenende?
 1914 CB57  BD          	CP	L
 1915 CB58  20 C1       	JR	NZ,ESCP2b
 1916 CB5A  7C          	LD	A,H
 1917 CB5B  C6 08       	ADD	A,8
 1918 CB5D  67          	LD	H,A
 1919 CB5E  30 B6       	JR	NC,ESCP2a
 1920 CB60  18 3B       	JR	JHCRLF
 1921                   
 1922                   ; ESC/P 9-Nadeln (breit)
 1923                   
 1924 CB62  26 00       K6314:	LD	H,0
 1925 CB64  CD CC8E     K6314a:	CALL	PRZK
 1926 CB67  2E 00       	LD	L,0
 1927 CB69  06 04       K6314b:	LD	B,4
 1928 CB6B  E5          	PUSH	HL
 1929 CB6C  CD E051     	CALL	PADR
 1930 CB6F  11 B700     	LD	DE,CASS
 1931 CB72  7E          K6314c:	LD	A,(HL)
 1932 CB73  12          	LD	(DE),A
 1933 CB74  13          	INC	DE
 1934 CB75  12          	LD	(DE),A
 1935 CB76  13          	INC	DE
 1936 CB77  2C          	INC	L
 1937 CB78  10 F8       	DJNZ	K6314c		; 4*
 1938 CB7A  0E 08       	LD	C,8
 1939 CB7C  06 08       K6314d:	LD	B,8
 1940 CB7E  21 B700     	LD	HL,CASS
 1941 CB81  CB 16       K6314e:	RL 	(HL)
 1942 CB83  17          	RLA
 1943 CB84  23          	INC	HL
 1944 CB85  10 FA       	DJNZ	K6314e
 1945 CB87  CD B7E9     	CALL	OFILT
 1946 CB8A  CD B7E9     	CALL	OFILT
 1947 CB8D  0D          	DEC	C
 1948 CB8E  20 EC       	JR	NZ,K6314d
 1949 CB90  E1          	POP	HL
 1950 CB91  2C          	INC	L
 1951 CB92  3E 28       	LD	A,40
 1952 CB94  BD          	CP	L
 1953 CB95  20 D2       	JR	NZ,K6314b
 1954 CB97  7C          	LD	A,H
 1955 CB98  C6 04       	ADD	A,4
 1956 CB9A  67          	LD	H,A
 1957 CB9B  30 C7       	JR	NC,K6314a
 1958 CB9D  C3 CAD8     JHCRLF:	JP	HCCRLF
 1959                   
 1960                   ; ANSI-Drucker
 1961                   
 1962 CBA0  CD CC8E     K6311:	CALL	PRZK
 1963 CBA3  06 2A       	LD	B,256/6
 1964 CBA5  21 0000     	LD	HL,0
 1965 CBA8  0E 06       K6311a:	LD	C,6

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  43
CC46    INC

 1966 CBAA  CD CBFA     	CALL	CBYTES
 1967 CBAD  CD CC1B     	CALL	SPRS		; 6*8-Feld ausg.
 1968 CBB0  20 F6       	JR	NZ,K6311a
 1969 CBB2  3E 06       	LD	A,6		; 6 Pixel tiefer
 1970 CBB4  84          	ADD	A,H
 1971 CBB5  67          	LD	H,A
 1972 CBB6  2E 00       	LD	L,0
 1973 CBB8  CD CC8E     	CALL	PRZK
 1974 CBBB  05          	DEC	B
 1975 CBBC  20 EA       	JR	NZ,K6311a
 1976 CBBE  0E 04       K6311b:	LD	C,256 MOD 6	; den Rest
 1977 CBC0  CD CBFA     	CALL	CBYTES
 1978 CBC3  AF          	XOR	A
 1979 CBC4  12          	LD	(DE),A		; letzte beiden
 1980 CBC5  13          	INC	DE		; Zeilen leeren
 1981 CBC6  12          	LD	(DE),A
 1982 CBC7  CD CC1B     	CALL	SPRS
 1983 CBCA  20 F2       	JR	NZ,K6311b
 1984 CBCC  18 CF       	JR	JHCRLF
 1985                   
 1986                   ; ANSI breit
 1987                   
 1988 CBCE  CD CC8E     K6312:	CALL	PRZK
 1989 CBD1  06 55       	LD	B,256/3
 1990 CBD3  21 0000     	LD	HL,0
 1991 CBD6  0E 03       K6312a:	LD	C,3
 1992 CBD8  CD CC09     	CALL	CBYTS2
 1993 CBDB  CD CC44     	CALL	S2PRS
 1994 CBDE  20 F6       	JR	NZ,K6312a
 1995 CBE0  24          	INC	H
 1996 CBE1  24          	INC	H
 1997 CBE2  24          	INC	H
 1998 CBE3  2E 00       	LD	L,0
 1999 CBE5  CD CC8E     	CALL	PRZK
 2000 CBE8  10 EC       	DJNZ	K6312a
 2001 CBEA  0E 04       K6312b:	LD	C,256 MOD 6	; den Rest
 2002 CBEC  CD CC09     	CALL	CBYTS2
 2003 CBEF  AF          	XOR	A
 2004 CBF0  12          	LD	(DE),A
 2005 CBF1  13          	INC	DE
 2006 CBF2  12          	LD	(DE),A
 2007 CBF3  CD CC44     	CALL	S2PRS
 2008 CBF6  20 F2       	JR	NZ,K6312b
 2009 CBF8  18 A3       	JR	JHCRLF
 2010                   
 2011                   ; C Bytes zum Puffer
 2012                   
 2013 CBFA  E5          CBYTES:	PUSH	HL
 2014 CBFB  C5          	PUSH	BC
 2015 CBFC  CD E051     	CALL	PADR
 2016 CBFF  11 B700     	LD	DE,CASS
 2017 CC02  06 00       	LD	B,0
 2018 CC04  ED B0       	LDIR
 2019 CC06  C1          	POP	BC
 2020 CC07  E1          	POP	HL
 2021 CC08  C9          	RET
 2022                   
 2023                   ; C Bytes zum Puffer & doppeln

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  44
CC46    INC

 2024                   
 2025 CC09  E5          CBYTS2:	PUSH	HL
 2026 CC0A  CD E051     	CALL	PADR
 2027 CC0D  11 B700     	LD	DE,CASS
 2028 CC10  7E          C2BYTL:	LD	A,(HL)
 2029 CC11  12          	LD	(DE),A
 2030 CC12  13          	INC	DE
 2031 CC13  12          	LD	(DE),A
 2032 CC14  13          	INC	DE
 2033 CC15  2C          	INC	L
 2034 CC16  0D          	DEC	C
 2035 CC17  20 F7       	JR	NZ,C2BYTL
 2036 CC19  E1          	POP	HL
 2037 CC1A  C9          	RET
 2038                   
 2039                   ; 8* 6-Nadel-Sprosse ausgeben
 2040                   
 2041 CC1B  E5          SPRS:	PUSH	HL
 2042 CC1C  C5          	PUSH	BC
 2043 CC1D  2E 80       	LD	L,80H
 2044 CC1F  06 00       SPRS1:	LD	B,0
 2045 CC21  11 B700     	LD	DE,CASS
 2046 CC24  1A          SPRS2:	LD	A,(DE)
 2047 CC25  A5          	AND	L		; CY=0
 2048 CC26  28 01       	JR	Z,SPRS3
 2049 CC28  37          	SCF			; CY=1
 2050 CC29  CB 10       SPRS3:	RL 	B
 2051 CC2B  13          	INC	DE
 2052 CC2C  3E 06       	LD	A,6		; fuer 6 Bit
 2053 CC2E  BB          	CP	E
 2054 CC2F  20 F3       	JR	NZ,SPRS2	; ob. Nadel war 0
 2055 CC31  A7          	AND	A		; unt. Nadel = 0
 2056 CC32  CB 10       	RL 	B
 2057 CC34  78          	LD	A,B
 2058 CC35  CD B7E9     	CALL	OFILT
 2059 CC38  CB 0D       	RRC	L
 2060 CC3A  F2 CC1F     	JP	P,SPRS1
 2061 CC3D  C1          	POP	BC
 2062 CC3E  E1          	POP	HL
 2063 CC3F  2C          	INC	L
 2064 CC40  3E 28       	LD	A,40
 2065 CC42  BD          	CP	L
 2066 CC43  C9          	RET
 2067                   
 2068                   ; 8* 6-Nadel-Sprosse doppelt out
 2069                   
 2070 CC44  E5          S2PRS:	PUSH	HL
 2071 CC45  C5          	PUSH	BC
 2072 CC46  2E 80       	LD	L,80H
 2073 CC48  06 00       S2PR1:	LD	B,0
 2074 CC4A  11 B700     	LD	DE,CASS		; Kassetten-Puffer
 2075 CC4D  1A          S2PR2:	LD	A,(DE)
 2076 CC4E  A5          	AND	L
 2077 CC4F  28 01       	JR	Z,S2PR3
 2078 CC51  37          	SCF
 2079 CC52  CB 10       S2PR3:	RL 	B
 2080 CC54  13          	INC	DE
 2081 CC55  3E 06       	LD	A,6

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  45
CC46    INC

 2082 CC57  BB          	CP	E
 2083 CC58  20 F3       	JR	NZ,S2PR2
 2084 CC5A  78          	LD	A,B
 2085 CC5B  17          	RLA			; untere beiden
 2086 CC5C  17          	RLA			; Nadeln tot
 2087 CC5D  CD B7E9     	CALL	OFILT
 2088 CC60  CD B7E9     	CALL	OFILT
 2089 CC63  CB 0D       	RRC	L
 2090 CC65  F2 CC48     	JP	P,S2PR1
 2091 CC68  C1          	POP	BC
 2092 CC69  E1          	POP	HL
 2093 CC6A  2C          	INC	L
 2094 CC6B  3E 28       	LD	A,40
 2095 CC6D  BD          	CP	L
 2096 CC6E  C9          	RET
 2097                   
 2098                   ; 8* 24-Nadel-Sprosse ausgeben
 2099                   
 2100 CC6F  E5          S3PRS:	PUSH	HL
 2101 CC70  1E 08       	LD	E,8
 2102 CC72  0E 03       S3PR1:	LD	C,3		; 24 Nadeln = 3 Byte
 2103 CC74  21 B700     	LD	HL,CASS
 2104 CC77  06 08       S3PR2:	LD	B,8
 2105 CC79  CB 16       S3PR3:	RL	(HL)
 2106 CC7B  17          	RLA
 2107 CC7C  23          	INC	HL
 2108 CC7D  10 FA       	DJNZ	S3PR3		; Wandlung
 2109 CC7F  CD B7E9     	CALL	OFILT
 2110 CC82  0D          	DEC	C
 2111 CC83  20 F2       	JR	NZ,S3PR2
 2112 CC85  1D          	DEC	E
 2113 CC86  20 EA       	JR	NZ,S3PR1
 2114 CC88  E1           	POP	HL
 2115 CC89  2C          	INC	L
 2116 CC8A  3E 28       	LD	A,40
 2117 CC8C  BD          	CP	L
 2118 CC8D  C9          	RET
 2119                   
 2120                   ; Druckerinitialisierung entsprechend HCPZ
 2121                   
 2122 CC8E  E5          PRZK:	PUSH	HL
 2123 CC8F  C5          	PUSH	BC
 2124 CC90  AF          	XOR	A
 2125 CC91  21 B7E1     	LD	HL,HCPZ
 2126 CC94  ED 6F       	RLD
 2127 CC96  4F          	LD	C,A		; Druckertyp
 2128 CC97  ED 67       	RRD
 2129 CC99  0C          	INC	C
 2130 CC9A  21 CCB4     	LD	HL,C6313
 2131 CC9D  46          PRZK1:	LD	B,(HL)		; Laenge
 2132 CC9E  0D          	DEC	C
 2133 CC9F  28 09       	JR	Z,PRZK2
 2134 CCA1  04          	INC	B
 2135 CCA2  7D          	LD	A,L
 2136 CCA3  80          	ADD	A,B
 2137 CCA4  6F          	LD	L,A
 2138 CCA5  30 F6       	JR	NC,PRZK1
 2139 CCA7  24          	INC	H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  46
CC46    INC

 2140 CCA8  18 F3       	JR	PRZK1
 2141 CCAA  23          PRZK2:	INC	HL
 2142 CCAB  7E          	LD	A,(HL)
 2143 CCAC  CD B7E9     	CALL	OFILT
 2144 CCAF  10 F9       	DJNZ	PRZK2
 2145 CCB1  C1          	POP	BC
 2146 CCB2  E1          	POP	HL
 2147 CCB3  C9          	RET
 2148                   
 2149                   ; Grafiksteuersequenzen fuer die Drucker
 2150                   
 2151 CCB4  0A          C6313:	DB	10		; Laenge
 2152 CCB5  0D 09       	DB	CR,9
 2153 CCB7  1B 4A 18    	DB	ESC,'J',24
 2154 CCBA  1B 2A 05    	DB	ESC,'*',5
 2155 CCBD  0140        	DW	320
 2156                   
 2157 CCBF  0A          C6314:	DB	10		; Laenge
 2158 CCC0  0D 09       	DB	CR,9
 2159 CCC2  1B 4A 18    	DB	ESC,'J',24
 2160 CCC5  1B 2A 05    	DB	ESC,'*',5
 2161 CCC8  0280        	DW	640
 2162                   
 2163 CCCA  0E          C6311:	DB	14		; Laenge
 2164 CCCB  1B 5B 30 31 	DB	ESC,'[01e'
 2165 CCD0  1B 5B 31 32 	DB	ESC,'[12`'
 2166 CCD5  1B 4B       	DB	ESC,'K'
 2167 CCD7  0140        	DW	320
 2168                   
 2169 CCD9  0E          C6312:	DB	14		; Laenge
 2170 CCDA  1B 5B 30 31 	DB	ESC,'[01e'
 2171 CCDF  1B 5B 31 32 	DB	ESC,'[12`'
 2172 CCE4  1B 4B       	DB	ESC,'K'
 2173 CCE6  0280        	DW	640
 2174                   
 2175 CCE8  09          C6304:	DB	9		; Laenge
 2176 CCE9  0D 09       	DB	CR,9
 2177 CCEB  1B 4A 18    	DB	ESC,'J',24
 2178 CCEE  1B 4B       	DB	ESC,'K'
 2179 CCF0  0140        	DW	320
 2180                   
 2181 CCF2  0A          CMINI:	DB	10		; Laenge
 2182 CCF3  0D 09       	DB	CR,9
 2183 CCF5  1B 4A 18    	DB	ESC,'J',24
 2184 CCF8  1B 2A 27    	DB	ESC,'*',39
 2185 CCFB  0140        	DW	320
 2186                   
 2187 CCFD  0A          C24N1:	DB	10		; Laenge
 2188 CCFE  0D 09       	DB	CR,9
 2189 CD00  1B 4A 18    	DB	ESC,'J',24
 2190 CD03  1B 2A 00    	DB	ESC,'*',0
 2191 CD06  0140        	DW	320
 2192                   
 2193 CD08  0A          C24N2:	DB	10		; Laenge
 2194 CD09  0D 09       	DB	CR,9
 2195 CD0B  1B 4A 18    	DB	ESC,'J',24
 2196 CD0E  1B 2A 27    	DB	ESC,'*',39
 2197 CD11  03C0        	DW	960

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  47
CC46    INC

 2198                   
 2199                   ; V.24-Tabellen, zum Kopieren in den IRM ab A800H:
 2200                   
 2201 CD13  00          V24TAB:	DB	0		; Steckplatz M003 (Aktualisierung durch Suche)
 2202                   
 2203                   ; Kanal 1 - Druckerausgabe (9600 Baud)
 2204 CD14  47          	DB	01000111b	; CTC: DI, Zaehler, neg. Flanke, RESET
 2205 CD15  5B          	DB	91		; Zeitkonstante
 2206 CD16  04 04       	DB	4,00000100b	; WR4: Vorteiler=1, 1 Stop-Bit, ohne Paritaet
 2207 CD18  03 20       	DB	3,00100000b	; WR3: Empfaenger aus, CTS+DCD-Steuerung
 2208 CD1A  05 6A       	DB	5,01101010b	; WR5: Sender ein, 8Bit, /DTR=1, RTS=1
 2209                   
 2210                   ; Kanal 2 - Duplex (1200 Baud)
 2211 CD1C  47          	DB	01000111b	; CTC: DI, Zaehler, neg. Flanke, RESET
 2212 CD1D  2E          	DB	46		; Zeitkonstante
 2213 CD1E  18          	DB	00011000b	; Port-RESET
 2214 CD1F  04 44       	DB	4,01000100b	; WR4: Vorteiler=16, 1 Stop-Bit, ohne Paritaet
 2215 CD21  03 E1       	DB	3,11100001b	; WR3: Empfaenger ein, 8Bit, CTS+DCD-Steuerung
 2216 CD23  05 6A       	DB	5,01101010b	; WR5: Sender ein, 8Bit, /DTR=1, RTS=1
 2217                   
 2218                   ; Initialisierung SIO-B fuer Empfangs-Interrupt (1200 Baud):
 2219                   
 2220 CD25  02          V24UMT:	DB	2		; 2 Ports
 2221 CD26  0D 02       	 DB	0Dh,2		; CTC1
 2222 CD28  47          	  DB	01000111b	; DI, Zaehler, neg. Flanke, ZK folgt, RESET
 2223 CD29  2E          	  DB	46		; Zeitkonstante
 2224 CD2A  0B 0B       V24INT:	 DB	0Bh,11		; SIO-B Steuerwort
 2225 CD2C  18          	  DB	00011000b	; Port-RESET
 2226 CD2D  02 E2       	  DB	2,0E2h		; WR2: INT-Vektor
 2227 CD2F  04 44       	  DB	4,01000100b	; WR4: Vorteiler=16, 1 Stop-Bit, ohne Paritaet
 2228 CD31  03 E1       	  DB	3,11100001b	; WR3: Empfaenger ein, 8Bit, CTS/DCD-Steuerung
 2229 CD33  05 EA       	  DB	5,11101010b	; WR5: Sender ein, 8Bit, /DTR=0 (bereit), RTS=1
 2230 CD35  11 18       	  DB	11h,00011000b	; WR1: Interrupt bei Zeichenempfang
 2231                   
 2232                   ; Initialisierung SIO-B fuer Polling-Betrieb:
 2233                   
 2234 CD37  0B 07       V24POL:	DB	0Bh,7		; SIO-B Steuerwort, 7 Byte
 2235 CD39  18          	 DB	00011000b	; Port RESET
 2236 CD3A  04 44       	 DB	4,01000100b	; Vorteiler 16, 1 Stop-Bit, ohne Paritaet
 2237 CD3C  03 E1       	 DB	3,11100001b	; Empfaenger ein, 8 Bit, CTS/DCD-Steuerung
 2238 CD3E  05 6A       	 DB	5,01101010b	; Sender ein, 8 Bit, DTR aus, RTS ein
 2239                   
 2240                   ; Byteweise MB-Ausgabe
 2241                   
 2242 CD40  5A          MBOC:	LD	E,D		; Steuerbyte
 2243 CD41  57          	LD	D,A		; Datenbyte
 2244 CD42  D5          	PUSH	DE
 2245 CD43  C5          	PUSH	BC
 2246 CD44  CB 5B       	BIT	3,E
 2247 CD46  28 29       	JR	Z,NOINIT
 2248 CD48  DD CB 07 CE 	SET	1,(IX+7)	; merken INIT
 2249 CD4C  3E D5       	LD	A,'U'+80H
 2250 CD4E  BE          	CP	(HL)
 2251 CD4F  D5          	PUSH	DE
 2252 CD50  11 00A0     	LD	DE,160		; Vortonlaenge
 2253 CD53  20 03       	JR	NZ,NOHIU
 2254 CD55  11 0500     	LD	DE,1280		; bei 'U' gedehnt
 2255 CD58  ED 53 B7D8  NOHIU:	LD	(VORTN),DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  48
CC46    INC

 2256 CD5C  11 B700     	LD	DE,CASS
 2257 CD5F  01 000B     	LD	BC,11
 2258 CD62  ED B0       	LDIR			; Name
 2259 CD64  EB          	EX	DE,HL
 2260 CD65  D1          	POP	DE
 2261 CD66  72          	LD	(HL),D		; 1.Byte
 2262 CD67  2C          	INC	L
 2263 CD68  7D          MBOC1:	LD	A,L
 2264 CD69  32 B7DA     	LD	(DTPTR),A
 2265 CD6C  C1          MBOCE:	POP	BC
 2266 CD6D  D1          	POP	DE
 2267 CD6E  CB 9B       	RES	3,E
 2268 CD70  C9          	RET
 2269                   	;
 2270 CD71  2A B7DA     NOINIT:	LD	HL,(DTPTR)
 2271 CD74  26 B7       	LD	H,0B7H
 2272 CD76  72          	LD	(HL),D		; Byte eintragen
 2273 CD77  CB 73       	BIT	6,E
 2274 CD79  20 1F       	JR	NZ,MCLOS	; Close
 2275 CD7B  2C          	INC	L
 2276 CD7C  F2 CD68     	JP	P,MBOC1
 2277 CD7F  DD CB 07 4E 	BIT	1,(IX+7)
 2278 CD83  20 08       	JR	NZ,MBOC2	; erst mal Init!
 2279 CD85  CD CE8F     	CALL	MBLO		; Block ausgeben
 2280 CD88  21 B700     MBOC6:	LD	HL,CASS
 2281 CD8B  18 DB       	JR	MBOC1
 2282                   	;
 2283 CD8D  DD CB 07 8E MBOC2:	RES	1,(IX+7)	; ruecksetzen
 2284 CD91  CD F04F     	CALL	PV1		; Init
 2285 CD94  08          	DB	08H		; ISRO
 2286 CD95  CD CE97     	CALL	MBLNR		; Blocknr.
 2287 CD98  18 EE       	JR	MBOC6
 2288                   	;
 2289 CD9A  DD CB 07 4E MCLOS:	BIT	1,(IX+7)	; Init?
 2290 CD9E  28 06       	JR	Z,MBOC3
 2291 CDA0  CD F04F     	CALL	PV1		; erst noch Init!
 2292 CDA3  08          	DB	08H		; ISRO
 2293 CDA4  18 03       	JR	MBOC4
 2294                   	;
 2295 CDA6  CD CE8F     MBOC3:	CALL	MBLO		; Block ausgeben
 2296 CDA9  ED 4B B7D8  MBOC4:	LD	BC,(VORTN)
 2297 CDAD  CD F04F     	CALL	PV1		; Endeblock
 2298 CDB0  09          	DB	09H		; CSRO
 2299 CDB1  D5          MBOC5:	PUSH	DE
 2300 CDB2  CD F04F     	CALL	PV1
 2301 CDB5  0B          	DB	0BH		; CSRI
 2302 CDB6  DD CB 07 AE 	RES	5,(IX+7)	; 'U'-Merker ruecksetzen
 2303 CDBA  D1          	POP	DE
 2304 CDBB  18 AF       	JR	MBOCE
 2305                   
 2306                   ; Byteweise MB-Eingabe
 2307                   
 2308 CDBD  5A          MBIC:	LD	E,D		; Steuerbyte
 2309 CDBE  57          	LD	D,A		; Datenbyte (PA!)
 2310 CDBF  D5          	PUSH	DE
 2311 CDC0  C5          	PUSH	BC
 2312 CDC1  CB 73       	BIT	6,E		; Close?
 2313 CDC3  20 EC       	JR	NZ,MBOC5

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  49
CC46    INC

 2314 CDC5  CB 5B       	BIT	3,E		; Init?
 2315 CDC7  28 62       	JR	Z,MBIU
 2316 CDC9  E5          	PUSH	HL
 2317 CDCA  CD F04F     	CALL	PV1		; Block 01h einlesen
 2318 CDCD  0A          	DB	0AH		; ISRI
 2319 CDCE  E1          MBIC1:	POP	HL
 2320 CDCF  DA CE7E     	JP	C,JBLERR	; Fehler: '*'
 2321 CDD2  DD 7E 02    	LD	A,(IX+2)	; gelesener Block
 2322 CDD5  FE 01       	CP	1
 2323 CDD7  C2 CE7E     	JP	NZ,JBLERR	; Fehler: '*'
 2324 CDDA  DD CB 07 BE 	RES	7,(IX+7)	; Kopfblock geladen
 2325 CDDE  DD 34 03    	INC	(IX+3)		; naechster erwarteter Block
 2326 CDE1  11 B700     	LD	DE,CASS
 2327 CDE4  06 0B       	LD	B,11
 2328 CDE6  1A          	LD	A,(DE)
 2329 CDE7  FE D5       	CP	'U'+80H		; hohes 'U'?
 2330 CDE9  20 04       	JR	NZ,MBIC2
 2331 CDEB  DD CB 07 EE 	SET	5,(IX+7)	; merken zur Blocknummernausgabeunterdrueckung
 2332 CDEF  C6 29       MBIC2:	ADD	A,29H
 2333 CDF1  30 12       	JR	NC,MBIC3
 2334 CDF3  1A          	LD	A,(DE)		; geschuetzte BASIC-Programme
 2335 CDF4  D6 04       	SUB	4		; als ungeschuetzt anzeigen
 2336 CDF6  12          	LD	(DE),A
 2337 CDF7  13          	INC	DE
 2338 CDF8  12          	LD	(DE),A
 2339 CDF9  13          	INC	DE
 2340 CDFA  12          	LD	(DE),A
 2341 CDFB  32 035E     	LD	(DATFLG),A	; <=hier LIST/EDIT/BYE-Schutz setzen
 2342 CDFE  DD CB 07 F6 	SET	6,(IX+7)	; merken wofuer?
 2343 CE02  11 B700     	LD	DE,CASS
 2344 CE05  1A          MBIC3:	LD	A,(DE)		; Name aus Kassettenpuffer
 2345 CE06  CD E091     	CALL	CRT		; anzeigen
 2346 CE09  BE          	CP	(HL)		; stimmt Name?
 2347 CE0A  28 04       	JR	Z,MBIC4
 2348 CE0C  DD CB 07 FE 	SET	7,(IX+7)	; nein-merken
 2349 CE10  23          MBIC4:	INC	HL
 2350 CE11  13          	INC	DE
 2351 CE12  10 F1       	DJNZ	MBIC3
 2352 CE14  CD F4E7     	CALL	CRLF
 2353 CE17  DD CB 07 7E 	BIT	7,(IX+7)
 2354 CE1B  C2 EDC3     	JP	NZ,JIOERR	 ; Name falsch -> ?IO ERROR
 2355 CE1E  EB          	EX	DE,HL
 2356 CE1F  56          MBIC5:	LD	D,(HL)		; Daten lesen
 2357 CE20  2C          	INC	L
 2358 CE21  7D          	LD	A,L
 2359 CE22  32 B7DA     	LD	(DTPTR),A
 2360 CE25  7A          	LD	A,D
 2361 CE26  C1          	POP	BC
 2362 CE27  D1          	POP	DE
 2363 CE28  CB 9B       	RES	3,E
 2364 CE2A  C9          	RET
 2365                   
 2366 CE2B  2A B7DA     MBIU:	LD	HL,(DTPTR)
 2367 CE2E  26 B7       	LD	H,HIGH(CASS)
 2368 CE30  CB 7D       	BIT	7,L
 2369 CE32  28 EB       	JR	Z,MBIC5		; aus Puffer
 2370 CE34  CD F04F     MBIU1:	CALL	PV1		; einen Block lesen
 2371 CE37  05          	DB	05H		; MBI

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  50
CC46    INC

 2372 CE38  38 33       	JR	C,MERR
 2373 CE3A  3E FF       	LD	A,0FFH
 2374 CE3C  DD BE 02    	CP	(IX+2)		; Block FF?
 2375 CE3F  28 17       	JR	Z,MBIU3
 2376 CE41  DD 7E 03    	LD	A,(IX+3)
 2377 CE44  DD BE 02    	CP	(IX+2)		; erwarteter?
 2378 CE47  28 0F       	JR	Z,MBIU3
 2379 CE49  3E 2A       	LD	A,'*'
 2380 CE4B  CD E091     	CALL	CRT		; nicht erwartet
 2381 CE4E  CD F0C8     	CALL	BNROST
 2382 CE51  19 00       	DB	19H,0
 2383 CE53  CD CE9D     MBIU2:	CALL	JBRKT
 2384 CE56  18 DC       	JR	MBIU1
 2385                   	;
 2386 CE58  DD 34 03    MBIU3:	INC	(IX+3)		; naechsten Block erwarten
 2387 CE5B  3D          	DEC	A
 2388 CE5C  DD CB 07 6E 	BIT	5,(IX+7)
 2389 CE60  20 06       	JR	NZ,MBIU4
 2390 CE62  CD F0C8     	CALL	BNROST		; Blocknummer
 2391 CE65  3E 19 00    	DB	'>',19H,0	; unter Vorbehalt ausgeben
 2392 CE68  21 B700     MBIU4:	LD	HL,CASS
 2393 CE6B  18 B2       	JR	MBIC5
 2394                   	;
 2395 CE6D  CD F0CE     MERR:	CALL	OSTR
 2396 CE70  09 09 09 09 	DB	9,9,9,9,'?',0	; Fehler im Block
 2397 CE76  CD F0C8     	CALL	BNROST
 2398 CE79  0D 0A 00    	DB	CR,LF,0
 2399 CE7C  18 D5       	JR	MBIU2
 2400                   	;
 2401 CE7E  CD F0CE     JBLERR:	CALL	OSTR
 2402 CE81  2A 08 00    	DB	'*',8,0		; nicht erwarteter 1. Block
 2403 CE84  CD CE9D     	CALL	JBRKT
 2404 CE87  CD F04F     	CALL	PV1		; Block lesen
 2405 CE8A  05          	DB	05H		; MBI
 2406 CE8B  E5          	PUSH	HL
 2407 CE8C  C3 CDCE     	JP	MBIC1
 2408                   	;
 2409 CE8F  ED 4B B7D8  MBLO:	LD	BC,(VORTN)
 2410 CE93  CD F04F     	CALL	PV1		; Block ausgeben
 2411 CE96  01          	DB	01H		; MBO
 2412 CE97  CD F0C8     MBLNR:	CALL	BNROST
 2413 CE9A  3E 19 00    	DB	'>',19H,0
 2414 CE9D  CD E379     JBRKT:	CALL	BRKT		; bei BRK
 2415 CEA0  D0          	RET	NC		; auch ?IO ERROR
 2416 CEA1  C3 EDC3     	JP	JIOERR
 2417                   
 2418                   ; Tabelle der Modulnamen:
 2419                   
 2420 CEA4  01 53 54 41 MTAB:	DB	001H,'START-ROM',0	; M033 Typestar
 2421 CEAF  70 33 32 4B 	DB	070H,'32K EPROM',0	; M045
 2422 CEBA  71 36 34 4B 	DB	071H,'64K EPROM',0	; M046
 2423 CEC5  72 31 32 38 	DB	072H,'128K EPROM',0	; M047
 2424 CED1  73 32 35 36 	DB	073H,'256K EPROM',0	; M048
 2425                   ;	DB	074H,'512K EPROM',0	; reserviert!
 2426                   ;	DB	075H,'1M EPROM',0	; reserviert!
 2427 CEDD  77 36 34 4B 	DB	077H,'64K RAM',0	; M032 - 64k-Variante
 2428 CEE6  78 31 32 38 	DB	078H,'128K RAM',0	; M036
 2429 CEF0  79 32 35 36 	DB	079H,'256K RAM',0	; M032 - 256k-Variante

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  51
CC46    INC

 2430 CEFA  7A 35 31 32 	DB	07AH,'512K RAM',0	; M034
 2431 CF04  7B 31 4D 20 	DB	07BH,'1M RAM',0		; M035, M035x4
 2432                   ;	DB	07CH,'32K EEPROM',0	; reserviert!
 2433                   ;	DB	07DH,'64K EEPROM',0	; reserviert!
 2434                   ;	DB	07EH,'128K EEPROM',0	; reserviert!
 2435                   ;	DB	07FH,'256K EEPROM',0	; reserviert!
 2436 CF0C  A7 46 4C 4F 	DB	0A7H,'FLOPPY',0		; D004, D008
 2437 CF14  D9 45 50 52 	DB	0D9H,'EPROMMER 32K',0	; M030 (fuer 2k-32k EPROMs)
 2438 CF22  DA 50 49 4F 	DB	0DAH,'PIO-3',0		; M002
 2439 CF29  DB 45 50 52 	DB	0DBH,'EPROMMER 64K',0	; M030 (fuer 1k-64k EPROMs)
 2440 CF37  E3 44 41 55 	DB	0E3H,'DAU1',0		; M029
 2441 CF3D  E7 41 44 55 	DB	0E7H,'ADU1',0		; M010
 2442 CF43  EC 53 43 41 	DB	0ECH,'SCANNER',0	; M051 (KC-Club)
 2443 CF4C  EE 56 2E 32 	DB	0EEH,'V.24',0		; M003, M053
 2444 CF52  EF 44 49 47 	DB	0EFH,'DIGITAL I/O',0	; M001
 2445 CF5F  F0 38 4B 20 	DB	0F0H,'8K CMOS-RAM',0	; M120
 2446 CF6C  F1 31 36 4B 	DB	0F1H,'16K CMOS-RAM',0	; M122
 2447 CF7A  F2 33 32 4B 	DB	0F2H,'32K CMOS-RAM',0	; M124
 2448                   ;	DB	0F3H,'8*8K EPROM',0	; M062-RAM/ROM       (Sonderbehandlung!)
 2449 CF88  F4 31 36 4B 	DB	0F4H,'16K RAM',0	; M022
 2450 CF91  F5 33 32 4B 	DB	0F5H,'32K RAM',0	; M024
 2451 CF9A  F6 36 34 4B 	DB	0F6H,'64K RAM',0	; M011
 2452 CFA3  F7 38 4B 20 	DB	0F7H,'8K EPROM',0	; M025, M040
 2453 CFAD  F8 31 36 4B 	DB	0F8H,'16K EPROM',0	; M028, M040
 2454                   ;	DB	0F9H,'CP/M GIDE',0	; M064 (in Planung)
 2455                   ;	DB	0FBH,'8K SOFTWARE',0	; M012, M026, M027   (Sonderbehandlung!)
 2456 CFB8  FC 42 41 53 	DB	0FCH,'BASIC',0		; M006
 2457                   ;	DB	0FDH,'USB+NET',0	; M052               (Sonderbehandlung!)
 2458 CFBF  FF 3F 3F 3F 	DB	0FFH,'???',0		; unbekanntes Modul
 2459 CFC4  53 4F 46 54 MTAB1:	DB	'SOFTWARE'		; Standardanzeige falls ohne Menuewort
 2460 CFCC  00          MTAB2:	DB	0
 2461                   
 2462 CFCD  55 53 45 52 MUSER:	DB	'USER',0		; M005 (USER-Module C0-D7)
 2463                   	;
 2464 CFD2  55 53 42 2B M052A:	DB	'USB+NET',0		; M052 (USB+Netzwerk, 32K EEPROM 4 * 8K)
 2465 CFDA  55 53 42 00 M052B:	DB	'USB',0			; M052 (nur USB, 8K EEPROM)
 2466                   	;
 2467 CFDE  34 2A 38 4B M062A:	DB	'4*8K RAM',0		; M062-RAM (E. Mueller)
 2468 CFE7  38 2A 38 4B M062B:	DB	'8*8K EPROM',0		; M062-ROM (E. Mueller)
 2469                   
 2470                   	ABSFILL	0D000h,<ROM-C-Ende>
    7 CFF2  FF FF FF FF 	  DS	0D000h - $,0FFh
  141                   
  142                   	INCLUDE	CD46.INC	; ROM-D (D000-DAB7)
    1                   ;*****************************************
    2                   ;**	CAOS 4.6	ROM D		**
    3                   ;**					**
    4                   ;**	Adresse:  D000h bis DAB7h	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 03.03.2016	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0D000H
   10                   
   11                   ;*******************************************************************************
   12                   ;	CAOS 4.6 - Floppy-Treiber fuer D004/D008
   13                   ;*******************************************************************************
   14                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  52
CD46    INC

   15                   ; Eingabedatei oeffnen und Block 01 einlesen		** 0A **
   16                   ; PE:	HL	Dateiname
   17                   ; PA:	CY=1	Fehler
   18                   ;
   19 D000  DD 36 02 00 FISRID:	LD	(IX+2),0	; 1. Block lesen
   20 D004  DD 36 03 01 	LD	(IX+3),1	; erwarteter Block = 1
   21 D008  CD D0A4     	CALL	NAMOUT		; Dateiname ausgeben zum D004
   22 D00B  3E 09       	LD	A,9		; Lesen oeffnen
   23 D00D  21          	DB	21h		; LD HL,nn
   24                   ;
   25                   ; Einlesen Datenblock 128 Byte				** 05 **
   26                   ; PE:	(IX+3)	erwartete Blocknummer
   27                   ; PA:	(IX+2)	gelesene Blocknummer
   28                   ;	CY=1	Lesefehler
   29                   ; VR:	AF,BC
   30                   ;
   31 D00E  3E 01       FMBID:	LD	A,1		; Lesen normal
   32 D010  CD D05A     	CALL	STEUER
   33 D013  D8          	RET	C		; Fehler
   34 D014  0D          	DEC	C		; STBYT1 -> FDATA (80F2H)
   35 D015  E5          	PUSH	HL
   36 D016  DD 6E 05    	LD	L,(IX+5)
   37 D019  DD 66 06    	LD	H,(IX+6)	; Kassettenpuffer
   38 D01C  ED 78       FMBI1:	IN	A,(C)
   39 D01E  CD FB8E     	CALL	LDMAE		; Daten in Speicher ablegen
   40 D021  23          	INC	HL
   41 D022  04          	INC	B
   42 D023  20 F7       	JR	NZ,FMBI1	; CY von allen Befehlen nach RET C unbeeinflusst
   43 D025  E1          	POP	HL
   44                   ;	LD	A,(IX+3)	; erwarteten Block
   45                   ;	LD	(IX+2),A	; als gelesenen Block melden
   46 D026  DD 34 02    	INC	(IX+2)		; Blocknummer erhoehen
   47 D029  C9          	RET
   48                   ;
   49                   ; Eingabedatei schliessen				** 0B **
   50                   ; PE:
   51                   ; PA:	CY=1	bei Fehler
   52                   ;
   53 D02A  3E 41       FCSRID:	LD	A,41H		; READ - close
   54 D02C  18 2C       	JR	STEUER
   55                   ;
   56                   ; Ausgabedatei oeffnen und ersten Block 01h ausgeben	** 08 **
   57                   ; PE:	Kassettenpuffer mit Daten des Vorblocks
   58                   ;	Dateiname am Anfang des Puffers
   59                   ; PA:	CY=1	Fehler
   60                   ; VR:	AF,BC,DE,HL
   61                   ;
   62 D02E  DD 36 02 00 FISROD:	LD	(IX+2),0	; mit Block 1 beginnen
   63 D032  DD 6E 05    	LD	L,(IX+5)	; HL = Dateiname im Kassettenpuffer
   64 D035  DD 66 06    	LD	H,(IX+6)
   65 D038  CD D0A4     	CALL	NAMOUT		; Dateiname ausgeben zum D004
   66 D03B  3E 0B       	LD	A,0BH		; Schreiben oeffnen
   67 D03D  21          	DB	21h		; LD HL,nn
   68                   ;
   69                   ; Ausgabe Datenblock 128 Byte				** 01 **
   70                   ; PE:	Datenblock im Kassettenpuffer
   71                   ; PA:	CY=1	Fehler
   72                   ; VR:	AF,BC,DE,HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  53
CD46    INC

   73                   ;
   74 D03E  3E 03       FMBOD:	LD	A,3		; Schreiben normal
   75 D040  DD 34 02    	INC	(IX+2)		; Blocknummer erhoehen
   76 D043  DD 6E 05    	LD	L,(IX+5)	; Kassettenpuffer
   77 D046  DD 66 06    	LD	H,(IX+6)
   78 D049  01 80F2     	LD	BC,FDATA	; 80F2H
   79 D04C  1E 80       	LD	E,128
   80 D04E  08          	EX	AF,AF'		; Kommando in A' merken
   81 D04F  CD FB9E     FMBO1:	 CALL	LDAME		; Daten aus Speicher holen
   82 D052  ED 79       	 OUT	(C),A		; und in Koppel-RAM schreiben
   83 D054  23          	 INC	HL
   84 D055  04          	 INC	B
   85 D056  1D          	 DEC	E
   86 D057  20 F6       	 JR	NZ,FMBO1
   87 D059  08          	EX	AF,AF'		; Kommando zurueck nach A
   88                   ;
   89                   ; Steuerbyte 1 ausgeben, bei Fehler: Fehlercode/-text anzeigen
   90                   ; PE:	A	Kommando-Steuerbyte
   91                   ; PA:	A	Antwort von DEP
   92                   ;	CY=1	Fehler aufgetreten
   93                   ; VR:	AF,BC
   94                   ;
   95 D05A  01 80F3     STEUER:	LD	BC,STBYT1	; 80F3H
   96 D05D  ED 79       STEU0:	OUT	(C),A
   97 D05F  C5          STEU1:	PUSH	BC
   98 D060  3E 01       	LD	A,1		; 6ms
   99 D062  CD F38B     	CALL	WAIT		; warten
  100 D065  C1          	POP	BC
  101 D066  ED 78       	IN	A,(C)
  102 D068  A7          	AND	A		; CY-Flag=0
  103 D069  CB 47       	BIT	0,A
  104 D06B  20 F2       	JR	NZ,STEU1	; fertig?
  105 D06D  CB 7F       	BIT	7,A		; Bit 7 gesetzt?
  106 D06F  C8          	RET	Z		; kein Fehler
  107 D070  01 83F1     FLERR:	LD	BC,DEPVER	; 83F1H
  108 D073  ED 78       	IN	A,(C)
  109 D075  FE 20       	CP	20H		; DEP ab 2.0?
  110 D077  30 0D       	JR	NC,FLER1	; ja
  111 D079  01 81F3     	LD	BC,FCODE	; 81F3H
  112 D07C  ED 78       	IN	A,(C)		; Fehlernummer
  113 D07E  CD F3D4     	CALL	AHEX		; anzeigen
  114 D081  CD F4DD     	CALL	ERRM
  115 D084  37          FLER3:	SCF			; CY=1: Fehler
  116 D085  C9          	RET
  117                   	;
  118 D086  06 00       FLER1:	LD	B,HIGH(ERRTX)	; 00F1H = Fehlertext von DEP 2.0
  119 D088  ED 78       FLER2:	IN	A,(C)
  120 D08A  04          	INC	B
  121 D08B  A7          	AND	A
  122 D08C  28 F6       	JR	Z,FLER3		; 00=Ende
  123 D08E  CD F3E5     	CALL	OCHR
  124 D091  18 F5       	JR	FLER2
  125                   
  126                   ; Steuerbyte 2 ausgeben
  127                   
  128 D093  01 80F1     STEUB2:	LD	BC,STBYT2	; 80F1H
  129 D096  18 C5       	JR	STEU0
  130                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  54
CD46    INC

  131                   ; Ausgabedatei schliessen und Endeblock FFh ausgeben	** 09 **
  132                   ; PE:	Datenblock im Kassettenpuffer
  133                   ; PA:	CY=1	bei Fehler
  134                   ; VR:	AF,BC,DE,HL
  135                   ;
  136 D098  DD 36 02 FE FCSROD:	LD	(IX+2),0FEH	; Nr. letzter Block
  137 D09C  CD D03E     	CALL	FMBOD		; Datenblock ausgeben
  138 D09F  D8          	RET	C		; Fehler
  139 D0A0  3E 43       	LD	A,43H		; write close
  140 D0A2  18 B6       	JR	STEUER
  141                   
  142                   ; Dateiname ausgeben
  143                   ; PE:	HL	Dateiname (12 Zeichen)
  144                   ; VR:	F,BC,E,HL
  145                   
  146 D0A4  1E 0C       NAMOUT:	LD	E,12		; Dateiname 8.3 = 12 Zeichen
  147 D0A6  01 83F3     NAMO1:	LD	BC,DIRBUF+100H	; 83F3H
  148 D0A9  ED A3       NAMO2:	OUTI			; Dateiname ausgeben zum D004
  149 D0AB  04          	INC	B
  150 D0AC  04          	INC	B
  151 D0AD  1D          	DEC	E
  152 D0AE  20 F9       	JR	NZ,NAMO2
  153 D0B0  C9          	RET
  154                   ;
  155                   ; Byteeingabe (BASIC-Schnittstelle)			** 37 **
  156                   ; PE:	D	Steuerbyte
  157                   ;		Bit 3 = 1 INIT (Block 01)
  158                   ;		Bit 6 = 1 Close (Block FF)
  159                   ;	HL	Name nur bei INIT (Adresszeiger 11 Byte)
  160                   ; PA:	A	Datenbyte
  161                   ; VR:	AF, DE, HL
  162                   ;
  163 D0B1  7A          FMBIND:	LD	A,D		; Steuerbyte
  164 D0B2  E6 48       	AND	01001000b	; nur Bit 3 und 6 ausfiltern
  165 D0B4  F6 35       	OR	35H		; BASIC-Byte lesen
  166 D0B6  CD D0C8     	CALL	NAMBAS		; Dateiname ausgeben
  167 D0B9  06 8E       	LD	B,HIGH(BASBYT)	; 08EF3H
  168 D0BB  ED 78       	IN	A,(C)		; Datenbyte abholen
  169 D0BD  C9          	RET
  170                   ;
  171                   ; Byteausgabe (BASIC-Schnittstelle)			** 38 **
  172                   ; PE:	A	Datenbyte
  173                   ;	D	Steuerbyte
  174                   ;		Bit 3 = 1 INIT (Block 01)
  175                   ;		Bit 6 = 1 Close (Block FF)
  176                   ;	HL	Name nur bei INIT (Adresszeiger 11 Byte)
  177                   ; PA:	-
  178                   ; VR:	AF,DE, HL
  179                   ;
  180 D0BE  01 8EF3     FMBOUD:	LD	BC,BASBYT	; 08EF3H
  181 D0C1  ED 79       	OUT	(C),A		; Datenbyte ablegen
  182 D0C3  7A          	LD	A,D		; Steuerbyte
  183 D0C4  E6 48       	AND	01001000b	; nur Bit 3 und 6 ausfiltern
  184 D0C6  F6 37       	OR	37H		; BASIC-Byte schreiben
  185                   ;	BIT	6,A		; schliessen?
  186                   ;	JR	Z,NAMBAS	; nein
  187                   ;	LD	D,A
  188                   ;	LD	A,(0200h)	; RUN ???

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  55
CD46    INC

  189                   ;	AND	A
  190                   ;	LD	A,D
  191                   ;	JR	Z,O1
  192                   ;	SET	7,A		; run-switch im Steuerbyte setzen
  193                   
  194                   ; Dateiname + Steuerbyte ausgeben:
  195                   ; PE:	A	Steuerbyte
  196                   ;	HL	Dateiname bei gesetzem Bit 3 im Steuerbyte
  197                   ; PA:	BC	80F3H (Steuerbyte 1)
  198                   ;	Absprung zu I/O-Error wenn Fehler aufgetreten ist
  199                   ; VR:	AF,BC,E,HL
  200                   
  201 D0C8  1E 0B       NAMBAS:	LD	E,11		; 11 Zeichen (hier TYP+Name ohne Punkt)
  202 D0CA  CB 5F       	BIT	3,A		; OPEN-Bit gesetzt?
  203 D0CC  C4 D0A6     	CALL	NZ,NAMO1	; Dateiname ausgeben bei Bedarf
  204 D0CF  01 80F3     	LD	BC,STBYT1	; 80F3H (Steuerbyte 1)
  205 D0D2  ED 79       	OUT	(C),A		; Steuerbyte ausgeben
  206 D0D4  ED 78       NB1:	IN	A,(C)		; Antwort von DEP abfragen
  207 D0D6  CB 47       	BIT	0,A		; abwarten, bis D004 fertig meldet
  208 D0D8  20 FA       	JR	NZ,NB1
  209 D0DA  07          	RLCA			; Bit 7 nach CY rotieren
  210 D0DB  D0          	RET	NC		; kein Fehler
  211 D0DC  01 83F1     	LD	BC,DEPVER	; 083F1H
  212 D0DF  ED 78       	IN	A,(C)
  213 D0E1  FE 20       	CP	20H		; DEP ab 2.0?
  214 D0E3  30 0B       	JR	NC,BERR2	; ja
  215 D0E5  01 81F3     	LD	BC,FCODE	; 081F3H
  216 D0E8  ED 78       	IN	A,(C)
  217 D0EA  CD F3D4     	CALL	AHEX		; Fehler-Nr.
  218 D0ED  C3 EDC3     BERR1:	JP	JIOERR		; CAOS-C aus, IRM aus, Sprung zu I/O-ERROR
  219                   	;
  220 D0F0  06 00       BERR2:	LD	B,HIGH(ERRTX)	; Fehlertext - Register C ist bereits korrekt
  221 D0F2  ED 78       BERR3:	IN	A,(C)
  222 D0F4  28 F7       	JR	Z,BERR1		; 00-Ende
  223 D0F6  04          	INC	B
  224 D0F7  CD F3E5     	CALL	OCHR
  225 D0FA  18 F6       	JR	BERR3
  226                   
  227                   ; Test ob Floppy arbeitet (fuer SETWR, SETRO, time)
  228                   
  229 D0FC  01 FC80     DISK:	LD	BC,0FC80H	; Modulsteckplatz FC
  230 D0FF  ED 78       	IN	A,(C)
  231 D101  FE A7       	CP	0A7H		; Floppy vorhanden?
  232 D103  28 13       	JR	Z,DISK1
  233 D105  CD F0CE     	CALL	OSTR
  234 D108  4B 65 69 6E 	DB	'Kein D004!'
  235 D112  07 0D 0A 00 	DB	7,CR,LF,0
  236 D116  E1          	POP	HL		; RET-Adresse vom Stack nehmen
  237 D117  C9          	RET			; und Kommando beenden!
  238                   	;
  239 D118  01 B3F3     DISK1:	LD	BC,UROK		; 0B3F3H
  240 D11B  ED 78       	IN	A,(C)
  241 D11D  FE 05       	CP	5		; CAOS-Betriebsart?
  242 D11F  C8          	RET	Z
  243 D120  CD F0CE     	CALL	OSTR
  244 D123  43 41 4F 53 	DB	'CAOS-Disk starten!'
  245 D135  07 0D 0A 00 	DB	7,CR,LF,0
  246 D139  E1          	POP	HL		; RET-Adresse vom Stack nehmen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  56
CD46    INC

  247 D13A  C9          	RET			; und Kommando beenden!
  248                   
  249 D13B  7F7F        SRO7F:	DW	7F7FH
  250 D13D  53 45 54 52 	DB	'SETRO'
  251 D142  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
  252 D143  CD D0FC     	CALL	DISK		; D004 bereit?
  253 D146  CD D161     	CALL	FNAME		; Dateiname abfragen und ausgeben zum D004
  254 D149  3E 25       	LD	A,25H		; Setro
  255 D14B  18 10       	JR	DOUT
  256                   
  257 D14D  7F7F        SWR7F:	DW	7F7FH
  258 D14F  53 45 54 57 	DB	'SETWR'
  259 D154  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
  260 D155  CD D0FC     	CALL	DISK		; D004 bereit?
  261 D158  CD D161     	CALL	FNAME		; Dateiname abfragen und ausgeben zum D004
  262 D15B  3E 31       	LD	A,31H		; Setwr
  263 D15D  D8          DOUT:	RET	C		; BRK
  264 D15E  C3 D05A     	JP	STEUER		; Kommando ausgeben
  265                   ;
  266                   ; Name ein-, ausgeben: (fuer REN, SETRO, SETWR)
  267                   ; PE:	DE	Zeiger auf Dateinamen, wenn 0 dann Eingabe
  268                   ; PA:	CY=1	BRK
  269                   ;	DE	Zeiger auf Zeichen nach Dateinamen (2. Name bei REN)
  270                   ;
  271 D161  EB          FNAME:	EX	DE,HL
  272 D162  7E          	LD	A,(HL)		; Zeichen nach Menuewort holen
  273 D163  E6 DF       	AND	0DFH
  274 D165  20 07       	JR	NZ,FNAM2	; Argument angegeben, als Dateiname nutzen!
  275 D167  21 0006     FNAM0:	LD	HL,6
  276 D16A  CD F576     FNAM1:	CALL	NAMHL		; Dateiname eingeben
  277 D16D  D8          	RET	C		; BRK
  278 D16E  1E 0C       FNAM2:	LD	E,12		; Dateiname 8.3 = max. 12 Zeichen
  279 D170  01 82F3     	LD	BC,DIRBUF	; 082F3H
  280 D173  7E          FNAM3:	LD	A,(HL)
  281 D174  ED 79       	OUT	(C),A		; Zeichen in DIRBUF eintragen
  282 D176  E6 DF       	AND	0DFH		; war das ein Leerzeichen oder 0?
  283 D178  28 01       	JR	Z,FNAM4
  284 D17A  23          	INC	HL		; ansonsten weiter zum naechsten Zeichen
  285 D17B  04          FNAM4:	INC	B
  286 D17C  1D          	DEC	E
  287 D17D  20 F4       	JR	NZ,FNAM3
  288 D17F  EB          	EX	DE,HL		; Zeiger jetzt wieder in DE
  289 D180  13          	INC	DE		; Trennzeichen uebergehen
  290 D181  C9          	RET
  291                   
  292                   ; CAOS-D-Teil der Pixelausgaberoutine WPIX
  293                   
  294 D182  79          WPIXD:	LD	A,C
  295 D183  01 DC00     	LD	BC,0DC00H
  296 D186  87          	ADD	A,A
  297 D187  38 2C       	JR	C,WPX02		; 80..FF
  298 D189  05          	DEC	B
  299 D18A  FE 40       	CP	40H
  300 D18C  38 27       	JR	C,WPX02		; 00..1F
  301 D18E  06 ED       	LD	B,0EEH-1	; Grossbuchstaben
  302 D190  FE B6       	CP	2*5BH
  303 D192  38 21       	JR	C,WPX02		; 20..5A
  304 D194  FE BC       	CP	2*5EH

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  57
CD46    INC

  305 D196  38 0C       	JR	C,WPX01		; 5B..5D
  306 D198  FE C0       	CP	2*60H
  307 D19A  38 19       	JR	C,WPX02		; 5E..5F
  308 D19C  28 06       	JR	Z,WPX01		; 60
  309 D19E  06 FC       	LD	B,0FEH-2	; Kleinbuchstaben
  310 D1A0  FE F6       	CP	2*7BH
  311 D1A2  38 11       	JR	C,WPX02		; 61..7A
  312 D1A4  01 DAB8     WPX01:	LD	BC,0DAB8H	; Zusatztabelle
  313 D1A7  D6 B6       	SUB	2*5BH
  314 D1A9  FE 06       	CP	6
  315 D1AB  38 08       	JR	C,WPX02		; 5B..5D
  316 D1AD  D6 04       	SUB	4
  317 D1AF  FE 06       	CP	6
  318 D1B1  28 02       	JR	Z,WPX02		; 60
  319 D1B3  D6 34       	SUB	34H
  320 D1B5  6F          WPX02:	LD	L,A
  321 D1B6  26 00       	LD	H,0
  322 D1B8  29          	ADD	HL,HL		; *4
  323 D1B9  C3 E0D0     	JP	WPX07		; Zurueck zu CAOS-E
  324                   
  325                   ; Rolle Fenster fuer Scrollroutine
  326                   
  327 D1BC  E5          MOVELN:	PUSH	HL
  328 D1BD  D5          	PUSH	DE
  329 D1BE  C5          	PUSH	BC
  330 D1BF  F5          	PUSH	AF
  331 D1C0  08          	EX	AF,AF'
  332 D1C1  F5          	PUSH	AF
  333 D1C2  79          	LD	A,C		; BC: Pixelzeilen
  334 D1C3  08          	EX	AF,AF'
  335 D1C4  3A B79E     	LD	A,(WINLG)	; Spalten
  336 D1C7  E5          MOLN1:	PUSH	HL
  337 D1C8  D5          	PUSH	DE
  338 D1C9  ED A0       MOLN2:	LDI			; zeichenweise
  339 D1CB  ED A0       	LDI
  340 D1CD  ED A0       	LDI
  341 D1CF  ED A0       	LDI
  342 D1D1  ED A0       	LDI
  343 D1D3  ED A0       	LDI
  344 D1D5  ED A0       	LDI
  345 D1D7  ED A0       	LDI
  346 D1D9  EA D1C9     	JP	PE,MOLN2
  347 D1DC  D1          	POP	DE
  348 D1DD  E1          	POP	HL
  349 D1DE  24          	INC	H		; neue Spalte
  350 D1DF  14          	INC	D
  351 D1E0  08          	EX	AF,AF'
  352 D1E1  4F          	LD	C,A
  353 D1E2  08          	EX	AF,AF'
  354 D1E3  3D          	DEC	A		; Spaltenzaehler
  355 D1E4  20 E1       	JR	NZ,MOLN1
  356 D1E6  08          	EX	AF,AF'
  357 D1E7  F1          	POP	AF
  358 D1E8  08          	EX	AF,AF'
  359 D1E9  C3 E09C     	JP	POP4		; POP	AF,BC,DE,HL   RET
  360                   
  361                   ; Loeschen einer Zeile
  362                   ; HL: Adresse, C: Laenge, A: Byte

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  58
CD46    INC

  363                   
  364 D1EC  41          CLLINE:	LD	B,C
  365 D1ED  55          CLL1:	LD	D,L		; L retten
  366 D1EE  77          	LD	(HL),A		; zeichenweise
  367 D1EF  2C          	INC	L		; ohne Schleife
  368 D1F0  77          	LD	(HL),A
  369 D1F1  2C          	INC	L
  370 D1F2  77          	LD	(HL),A
  371 D1F3  2C          	INC	L
  372 D1F4  77          	LD	(HL),A
  373 D1F5  2C          	INC	L
  374 D1F6  77          	LD	(HL),A
  375 D1F7  2C          	INC	L
  376 D1F8  77          	LD	(HL),A
  377 D1F9  2C          	INC	L
  378 D1FA  77          	LD	(HL),A
  379 D1FB  2C          	INC	L
  380 D1FC  77          	LD	(HL),A
  381 D1FD  6A          	LD	L,D		; L holen
  382 D1FE  24          	INC	H
  383 D1FF  10 EC       	DJNZ	CLL1
  384 D201  C9          	RET
  385                   
  386                   ; CAOS-D-Teil der Scrollroutine SCRLPG
  387                   
  388 D202  3A B79E     SCRLD:	LD	A,(WINLG)	; Spalten
  389 D205  4F          	LD	C,A
  390 D206  06 00       	LD	B,0
  391 D208  3A B79F     	LD	A,(WINLG+1)	; Zeilen
  392 D20B  3D          	DEC	A		; nur 1 Zeile?
  393 D20C  28 3A       	JR	Z,SCRL3		; nur CLLN
  394 D20E  D5          	PUSH	DE
  395 D20F  F5          	PUSH	AF
  396 D210  50          	LD	D,B		; DE=0
  397 D211  58          	LD	E,B		; Cursor links/oben
  398 D212  CD E06D     	CALL	DABR
  399 D215  EB          	EX	DE,HL
  400 D216  21 0028     SCRL1:	LD	HL,40		; 1 Zeile tiefer
  401 D219  19          	ADD	HL,DE
  402 D21A  E5          	PUSH	HL
  403 D21B  C5          	PUSH	BC
  404 D21C  ED B0       	LDIR			; im VRAM eine Zeile rollen
  405 D21E  C1          	POP	BC
  406 D21F  D1          	POP	DE
  407 D220  3D          	DEC	A
  408 D221  20 F3       	JR	NZ,SCRL1	; A-mal rollen
  409 D223  F1          	POP	AF
  410 D224  87          	ADD	A,A
  411 D225  87          	ADD	A,A
  412 D226  87          	ADD	A,A		; *8: Pixelzeile
  413 D227  4F          	LD	C,A
  414 D228  50          	LD	D,B		; B war 0
  415 D229  58          	LD	E,B		; DE=0
  416 D22A  CD E047     	CALL	PADR1
  417 D22D  EB          	EX	DE,HL		; DE=Pixeladresse
  418 D22E  2E 08       	LD	L,8		; H war 0
  419 D230  19          	ADD	HL,DE
  420 D231  3A B7A2     	LD	A,(STBT)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  59
CD46    INC

  421 D234  1F          	RRA
  422 D235  1F          	RRA
  423 D236  38 0B       	JR	C,SCRL2		; Farbe AUS
  424 D238  F5          	PUSH	AF
  425 D239  CD F9A5     	CALL	ESC9
  426 D23C  CD D1BC     	CALL	MOVELN
  427 D23F  CD F9A5     	CALL	ESC9
  428 D242  F1          	POP	AF
  429 D243  17          SCRL2:	RLA			; Pixel AUS?
  430 D244  D4 D1BC     	CALL	NC,MOVELN
  431 D247  D1          	POP	DE
  432 D248  15          SCRL3:	DEC	D
  433                   
  434                   ; CAOS-D-Teil der Zeilenloeschroutine CLLN (Shift-DEL)
  435                   
  436 D249  1E 00       CLLND:	LD	E,0
  437 D24B  CD E06D     	CALL	DABR		; ausserhalb?
  438 D24E  D8          	RET	C		; (Selbstschutz)
  439 D24F  3A B79E     	LD	A,(WINLG)
  440 D252  47          	LD	B,A		; Spalten
  441 D253  4F          	LD	C,A
  442 D254  AF          	XOR	A
  443 D255  77          CLLN1:	LD	(HL),A		; VRAM loeschen
  444 D256  23          	INC	HL
  445 D257  10 FC       	DJNZ	CLLN1
  446 D259  CD E047     	CALL	PADR1
  447 D25C  D8          	RET	C
  448 D25D  D5          	PUSH	DE
  449 D25E  DD CB 01 5E 	BIT	3,(IX+1)
  450 D262  3A B7A2     	LD	A,(STBT)
  451 D265  20 04       	JR	NZ,CLLALT	; LORES
  452 D267  CB 77       	BIT	6,A
  453 D269  20 1C       	JR	NZ,CLLHR	; HRG-Modus
  454 D26B  0F          CLLALT:	RRCA			; Pixel AUS?
  455 D26C  5F          	LD	E,A		; nach E merken
  456 D26D  38 06       	JR	C,CLLN2
  457 D26F  AF          	XOR	A
  458 D270  E5          	PUSH	HL
  459 D271  CD D1EC     	CALL	CLLINE		; Pixel loeschen
  460 D274  E1          	POP	HL
  461 D275  CB 0B       CLLN2:	RRC	E		; Farbe AUS?
  462 D277  38 0C       	JR	C,CLLN3
  463 D279  CD F9A5     	CALL	ESC9
  464 D27C  3A B7A3     	LD	A,(COLOR)
  465 D27F  CD D1EC     CLLCOL:	CALL	CLLINE		; Farbe setzen
  466 D282  CD F9A5     	CALL	ESC9
  467 D285  D1          CLLN3:	POP	DE
  468 D286  C9          	RET
  469                   
  470 D287  3A B7A3     CLLHR:	LD	A,(COLOR)
  471 D28A  E6 03       	AND	00000011b	; Paper, CY=0
  472 D28C  1F          	RRA
  473 D28D  3D          	DEC	A		; NEG ohne Veraenderung von CY
  474 D28E  2F          	CPL
  475 D28F  5F          	LD	E,A		; E = FFh * Bit 1 (Farbe)
  476 D290  9F          	SBC	A,A		; A = FFh * Bit 0 (Pixel)
  477 D291  E5          	PUSH	HL
  478 D292  CD D1EC     	CALL	CLLINE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  60
CD46    INC

  479 D295  E1          	POP	HL
  480 D296  CD F9A5     	CALL	ESC9
  481 D299  7B          	LD	A,E		; Farbe
  482 D29A  18 E3       	JR	CLLCOL
  483                   
  484 D29C  7F7F        	DW	7F7FH
  485 D29E  74 69 6D 65 	DB	'time',1
  486 D2A3  CD D0FC     	CALL	DISK		; D004 bereit?
  487 D2A6  01 83F1     	LD	BC,DEPVER	; 083F1H
  488 D2A9  ED 78       	IN	A,(C)
  489 D2AB  FE 30       	CP	30H		; DEP ab 3.0?
  490 D2AD  30 13       	JR	NC,UHR
  491 D2AF  CD F0CE     	CALL	OSTR
  492 D2B2  4B 65 69 6E 	DB	'Kein DEP 3!'
  493 D2BD  07 0D 0A 00 	DB	7,CR,LF,0
  494 D2C1  C9          	RET
  495 D2C2  3E 19       UHR:	LD	A,19H		; Cursor ganz nach links
  496 D2C4  CD F3E5     	CALL	OCHR
  497 D2C7  1E 02       	LD	E,2
  498 D2C9  01 86F1     	LD	BC,DATE+200H
  499 D2CC  ED 78       UHR1:	IN	A,(C)		; Datum aus Koppel-RAM
  500 D2CE  CD F3D4     	CALL	AHEX
  501 D2D1  3E 2E       	LD	A,'.'
  502 D2D3  CD F3E5     	CALL	OCHR
  503 D2D6  05          	DEC	B
  504 D2D7  1D          	DEC	E
  505 D2D8  20 F2       	JR	NZ,UHR1
  506 D2DA  ED 78       	IN	A,(C)		; Jahr
  507 D2DC  FE 78       	CP	78H
  508 D2DE  3E 19       	LD	A,19H		; 1978-1999
  509 D2E0  CE 00       	ADC	A,0
  510 D2E2  27          	DAA			; 2000-2077
  511 D2E3  CD F3D4     	CALL	AHEX		; Jahrhundert
  512 D2E6  ED 78       	IN	A,(C)
  513 D2E8  CD F3D4     	CALL	AHEX		; Jahr
  514 D2EB  CD F0CE     	CALL	OSTR
  515 D2EE  20 20 00    	DB	'  ',0
  516 D2F1  1E 02       	LD	E,2
  517 D2F3  01 87F1     	LD	BC,TIME
  518 D2F6  ED 78       UHR2:	IN	A,(C)		; Uhrzeit aus Koppel-RAM
  519 D2F8  CD F3D4     	CALL	AHEX
  520 D2FB  3E 3A       	LD	A,':'
  521 D2FD  CD F3E5     	CALL	OCHR
  522 D300  04          	INC	B
  523 D301  1D          	DEC	E
  524 D302  20 F2       	JR	NZ,UHR2
  525 D304  ED 78       	IN	A,(C)
  526 D306  CD F3D4     	CALL	AHEX
  527 D309  3A B781     	LD	A,(ARGN)	; Parameter angegeben?
  528 D30C  A7          	AND	A		; =Dauerlauf?
  529 D30D  28 05       	JR	Z,UHR3		; nein!
  530 D30F  CD E379     	CALL	BRKT		; BRK?
  531 D312  30 AE       	JR	NC,UHR
  532 D314  C3 F4E7     UHR3:	JP	CRLF
  533                   
  534                   ; Quadratwurzel 16Bit A=SQR(HL)
  535                   
  536 D317  A7          SQRC:	AND	A		; CY=0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  61
CD46    INC

  537 D318  11 FFFF     	LD	DE,0FFFFH
  538 D31B  13          SQ1:	INC	DE
  539 D31C  13          	INC	DE
  540 D31D  ED 52       	SBC	HL,DE
  541 D31F  30 FA       	JR	NC,SQ1
  542 D321  7B          	LD	A,E
  543 D322  CB 3A       	SRL	D
  544 D324  1F          	RRA			; A=RADIUS
  545 D325  C3 FBBA     	JP	COFF
  546                   
  547                   ; Multiplikation BA=C*D
  548                   
  549 D328  06 00       MULC:	LD	B,0
  550 D32A  1E 09       	LD	E,9
  551 D32C  7A          MULC1:	LD	A,D
  552 D32D  1F          	RRA
  553 D32E  1D          	DEC	E
  554 D32F  CA FBBA     	JP	Z,COFF
  555 D332  57          	LD	D,A
  556 D333  78          	LD	A,B
  557 D334  30 01       	JR	NC,MULC2
  558 D336  81          	ADD	A,C
  559 D337  1F          MULC2:	RRA
  560 D338  47          	LD	B,A
  561 D339  18 F1       	JR	MULC1 		; 8*
  562                   
  563                   ; Speicherschnellansicht
  564                   
  565 D33B  7F7F        VIEW7F:	DW	7F7FH
  566 D33D  76 69 65 77 	DB	'view'
  567 D341  03          	DB	3
  568 D342  7D          	LD	A,L
  569 D343  FE 10       	CP	10H
  570 D345  30 0C       	JR	NC,VIEW1	; L>0Fh
  571 D347  7C          	LD	A,H
  572 D348  A7          	AND	A
  573 D349  20 08       	JR	NZ,VIEW1	; H>0
  574 D34B  21 B782     	LD	HL,ARG1
  575 D34E  ED 6F       	RLD
  576 D350  66          	LD	H,(HL)
  577 D351  2E 00       	LD	L,0
  578 D353  11 8800     VIEW1:	LD	DE,8800H
  579 D356  01 2000     	LD	BC,2000H
  580 D359  CD FB9E     VIEW2:	CALL	LDAME		; Byte holen
  581 D35C  12          	LD	(DE),A		; in IRM poken
  582 D35D  23          	INC	HL
  583 D35E  13          	INC	DE
  584 D35F  0D          	DEC	C
  585 D360  20 F7       	JR	NZ,VIEW2
  586 D362  10 F5       	DJNZ	VIEW2
  587 D364  3E 0B       VIEW3:	LD	A,0BH		; Zeile hoch
  588 D366  CD E091     	CALL	CRT
  589 D369  3E 08       	LD	A,8
  590 D36B  32 B7A0     	LD	(CURSO),A
  591 D36E  CD D371     	CALL	VIEW4
  592 D371  3E 01       VIEW4:	LD	A,1
  593 D373  4F          VIEW5:	LD	C,A
  594 D374  CD F3D4     	CALL	AHEX		; HEX-Leiste

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  62
CD46    INC

  595 D377  79          	LD	A,C
  596 D378  C6 22       	ADD	A,22H
  597 D37A  30 F7       	JR	NC,VIEW5
  598 D37C  C9          	RET
  599                   
  600                   ; Druckereinstellungen
  601                   
  602 D37D  7F7F        PRI7F:	DW	7F7FH
  603 D37F  50 52 49 4E 	DB	'PRINT',1FH
  604 D385  1A          PRI:	LD	A,(DE)
  605 D386  A7          	AND	A
  606 D387  C8          	RET	Z		; fertig
  607 D388  FE 20       	CP	' '
  608 D38A  28 14       	JR	Z,PRINC
  609 D38C  FE 2C       	CP	','
  610 D38E  28 13       	JR	Z,PRK		; Zeichen
  611 D390  FE 27       	CP	27H
  612 D392  28 13       	JR	Z,PRSTR		; String
  613 D394  CD F4F7     	CALL	RHEX
  614 D397  DA F4DD     	JP	C,ERRM		; Fehler!
  615 D39A  3A B797     	LD	A,(NUMVX)
  616 D39D  CD B7E9     PRIC:	CALL	OFILT
  617 D3A0  13          PRINC:	INC	DE
  618 D3A1  18 E2       	JR	PRI
  619                   	;
  620 D3A3  13          PRK:	INC	DE
  621 D3A4  1A          	LD	A,(DE)		; Zeichen
  622 D3A5  18 F6       	JR	PRIC
  623                   	;
  624 D3A7  13          PRSTR:	INC	DE
  625 D3A8  1A          	LD	A,(DE)
  626 D3A9  A7          	AND	A
  627 D3AA  C8          	RET	Z		; Ende-0
  628 D3AB  FE 27       	CP	27H
  629 D3AD  28 F1       	JR	Z,PRINC		; Stringende
  630 D3AF  CD B7E9     	CALL	OFILT
  631 D3B2  18 F3       	JR	PRSTR
  632                   
  633                   ; Schreibe ON, ON* oder OFF fuer Systemcheck
  634                   ; PE:	Z=1	OFF
  635                   ;	Z=0 und CY=0 ON
  636                   ;	Z=0 und CY=1 ON*
  637                   
  638 D3B4  28 14       WONOF:	JR	Z,WOF
  639 D3B6  F5          	PUSH	AF
  640 D3B7  CD F0CE     	CALL	OSTR
  641 D3BA  20 4F 4E 00 	DB	' ON',0
  642 D3BE  F1          	POP	AF
  643 D3BF  3E 20       	LD	A,' '
  644 D3C1  30 02       	JR	NC,WRR
  645 D3C3  3E 2A       	LD	A,'*'		; Schreibschutz anzeigen
  646 D3C5  CD F3E5     WRR:	CALL	OCHR
  647 D3C8  18 08       	JR	WRLF
  648                   	;
  649 D3CA  CD F0CE     WOF:	CALL	OSTR
  650 D3CD  20 4F 46 46 	DB	' OFF',0
  651 D3D2  C3 F4E7     WRLF:	JP	CRLF
  652                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  63
CD46    INC

  653                   ; Anzeige der CAOS-Version mit Datum
  654                   
  655 D3D5  7F7F        HELP7F:	DW	7F7FH
  656 D3D7  68 65 6C 70 	DB	'help'
  657 D3DB  01          	DB	1
  658 D3DC  CD F0CE     	CALL	OSTR
  659 D3DF  20 4B 43 2D 	DB	' KC-Club CAOS 4.6 '
  660         0001      if beta
  661 D3F1  62 65 74 61 	DB	'beta '		; Beta-Version?
  662                   endif
  663                   	DATUM			; Versionsdatum
    1 D3F6  30 35 2E 30 	DB	'05.03.2016'	; Versionsdatum nur hier aendern!
  664 D400  0D 0A 00    	DB	CR,LF,0
  665 D403  C9          	RET
  666                   
  667                   ; * * * *	ab hier DEVICE-Treiber-Funktionen (neu)	* * * *
  668                   
  669                   ;
  670                   ; Floppy-Treiber Funktion 0: Directory mit Maske
  671                   ; PE:	DE	Maske
  672                   ; PA:	-
  673                   ;
  674 D404  EB          FDIR:	EX	DE,HL		; Maske aus Kommandozeile
  675 D405  11 B700     	LD	DE,CASS
  676 D408  01 000B     	LD	BC,11		; max. Laenge
  677 D40B  ED B0       	LDIR			; In Kassettenpuffer ablegen
  678 D40D  AF          	XOR	A		; Abschluss Maske
  679 D40E  12          	LD	(DE),A
  680 D40F  3E 0D       	LD	A,0DH		; Directory oeffnen
  681 D411  CD D05A     DIR1:	CALL	STEUER
  682 D414  CB 57       	BIT	2,A
  683 D416  20 41       	JR	NZ,DIR6		; Ende
  684 D418  06 82       	LD	B,HIGH(DIRBUF)	; 82F3H
  685 D41A  21 B70C     	LD	HL,CASS+12
  686 D41D  A7          	AND	A		; CY=0
  687 D41E  16 03       	LD	D,3		; 3 Eintraege
  688 D420  1E 0B       DIR2:	LD	E,11		; 11 Zeichen lang
  689 D422  ED 78       DIR3:	IN	A,(C)		; einlesen
  690 D424  F5          	PUSH	AF
  691 D425  E6 7F       	AND	7FH
  692 D427  04          	INC	B
  693 D428  77          	LD	(HL),A
  694 D429  23          	INC	HL
  695 D42A  7B          	LD	A,E
  696 D42B  FE 03       	CP	3		; RO-Byte?
  697 D42D  28 01       	JR	Z,DIR4
  698 D42F  F1          	POP	AF
  699 D430  1D          DIR4:	DEC	E
  700 D431  20 EF       	JR	NZ,DIR3
  701 D433  36 00       	LD	(HL),0		; Ende-Kennung
  702 D435  23          	INC	HL
  703 D436  04          	INC	B
  704 D437  F1          	POP	AF
  705 D438  77          	LD	(HL),A		; RO-Byte
  706 D439  23          	INC	HL
  707 D43A  15          	DEC	D
  708 D43B  20 E3       	JR	NZ,DIR2
  709 D43D  21 B70C     	LD	HL,CASS+12

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  64
CD46    INC

  710 D440  06 03       	LD	B,3
  711 D442  E5          DIR5:	PUSH	HL
  712 D443  11 B700     	LD	DE,CASS
  713 D446  1A          	LD	A,(DE)
  714 D447  A7          	AND	A
  715 D448  C4 D495     	CALL	NZ,GLOB		; Vergleich mit Maske
  716 D44B  E1          	POP	HL
  717 D44C  D4 D477     	CALL	NC,DIR7		; Anzeige eines passenden Eintrags
  718 D44F  11 000D     	LD	DE,13
  719 D452  19          	ADD	HL,DE
  720 D453  10 ED       	DJNZ	DIR5		; 3 Eintraege
  721 D455  3E 05       	LD	A,5		; DIR weiter
  722 D457  18 B8       	JR	DIR1
  723                   	;
  724 D459  3A B7A0     DIR6:	LD	A,(CURSO)
  725 D45C  A7          	AND	A		; Cursor auf neuer Zeile?
  726 D45D  C4 F4E7     	CALL	NZ,CRLF		; wenn nicht, dann Zeilenwechsel
  727                   
  728                   ; Nach Ende aller Dateien noch die Statusmeldung anzeigen:
  729                   
  730 D460  3E 15       STAT:	LD	A,15H		; Status abfragen
  731 D462  CD D05A     	CALL	STEUER
  732 D465  1E 14       	LD	E,20
  733 D467  06 82       	LD	B,HIGH(DIRBUF)	; 82F3H
  734 D469  ED 78       STAT1:	IN	A,(C)
  735 D46B  E6 7F       	AND	7FH		; Bit 7 abtrennen
  736 D46D  04          	INC	B
  737 D46E  F5          	PUSH	AF
  738 D46F  CD F3E5     	CALL	OCHR
  739 D472  F1          	POP	AF
  740 D473  1D          	DEC	E
  741 D474  20 F3       	JR	NZ,STAT1
  742 D476  C9          	RET
  743                   
  744                   ; DIR-Eintrag anzeigen:
  745                   
  746 D477  E5          DIR7:	PUSH	HL
  747 D478  3A B7A0     	LD	A,(CURSO)
  748 D47B  FE 27       	CP	3*13
  749 D47D  CC F4E7     	CALL	Z,CRLF
  750 D480  CD F91D     	CALL	ZKOUT
  751 D483  3E 20       	LD	A,' '		; WR
  752 D485  CB 7E       	BIT	7,(HL)
  753 D487  28 02       	JR	Z,DIR8
  754 D489  3E 2A       	LD	A,'*'		; RO
  755 D48B  CD F3E5     DIR8:	CALL	OCHR
  756 D48E  CD F3CC     	CALL	SPACE
  757 D491  E1          	POP	HL
  758 D492  C9          	RET
  759                   
  760                   ; Vergleich mit DIR-Maske:
  761                   
  762 D493  23          MAT0:	INC	HL
  763 D494  13          MAT0E:	INC	DE
  764 D495              GLOB:	; Eintritt, HL=Name, DE=Maske
  765                   	; PA: CY=1: nicht gefunden
  766 D495  1A          	LD	A,(DE)
  767 D496  B6          	OR	(HL)		; Beide Ende?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  65
CD46    INC

  768 D497  C8          	RET	Z		; -> OK
  769 D498  1A          	LD	A,(DE)
  770 D499  FE 2A       	CP	'*'
  771 D49B  28 16       	JR	Z,MAT0S
  772 D49D  FE 01       	CP	1
  773 D49F  D8          	RET	C		; M Ende
  774 D4A0  7E          	LD	A,(HL)
  775 D4A1  FE 01       	CP	1
  776 D4A3  D8          	RET	C		; N Ende
  777 D4A4  1A          	LD	A,(DE)
  778 D4A5  FE 3F       	CP	'?'
  779 D4A7  28 EA       	JR	Z,MAT0		; Joker
  780 D4A9  CB 6E       	BIT	5,(HL)
  781 D4AB  CC F549     	CALL	Z,UPCASE
  782 D4AE  BE          	CP	(HL)
  783 D4AF  28 E2       	JR	Z,MAT0
  784 D4B1  37          	SCF
  785 D4B2  C9          	RET
  786                   	;
  787 D4B3  E5          MAT0S:	PUSH	HL
  788 D4B4  D5          	PUSH	DE
  789 D4B5  CD D494     	CALL	MAT0E		; Rekursion!
  790 D4B8  D1          	POP	DE
  791 D4B9  E1          	POP	HL
  792 D4BA  D0          	RET	NC		; -> OK
  793 D4BB  7E          	LD	A,(HL)
  794 D4BC  23          	INC	HL
  795 D4BD  B7          	OR	A
  796 D4BE  20 F3       	JR	NZ,MAT0S
  797 D4C0  37          	SCF
  798 D4C1  C9          	RET
  799                   ;
  800                   ; Floppy-Treiber Funktion 2: Datei loeschen
  801                   ; PE:	DE	Dateiname
  802                   ;	(DE)=0	Dateinamen werden abgefragt
  803                   ; PA:	CY=1	Fehler
  804                   ;
  805 D4C2  EB          FERA:	EX	DE,HL
  806 D4C3  7E          	LD	A,(HL)		; Parameter in Kommandozeile
  807 D4C4  E6 DF       	AND	0DFH		; angegeben?
  808 D4C6  CC F573     	CALL	Z,NAME		; Dateiname abfragen falls nicht angegeben
  809 D4C9  3F          	CCF			; BRK nicht als Fehler anzeigen
  810 D4CA  D0          	RET	NC		; Eingabe Dateiname mit BRK abgebrochen
  811 D4CB  CD D0A4     	CALL	NAMOUT		; Dateiname ausgeben zum D004
  812 D4CE  3E 11       	LD	A,11H		; Era
  813 D4D0  CD D05A     	CALL	STEUER		; mit Steuerbyte 1 im D004 anfordern
  814 D4D3  D8          	RET	C		; Fehler aufgetreten
  815 D4D4  18 8A       	JR	STAT
  816                   ;
  817                   ; Floppy-Treiber Funktion 3: Datei umbenennen
  818                   ; PE:	DE	Zeiger auf Zeichenkette mit 2 Dateinamen
  819                   ;	(DE)=0	Dateinamen werden abgefragt
  820                   ; PA:	CY=1	Fehler
  821                   ;
  822 D4D6  1A          FREN:	LD	A,(DE)		; Parameter in Kommandozeile
  823 D4D7  E6 DF       	AND	0DFH		; angegeben?
  824 D4D9  20 13       	JR	NZ,REN1		; ja, dann diesen verwenden
  825 D4DB  CD F0CE     	CALL	OSTR

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  66
CD46    INC

  826 D4DE  41 6C 74 65 	DB	'Alter ',0
  827 D4E5  21 000C     	LD	HL,12
  828 D4E8  CD D16A     	CALL	FNAM1		; Dateiname abfragen
  829 D4EB  D8          	RET	C		; BRK
  830 D4EC  18 04       	JR	REN2
  831                   	;
  832 D4EE  EB          REN1:	EX	DE,HL		; Dateiname in HL
  833 D4EF  CD D16E     	CALL	FNAM2
  834 D4F2  3E 29       REN2:	LD	A,29H		; REN alter Dateiname
  835 D4F4  CD D05A     	CALL	STEUER
  836 D4F7  D8          	RET	C		; Fehler
  837 D4F8  1A          	LD	A,(DE)		; Parameter in Kommandozeile
  838 D4F9  E6 DF       	AND	0DFH		; 2. Dateiname angegeben?
  839 D4FB  20 13       	JR	NZ,REN3		; ja, dann diesen verwenden
  840 D4FD  CD F0CE     	CALL	OSTR
  841 D500  4E 65 75 65 	DB	'Neuer ',0
  842 D507  21 000C     	LD	HL,12
  843 D50A  CD D16A     	CALL	FNAM1		; Dateiname abfragen
  844 D50D  D8          	RET	C		; BRK
  845 D50E  18 04       	JR	REN4
  846                   	;
  847 D510  EB          REN3:	EX	DE,HL		; Dateiname in HL
  848 D511  CD D16E     	CALL	FNAM2
  849 D514  3E 21       REN4:	LD	A,21H		; REN neuer Dateiname
  850 D516  CD D05A     	CALL	STEUER		; Steuerbyte ausgeben
  851 D519  D8          	RET	C		; Fehler
  852 D51A  CD F0CE     	CALL	OSTR
  853 D51D  4F 4B 2E 0D 	DB	'OK.',CR,LF,0
  854 D523  C9          	RET
  855                   ;
  856                   ; Anzeige einer beliebigen Text-Datei (nicht fuer TAPE-Modus)
  857                   ;
  858 D524  7F7F        TYPE7F:	DW	7F7FH
  859 D526  54 59 50 45 	DB	'TYPE'
  860 D52A  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
  861 D52B  CD D64A     	CALL	TDUP1		; Dateiname in HL
  862 D52E  D8          	RET	C		; TAPE oder BRK
  863 D52F  CD F04F     	CALL	PV1		; HL = Dateiname
  864 D532  0A          	DB	0AH		; ISRI (ersten Block einlesen)
  865 D533  38 78       	JR	C,FCLOSE	; Fehler aufgetreten
  866 D535  3A B710     	LD	A,(CASS+10h)	; Anzahl ARG in Vorblock
  867 D538  FE 02       	CP	2
  868 D53A  38 1B       	JR	C,TYPE4		; kein Vorblock, da < 2
  869 D53C  FE 05       	CP	5
  870 D53E  30 17       	JR	NC,TYPE4	; kein Vorblock, da > 4
  871 D540  18 0F       	JR	TYPE3		; Vorblock -> dann ersten Datenblock einlesen
  872                   	;
  873 D542  3E 0C       TYPE1:	LD	A,0CH		; CLS
  874 D544  CD E091     	CALL	CRT		; CRT, damit nicht zu Druckprotokoll!
  875 D547  3E 0A       	LD	A,LF
  876 D549  CD E091     	CALL	CRT		; oben eine Zeile frei lassen
  877 D54C  7B          TYPE2:	LD	A,E
  878 D54D  FE 80       	CP	80h		; Ende Kassettenpuffer erreicht?
  879 D54F  20 09       	JR	NZ,TYPE5	; nein, weiter anzeigen
  880 D551  CD F04F     TYPE3:	CALL	PV1		; naechsten Block einlesen mit
  881 D554  05          	DB	05H		; MBI
  882 D555  38 40       	JR	C,TYPE10		; Fehler
  883 D557  11 B700     TYPE4:	LD	DE,CASS		; Kassettenpuffer zur Entnahme der Daten

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  67
CD46    INC

  884 D55A  1A          TYPE5:	LD	A,(DE)		; Zeichen
  885 D55B  1C          	INC	E		; Zeiger auf naechstes Zeichen
  886 D55C  FE 03       	CP	3
  887 D55E  28 37       	JR	Z,TYPE10	; CAOS-Ende
  888 D560  FE 1A       	CP	1AH
  889 D562  CA D597     	JP	Z,TYPE10	; CP/M-Ende
  890 D565  FE 20       	CP	20H
  891 D567  30 1C       	JR	NC,TYPE8	; ASCII-Zeichen
  892 D569  FE 0A       	CP	LF
  893 D56B  28 18       	JR	Z,TYPE8
  894 D56D  FE 0D       	CP	CR
  895 D56F  28 14       	JR	Z,TYPE8
  896 D571  FE 09       	CP	9		; TAB in Space umwandeln
  897 D573  20 0E       	JR	NZ,TYPE7	; andere Steuerzeichen als Punkt anzeigen
  898 D575  3E 20       TYPE6:	LD	A,' '
  899 D577  CD F3E5     	CALL	OCHR
  900 D57A  3A B7A0     	LD	A,(CURSO)
  901 D57D  E6 07       	AND	7		; TAB-Stopp alle 8 Zeichen
  902 D57F  20 F4       	JR	NZ,TYPE6
  903 D581  18 05       	JR	TYPE9
  904                   	;
  905 D583  3E 2E       TYPE7:	LD	A,'.'		; statt Steuerzeichen anzeigen
  906 D585  CD F3E5     TYPE8:	CALL	OCHR
  907 D588  3A B7A1     TYPE9:	LD	A,(CURSO+1)
  908 D58B  3C          	INC	A
  909 D58C  21 B79F     	LD	HL,WINLG+1
  910 D58F  BE          	CP	(HL)		; Seite voll?
  911 D590  20 BA       	JR	NZ,TYPE2
  912 D592  CD D668     	CALL	TDUP2		; Eingabe abwarten
  913 D595  20 AB       	JR	NZ,TYPE1	; auf neuer Seite weiter anzeigen
  914 D597  CD F4E7     TYPE10:	CALL	CRLF		; noch eine neue Zeile nach dem Text
  915 D59A  18 11       	JR	FCLOSE		; Datei schliessen
  916                   ;
  917                   ; Hexadezimele Dateianzeige einer beliebigen Datei (nicht fuer TAPE-Modus)
  918                   ;
  919 D59C  7F7F        DUMP7F:	DW	7F7FH
  920 D59E  44 55 4D 50 	DB	'DUMP'
  921 D5A2  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
  922 D5A3  CD D64A     	CALL	TDUP1		; Dateiname in HL
  923 D5A6  D8          	RET	C		; TAPE oder BRK
  924 D5A7  CD F04F     	CALL	PV1		; HL = Dateiname
  925 D5AA  0A          	DB	0AH		; ISRI (ersten Block einlesen)
  926 D5AB  30 25       	JR	NC,DUMP4	; kein Fehler aufgetreten
  927 D5AD  CD F04F     FCLOSE:	CALL	PV1		; Datei schliessen
  928 D5B0  0B          	DB	0BH		; CSRI
  929 D5B1  CD E4BE     	CALL	CLC		; Kassettenpuffer loeschen
  930 D5B4  3A B780     	LD	A,(ARGC)	; urspruenglichen ROM-C Schaltzustand 
  931 D5B7  32 B805     	LD	(MODST+5),A	; wieder eintragen
  932 D5BA  C3 FBBA     	JP	COFF		; und so schalten -> DUMP-Ende
  933                   	;
  934 D5BD  3E 0C       DUMP2:	LD	A,0CH		; CLS
  935 D5BF  CD E091     	CALL	CRT		; CRT damit nicht zu Druckprotokoll!
  936 D5C2  3E 0A       	LD	A,LF
  937 D5C4  CD E091     	CALL	CRT		; oben eine Zeile frei lassen
  938 D5C7  7B          DUMP3:	LD	A,E
  939 D5C8  FE 80       	CP	80h		; Ende Kassettenpuffer erreicht?
  940 D5CA  20 09       	JR	NZ,DUMP5	; nein, weiter anzeigen
  941 D5CC  CD F04F     	CALL	PV1		; naechsten Block einlesen mit

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  68
CD46    INC

  942 D5CF  05          	DB	05H		; MBI
  943 D5D0  38 DB       	JR	C,FCLOSE	; Fehler
  944 D5D2  11 B700     DUMP4:	LD	DE,CASS		; Kassettenpuffer zur Entnahme der Daten
  945 D5D5  EB          DUMP5:	EX	DE,HL
  946 D5D6  CD F3CC     	CALL	SPACE		; Zeile mit Leerzeichen beginnen
  947 D5D9  0E 08       	LD	C,8		; 8 Bytes
  948 D5DB  CD C7B3     	CALL	DPME0		; Anzeigen mit der Display-Rutine
  949 D5DE  EB          	EX	DE,HL
  950 D5DF  CD F4E7     	CALL	CRLF		; neue Zeile
  951 D5E2  3A B7A1     	LD	A,(CURSO+1)
  952 D5E5  3C          	INC	A
  953 D5E6  21 B79F     	LD	HL,WINLG+1
  954 D5E9  BE          	CP	(HL)		; Seite voll?
  955 D5EA  20 DB       	JR	NZ,DUMP3	; nein, weiter anzeigen
  956 D5EC  CD D668     	CALL	TDUP2		; Eingabe abwarten
  957 D5EF  28 BC       	JR	Z,FCLOSE	; BRK -> Datei schliessen und Ende
  958 D5F1  18 CA       	JR	DUMP2
  959                   ;
  960                   ; Abarbeitung von Kommandos aus einer Datei INITIAL.UUU wie F-Tastencode
  961                   ; Laufwerksangabe wird hier nicht mehr unterstuetzt, das macht DEP 3.x
  962                   ; Ablage und Abarbeitung auf Adresse 100h
  963                   ; Dateigroesse max. 1 Block = 128 Byte !
  964                   ;
  965 D5F3  49 4E 49 54 UUU:	DB	'INITIAL.UUU',0	; Standard-Dateiname
  966 D5FF  7F7F        	DW	7F7FH
  967 D601  49 4E 49 54 	DB	'INIT'
  968 D605  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
  969 D606  1A          	LD	A,(DE)		; Parameter in Kommandozeile
  970 D607  E6 DF       	AND	0DFH		; angegeben?
  971 D609  20 03       	JR	NZ,INIT1	; ja, diesen verwenden
  972 D60B  11 D5F3     	LD	DE,UUU		; ansonsten Standard-Dateiname INITIAL.UUU
  973 D60E  CD D64A     INIT1:	CALL	TDUP1		; Dateiname in HL
  974 D611  D8          	RET	C		; TAPE oder BRK
  975 D612  CD F04F     	CALL	PV1		; HL = Dateiname
  976 D615  0A          	DB	0AH		; ISRI (ersten Block einlesen)
  977 D616  38 95       	JR	C,FCLOSE	; Fehler aufgetreten
  978 D618  21 B700     	LD	HL,CASS		; Daten aus Kassettenpuffer
  979 D61B  11 0100     	LD	DE,100H		; hier aufbereiten zur Abarbeitung
  980 D61E  7E          INIT2:	LD	A,(HL)		; Zeichen
  981 D61F  A7          	AND	A
  982 D620  28 13       	JR	Z,INIT3		; 00 ignorieren
  983 D622  FE 03       	CP	3
  984 D624  28 15       	JR	Z,INIT4		; CAOS-Ende
  985 D626  FE 0A       	CP	0AH
  986 D628  28 0B       	JR	Z,INIT3		; LF ignorieren
  987 D62A  FE 1A       	CP	1AH
  988 D62C  28 0D       	JR	Z,INIT4		; CP/M-Ende
  989 D62E  12          	LD	(DE),A		; Zeichen ablegen
  990 D62F  1C          	INC	E		; Ziel +1
  991 D630  7B          	LD	A,E
  992 D631  FE 7F       	CP	7FH
  993 D633  28 06       	JR	Z,INIT4		; Pufferende erreicht
  994 D635  2C          INIT3:	INC	L		; Quelle +1
  995 D636  7D          	LD	A,L
  996 D637  FE 80       	CP	80H		; Pufferende?
  997 D639  20 E3       	JR	NZ,INIT2	; weitere Zeichen bearbeiten
  998 D63B  AF          INIT4:	XOR	A
  999 D63C  12          	LD	(DE),A		; Ende-Kennung anhaengen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  69
CD46    INC

 1000 D63D  21 0100     	LD	HL,100h		; Ablage hier (wie DEP 3.2)
 1001 D640  22 B7D1     	LD	(FTAST),HL	; Aktivierung als ob es
 1002 D643  DD CB 08 F6 	SET	6,(IX+8)	; eine Funktionstaste waere
 1003 D647  C3 D5AD     	JP	FCLOSE		; Datei schliessen, CAOS ROM-C wie vorher
 1004                   ;
 1005                   ; UP1 fuer TYPE, DUMP, INIT, ERA: Vorbereitung fuer Datei oeffnen
 1006                   ; PA:	CY=1	Fehler (DEVICE=0 oder BRK)
 1007                   ;
 1008 D64A  DD 7E 08    TDUP1:	LD	A,(IX+8)
 1009 D64D  E6 1C       	AND	00011100b	; DEVICE-Nummer
 1010 D64F  37          	SCF			; Fehlerkennung
 1011 D650  C8          	RET	Z		; bei TAPE macht das keinen Sinn...
 1012 D651  EB          	EX	DE,HL
 1013 D652  7E          	LD	A,(HL)		; erstes Zeichen nach Menuewort holen
 1014 D653  E6 DF       	AND	0DFH
 1015 D655  CC F573     	CALL	Z,NAME		; Dateiname abfragen falls nicht angegeben
 1016 D658  D8          	RET	C		; mit BRK abgebrochen
 1017 D659  CD F552     	CALL	KPUFF		; Standardpuffer setzen
 1018 D65C  3A B805     	LD	A,(MODST+5)	; Schaltzustand Moduladresse 5 (ROM C)
 1019 D65F  32 B780     	LD	(ARGC),A	; hier merken (zeigt sonst USER-ROM-Zustand an)
 1020 D662  3E 01       	LD	A,1		; und voruebergehend fest einschalten
 1021 D664  32 B805     	LD	(MODST+5),A
 1022 D667  C9          	RET
 1023                   ;
 1024                   ; UP2 fuer TYPE+DUMP: Eingabe bei Seitenende
 1025                   ; PA:	Z=1	BRK
 1026                   ;
 1027 D668  CD F400     TDUP2:	CALL	INTB
 1028 D66B  FE 03       	CP	3		; BRK?
 1029 D66D  C8          	RET	Z		; ja, Datei schliessen und Ende
 1030 D66E  FE 0F       	CP	0FH		; Hardcopy?
 1031 D670  C0          	RET	NZ
 1032 D671  CD F3E5     	CALL	OCHR		; Hardcopy zulassen
 1033 D674  18 F2       	JR	TDUP2
 1034                   
 1035                   ; Geraetecode in Bits 2-4 (IX+8) eintragen und Treiberadressen in SUTAB kopieren
 1036                   ; PE:	A	Geraetecode 0...7
 1037                   ;		0	Kassette - Standard
 1038                   ;		1	Diskette - D004/D008
 1039                   ;		2	USB (M052)
 1040                   ;		3	Netzwerk (M052)
 1041                   ;		4-7	Anwender-Treiber
 1042                   ;		8-FE	aktuellen Treiber anzeigen
 1043                   ;		FF	Auflisten aller Treiber
 1044                   ; PA:		CY=1	ausgewaehlter Treiber nicht aktiv
 1045                   ; VR:	AF,BC,DE,HL
 1046                   
 1047 D676  FE 08       SET_DD:	CP	8		; Treiber aendern oder nur Name abfragen?
 1048 D678  30 42       	JR	NC,DLIST
 1049 D67A  4F          	ld	c,a		; Nr. zum Vergleich merken
 1050 D67B  87          	ADD	A,A
 1051 D67C  87          	ADD	A,A		; nach Bits 2..4
 1052 D67D  DD AE 08    	XOR	(IX+8)
 1053 D680  E6 1C       	AND	00011100b	; Bits 0..1 und 5..7 zuruecksetzen
 1054 D682  DD AE 08    	XOR	(IX+8)		; a = (a XOR b) XOR b fuer Bits 2..4
 1055 D685  47          	ld	b,a		; vorbereiteter neuer Wert fuer IX+8
 1056 D686  E6 1C       	and	00011100b	; nur die Bits 2..4 ausfiltern
 1057 D688  87          	add	a,a

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  70
CD46    INC

 1058 D689  87          	add	a,a		; *32
 1059 D68A  87          	add	a,a
 1060 D68B  26 A9       	ld	h,High(devtab)	; = A900H
 1061 D68D  6F          	ld	l,a
 1062 D68E  7E          	ld	a,(hl)
 1063 D68F  B9          	cp	c		; aktiver Treiber?
 1064 D690  37          	SCF			; Fehlercode
 1065 D691  C0          	ret	nz		; nein, dann nicht umstellen!
 1066 D692  DD 70 08    	LD	(IX+8),B	; neuen Treiber jetzt eintragen
 1067 D695  CB DD       	set	3,l		; hier beginnen die Treiberadressen
 1068 D697  ED 5B B7B0  	ld	de,(sutab)	; SUTAB-Adresse zum Modifizieren
 1069 D69B  13          	inc	de
 1070 D69C  13          	inc	de
 1071 D69D  ED A0       	ldi			; 01h = MBO
 1072 D69F  ED A0       	ldi
 1073 D6A1  EB          	ex	de,hl
 1074 D6A2  01 0006     	ld	bc,6		; 2*(MBI-MBO-1)=6
 1075 D6A5  09          	add	hl,bc
 1076 D6A6  EB          	ex	de,hl
 1077 D6A7  ED A0       	ldi			; 05h = MBI
 1078 D6A9  ED A0       	ldi
 1079 D6AB  EB          	ex	de,hl
 1080                   ;	ld	bc,4		; 2*(ISRO-MBI-1)=4	(BC=4 ist 4 nach 2x LDI)
 1081 D6AC  09          	add	hl,bc
 1082 D6AD  EB          	ex	de,hl
 1083 D6AE  0E 08       	ld	c,8
 1084 D6B0  ED B0       	ldir			; 08h = ISRO bis 0Bh = CSRI
 1085 D6B2  EB          	ex	de,hl
 1086 D6B3  0E 56       	ld	c,56h		; 2*(MBIN-CSRI-1)=56h
 1087 D6B5  09          	add	hl,bc		; CY=0
 1088 D6B6  EB          	ex	de,hl
 1089 D6B7  0E 04       	ld	c,4
 1090 D6B9  ED B0       	ldir			; 37h = MBIN und 38h = MBOUT
 1091 D6BB  C9          	RET
 1092                   
 1093                   ; aktuellen Treiber anzeigen (4 Zeichen):
 1094                   
 1095 D6BC  3C          DLIST:	INC	A		; A=FFh?
 1096 D6BD  28 19       	jr	z,dl0		; ja, dann alle Treiber auflisten
 1097 D6BF  DD 7E 08    dl2:	LD	A,(IX+8)
 1098 D6C2  E6 1C       	AND	00011100b	; aktuelles Geraet ausfiltern
 1099 D6C4  87          	add	a,a
 1100 D6C5  87          	add	a,a
 1101 D6C6  87          	add	a,a
 1102 D6C7  21 A904     	LD	HL,DEVTAB+4	; Zeiger auf String
 1103 D6CA  B5          	or	l
 1104 D6CB  6F          	ld	l,a
 1105 D6CC  06 04       dl5:	ld	b,4		; 4 Zeichen
 1106 D6CE  7E          dl3:	ld	a,(hl)
 1107 D6CF  23          	inc	hl
 1108 D6D0  FE 20       	cp	20h		; keine Steuerzeichen!
 1109 D6D2  D4 F3E5     	call	nc,ochr		; Name des Treibers anzeigen
 1110 D6D5  10 F7       	djnz	dl3
 1111 D6D7  C9          	ret
 1112                   
 1113                   ; alle Treiber auflisten:
 1114                   
 1115 D6D8  21 A900     dl0:	ld	hl,devtab	; Treiber-Tabelle

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  71
CD46    INC

 1116 D6DB  0E 00       	ld	c,0		; Beginne mit Treiber Nr. 0
 1117 D6DD  7E          dl1:	ld	a,(hl)		; Treibernummer
 1118 D6DE  B9          	cp	c		; Treiber aktiviert?
 1119 D6DF  20 12       	jr	nz,dl6
 1120 D6E1  23          	inc	hl
 1121 D6E2  23          	inc	hl
 1122 D6E3  23          	inc	hl
 1123 D6E4  23          	inc	hl		; Zeiger auf String
 1124 D6E5  CD F3DD     	CALL	AHEX0		; Geraetenummer einstellig anzeigen
 1125 D6E8  3E 3D       	LD	A,'='
 1126 D6EA  CD F3E5     	CALL	OCHR
 1127 D6ED  CD D6CC     	CALL	DL5		; Treiber-Name anzeigen
 1128 D6F0  CD F4E7     	call	CRLF
 1129 D6F3  7D          dl6:	ld	a,l
 1130 D6F4  F6 1F       	or	31
 1131 D6F6  3C          	inc	a
 1132 D6F7  6F          	ld	l,a		; weiter zum naechsten Treiber
 1133 D6F8  0C          	inc	c		; Nr. erhoehen
 1134 D6F9  79          	ld	a,c
 1135 D6FA  FE 08       	cp	8
 1136 D6FC  20 DF       	jr	nz,dl1		; Bis alle 8 Treiber erreicht sind
 1137 D6FE  C9          	ret
 1138                   
 1139                   ; Laufwerkwechsel per ESC-D:
 1140                   
 1141 D6FF  CD F4E7     ESCDD:	CALL	CRLF		; neue Zeile
 1142 D702  CD D6D8     	CALL	DL0		; Treiber auflisten
 1143 D705  CD F0CE     DL7:	CALL	OSTR
 1144 D708  02 3F 00    	DB	2,'?',0		; Eingabeaufforderung anzeigen
 1145 D70B  CD F406     	CALL	KBD		; Tastatureingabe
 1146 D70E  FE 30       	CP	'0'
 1147 D710  38 F3       	JR	C,DL7		; Eingabewert zu klein!
 1148 D712  FE 38       	CP	'8'
 1149 D714  30 EF       	JR	NC,DL7		; zu gross
 1150 D716  F5          	push	af
 1151 D717  E6 0F       	AND	0FH
 1152 D719  CD D676     	CALL	SET_DD		; Treiber einstellen
 1153 D71C  30 03       	jr	nc,dl8		; kein Fehler
 1154 D71E  F1          	pop	af
 1155 D71F  18 E4       	jr	dl7		; wiederholen
 1156                   	;
 1157 D721  F1          dl8:	pop	af
 1158 D722  CD E091     	call	crt		; anzeigen
 1159 D725  C3 F4E7     	jp	crlf		; neue Zeile
 1160                   ;
 1161                   ; Floppy-Treiber Funktion 1: Laufwerkwechsel (DEP 2.0)
 1162                   ; PE:	DE	Zeichenkette neues Laufwerk
 1163                   ;	(DE)=0	Anzeige aktuelles Laufwerk
 1164                   ; PA:	CY=1	Fehler
 1165                   ;
 1166 D728  01 83F1     DRIVE:	LD	BC,DEPVER	; 083F1H
 1167 D72B  ED 78       	IN	A,(C)
 1168 D72D  FE 20       	CP	20H		; DEP ab 2.0?
 1169 D72F  30 13       	JR	NC,DRIVE1	; OK, Laufwerkwechsel moeglich
 1170 D731  CD F0CE     	CALL	OSTR
 1171 D734  4B 65 69 6E 	DB	'Kein DEP2!',7,CR,LF,0
 1172 D742  37          	SCF
 1173 D743  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  72
CD46    INC

 1174                   	;
 1175 D744  EB          DRIVE1:	EX	DE,HL		; LW-Zeichenkette jetzt in HL
 1176 D745  7E          	LD	A,(HL)
 1177 D746  E6 DF       	AND	0DFH
 1178 D748  20 2D       	JR	NZ,DRIVE3	; mit Argument aufgerufen!
 1179 D74A  CD F0CE     	CALL	OSTR
 1180 D74D  44 72 69 76 	DB	'Drive:',0
 1181 D754  3E 01       	LD	A,1		; aktuell lesen
 1182 D756  CD D093     	CALL	STEUB2
 1183 D759  01 81F1     	LD	BC,LWANF	; 081F1H
 1184 D75C  ED 78       	IN	A,(C)
 1185 D75E  CD F3E5     	CALL	OCHR		; Laufwerk anzeigen
 1186 D761  04          	INC	B		; 082F1H
 1187 D762  ED 78       	IN	A,(C)		; aktueller User-Bereich
 1188 D764  E6 0F       	AND	0FH
 1189 D766  C4 F3DD     	CALL	NZ,AHEX0	; Userbereich hex anzeigen
 1190 D769  3E 06       	LD	A,6
 1191 D76B  32 B7A0     	LD	(CURSO),A
 1192 D76E  CD F4A5     	CALL	INLIN		; Eingabe
 1193 D771  3F          	CCF
 1194 D772  D0          	RET	NC		; BRK
 1195 D773  21 0006     	LD	HL,6
 1196 D776  19          	ADD	HL,DE
 1197 D777  01 81F1     DRIVE3:	LD	BC,LWANF	; 081F1H
 1198 D77A  7E          	LD	A,(HL)
 1199 D77B  A7          	AND	A		; leer?
 1200 D77C  C8          	RET	Z
 1201 D77D  CD F549     	CALL	UPCASE
 1202 D780  ED 79       	OUT	(C),A		; LW-Code
 1203 D782  23          	INC	HL
 1204 D783  7E          	LD	A,(HL)
 1205 D784  A7          	AND	A		; USER mit angegeben?
 1206 D785  3E 03       	LD	A,3		; nur LW anfordern
 1207 D787  28 10       	JR	Z,DRIVE5
 1208 D789  EB          	EX	DE,HL
 1209 D78A  CD F4F7     	CALL	RHEX
 1210 D78D  3E 00       	LD	A,0		; USER 0, weil
 1211 D78F  38 03       	JR	C,DRIVE4	; keine HEX-Zahl
 1212 D791  3A B797     	LD	A,(NUMVX)
 1213 D794  04          DRIVE4:	INC	B		; 082F1H
 1214 D795  ED 79       	OUT	(C),A		; USER-Nr.
 1215 D797  3E 07       	LD	A,7		; LW+User anfordern
 1216 D799  CD D093     DRIVE5:	CALL	STEUB2		; Stack-Unwinding:
 1217 D79C  C9          	RET			; nicht in JP umwandeln!
 1218                   ;
 1219                   ; CAOS-Kommandos mit DEVICE-Treiberfunktionen
 1220                   ;
 1221 D79D  7F7F        	DW	7F7FH
 1222 D79F  52 45 4E    	DB	'REN'
 1223 D7A2  1F          	DB	1FH		; Textargument zulaessig (2 Dateinamen)
 1224 D7A3  3E 03       	LD	A,3		; Funktion 3
 1225 D7A5  18 1A       	JR	FKT_DD
 1226                   
 1227 D7A7  7F7F        	DW	7F7FH
 1228 D7A9  45 52 41    	DB	'ERA'
 1229 D7AC  1F          	DB	1FH		; Textargument zulaessig (Dateiname)
 1230 D7AD  3E 02       	LD	A,2		; Funktion 2
 1231 D7AF  18 10       	JR	FKT_DD

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  73
CD46    INC

 1232                   
 1233 D7B1  7F7F        	DW	7F7FH
 1234 D7B3  43 44       	DB	'CD'		; ersetzt bisheriges Menuewort DRIVE
 1235 D7B5  1F          	DB	1FH		; Textargument zulaessig (Verzeichnis)
 1236 D7B6  3E 01       	LD	A,1		; Funktion 1
 1237 D7B8  18 07       	JR	FKT_DD
 1238                   
 1239 D7BA  7F7F        	DW	7F7FH
 1240 D7BC  44 49 52    	DB	'DIR'
 1241 D7BF  1F          	DB	1FH		; Textargument zulaessig (Maske in DE)
 1242 D7C0  AF          	XOR	A		; Funktion 0
 1243                   
 1244                   ; Geraetetreiber-Funktion aufrufen
 1245                   ; PE:	A	Funktionsnummer
 1246                   ;		0 = DIR bzw. TAPELIST
 1247                   ;		1 = DRIVE oder CD
 1248                   ;		2 = ERA (Datei loeschen)
 1249                   ;		3 = REN (Datei umbenennen)
 1250                   ;		?? (SETWR, SETRO)
 1251                   ;	DE	Dateiname bzw. Maske
 1252                   ; PA:		entsprechend Treiber
 1253                   ; VR:	AF,BC,DE,HL
 1254                   
 1255 D7C1  E6 03       FKT_DD:	and	3		; nur Treiberfunktionen 0..3 definiert
 1256 D7C3  4F          	ld	c,a
 1257 D7C4  DD 7E 08    	LD	A,(IX+8)
 1258 D7C7  E6 1C       	AND	00011100b	; die Bits 2..4 (DEVICE-Nr.) ausfiltern
 1259 D7C9  87          	add	a,a
 1260 D7CA  87          	add	a,a		; *16
 1261 D7CB  81          	add	a,c		; FKT-Nummer dazu
 1262 D7CC  87          	add	a,a		; *32
 1263 D7CD  4F          	ld	c,a
 1264 D7CE  06 00       	ld	b,0
 1265 D7D0  21 A918     	ld	HL,DEVTAB+24	; DIR-Kommando des jeweiligen Treibers
 1266 D7D3  09          	ADD	HL,BC
 1267 D7D4  7E          	LD	A,(HL)
 1268 D7D5  23          	INC	HL
 1269 D7D6  66          	LD	H,(HL)		; Aus Treibertabelle ermitteln
 1270 D7D7  6F          	LD	L,A
 1271 D7D8  E9          	JP	(HL)		; und anspringen
 1272                   ;
 1273                   ; TAPELIST = DIR-Kommando fuer Kassette
 1274                   ;
 1275 D7D9  CD F0CE     TLIST:	CALL	OSTR
 1276 D7DC  54 61 70 65 	DB	'Tape-Directory:',CR,LF,0
 1277 D7EE  DB 88       	IN	A,(PIOAD)
 1278 D7F0  F6 60       	OR	01100000b	; Motor+LED ein
 1279 D7F2  D3 88       	OUT	(PIOAD),A
 1280 D7F4  3E 0A       	LD	A,10
 1281 D7F6  CD F38B     	CALL	WAIT		; 60ms warten (Bandanlauf)
 1282 D7F9  CD F552     	CALL	KPUFF		; Standard-Puffer einstellen
 1283 D7FC  DD 36 03 01 TLW:	LD	(IX+3),1	; Block Nr. 1 erwarten
 1284 D800  CD F04F     	CALL	PV1
 1285 D803  05          	DB	05H		; MBI
 1286 D804  38 32       	JR	C,TLBRK		; Fehler aufgetreten
 1287 D806  DD 7E 02    	LD	A,(IX+2)
 1288 D809  3D          	DEC	A
 1289 D80A  28 08       	JR	Z,TL01		; Block Nr. 1 gefunden

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  74
CD46    INC

 1290 D80C  CD F0C8     	CALL	BNROST
 1291 D80F  2A          	DB	'*'		; falsche Blocknummer
 1292 D810  19 00       	DB	19H,0
 1293 D812  18 24       	JR	TLBRK
 1294                   	;
 1295 D814  CD F641     TL01:	CALL	LUP3		; Name aus Vorblock anzeigen
 1296 D817  3A B710     	LD	A,(CASS+10H)	; Anzahl der Argumente
 1297 D81A  D6 02       	SUB	2
 1298 D81C  FE 08       	CP	8		; 2 bis 10 Argumente?
 1299 D81E  30 15       	JR	NC,TLNO		; keine MC-Datei!
 1300 D820  2A B711     	LD	HL,(CASS+11H)	; AADR
 1301 D823  ED 5B B713  	LD	DE,(CASS+13H)	; EADR+1
 1302 D827  CD F4EE     	CALL	HLDE		; Anfangsadresse und Endadresse anzeigen
 1303 D82A  2A B715     	LD	HL,(CASS+15H)	; SADR
 1304 D82D  3A B710     	LD	A,(CASS+10H)
 1305 D830  FE 03       	CP	3
 1306 D832  D4 F3C4     	CALL	NC,HLHX		; Startadresse anzeigen
 1307 D835  CD F4E7     TLNO:	CALL	CRLF		; Zeilenvorschub nach Dateiname + Adressen
 1308 D838  CD E379     TLBRK:	CALL	BRKT
 1309 D83B  30 BF       	JR	NC,TLW		; wiederholen bis BRK gedrueckt wird
 1310 D83D  DB 88       TLX:	IN	A,(PIOAD)
 1311 D83F  E6 9F       	AND	10011111b	; Motor+LED aus
 1312 D841  D3 88       	OUT	(PIOAD),A
 1313 D843  C9          	RET
 1314                   ;
 1315                   ; Unterprogrammtabelle (wird in IRM kopiert):
 1316                   ;
 1317 D844  E091        SUTB:	DW	CRT	; 00
 1318 D846  E4D6        	DW	MBO	; 01
 1319 D848  B7BD        	DW	UOUT1	; 02
 1320 D84A  B7C3        	DW	UOUT2	; 03
 1321 D84C  F406        	DW	KBD	; 04
 1322 D84E  E53B        	DW	MBI	; 05
 1323 D850  B7C0        	DW	UIN1	; 06
 1324 D852  B7C6        	DW	UIN2	; 07
 1325 D854  E4C7        	DW	ISRO	; 08
 1326 D856  E473        	DW	CSRO	; 09
 1327 D858  E538        	DW	ISRI	; 0A
 1328 D85A  E47B        	DW	CSRI	; 0B
 1329 D85C  E365        	DW	KBDS	; 0C
 1330 D85E  F166        	DW	BYE	; 0D
 1331 D860  E370        	DW	KBDZ	; 0E
 1332 D862  F792        	DW	COLR	; 0F
 1333 D864  F6AE        	DW	LOAD	; 10
 1334 D866  F698        	DW	VERIF	; 11
 1335 D868  F26B        	DW	LOOP	; 12
 1336 D86A  F399        	DW	NORM	; 13
 1337 D86C  F38B        	DW	WAIT	; 14
 1338 D86E  F609        	DW	LARG	; 15
 1339 D870  F400        	DW	INTB	; 16
 1340 D872  F4A5        	DW	INLIN	; 17
 1341 D874  F4F7        	DW	RHEX	; 18
 1342 D876  F4DD        	DW	ERRM	; 19
 1343 D878  F3C4        	DW	HLHX	; 1A
 1344 D87A  F4EE        	DW	HLDE	; 1B
 1345 D87C  F3D4        	DW	AHEX	; 1C
 1346 D87E  F35C        	DW	ZSUCH	; 1D
 1347 D880  F39F        	DW	SOUT	; 1E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  75
CD46    INC

 1348 D882  F3AC        	DW	SIN	; 1F
 1349 D884  F39C        	DW	NOUT	; 20
 1350 D886  F3A9        	DW	NIN	; 21
 1351 D888  F52C        	DW	GARG	; 22
 1352 D88A  F0CE        	DW	OSTR	; 23
 1353 D88C  F3E5        	DW	OCHR	; 24
 1354 D88E  F805        	DW	CUCP	; 25
 1355 D890  F107        	DW	MODU	; 26
 1356 D892  F120        	DW	JUMP	; 27
 1357 D894  E2CE        	DW	LDMA	; 28
 1358 D896  E2D0        	DW	LDAM	; 29
 1359 D898  E379        	DW	BRKT	; 2A
 1360 D89A  F3CC        	DW	SPACE	; 2B
 1361 D89C  F4E7        	DW	CRLF	; 2C
 1362 D89E  F3D0        	DW	HOME	; 2D
 1363 D8A0  F7C0        	DW	MODI	; 2E
 1364 D8A2  F83B        	DW	PUDE	; 2F
 1365 D8A4  F833        	DW	PUSE	; 30
 1366 D8A6  FBB4        	DW	SIXD	; 31
 1367 D8A8  E06D        	DW	DABR	; 32
 1368 D8AA  E061        	DW	TCIF	; 33
 1369 D8AC  E051        	DW	PADR	; 34
 1370 D8AE  F923        	DW	TON	; 35
 1371 D8B0  F591        	DW	SAVE	; 36
 1372 D8B2  F85B        	DW	MBIN	; 37
 1373 D8B4  F853        	DW	MBOUT	; 38
 1374 D8B6  F7FD        	DW	KEY	; 39
 1375 D8B8  F7F4        	DW	KEYLI	; 3A
 1376 D8BA  F7AF        	DW	DISP	; 3B
 1377 D8BC  F7DA        	DW	WININ	; 3C
 1378 D8BE  F7E2        	DW	WINAK	; 3D
 1379 D8C0  F84B        	DW	LINE	; 3E
 1380 D8C2  F843        	DW	CIRCL	; 3F
 1381 D8C4  FBD0        	DW	SQR	; 40
 1382 D8C6  FBCA        	DW	MULT	; 41
 1383 D8C8  F798        	DW	CSTBT	; 42
 1384 D8CA  F55B        	DW	INIEA	; 43
 1385 D8CC  F56D        	DW	INIME	; 44
 1386 D8CE  F91D        	DW	ZKOUT	; 45
 1387 D8D0  F1FE        	DW	MENU	; 46
 1388 D8D2  F9D7        	DW	V24OUT	; 47
 1389 D8D4  F9FF        	DW	V24DUP	; 48
 1390 D8D6  FC03        	DW	SETDEV	; 49 - CAOS 4.6: Speichergeraet einstellen
 1391 D8D8  FC0C        	DW	DEVFKT	; 4A - CAOS 4.6: Geraetefunktion aufrufen
 1392 D8DA              SUEND:
 1393                   
 1394                   ; CAOS 4.6 - Sprungtabelle Treiber Nr. 0 - Kassette
 1395                   
 1396 D8DA  FF          DRV0:	DB	-1		; Kennung (Vorgabe = nicht aktiv)
 1397 D8DB  00          	DB	0		; Modulsteckplatz (D001)
 1398 D8DC  03 03       	DB	3,3		; SWITCH-Befehl ein/aus
 1399 D8DE  54 41 50 45 	DB	'TAPE'		; Name des Treibers
 1400 D8E2  E4D6        	DW	MBO		; 01 Ausgabe Datenblock 128 Byte
 1401 D8E4  E53B        	DW	MBI		; 05 Einlesen Datenblock 128 Byte
 1402 D8E6  E4C7        	DW	ISRO		; 08 Ausgabedatei oeffnen und ersten Block 01h ausgeben
 1403 D8E8  E473        	DW	CSRO		; 09 Ausgabedatei schliessen und Endeblock FFh ausgeben
 1404 D8EA  E538        	DW	ISRI		; 0A Eingabedatei oeffnen und Block 01 einlesen
 1405 D8EC  E47B        	DW	CSRI		; 0B Eingabedatei schliessen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  76
CD46    INC

 1406 D8EE  F85B        	DW	MBIN		; 37 Einlesen 1 Byte (BASIC-Schnittstelle)
 1407 D8F0  F853        	DW	MBOUT		; 38 Ausgabe 1 Byte (BASIC-Schnittstelle)
 1408 D8F2  D7D9        	DW	TLIST		; DIR = TAPELIST
 1409 D8F4  FBDF        	DW	MOT		; CD  = Kassette ein/aus (statt Laufwerkwechsel)
 1410 D8F6  F305        	DW	ERR1		; ERA - nicht vorgesehen
 1411 D8F8  F305        	DW	ERR1		; REN - nicht vorgesehen
 1412                   
 1413                   ; CAOS 4.6 - Sprungtabelle Treiber Nr. 1 Diskette D004/D008
 1414                   
 1415 D8FA  01          DRV1:	DB	1		; Kennung (Treiber Nr. 1)
 1416 D8FB  FC          	DB	0FCH		; Modulsteckplatz (D004)
 1417 D8FC  FF FF       	DB	0FFH,0FFH	; SWITCH-Befehl ein/aus
 1418 D8FE  44 49 53 4B 	DB	'DISK'		; Name des Treibers
 1419 D902  F883        	DW	FMBO		; 01 Ausgabe Datenblock 128 Byte
 1420 D904  F86B        	DW	FMBI		; 05 Einlesen Datenblock 128 Byte
 1421 D906  F87B        	DW	FISRO		; 08 Ausgabedatei oeffnen und ersten Block 01h ausgeben
 1422 D908  F88B        	DW	FCSRO		; 09 Ausgabedatei schliessen und Endeblock FFh ausgeben
 1423 D90A  F863        	DW	FISRI		; 0A Eingabedatei oeffnen und Block 01 einlesen
 1424 D90C  F873        	DW	FCSRI		; 0B Eingabedatei schliessen
 1425 D90E  F893        	DW	FMBIN		; 37 Einlesen 1 Byte (BASIC-Schnittstelle)
 1426 D910  F89B        	DW	FMBOUT		; 38 Ausgabe 1 Byte (BASIC-Schnittstelle)
 1427 D912  D404        	DW	FDIR		; DIR = Verzeichnisanzeige mit Maske
 1428 D914  D728        	DW	DRIVE		; CD  = Laufwerkwechsel
 1429 D916  D4C2        	DW	FERA		; ERA = Datei loeschen
 1430 D918  D4D6        	DW	FREN		; REN = Datei umbenennen
 1431                   ;
 1432                   ; Portinitialisierungstabellen:
 1433                   ;
 1434 D91A  07          IOTAB1:	DB	7		; 7 Ports fuer Erstinitialisierung
 1435                   
 1436 D91B  8A 01       	 DB	PIOAS,1		; PIO-A Steuerwort
 1437 D91D  E4          	  DB	0E4h		; Interruptvektor
 1438                   
 1439 D91E  88 02       	 DB	PIOAD,2		; PIO-A Daten
 1440 D920  1F          	  DB	00011111b	; D005-Reset
 1441 D921  0F          	  DB	00001111b	; IRM, RAM0, CAOS-E
 1442                   
 1443 D922  8A 02       	 DB	PIOAS,2		; PIO-A Steuerwort
 1444 D924  0F          	  DB	00001111b	; Byte-Ausgabemodus
 1445 D925  03          	  DB	00000011b	; DI
 1446                   
 1447 D926  8B 03       	 DB	PIOBS,3		; PIO-B Steuerwort
 1448 D928  E6          	  DB	0E6h		; Interruptvektor
 1449 D929  0F          	  DB	00001111b	; Byte-Ausgabemodus
 1450 D92A  83          	  DB	10000011b	; EI
 1451                   
 1452 D92B  89 01       	 DB	PIOBD,1		; PIO-B Daten
 1453 D92D  FF          	  DB	0FFh		; Daten
 1454                   
 1455 D92E  84 01       	 DB	84h,1		; Ausgabeport 84h
 1456 D930  28          	  DB	00101000b	; RAM8 0, LoRes
 1457                   
 1458 D931  86 01       	 DB	86h,1		; Ausgabeport 86h
 1459 D933  E3          	  DB	11100011b	; RAM4 ein, USER-C 3, CAOS-C ein
 1460                   
 1461 D934  04          IOTAB2:	DB	4		; 4 Ports initialisieren
 1462                   
 1463 D935  8A 01       	 DB	PIOAS,1		; PIO-A Steuerwort

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  77
CD46    INC

 1464 D937  E4          	  DB	0E4h		; Interruptvektor
 1465                   
 1466 D938  8B 01       	 DB	PIOBS,1		; PIO-B Steuerwort
 1467 D93A  E6          	  DB	0E6h		; Interruptvektor
 1468                   
 1469 D93B  8C 01       	 DB	CTC0,1		; CTC Kanal 0
 1470 D93D  E8          	  DB	0E8h		; Interruptvektor
 1471                   
 1472 D93E  8E 02       	 DB	CTC2,2		; CTC Kanal 2: blinken
 1473 D940  47          	  DB	01000111b	; DI, Zaehler, RESET
 1474 D941  0C          	  DB	12		; Zeitkonstante
 1475                   
 1476                   ; Initialisierungstabelle fuer M001 als Centronics-Druckerschnittstelle:
 1477                   ;
 1478 D942  03          DIOINI:	DB	3
 1479 D943  06 02       	 DB	06h,2		; PIO-A Steuerwort
 1480 D945  CF          	  DB	11001111b	; Bitbetrieb
 1481 D946  00          	  DB	00000000b	; alles Ausgaenge
 1482 D947  07 02       	 DB	07h,2		; PIO-B Steuerwort
 1483 D949  CF          	  DB	11001111b	; Bitbetrieb
 1484 D94A  FE          	  DB	11111110b	; Bit 0 Ausgang
 1485 D94B  05 01       	 DB	05h,1		; PIO-B Daten
 1486 D94D  01          	  DB	00000001b	; Strobe passiv
 1487                   
 1488                   ; Voreingestellte Zuordnung von Joystickfunktionen zu ASCII-Tastencodes
 1489                   ; Tabelle wird bei Power-On in den IRM kopiert, Bereich A894..A89F
 1490                   ; Hinweis: Fire2 ist beim M008 die primaere oder einzige Feuertaste
 1491                   ;
 1492 D94E  02          JOYTBD:	DB	2		; Wartezyklen fuer Tastenwiederholung
 1493 D94F  0B          	DB	0Bh		; Up
 1494 D950  0A          	DB	0Ah		; Down
 1495 D951  0D          	DB	CR		; Fire+Fire2
 1496 D952  08          	DB	08h		; Left
 1497 D953  00          	DB	0		; Up+Left
 1498 D954  00          	DB	0		; Down+Left
 1499 D955  0D          	DB	CR		; Fire
 1500 D956  09          	DB	09h		; Right
 1501 D957  00          	DB	0		; Up+Right
 1502 D958  00          	DB	0		; Down+Right
 1503 D959  20          	DB	' '		; Fire2
 1504                   ;
 1505                   ; Interrupttabelle (wird in den RAM kopiert):
 1506                   ;
 1507 D95A  E3D2        ISRTAB:	DW	ISRJ	; (IX-16) M008 PIO A: Joystick
 1508 D95C  FAAE        	DW	ISRSB	; (IX-14) M003 SIO B: V.24-Empfang
 1509 D95E  E5AE        	DW	ISRPA	; (IX-12) PIO A: Kassette
 1510 D960  E2E7        	DW	ISRPB	; (IX-10) PIO B: Tastatur
 1511 D962  E5BD        	DW	IRET	; (IX-8)  CTC 0: frei (TEMO Schrittbetrieb)
 1512 D964  E59E        	DW	ISRC1	; (IX-6)  CTC 1: Kassette
 1513 D966  FBD6        	DW	ISRC2	; (IX-4)  CTC 2: Tondauer
 1514 D968  E2DB        	DW	ISRC3	; (IX-2)  CTC 3: Tastatur
 1515                   ;
 1516                   ; IBM-Kodierungen fuer allgemeine Druckroutine PRINTC
 1517                   ;
 1518 D96A  7B 7C 7D 7E ZIBM:	DB	7BH,7CH,7DH,7EH
 1519 D96E  5B 5C 5D    	DB	5BH,5CH,5DH
 1520 D971  84 94 81 E1 	DB	84H,94H,81H,0E1H
 1521 D975  8E 99 9A    	DB	8EH,99H,9AH

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  78
CD46    INC

 1522                   
 1523                   	ABSFILL	0DAB8h,<ROM-D-Ende>
    7 D978  FF FF FF FF 	  DS	0DAB8h - $,0FFh
  143                   	INCLUDE	ZSIBM.INC	; IBM-Zeichensatz
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 IBM-Zeichensatz	**
    3                   ;**					**
    4                   ;**	Adresse:  DAB8h bis DFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 28.05.2010	**
    7                   ;*****************************************
    8                   
    9 DAB8  78 60 60 60 	DB	078H, 060H, 060H, 060H, 060H, 060H, 078H, 000H	; 5BH
   10 DAC0  C0 60 30 18 	DB	0C0H, 060H, 030H, 018H, 00CH, 006H, 002H, 000H	; 5CH
   11 DAC8  78 18 18 18 	DB	078H, 018H, 018H, 018H, 018H, 018H, 078H, 000H	; 5DH
   12 DAD0  30 30 18 00 	DB	030H, 030H, 018H, 000H, 000H, 000H, 000H, 000H	; 60H
   13 DAD8  1C 30 30 E0 	DB	01CH, 030H, 030H, 0E0H, 030H, 030H, 01CH, 000H	; 7BH
   14 DAE0  18 18 18 00 	DB	018H, 018H, 018H, 000H, 018H, 018H, 018H, 000H	; 7CH
   15 DAE8  E0 30 30 1C 	DB	0E0H, 030H, 030H, 01CH, 030H, 030H, 0E0H, 000H	; 7DH
   16 DAF0  76 DC 00 00 	DB	076H, 0DCH, 000H, 000H, 000H, 000H, 000H, 000H	; 7EH
   17 DAF8  00 10 38 6C 	DB	000H, 010H, 038H, 06CH, 0C6H, 0C6H, 0FEH, 000H	; 7FH
   18                   
   19 DB00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 081H, 0FFH	; 00H
   20 DB08  7E 81 A5 81 	DB	07EH, 081H, 0A5H, 081H, 0BDH, 099H, 081H, 07EH	; 01H
   21 DB10  7E FF DB FF 	DB	07EH, 0FFH, 0DBH, 0FFH, 0C3H, 0E7H, 0FFH, 07EH	; 02H
   22 DB18  6C FE FE FE 	DB	06CH, 0FEH, 0FEH, 0FEH, 07CH, 038H, 010H, 000H	; 03H
   23 DB20  10 38 7C FE 	DB	010H, 038H, 07CH, 0FEH, 07CH, 038H, 010H, 000H	; 04H
   24 DB28  38 7C 38 FE 	DB	038H, 07CH, 038H, 0FEH, 0FEH, 07CH, 038H, 07CH	; 05H
   25 DB30  10 10 38 7C 	DB	010H, 010H, 038H, 07CH, 0FEH, 07CH, 038H, 07CH	; 06H
   26 DB38  00 00 18 3C 	DB	000H, 000H, 018H, 03CH, 03CH, 018H, 000H, 000H	; 07H
   27 DB40  FF FF E7 C3 	DB	0FFH, 0FFH, 0E7H, 0C3H, 0C3H, 0E7H, 0FFH, 0FFH	; 08H
   28 DB48  00 3C 66 42 	DB	000H, 03CH, 066H, 042H, 042H, 066H, 03CH, 000H	; 09H
   29 DB50  FF C3 99 BD 	DB	0FFH, 0C3H, 099H, 0BDH, 0BDH, 099H, 0C3H, 0FFH	; 0AH
   30 DB58  0F 07 0F 7D 	DB	00FH, 007H, 00FH, 07DH, 0CCH, 0CCH, 0CCH, 078H	; 0BH
   31 DB60  3C 66 66 66 	DB	03CH, 066H, 066H, 066H, 03CH, 018H, 07EH, 018H	; 0CH
   32 DB68  3F 33 3F 30 	DB	03FH, 033H, 03FH, 030H, 030H, 070H, 0F0H, 0E0H	; 0DH
   33 DB70  7F 63 7F 63 	DB	07FH, 063H, 07FH, 063H, 063H, 067H, 0E6H, 0C0H	; 0EH
   34 DB78  99 5A 3C E7 	DB	099H, 05AH, 03CH, 0E7H, 0E7H, 03CH, 05AH, 099H	; 0FH
   35                   
   36 DB80  80 E0 F8 FE 	DB	080H, 0E0H, 0F8H, 0FEH, 0F8H, 0E0H, 080H, 000H	; 10H
   37 DB88  02 0E 3E FE 	DB	002H, 00EH, 03EH, 0FEH, 03EH, 00EH, 002H, 000H	; 11H
   38 DB90  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 018H, 07EH, 03CH, 018H	; 12H
   39 DB98  66 66 66 66 	DB	066H, 066H, 066H, 066H, 066H, 000H, 066H, 000H	; 13H
   40 DBA0  7B DB DB 7B 	DB	07BH, 0DBH, 0DBH, 07BH, 01BH, 01BH, 01BH, 000H	; 14H
   41 DBA8  3C 66 38 6C 	DB	03CH, 066H, 038H, 06CH, 06CH, 038H, 0CCH, 078H	; 15H
   42 DBB0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 07EH, 07EH, 07EH, 000H	; 16H
   43 DBB8  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 07EH, 03CH, 018H, 0FFH	; 17H
   44 DBC0  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 018H, 018H, 018H, 000H	; 18H
   45 DBC8  18 18 18 18 	DB	018H, 018H, 018H, 018H, 07EH, 03CH, 018H, 000H	; 19H
   46 DBD0  00 18 0C FE 	DB	000H, 018H, 00CH, 0FEH, 00CH, 018H, 000H, 000H	; 1AH
   47 DBD8  00 30 60 FE 	DB	000H, 030H, 060H, 0FEH, 060H, 030H, 000H, 000H	; 1BH
   48 DBE0  00 00 C0 C0 	DB	000H, 000H, 0C0H, 0C0H, 0C0H, 0FEH, 000H, 000H	; 1CH
   49 DBE8  00 24 66 FF 	DB	000H, 024H, 066H, 0FFH, 066H, 024H, 000H, 000H	; 1DH
   50 DBF0  00 18 3C 7E 	DB	000H, 018H, 03CH, 07EH, 0FFH, 0FFH, 000H, 000H	; 1EH
   51 DBF8  00 FF FF 7E 	DB	000H, 0FFH, 0FFH, 07EH, 03CH, 018H, 000H, 000H	; 1FH
   52                   
   53 DC00  78 CC C0 C0 	DB	078H, 0CCH, 0C0H, 0C0H, 0CCH, 078H, 010H, 070H	; 80H neu
   54 DC08  00 CC 00 CC 	DB	000H, 0CCH, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 81H neu

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  79
ZSIBM   INC

   55 DC10  1C 00 78 CC 	DB	01CH, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 82H
   56 DC18  78 84 78 0C 	DB	078H, 084H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 83H neu
   57 DC20  6C 00 78 0C 	DB	06CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 84H neu
   58 DC28  E0 00 78 0C 	DB	0E0H, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 85H neu
   59 DC30  30 30 78 0C 	DB	030H, 030H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 86H neu
   60 DC38  00 78 CC C0 	DB	000H, 078H, 0CCH, 0C0H, 0CCH, 078H, 010H, 070H	; 87H neu
   61 DC40  78 84 78 CC 	DB	078H, 084H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 88H neu
   62 DC48  CC 00 78 CC 	DB	0CCH, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 89H
   63 DC50  E0 00 78 CC 	DB	0E0H, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 8AH
   64 DC58  D8 00 70 30 	DB	0D8H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; 8BH neu
   65 DC60  70 88 70 30 	DB	070H, 088H, 070H, 030H, 030H, 030H, 078H, 000H	; 8CH neu
   66 DC68  E0 00 70 30 	DB	0E0H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; 8DH neu
   67 DC70  CC 30 78 CC 	DB	0CCH, 030H, 078H, 0CCH, 0FCH, 0CCH, 0CCH, 000H	; 8EH
   68 DC78  78 84 30 78 	DB	078H, 084H, 030H, 078H, 0CCH, 0FCH, 0CCH, 000H	; 8FH neu
   69                   
   70 DC80  1C 00 FC 60 	DB	01CH, 000H, 0FCH, 060H, 078H, 060H, 0FCH, 000H	; 90H
   71 DC88  00 00 6C 92 	DB	000H, 000H, 06CH, 092H, 09EH, 090H, 07EH, 000H	; 91H neu
   72 DC90  3E 78 D8 FE 	DB	03EH, 078H, 0D8H, 0FEH, 0D8H, 0D8H, 0DEH, 000H	; 92H neu
   73 DC98  78 84 00 78 	DB	078H, 084H, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 93H neu
   74 DCA0  00 CC 00 78 	DB	000H, 0CCH, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 94H
   75 DCA8  00 E0 00 78 	DB	000H, 0E0H, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 95H
   76 DCB0  78 84 00 CC 	DB	078H, 084H, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 96H neu
   77 DCB8  00 E0 00 CC 	DB	000H, 0E0H, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 97H neu
   78 DCC0  00 CC 00 CC 	DB	000H, 0CCH, 000H, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 98H
   79 DCC8  C6 38 6C C6 	DB	0C6H, 038H, 06CH, 0C6H, 0C6H, 06CH, 038H, 000H	; 99H
   80 DCD0  CC 00 CC CC 	DB	0CCH, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 078H, 000H	; 9AH
   81 DCD8  00 10 7C D6 	DB	000H, 010H, 07CH, 0D6H, 0D0H, 0D6H, 07CH, 010H	; 9BH neu
   82 DCE0  38 6C 64 F0 	DB	038H, 06CH, 064H, 0F0H, 060H, 0E6H, 0FCH, 000H	; 9CH
   83 DCE8  66 66 3C 7E 	DB	066H, 066H, 03CH, 07EH, 018H, 07EH, 018H, 018H	; 9DH
   84 DCF0  F8 CC CC FA 	DB	0F8H, 0CCH, 0CCH, 0FAH, 0C6H, 0CFH, 0C6H, 0C7H	; 9EH
   85 DCF8  0E 1B 18 3C 	DB	00EH, 01BH, 018H, 03CH, 018H, 018H, 0D8H, 070H	; 9FH
   86                   
   87 DD00  1C 00 78 0C 	DB	01CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; A0H neu
   88 DD08  38 00 70 30 	DB	038H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; A1H
   89 DD10  00 1C 00 78 	DB	000H, 01CH, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; A2H
   90 DD18  00 1C 00 CC 	DB	000H, 01CH, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; A3H neu
   91 DD20  00 F8 00 F8 	DB	000H, 0F8H, 000H, 0F8H, 0CCH, 0CCH, 0CCH, 000H	; A4H
   92 DD28  FC 00 CC EC 	DB	0FCH, 000H, 0CCH, 0ECH, 0FCH, 0DCH, 0CCH, 000H	; A5H
   93 DD30  00 3C 6C 6C 	DB	000H, 03CH, 06CH, 06CH, 03EH, 000H, 07EH, 000H	; A6H
   94 DD38  00 38 6C 6C 	DB	000H, 038H, 06CH, 06CH, 038H, 000H, 07CH, 000H	; A7H
   95 DD40  30 00 30 18 	DB	030H, 000H, 030H, 018H, 00CH, 0CCH, 078H, 000H	; A8H
   96 DD48  00 00 00 7E 	DB	000H, 000H, 000H, 07EH, 060H, 060H, 000H, 000H	; A9H
   97 DD50  00 00 00 7E 	DB	000H, 000H, 000H, 07EH, 006H, 006H, 000H, 000H	; AAH
   98 DD58  C3 C6 CC DE 	DB	0C3H, 0C6H, 0CCH, 0DEH, 033H, 066H, 0CCH, 00FH	; ABH
   99 DD60  C3 C6 CC DB 	DB	0C3H, 0C6H, 0CCH, 0DBH, 037H, 06FH, 0CFH, 003H	; ACH
  100 DD68  30 00 30 30 	DB	030H, 000H, 030H, 030H, 078H, 078H, 030H, 000H	; ADH
  101 DD70  00 33 66 CC 	DB	000H, 033H, 066H, 0CCH, 066H, 033H, 000H, 000H	; AEH
  102 DD78  00 CC 66 33 	DB	000H, 0CCH, 066H, 033H, 066H, 0CCH, 000H, 000H	; AFH
  103                   
  104 DD80  22 88 22 88 	DB	022H, 088H, 022H, 088H, 022H, 088H, 022H, 088H	; B0H
  105 DD88  55 AA 55 AA 	DB	055H, 0AAH, 055H, 0AAH, 055H, 0AAH, 055H, 0AAH	; B1H
  106 DD90  77 DD 77 DD 	DB	077H, 0DDH, 077H, 0DDH, 077H, 0DDH, 077H, 0DDH	; B2H neu
  107 DD98  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 018H, 018H, 018H	; B3H
  108 DDA0  18 18 18 F8 	DB	018H, 018H, 018H, 0F8H, 018H, 018H, 018H, 018H	; B4H
  109 DDA8  18 18 F8 18 	DB	018H, 018H, 0F8H, 018H, 0F8H, 018H, 018H, 018H	; B5H
  110 DDB0  36 36 36 F6 	DB	036H, 036H, 036H, 0F6H, 036H, 036H, 036H, 036H	; B6H
  111 DDB8  00 00 00 FE 	DB	000H, 000H, 000H, 0FEH, 036H, 036H, 036H, 036H	; B7H
  112 DDC0  00 00 F8 18 	DB	000H, 000H, 0F8H, 018H, 0F8H, 018H, 018H, 018H	; B8H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  80
ZSIBM   INC

  113 DDC8  36 36 F6 06 	DB	036H, 036H, 0F6H, 006H, 0F6H, 036H, 036H, 036H	; B9H
  114 DDD0  36 36 36 36 	DB	036H, 036H, 036H, 036H, 036H, 036H, 036H, 036H	; BAH
  115 DDD8  00 00 FE 06 	DB	000H, 000H, 0FEH, 006H, 0F6H, 036H, 036H, 036H	; BBH
  116 DDE0  36 36 F6 06 	DB	036H, 036H, 0F6H, 006H, 0FEH, 000H, 000H, 000H	; BCH
  117 DDE8  36 36 36 FE 	DB	036H, 036H, 036H, 0FEH, 000H, 000H, 000H, 000H	; BDH
  118 DDF0  18 18 F8 18 	DB	018H, 018H, 0F8H, 018H, 0F8H, 000H, 000H, 000H	; BEH
  119 DDF8  00 00 00 F8 	DB	000H, 000H, 000H, 0F8H, 018H, 018H, 018H, 018H	; BFH
  120                   
  121 DE00  18 18 18 1F 	DB	018H, 018H, 018H, 01FH, 000H, 000H, 000H, 000H	; C0H
  122 DE08  18 18 18 FF 	DB	018H, 018H, 018H, 0FFH, 000H, 000H, 000H, 000H	; C1H
  123 DE10  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 018H, 018H, 018H, 018H	; C2H
  124 DE18  18 18 18 1F 	DB	018H, 018H, 018H, 01FH, 018H, 018H, 018H, 018H	; C3H
  125 DE20  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 000H, 000H, 000H, 000H	; C4H
  126 DE28  18 18 18 FF 	DB	018H, 018H, 018H, 0FFH, 018H, 018H, 018H, 018H	; C5H
  127 DE30  18 18 1F 18 	DB	018H, 018H, 01FH, 018H, 01FH, 018H, 018H, 018H	; C6H
  128 DE38  36 36 36 37 	DB	036H, 036H, 036H, 037H, 036H, 036H, 036H, 036H	; C7H
  129 DE40  36 36 37 30 	DB	036H, 036H, 037H, 030H, 03FH, 000H, 000H, 000H	; C8H
  130 DE48  00 00 3F 30 	DB	000H, 000H, 03FH, 030H, 037H, 036H, 036H, 036H	; C9H
  131 DE50  36 36 F7 00 	DB	036H, 036H, 0F7H, 000H, 0FFH, 000H, 000H, 000H	; CAH
  132 DE58  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0F7H, 036H, 036H, 036H	; CBH
  133 DE60  36 36 37 30 	DB	036H, 036H, 037H, 030H, 037H, 036H, 036H, 036H	; CCH
  134 DE68  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0FFH, 000H, 000H, 000H	; CDH
  135 DE70  36 36 F7 00 	DB	036H, 036H, 0F7H, 000H, 0F7H, 036H, 036H, 036H	; CEH
  136 DE78  18 18 FF 00 	DB	018H, 018H, 0FFH, 000H, 0FFH, 000H, 000H, 000H	; CFH
  137                   
  138 DE80  36 36 36 FF 	DB	036H, 036H, 036H, 0FFH, 000H, 000H, 000H, 000H	; D0H
  139 DE88  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0FFH, 018H, 018H, 018H	; D1H
  140 DE90  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 036H, 036H, 036H, 036H	; D2H
  141 DE98  36 36 36 3F 	DB	036H, 036H, 036H, 03FH, 000H, 000H, 000H, 000H	; D3H
  142 DEA0  18 18 1F 18 	DB	018H, 018H, 01FH, 018H, 01FH, 000H, 000H, 000H	; D4H
  143 DEA8  00 00 1F 18 	DB	000H, 000H, 01FH, 018H, 01FH, 018H, 018H, 018H	; D5H
  144 DEB0  00 00 00 3F 	DB	000H, 000H, 000H, 03FH, 036H, 036H, 036H, 036H	; D6H
  145 DEB8  36 36 36 FF 	DB	036H, 036H, 036H, 0FFH, 036H, 036H, 036H, 036H	; D7H
  146 DEC0  18 18 FF 18 	DB	018H, 018H, 0FFH, 018H, 0FFH, 018H, 018H, 018H	; D8H
  147 DEC8  18 18 18 F8 	DB	018H, 018H, 018H, 0F8H, 000H, 000H, 000H, 000H	; D9H
  148 DED0  00 00 00 1F 	DB	000H, 000H, 000H, 01FH, 018H, 018H, 018H, 018H	; DAH
  149 DED8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH	; DBH
  150 DEE0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 0FFH, 0FFH, 0FFH, 0FFH	; DCH
  151 DEE8  F0 F0 F0 F0 	DB	0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H	; DDH
  152 DEF0  0F 0F 0F 0F 	DB	00FH, 00FH, 00FH, 00FH, 00FH, 00FH, 00FH, 00FH	; DEH
  153 DEF8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 000H, 000H, 000H, 000H	; DFH
  154                   
  155 DF00  00 00 76 DC 	DB	000H, 000H, 076H, 0DCH, 0CCH, 0DCH, 076H, 000H	; E0H
  156 DF08  3C 66 66 6C 	DB	03CH, 066H, 066H, 06CH, 066H, 066H, 06CH, 0F0H	; E1H
  157 DF10  FE 62 60 60 	DB	0FEH, 062H, 060H, 060H, 060H, 060H, 0F0H, 000H	; E2H
  158 DF18  00 FE 6C 6C 	DB	000H, 0FEH, 06CH, 06CH, 06CH, 06CH, 06EH, 000H	; E3H
  159 DF20  7E 62 30 18 	DB	07EH, 062H, 030H, 018H, 030H, 062H, 07EH, 000H	; E4H
  160 DF28  00 00 7E D8 	DB	000H, 000H, 07EH, 0D8H, 0D8H, 0D8H, 070H, 000H	; E5H
  161 DF30  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 0F6H, 0C0H, 0C0H	; E6H neu
  162 DF38  00 7E D8 18 	DB	000H, 07EH, 0D8H, 018H, 018H, 018H, 018H, 000H	; E7H
  163 DF40  3C 18 3C 66 	DB	03CH, 018H, 03CH, 066H, 066H, 03CH, 018H, 03CH	; E8H
  164 DF48  38 6C C6 FE 	DB	038H, 06CH, 0C6H, 0FEH, 0C6H, 06CH, 038H, 000H	; E9H
  165 DF50  38 6C C6 C6 	DB	038H, 06CH, 0C6H, 0C6H, 06CH, 06CH, 0EEH, 000H	; EAH
  166 DF58  1C 30 18 7C 	DB	01CH, 030H, 018H, 07CH, 0CCH, 0CCH, 078H, 000H	; EBH
  167 DF60  00 6C FE 92 	DB	000H, 06CH, 0FEH, 092H, 0FEH, 06CH, 000H, 000H	; ECH neu
  168 DF68  03 7E CC DE 	DB	003H, 07EH, 0CCH, 0DEH, 0F6H, 066H, 0FCH, 080H	; EDH neu
  169 DF70  3C 60 C0 FC 	DB	03CH, 060H, 0C0H, 0FCH, 0C0H, 060H, 03CH, 000H	; EEH neu
  170 DF78  3C 66 66 66 	DB	03CH, 066H, 066H, 066H, 066H, 066H, 066H, 000H	; EFH

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  81
ZSIBM   INC

  171                   
  172 DF80  00 7E 00 7E 	DB	000H, 07EH, 000H, 07EH, 000H, 07EH, 000H, 000H	; F0H
  173 DF88  18 18 7E 18 	DB	018H, 018H, 07EH, 018H, 018H, 000H, 07EH, 000H	; F1H
  174 DF90  30 18 0C 18 	DB	030H, 018H, 00CH, 018H, 030H, 000H, 07EH, 000H	; F2H
  175 DF98  0C 18 30 18 	DB	00CH, 018H, 030H, 018H, 00CH, 000H, 07EH, 000H	; F3H
  176 DFA0  0E 1B 1B 18 	DB	00EH, 01BH, 01BH, 018H, 018H, 018H, 018H, 018H	; F4H
  177 DFA8  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 0D8H, 0D8H, 070H	; F5H
  178 DFB0  18 18 00 7E 	DB	018H, 018H, 000H, 07EH, 000H, 018H, 018H, 000H	; F6H
  179 DFB8  00 76 DC 00 	DB	000H, 076H, 0DCH, 000H, 076H, 0DCH, 000H, 000H	; F7H
  180 DFC0  38 6C 6C 38 	DB	038H, 06CH, 06CH, 038H, 000H, 000H, 000H, 000H	; F8H
  181 DFC8  00 00 00 18 	DB	000H, 000H, 000H, 018H, 018H, 000H, 000H, 000H	; F9H
  182 DFD0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 018H, 000H, 000H, 000H	; FAH
  183 DFD8  0F 0C 0C 0C 	DB	00FH, 00CH, 00CH, 00CH, 0CCH, 06CH, 03CH, 01CH	; FBH
  184 DFE0  78 6C 6C 6C 	DB	078H, 06CH, 06CH, 06CH, 06CH, 000H, 000H, 000H	; FCH
  185 DFE8  70 18 30 60 	DB	070H, 018H, 030H, 060H, 078H, 000H, 000H, 000H	; FDH
  186 DFF0  00 00 3C 3C 	DB	000H, 000H, 03CH, 03CH, 03CH, 03CH, 000H, 000H	; FEH
  187 DFF8  FF 81 81 81 	DB	0FFH, 081H, 081H, 081H, 081H, 081H, 081H, 0FFH	; FFH
  144                   
  145                   	INCLUDE	CE46.INC	; ROM-E (E000-EDFF)
    1                   ;*****************************************
    2                   ;**	CAOS 4.6	ROM E		**
    3                   ;**					**
    4                   ;**	Adresse:  E000h bis EDFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 05.03.2016	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0E000H
   10                   
   11 E000  C3 F166     	JP	BYE		; Tasten-RESET
   12 E003  C3 E5EB     	JP	BEXP1		; BASIC-Erweiterung 1
   13 E006  C3 E5FF     	JP	BEXP2		; BASIC-Erweiterung 2
   14 E009  C3 EC48     	JP	BEXP3		; BASIC-Erweiterung 3
   15 E00C  FCF8        	DW	TOKTAB		; Token-Tabelle der Erweiterungen
   16 E00E  C3 F8A4     BASIO:	JP	BASPV		; BASIC Programmverteiler
   17                   
   18 E011  7F7F        	DW	7F7FH
   19 E013  42 41 53 49 	DB	'BASIC'
   20 E018  11          	DB	11H
   21 E019  CD E02F     	CALL	BASON
   22 E01C  C3 C00D     	JP	PRIST		; BASIC-Kaltstart
   23                   
   24 E01F  7F7F        	DW	7F7FH
   25 E021  52 45 42 41 	DB	'REBASIC'
   26 E028  11          	DB	11H
   27 E029  CD E02F     	CALL	BASON
   28 E02C  C3 C08C     	JP	SECST		; BASIC-Warmstart
   29                   
   30                   ; BASIC vorbereiten:
   31                   
   32 E02F  16 00       BASON:	LD	D,0
   33 E031  3E 02       	LD	A,2
   34 E033  2E 05       	LD	L,5		; SWITCH 5 0
   35 E035  CD F107     	CALL	MODU		; CAOS-C aus
   36 E038  16 C1       	LD	D,0C1H
   37 E03A  3E 02       	LD	A,2
   38 E03C  6F          	LD	L,A		; SWITCH 2 C1
   39 E03D  CD F107     	CALL	MODU		; BASIC-Ebene einschalten

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  82
CE46    INC

   40 E040  C3 F03D     	JP	SCROFF		; IRM aus
   41                   
   42                   ; CRT-Treiber:
   43                   
   44 E043  ED 5B B7A0  PADR0:	LD	DE,(CURSO)
   45 E047  2A B79C     PADR1:	LD	HL,(WINON)
   46 E04A  19          	ADD	HL,DE
   47 E04B  CB 24       	SLA	H
   48 E04D  CB 24       	SLA	H
   49 E04F  CB 24       	SLA	H
   50                   	;
   51 E051  F5          PADR:	PUSH	AF		; **34**
   52 E052  7D          	LD	A,L		; Spalte
   53 E053  6C          	LD	L,H		; Pixelzeile
   54 E054  FE 28       	CP	28H
   55 E056  30 06       	JR	NC,IAD2		; zu gross
   56 E058  F6 80       	OR	80H
   57 E05A  67          	LD	H,A		; HL=Pixeladresse
   58 E05B  F1          	POP	AF
   59 E05C  A7          	AND	A		; CY=0
   60 E05D  C9          	RET
   61 E05E  F1          IAD2:	POP	AF
   62 E05F  37          	SCF			; CY=1
   63 E060  C9          	RET
   64                   
   65                   ; Test Cursor im Fenster
   66                   
   67 E061  3A B79E     TCIF:	LD	A,(WINLG)	; **33**
   68 E064  3D          	DEC	A
   69 E065  93          	SUB	E		; Cursor-Spalte
   70 E066  D8          	RET	C
   71 E067  3A B79F     	LD	A,(WINLG+1)
   72 E06A  3D          	DEC	A
   73 E06B  92          	SUB	D		; Cursor-Zeile
   74 E06C  C9          	RET
   75                   
   76 E06D  F5          DABR:	PUSH	AF		; **32**
   77 E06E  CD E061     	CALL	TCIF
   78 E071  38 EB       	JR	C,IAD2
   79 E073  3A B79C     	LD	A,(WINON)
   80 E076  83          	ADD	A,E		; Cursor-Spalte
   81 E077  D5          	PUSH	DE
   82 E078  5F          	LD	E,A		; absolut
   83 E079  3A B79D     	LD	A,(WINON+1)
   84 E07C  82          	ADD	A,D		; Cursor-Zeile
   85 E07D  87          	ADD	A,A
   86 E07E  87          	ADD	A,A
   87 E07F  87          	ADD	A,A		; *8
   88 E080  6F          	LD	L,A		; Pixelzeile
   89 E081  26 00       	LD	H,0
   90 E083  54          	LD	D,H		; D=0
   91 E084  29          	ADD	HL,HL
   92 E085  29          	ADD	HL,HL		; *4
   93 E086  19          	ADD	HL,DE		; *5, zus. *40
   94 E087  5F          	LD	E,A
   95 E088  3A B7CC     	LD	A,(VRAM+1)
   96 E08B  57          	LD	D,A
   97 E08C  19          	ADD	HL,DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  83
CE46    INC

   98 E08D  D1          	POP	DE
   99 E08E  F1          	POP	AF
  100 E08F  A7          	AND	A
  101 E090  C9          	RET
  102                   
  103 E091  E5          CRT:	PUSH	HL		; **00**
  104 E092  D5          	PUSH	DE
  105 E093  C5          	PUSH	BC
  106 E094  F5          	PUSH	AF
  107 E095  CD E17D     	CALL	PCHR
  108 E098  ED 53 B7A0  	LD	(CURSO),DE
  109 E09C  F1          POP4:	POP	AF
  110 E09D  C1          	POP	BC
  111 E09E  D1          	POP	DE
  112 E09F  E1          	POP	HL
  113 E0A0  C9          	RET
  114                   
  115                   ; Zeichen auf Grafikbildschirm sichtbar machen
  116                   ; PE:	DE, A, STBT
  117                   
  118 E0A1  E5          WPIX:	PUSH	HL
  119 E0A2  D5          	PUSH	DE
  120 E0A3  C5          	PUSH	BC
  121 E0A4  F5          	PUSH	AF
  122 E0A5  4F          	LD	C,A		; Zeichen
  123 E0A6  2A B79C     	LD	HL,(WINON)
  124 E0A9  19          	ADD	HL,DE
  125 E0AA  EB          	EX	DE,HL		; DE:absolute Cursorposition
  126 E0AB  7B          	LD	A,E
  127 E0AC  FE 28       	CP	28H
  128 E0AE  30 EC       	JR	NC,POP4		; ausserhalb!
  129 E0B0  21 B7A2     	LD	HL,STBT
  130 E0B3  CB 6E       	BIT	5,(HL)		; IBM?
  131 E0B5  20 63       	JR	NZ,WPX14
  132 E0B7  79          	LD	A,C
  133 E0B8  21 B7A6     	LD	HL,CCTL0
  134 E0BB  87          	ADD	A,A		; *2
  135 E0BC  30 02       	JR	NC,WPX04
  136 E0BE  2E AA       	LD	L,LOW(CCTL2)
  137 E0C0  D6 40       WPX04:	SUB	40H
  138 E0C2  F2 E0C9     	JP	P,WPX06		; CCTL0/2
  139 E0C5  2C          	INC	L
  140 E0C6  2C          	INC	L		; CCTL1/3
  141 E0C7  EE C0       	XOR	0C0H
  142 E0C9  4E          WPX06:	LD	C,(HL)
  143 E0CA  2C          	INC	L		; BC=(CCTL)
  144 E0CB  46          	LD	B,(HL)
  145 E0CC  87          	ADD	A,A		; *4
  146 E0CD  6F          	LD	L,A
  147 E0CE  26 00       	LD	H,0
  148 E0D0  29          WPX07:	ADD	HL,HL		; *8
  149 E0D1  09          	ADD	HL,BC		; HL=Pixelmuster
  150 E0D2  7A          	LD	A,D
  151 E0D3  87          	ADD	A,A
  152 E0D4  87          	ADD	A,A
  153 E0D5  87          	ADD	A,A
  154 E0D6  53          	LD	D,E
  155 E0D7  5F          	LD	E,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  84
CE46    INC

  156 E0D8  CB FA       	SET	7,D		; DE=IRM-Adresse
  157 E0DA  ED 4B B7A2  	LD	BC,(STBT)
  158 E0DE  CB 49       	BIT	1,C
  159 E0E0  20 16       	JR	NZ,WPIXNC	; Farbe AUS
  160 E0E2  CD F9A5     	CALL	ESC9
  161 E0E5  DD CB 01 5E 	BIT	3,(IX+1)
  162 E0E9  20 04       	JR	NZ,WPIXA	; LORES
  163 E0EB  CB 71       	BIT	6,C
  164 E0ED  20 38       	JR	NZ,WPIXH1	; HRG-Modus
  165 E0EF  78          WPIXA:	LD	A,B		; Farbe
  166 E0F0  43          	LD	B,E
  167 E0F1  CD E16D     	CALL	WCOLOR		; 8 Farbbytes
  168 E0F4  58          	LD	E,B
  169 E0F5  CD F9A5     WPIXHE:	CALL	ESC9
  170 E0F8  CB 41       WPIXNC:	BIT	0,C
  171 E0FA  20 12       	JR	NZ,WPX11	; Farbe AUS
  172 E0FC  DD CB 01 5E 	BIT	3,(IX+1)
  173 E100  20 04       	JR	NZ,WPIXB	; LORES
  174 E102  CB 71       	BIT	6,C
  175 E104  20 2C       	JR	NZ,WPIXH2	; HRG-Modus
  176 E106  CB 51       WPIXB:	BIT	2,C
  177 E108  CC E14C     	CALL	Z,WPIXEL	; normal
  178 E10B  C4 E15F     	CALL	NZ,WPIXI	; invers
  179 E10E  CB 69       WPX11:	BIT	5,C		; IBM?
  180 E110  28 8A       	JR	Z,POP4		; nein
  181 E112  F1          	POP	AF
  182 E113  DD 77 04    	LD	(IX+4),A	; CAOS-C
  183 E116  D3 86       	OUT	(86H),A		; wie vorher
  184 E118  18 82       	JR	POP4		; POP	AF,BC,DE,HL   RET
  185                   
  186 E11A  DD 7E 04    WPX14:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  187 E11D  F5          	PUSH	AF		; merken
  188                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E11E  DD CB 04    	 DB	0DDh,0CBh,4
    2 E121  FF          	 DB	7 SHL 3 OR 11000111b
  189 E122  D3 86       	OUT	(86h),A		; CAOS-C ein
  190 E124  C3 D182     	JP	WPIXD		; Springe zu CAOS-D-Block
  191                   
  192                   ; Farbebene im HRG-Modus
  193 E127  78          WPIXH1:	LD	A,B
  194 E128  0F          	RRCA
  195 E129  E5          	PUSH	HL
  196 E12A  D5          	PUSH	DE
  197 E12B  CD E13C     	CALL	WPHRG
  198 E12E  D1          	POP	DE
  199 E12F  E1          	POP	HL
  200 E130  18 C3       	JR	WPIXHE
  201                   
  202                   ; Pixelebene im HRG-Modus
  203 E132  78          WPIXH2:	LD	A,B
  204 E133  E5          	PUSH	HL
  205 E134  D5          	PUSH	DE
  206 E135  CD E13C     	CALL	WPHRG
  207 E138  D1          	POP	DE
  208 E139  E1          	POP	HL
  209 E13A  18 D2       	JR	WPX11
  210                   
  211                   ; Reaktion im HRG-Modus

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  85
CE46    INC

  212 E13C  E6 09       WPHRG:	AND	00001001b	; Bits 0,3
  213 E13E  28 2D       	JR	Z,WCOLOR	; beide 0: Ebene ruecksetzen
  214 E140  EA E16B     	JP	PE,COLFF	; beide 1: Ebene setzen
  215 E143  CB 51       	BIT	2,C
  216 E145  28 02       	JR	Z,WPHN
  217 E147  EE 09       	XOR	00001001b	; invers
  218 E149  3D          WPHN:	DEC	A
  219 E14A  28 13       	JR	Z,WPIXI		; Pixel invers
  220 E14C  C5          WPIXEL:	PUSH	BC
  221 E14D  ED A0       	LDI			; 8 Pixelbytes kopieren
  222 E14F  ED A0       	LDI			; ohne Schleife - schneller!
  223 E151  ED A0       	LDI
  224 E153  ED A0       	LDI
  225 E155  ED A0       	LDI
  226 E157  ED A0       	LDI
  227 E159  ED A0       	LDI
  228 E15B  ED A0       	LDI
  229 E15D  C1          	POP	BC
  230 E15E  C9          	RET
  231                   
  232 E15F  C5          WPIXI:	PUSH	BC
  233 E160  06 08       	LD	B,8		; 8 Pixelmuster
  234 E162  7E          WPIXI1:	LD	A,(HL)		; invers
  235 E163  2F          	CPL
  236 E164  12          	LD	(DE),A
  237 E165  23          	INC	HL
  238 E166  1C          	INC	E
  239 E167  10 F9       	DJNZ	WPIXI1
  240 E169  C1          	POP	BC
  241 E16A  C9          	RET
  242                   
  243 E16B  3E FF       COLFF:	LD	A,0FFH
  244 E16D  12          WCOLOR:	LD	(DE),A		; 8 Farbbytes
  245 E16E  1C          	INC	E
  246 E16F  12          	LD	(DE),A
  247 E170  1C          	INC	E
  248 E171  12          	LD	(DE),A
  249 E172  1C          	INC	E
  250 E173  12          	LD	(DE),A
  251 E174  1C          	INC	E
  252 E175  12          	LD	(DE),A
  253 E176  1C          	INC	E
  254 E177  12          	LD	(DE),A
  255 E178  1C          	INC	E
  256 E179  12          	LD	(DE),A
  257 E17A  1C          	INC	E
  258 E17B  12          	LD	(DE),A
  259 E17C  C9          	RET
  260                   
  261                   ; CRT-Grundprogramm
  262                   
  263 E17D  ED 5B B7A0  PCHR:	LD	DE,(CURSO)
  264 E181  21 B7A2     	LD	HL,STBT
  265 E184  CB 66       	BIT	4,(HL)		; ESC aktiv?
  266 E186  28 22       	JR	Z,PCHR3
  267 E188  CB A6       CRT1:	RES	4,(HL)
  268 E18A  FE 30       	CP	'0'
  269 E18C  D8          	RET	C

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  86
CE46    INC

  270 E18D  FE 3A       	CP	'9'+1
  271 E18F  30 04       	JR	NC,PCHR1
  272 E191  D6 30       	SUB	'0'
  273 E193  18 0A       	JR	PCHR2
  274                   	;
  275 E195  FE 41       PCHR1:	CP	'A'
  276 E197  D8          	RET	C
  277 E198  CB AF       	RES	5,A
  278 E19A  FE 5B       	CP	'Z'+1
  279 E19C  D0          	RET	NC
  280 E19D  D6 37       	SUB	'A'-10
  281 E19F  21 B7DF     PCHR2:	LD	HL,L3SIZ	; Tabelle
  282 E1A2  BE          	CP	(HL)		; lang genug?
  283 E1A3  D0          	RET	NC
  284 E1A4  87          	ADD	A,A		; *2
  285 E1A5  2A B7DD     	LD	HL,(L3TAB)	; klar zum Ansprung
  286 E1A8  18 0C       	JR	PCHR4
  287                   	;
  288 E1AA  FE 20       PCHR3:	CP	20H		; Steuerfunktion?
  289 E1AC  30 18       	JR	NC,PCHR5
  290 E1AE  CB 5E       	BIT	3,(HL)		; darstellen?
  291 E1B0  20 14       	JR	NZ,PCHR5
  292 E1B2  87          	ADD	A,A		; *2
  293 E1B3  2A B7B2     	LD	HL,(CTAB)
  294 E1B6  4F          PCHR4:	LD	C,A
  295 E1B7  06 00       	LD	B,0
  296 E1B9  09          	ADD	HL,BC
  297 E1BA  7E          	LD	A,(HL)
  298 E1BB  23          	INC	HL
  299 E1BC  66          	LD	H,(HL)
  300 E1BD  6F          	LD	L,A
  301 E1BE  E9          JPHL:	JP	(HL)		; anspringen
  302                   
  303 E1BF  7B          ESC0:	LD	A,E		; Tabulator
  304 E1C0  F6 07       	OR	7		; 8er Schrittweite
  305 E1C2  3C          	INC	A
  306 E1C3  5F          	LD	E,A
  307 E1C4  18 09       	JR	CUR1
  308                   	;
  309 E1C6  CD E06D     PCHR5:	CALL	DABR
  310 E1C9  D8          	RET	C		; ausserhalb
  311 E1CA  77          	LD	(HL),A		; ASCII eintragen
  312 E1CB  CD E0A1     	CALL	WPIX		; darstellen
  313 E1CE  1C          CUR:	INC	E
  314 E1CF  3A B79E     CUR1:	LD	A,(WINLG)
  315 E1D2  3D          	DEC	A
  316 E1D3  BB          	CP	E
  317 E1D4  D0          	RET	NC
  318 E1D5  1E 00       NL:	LD	E,0		; NL fuer 1E
  319 E1D7  14          CUD:	INC	D
  320 E1D8  3A B79F     	LD	A,(WINLG+1)
  321 E1DB  BA          	CP	D
  322 E1DC  C0          	RET	NZ
  323 E1DD  2A B7A4     	LD	HL,(WEND)
  324 E1E0  E9          	JP	(HL)		; PAGE oder SCROLL
  325                   
  326 E1E1  2A B799     HCOPY:	LD	HL,(HCADR)	; ShCLR
  327 E1E4  E9          	JP	(HL)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  87
CE46    INC

  328                   
  329 E1E5  7B          CUL:	LD	A,E
  330 E1E6  A7          	AND	A
  331 E1E7  28 02       	JR	Z,CUL1
  332 E1E9  1D          	DEC	E
  333 E1EA  C9          	RET
  334                   
  335 E1EB  7A          CUL1:	LD	A,D
  336 E1EC  A7          	AND	A
  337 E1ED  C8          	RET	Z
  338 E1EE  15          	DEC	D
  339 E1EF  3A B79E     CEL:	LD	A,(WINLG)
  340 E1F2  3D          	DEC	A
  341 E1F3  5F          	LD	E,A
  342 E1F4  C9          	RET
  343                   
  344 E1F5  7A          CUU:	LD	A,D
  345 E1F6  A7          	AND	A
  346 E1F7  C8          	RET	Z
  347 E1F8  15          	DEC	D
  348 E1F9  C9          	RET
  349                   
  350 E1FA  21 E269     PAGEM:	LD	HL,HOMEPG	; ShCUU
  351 E1FD  22 B7A4     WADR:	LD	(WEND),HL
  352 E200  C9          	RET
  353                   
  354 E201  21 E26E     SCROL:	LD	HL,SCRLPG	; ShCUD
  355 E204  18 F7       	JR	WADR
  356                   
  357 E206  CD E1E5     CLR:	CALL	CUL
  358 E209  D5          DEL:	PUSH	DE		; Cursor retten
  359 E20A  CD E06D     	CALL	DABR
  360 E20D  7E          	LD	A,(HL)
  361 E20E  A7          	AND	A		; Ende?
  362 E20F  28 29       	JR	Z,POPDE
  363 E211  E5          	PUSH	HL		; VRAM
  364 E212  D5          DEL1:	PUSH	DE		; Cursor
  365 E213  1C          	INC	E		; naechste Spalte
  366 E214  CD E06D     	CALL	DABR		; raus?
  367 E217  30 08       	JR	NC,DEL2
  368 E219  1E 00       	LD	E,0		; ja, wie NL
  369 E21B  14          	INC	D
  370 E21C  CD E06D     	CALL	DABR		; raus?
  371 E21F  38 10       	JR	C,DEL3		; ja-wie Ende
  372 E221  7E          DEL2:	LD	A,(HL)
  373 E222  A7          	AND	A		; Ende?
  374 E223  28 0C       	JR	Z,DEL3
  375 E225  42          	LD	B,D
  376 E226  4B          	LD	C,E		; BC:=DE
  377 E227  D1          	POP	DE		; DE=links davon
  378 E228  E3          	EX	(SP),HL		; HL=VRAM links
  379 E229  77          	LD	(HL),A		; eintragen
  380 E22A  CD E0A1     	CALL	WPIX		; zeichnen
  381 E22D  50          	LD	D,B
  382 E22E  59          	LD	E,C		; DE:=BC
  383 E22F  18 E1       	JR	DEL1		; von vorn
  384                   
  385 E231  D1          DEL3:	POP	DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  88
CE46    INC

  386 E232  E1          	POP	HL
  387 E233  36 00       	LD	(HL),0
  388 E235  3E 20       	LD	A,' '
  389 E237  CD E0A1     	CALL	WPIX
  390 E23A  D1          POPDE:	POP	DE
  391 E23B  C9          	RET
  392                   
  393 E23C  D5          INS:	PUSH	DE		; Cursor
  394 E23D  3E 20       	LD	A,' '
  395 E23F  CD E06D     	CALL	DABR
  396 E242  46          INS1:	LD	B,(HL)		; VRAM
  397 E243  77          	LD	(HL),A		; neues Zeichen
  398 E244  CD E0A1     	CALL	WPIX		; zeichnen
  399 E247  78          	LD	A,B
  400 E248  A7          	AND	A		; Dummy?
  401 E249  28 0E       	JR	Z,INS2
  402 E24B  1C          	INC	E		; CUR
  403 E24C  CD E06D     	CALL	DABR		; raus?
  404 E24F  30 F1       	JR	NC,INS1
  405 E251  1E 00       	LD	E,0		; wie NL
  406 E253  14          	INC	D
  407 E254  CD E06D     	CALL	DABR		; raus?
  408 E257  30 E9       	JR	NC,INS1
  409 E259  D1          INS2:	POP	DE		; wenn ja Schluss
  410 E25A  C9          	RET
  411                   
  412 E25B  3A B79F     CLS:	LD	A,(WINLG+1) 	; ShHOME
  413 E25E  16 00       	LD	D,0
  414 E260  F5          CLS1:	PUSH	AF
  415 E261  CD E27D     	CALL	CLLN
  416 E264  F1          	POP	AF
  417 E265  14          	INC	D
  418 E266  3D          	DEC	A
  419 E267  20 F7       	JR	NZ,CLS1		; A Zeilen
  420 E269  16 00       HOMEPG:	LD	D,0
  421 E26B  1E 00       CBL:	LD	E,0
  422 E26D  C9          	RET
  423                   
  424 E26E  DD 7E 04    SCRLPG:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  425 E271  F5          	PUSH	AF		; merken
  426                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E272  DD CB 04    	 DB	0DDh,0CBh,4
    2 E275  FF          	 DB	7 SHL 3 OR 11000111b
  427 E276  D3 86       	OUT	(86h),A		; CAOS-C ein
  428 E278  CD D202     	CALL	SCRLD		; weiter im CAOS-D-Segment
  429 E27B  18 0D       	JR	CCRES
  430                   
  431 E27D  DD 7E 04    CLLN:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  432 E280  F5          	PUSH	AF		; merken
  433                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E281  DD CB 04    	 DB	0DDh,0CBh,4
    2 E284  FF          	 DB	7 SHL 3 OR 11000111b
  434 E285  D3 86       	OUT	(86h),A		; CAOS-C ein
  435 E287  CD D249     	CALL	CLLND		; weiter im CAOS-D-Segment
  436 E28A  F1          CCRES:	POP	AF
  437 E28B  DD 77 04    	LD	(IX+4),A	; CAOS-C
  438 E28E  D3 86       	OUT	(86h),A		; wie vorher
  439 E290  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  89
CE46    INC

  440                   
  441 E291  01 0A0F     BEEP:	LD	BC,0A0FH	; B=Dauer, C=Lautstaerke
  442 E294  21 0030     	LD	HL,48
  443 E297  D5          	PUSH	DE
  444 E298  5C          	LD	E,H		; E=0
  445 E299  CD F92C     	CALL	TON2
  446 E29C  3E 1E       	LD	A,1EH
  447 E29E  CD F38B     	CALL	WAIT
  448 E2A1  3E 03       	LD	A,3
  449 E2A3  D3 8C       	OUT	(CTC0),A
  450 E2A5  3E 10       	LD	A,10H
  451 E2A7  D1          	POP	DE
  452 E2A8  C3 F38B     	JP	WAIT
  453                   
  454 E2AB  01 0307     CLIK:	LD	BC,0307H	; B=Dauer, C=Lautstaerke
  455 E2AE  21 0024     	LD	HL,36
  456 E2B1  D5          	PUSH	DE
  457 E2B2  5C          	LD	E,H		; E=0
  458 E2B3  CD F92C     	CALL	TON2
  459 E2B6  D1          	POP	DE
  460 E2B7  C9          	RET
  461                   
  462 E2B8  21 B7A3     ESC8:	LD	HL,COLOR	; Farbtausch
  463 E2BB  7E          	LD	A,(HL)
  464 E2BC  E6 07       	AND	00000111b	; Hintergrund
  465 E2BE  07          	RLCA
  466 E2BF  07          	RLCA
  467 E2C0  07          	RLCA
  468 E2C1  4F          	LD	C,A
  469 E2C2  7E          	LD	A,(HL)
  470 E2C3  E6 38       	AND	00111000b	; Vordergrund
  471 E2C5  0F          	RRCA
  472 E2C6  0F          	RRCA
  473 E2C7  0F          	RRCA
  474 E2C8  B1          	OR	C
  475 E2C9  4F          	LD	C,A
  476 E2CA  7E          	LD	A,(HL)
  477 E2CB  E6 C0       	AND	11000000b	; Attribute
  478 E2CD  B1          	OR	C
  479 E2CE  77          LDMA:	LD	(HL),A		; **28**
  480 E2CF  C9          	RET
  481                   
  482 E2D0  7E          LDAM:	LD	A,(HL)		; **29**
  483 E2D1  C9          	RET
  484                   
  485 E2D2  DD 7E 08    CLICK:	LD	A,(IX+8)	; ShINS
  486 E2D5  EE 20       	XOR	20H
  487 E2D7  DD 77 08    	LD	(IX+8),A
  488 E2DA  C9          	RET
  489                   
  490                   ;	=== KBD-Treiber ===
  491                   
  492                   ;
  493                   ; ISR CTC Kanal 3 (Tastatur)
  494                   ;
  495 E2DB  FB          ISRC3:	EI
  496 E2DC  F5          	PUSH	AF
  497 E2DD  3E 23       	LD	A,23H	  	; DI,ZG256,Res

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  90
CE46    INC

  498 E2DF  D3 8F       	OUT	(CTC3),A
  499 E2E1  DD 36 0D 00 	LD	(IX+13),0	; Zeichen tot
  500 E2E5  18 5D       	JR	TST5		; freigeben
  501                   ;
  502                   ; ISR PIO Kanal B (Tastatur)
  503                   ;
  504 E2E7  F5          ISRPB:	PUSH	AF
  505 E2E8  DB 8F       	IN	A,(CTC3)	; gemessene Zeit
  506 E2EA  F5          	PUSH	AF
  507 E2EB  3E A7       	LD	A,0A7H		; EI,ZG256,Res
  508 E2ED  D3 8F       	OUT	(CTC3),A
  509 E2EF  3E 8F       	LD	A,8FH		; Zeitkonstante
  510 E2F1  D3 8F       	OUT	(CTC3),A
  511 E2F3  F1          	POP	AF
  512 E2F4  FB          	EI
  513 E2F5  FE 14       	CP	20
  514 E2F7  38 4B       	JR	C,TST5		; zu lang
  515 E2F9  FE 78       	CP	120
  516 E2FB  30 47       	JR	NC,TST5		; zu kurz
  517 E2FD  FE 65       	CP	101		; Diskriminator
  518 E2FF  30 04       	JR	NC,TST1
  519 E301  C6 BE       	ADD	A,190
  520 E303  30 06       	JR	NC,TST2		; Stop-Bit
  521 E305  DD CB 0C 1E TST1:	RR	(IX+12)		; Bit einschieben
  522 E309  18 39       	JR	TST5
  523                   	;
  524 E30B  E5          TST2:	PUSH	HL
  525 E30C  D5          	PUSH	DE
  526 E30D  DD 7E 0C    	LD	A,(IX+12)
  527 E310  1F          	RRA			; 7bit-Scancode
  528 E311  EE 01       	XOR	1		; Startbit invertieren
  529                   ;
  530                   ; in CAOS 5.0/6.0 wird Shift-BRK hier zu Soft-Reset abgefragt
  531                   ; das koennte hier so aussehen:
  532                   ;
  533                   ;	CP	61		; Scancode Shift-BRK
  534                   ;	JR	NZ,IBRK
  535                   ;IBRK:	CALL	IRET		; Interrupts freigeben
  536                   ;	JP	BYE		; Sprung zu RESET
  537                   ;IBRK:
  538 E313  DD 6E 0E    	LD	L,(IX+14)
  539 E316  DD 66 0F    	LD	H,(IX+15)	; aktuelle KTAB-Adresse
  540 E319  16 00       	LD	D,0
  541 E31B  5F          	LD	E,A
  542 E31C  19          	ADD	HL,DE		; Position in KTAB
  543 E31D  7E          	LD	A,(HL)		; ASCII holen
  544 E31E  DD CB 08 7E 	BIT	7,(IX+8)	; CAPS aktiv?
  545 E322  20 0A       	JR	NZ,TST3		; 1=nein
  546 E324  FE 40       	CP	40H
  547                   ;
  548                   ; in CAOS 3.4 gefunden:
  549                   ;	CP 40H
  550                   ;	JP M,TST3
  551                   ;	XOR 20H
  552                   ;TST3:
  553                   ;
  554 E326  38 06       	JR	C,TST3
  555 E328  FE 80       	CP	80H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  91
CE46    INC

  556 E32A  30 02       	JR	NC,TST3
  557 E32C  EE 20       	XOR	20H		; klein<=>gross
  558 E32E  57          TST3:	LD	D,A		; Code merken
  559 E32F  DD BE 0D    	CP	(IX+13)		; = letzter Code?
  560 E332  20 17       	JR	NZ,TST6		; nein
  561 E334  21 B7E0     	LD	HL,COUNT
  562 E337  CD E383     	CALL	IRMGET
  563 E33A  DD BE 0A    	CP	(IX+10)		; FastRepeat?
  564 E33D  38 1C       	JR	C,TST7
  565 E33F  DD 34 0A    	INC	(IX+10)		; Zeit abwarten
  566 E342  D1          TST4:	POP	DE
  567 E343  E1          	POP	HL
  568 E344  DB 89       TST5:	IN	A,(PIOBD)	; PIO-Logik
  569 E346  D3 89       	OUT	(PIOBD),A	; freigeben
  570 E348  F1          	POP	AF
  571 E349  ED 4D       	RETI
  572                   
  573 E34B  DD 36 0A 00 TST6:	LD	(IX+10),0	; neuer Code
  574 E34F  FE 16       	CP	16H		; CAPS?
  575 E351  20 09       	JR	NZ,TST8
  576 E353  DD 7E 08    	LD	A,(IX+8)
  577 E356  EE 80       	XOR	80H		; CAPS on/off
  578 E358  DD 77 08    	LD	(IX+8),A
  579 E35B  7A          TST7:	LD	A,D		; Code
  580 E35C  DD 77 0D    TST8:	LD	(IX+13),A	; eintragen
  581 E35F  DD CB 08 C6 	SET	0,(IX+8)	; gueltig machen
  582 E363  18 DD       	JR	TST4
  583                   
  584                   ; Abfrage ohne Quittung
  585 E365  B7          KBDS:	OR	A		; **0C**
  586 E366  DD CB 08 46 	BIT	0,(IX+8)	; Code gueltig?
  587 E36A  C8          	RET	Z
  588 E36B  DD 7E 0D    	LD	A,(IX+13)	; Tastencode
  589 E36E  37          	SCF			; wenn ja
  590 E36F  C9          	RET
  591                   
  592                   ; Abfrage mit Quittung
  593 E370  CD E365     KBDZ:	CALL	KBDS		; **0E**
  594 E373  D0          	RET	NC
  595 E374  DD CB 08 86 	RES	0,(IX+8)
  596 E378  C9          	RET
  597                   
  598                   ; Test auf BRK-Anforderung
  599 E379  CD E365     BRKT:	CALL	KBDS		; **2A**
  600 E37C  D0          	RET	NC
  601 E37D  FE 03       	CP	3
  602 E37F  37          	SCF
  603 E380  C8          	RET	Z
  604 E381  A7          	AND	A
  605 E382  C9          	RET
  606                   ;
  607                   ; Arbeitszelle aus IRM lesen (innerhalb eines Interrupt)
  608                   ; PE:	HL	Adresse
  609                   ; PA:	A	Inhalt
  610                   ; VR:	A
  611                   ;
  612 E383  D5          IRMGET:	PUSH	DE
  613 E384  DB 88       	IN	A,(PIOAD)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  92
CE46    INC

  614 E386  5F          	LD	E,A		; IRM-Schaltzustand in Reg. E merken
  615 E387  CB D7       	SET	2,A		; IRM on!
  616 E389  F3          	DI			; damit Stack nicht genutzt wird!
  617 E38A  D3 88       	OUT	(PIOAD),A
  618 E38C  56          	LD	D,(HL)		; Arbeitszelle lesen
  619 E38D  7B          	LD	A,E
  620 E38E  D3 88       	OUT	(PIOAD),A	; IRM wie zuvor
  621 E390  FB          	EI
  622 E391  7A          	LD	A,D		; Wert nach A uebergeben
  623 E392  D1          	POP	DE
  624 E393  C9          	RET
  625                   ;
  626                   ; ISR fuer Fremdtastatur an SIO-B
  627                   ;
  628 E394  F5          ISRT:	PUSH	AF
  629 E395  E5          	PUSH	HL
  630 E396  D5          	PUSH	DE
  631 E397  C5          	PUSH	BC
  632 E398  21 A800     	LD	HL,V24PL	; Steckplatz M003
  633 E39B  CD E383     	CALL	IRMGET		; aus IRM lesen, Rueckkehr mit EI
  634 E39E  47          	LD	B,A		; Steckplatz M003 holen
  635 E39F  0E 80       	LD	C,80H
  636 E3A1  3E 01       	LD	A,1
  637 E3A3  ED 79       	OUT	(C),A		; Modul einschalten
  638 E3A5  DB 09       	IN	A,(9)		; empfangenen Code abholen
  639 E3A7  5F          	LD	E,A		; Code in Reg. E merken
  640 E3A8  A7          	AND	A
  641 E3A9  28 0E       	JR	Z,IST2		; Code 0 (Taste losgelassen)
  642 E3AB  DD BE 0D    	CP	(IX+13)		; 2x gleicher Tastencode?
  643 E3AE  3E 00       	LD	A,0		; kein Repeat
  644 E3B0  20 07       	JR	NZ,IST2
  645 E3B2  21 B7E0     	LD	HL,COUNT	; Repeat-Counter
  646 E3B5  CD E383     	CALL	IRMGET		; aus IRM lesen
  647 E3B8  3C          	INC	A		; sofort aktivieren
  648 E3B9  DD 77 0A    IST2:	LD	(IX+10),A	; repeat setzen
  649 E3BC  7B          	LD	A,E		; gemerkten
  650 E3BD  DD 77 0D    	LD	(IX+13),A	; Code eintragen
  651 E3C0  A7          	AND	A		; Code=0 ?
  652 E3C1  28 04       	JR	Z,IST3		; ja
  653 E3C3  DD CB 08 C6 	SET	0,(IX+8)	; sonst aktivieren
  654 E3C7  26 B8       IST3:	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
  655 E3C9  68          	LD	L,B		; Steckplatz
  656 E3CA  CD E383     	CALL	IRMGET		; Schaltzustand vor ISR ermitteln
  657 E3CD  ED 79       	OUT	(C),A		; und wiederherstellen
  658 E3CF  C1          	POP	BC
  659 E3D0  18 48       	JR	IPOP3		; POP DE,HL,AF; RETI
  660                   
  661                   ;	=== Joystick-Treiber fuer M008/M021 ===
  662                   
  663 E3D2  F5          ISRJ:	PUSH	AF
  664 E3D3  DB 90       	IN	A,(90h)		; M008 PIO A Daten
  665 E3D5  FB          	EI
  666 E3D6  2F          	CPL
  667 E3D7  E5          	PUSH	HL
  668 E3D8  D5          	PUSH	DE
  669 E3D9  E6 3F       	AND	00111111b	; Achsbewegung und/oder Feuertaste?
  670 E3DB  28 42       	JR	Z,ISRJ4
  671 E3DD  FE 10       	CP	00010000b	; Feuertaste?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  93
CE46    INC

  672 E3DF  38 06       	JR	C,ISRJ1
  673 E3E1  E6 30       	AND	00110000b	; Ignoriere Achse: Feuertasten haben Vorrang
  674 E3E3  0F          	RRCA			; Nutze Luecken zwischen den Achsrichtungen in
  675 E3E4  0F          	RRCA			; der Tastaturcode-Tabelle fuer Feuertasten
  676 E3E5  EE 0F       	XOR	00001111b	; A=0000xx11
  677 E3E7  C5          ISRJ1:	PUSH	BC
  678 E3E8  4F          	LD	C,A		; Tabellenindex
  679 E3E9  06 00       	LD	B,0
  680 E3EB  DB 88       	IN	A,(PIOAD)
  681 E3ED  57          	LD	D,A
  682 E3EE  F6 04       	OR	00000100b	; IRM ein
  683 E3F0  F3          	DI
  684 E3F1  D3 88       	OUT	(PIOAD),A
  685 E3F3  2A B7F0     	LD	HL,(JOYTAB)	; Adresse der Codetabelle fuer Joystick
  686 E3F6  5E          	LD	E,(HL)		; Wartezyklen waehrend Tastenwiederholung
  687 E3F7  09          	ADD	HL,BC		; Tastaturcode nachschlagen
  688 E3F8  6E          	LD	L,(HL)
  689 E3F9  3A B7E0     	LD	A,(COUNT)	; Wartezyklen vor erster Wiederholung
  690 E3FC  67          	LD	H,A		; (entsprechend Abfragerate der Tastatur)
  691 E3FD  7A          	LD	A,D
  692 E3FE  D3 88       	OUT	(PIOAD),A	; IRM-Zustand wiederherstellen
  693 E400  FB          	EI
  694 E401  C1          	POP	BC
  695 E402  3E 4F       	LD	A,01001111b	; Byte-Eingabemodus (mit Strobe-Interrupt)
  696 E404  D3 92       	OUT	(92h),A		; M008 PIO A Steuerwort
  697 E406  7D          	LD	A,L
  698 E407  A7          	AND	A		; Tastencode zugewiesen?
  699 E408  28 10       	JR	Z,IPOP3
  700 E40A  DD BE 0D    	CP	(IX+13)		; neuer Tastencode?
  701 E40D  28 28       	JR	Z,ISRJ5
  702 E40F  DD 77 0D    	LD	(IX+13),A	; Tastencode eintragen
  703 E412  AF          	XOR	A
  704 E413  DD CB 08 C6 ISRJ2:	SET	0,(IX+8)	; gueltig markieren
  705 E417  DD 77 0A    ISRJ3:	LD	(IX+10),A	; Zaehler zuruecksetzen
  706 E41A  D1          IPOP3:	POP	DE
  707 E41B  E1          	POP	HL
  708 E41C  F1          	POP	AF
  709 E41D  ED 4D       	RETI
  710                   
  711 E41F  DD BE 0A    ISRJ4:	CP	(IX+10)		; vorheriger Code war neu? (A war 0)
  712 E422  3C          	INC	A
  713 E423  30 F2       	JR	NC,ISRJ3	; dann zum Entprellen einen Zyklus warten
  714 E425  21 EDCE     	LD	HL,JOYINI
  715 E428  F3          	DI
  716 E429  CD F55B     	CALL	INIEA		; Ruhestellung: Strobe-Interrupt wieder aus
  717 E42C  FB          	EI
  718 E42D  AF          	XOR	A
  719 E42E  DD 77 0D    	LD	(IX+13),A	; Tastencode loeschen
  720 E431  DD CB 08 86 	RES	0,(IX+8)	; ungueltig markieren
  721 E435  18 E0       	JR	ISRJ3
  722                   
  723 E437  7C          ISRJ5:	LD	A,H		; Wartezyklen vor erster Wiederholung
  724 E438  87          	ADD	A,A		; an Abfragerate des Joysticks anpassen
  725 E439  87          	ADD	A,A		; (COUNT sollte kleiner als 64 sein)
  726 E43A  BB          	CP	E		; weniger als waehrend Wiederholung?
  727 E43B  30 01       	JR	NC,ISRJ6
  728 E43D  7B          	LD	A,E		; Zaehlerende = max(A,E)
  729 E43E  67          ISRJ6:	LD	H,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  94
CE46    INC

  730 E43F  DD 7E 0A    	LD	A,(IX+10)
  731 E442  BC          	CP	H		; Zaehlerende erreicht?
  732 E443  3C          	INC	A
  733 E444  38 D1       	JR	C,ISRJ3
  734 E446  7C          	LD	A,H		; Zaehler = Endwert - Wartezyklen
  735 E447  93          	SUB	E
  736 E448  18 C9       	JR	ISRJ2		; erneut gueltig markieren
  737                   
  738                   ; Initialisierung vor Kassetten-I/O
  739                   ;
  740 E44A  DD 36 03 01 ISRI1:	LD	(IX+3),1	; 1. Block lesen
  741 E44E  F3          	DI
  742 E44F  DB 88       	IN	A,(PIOAD)
  743 E451  F6 40       	OR	01000000b	; Motor ein
  744 E453  E6 DF       	AND	11011111b	; LED aus
  745 E455  D3 88       ISRO1:	OUT	(PIOAD),A
  746 E457  FB          	EI
  747 E458  2A B7A4     	LD	HL,(WEND)	; Page/Scroll-Modus
  748 E45B  22 B7CF     	LD	(ZWEND),HL	; hier merken
  749 E45E  CD F39C     	CALL	NOUT		; CRT-Ausgabe (kein Drucker!)
  750 E461  22 B7CD     	LD	(ZOTAB),HL	; alten Zeiger hier merken
  751 E464  CD E1FA     	CALL	PAGEM		; Page Mode
  752 E467  3E 03       TOFF:	LD	A,3		; CTC Stop
  753 E469  D3 8C       	OUT	(CTC0),A	; Tonhoehe Kanal 1
  754 E46B  D3 8D       	OUT	(CTC1),A	; Tonhoehe Kanal 2
  755 E46D  DD CB 08 8E 	RES	1,(IX+8)	; Ton ist jetzt aus
  756 E471  18 1E       	JR	CSRO2
  757                   ;
  758                   ; Abschluss Bandausgabe		**09**
  759                   ; PA:	CY=0
  760                   ;
  761 E473  DD 36 02 FE CSRO:	LD	(IX+2),0FEH	; FFH = Kennung Ende-Block
  762 E477  CD F04F     	CALL	PV1		; Block auf Kassette ausgeben
  763 E47A  01          	DB	01H		; MBO
  764                   ;
  765                   ; Abschluss Bandeingabe		**0B**
  766                   ; PA:	CY=0
  767                   ;
  768 E47B  2A B7CD     CSRI:	LD	HL,(ZOTAB) 	; intern
  769 E47E  22 B7B9     	LD	(OUTAB),HL
  770 E481  2A B7CF     	LD	HL,(ZWEND)	; grosses
  771 E484  22 B7A4     	LD	(WEND),HL	; Ruecksetzen
  772                   ;	CALL	CLC		; Puffer loeschen (VR: HL)
  773 E487  DB 88       	IN	A,(PIOAD)
  774 E489  E6 9F       	AND	10011111b	; Motor, LED aus
  775 E48B  D3 88       	OUT	(PIOAD),A
  776                   ;	CALL	CRLF		; VR: AF
  777 E48D  DD CB 08 86 	RES	0,(IX+8)
  778 E491  DD CB 01 5E CSRO2:	BIT	3,(IX+1)	; HiRes?
  779 E495  28 06       	JR	Z,CSRO3
  780 E497  DB 89       	IN	A,(PIOBD)	; nein-
  781 E499  CB FF       	SET	7,A		; Blinken ein
  782 E49B  D3 89       	OUT	(PIOBD),A
  783 E49D  DD CB 08 4E CSRO3:	BIT	1,(IX+8)	; neuer Ton?
  784 E4A1  20 FA       	JR	NZ,CSRO3	; Ende abwarten
  785 E4A3  DB 88       	IN	A,(PIOAD)
  786 E4A5  6F          	LD	L,A		; Schaltzustand IRM merken
  787 E4A6  CB D7       	SET	2,A		; IRM on

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  95
CE46    INC

  788 E4A8  F3          	DI			; Interrupt verbieten wegen Stacknutzung
  789 E4A9  D3 88       	OUT	(PIOAD),A
  790 E4AB  3A B7DB     	LD	A,(CTCMD)	; CTC2-Modus
  791 E4AE  E6 60       	AND	01100000b
  792 E4B0  F6 07       	OR	00000111b
  793 E4B2  D3 8E       	OUT	(CTC2),A	; Blinken
  794 E4B4  3A B7DC     	LD	A,(BLINK)	; ZK laden
  795 E4B7  D3 8E       	OUT	(CTC2),A
  796 E4B9  7D          	LD	A,L
  797 E4BA  D3 88       	OUT	(PIOAD),A	; IRM wie zuvor einstellen
  798 E4BC  FB          	EI			; Interrupt wieder ein
  799 E4BD  C9          	RET
  800                   ;
  801                   ; Kassettenpuffer loeschen:
  802                   ; PA:	HL = CASS
  803                   ;
  804 E4BE  21 B780     CLC:	LD	HL,CASS+80H
  805 E4C1  AF          	XOR	A
  806 E4C2  2D          CLC1:	DEC	L
  807 E4C3  77          	LD	(HL),A
  808 E4C4  20 FC       	JR	NZ,CLC1
  809 E4C6  C9          	RET
  810                   
  811                   ;***************************************************************
  812                   ; 
  813                   ;            K A S S E T T E N E I N / A U S G A B E
  814                   ;
  815                   ;***************************************************************
  816                   ; 
  817                   ; Zeitkonstanten fuer Schreiben:
  818                   ;
  819         005D      ZKKAT	EQU	93	;Trennzeichen
  820         0017      ZKKA0	EQU	23	; "0"
  821         002F      ZKKA1	EQU	47	; "1"
  822                   ;
  823                   ; Zeitkonstanten fuer Lesen:
  824                   ;
  825         00A3      IKEZK	EQU	163	; Zeitkonstante fuer CTC
  826         005D      IKEGN	EQU	93	; Erkennung Nullbit
  827         00BA      IKEG1	EQU	186	; Erkennung Einsbit
  828                   
  829                   ; Initialisierung Bandausgabe:
  830                   ; PA:	CY=0	(kein Fehler bei Bandausgabe)
  831                   
  832 E4C7  F3          ISRO:	DI			; **08**
  833 E4C8  DB 88       	IN	A,(PIOAD)
  834 E4CA  F6 60       	OR	01100000b	; Motor+LED ein
  835 E4CC  CD E455     	CALL	ISRO1		; Initialisierung
  836 E4CF  DD 36 02 00 	LD	(IX+2),0	; Block 1
  837 E4D3  01 1000     	LD	BC,4096		; langer Vorton
  838                   	; Ausgabe 1 Block
  839 E4D6  DD 34 02    MBO:	INC	(IX+2)		; **01**
  840 E4D9  3E 87       	LD	A,10000111b	; EI,ZG16,Res
  841 E4DB  F3          	DI
  842 E4DC  D3 8D       	OUT	(CTC1),A
  843 E4DE  3E 2F       	LD	A,ZKKA1		; Vorton 1
  844 E4E0  D3 8D       	OUT	(CTC1),A
  845 E4E2  FB          	EI

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  96
CE46    INC

  846 E4E3  57          	LD	D,A		; D=47
  847 E4E4  5F          	LD	E,A		; E=47
  848 E4E5  CD E52A     MBO1:	CALL	BITOUT		; Vorton ausgeben
  849 E4E8  ED A1       	CPI
  850 E4EA  EA E4E5     	JP	PE,MBO1		; BC mal
  851 E4ED  CD E528     	CALL	ZTON		; Trennzeichen
  852 E4F0  DD 7E 02    	LD	A,(IX+2)
  853 E4F3  CD E515     	CALL	BYTOT		; Blocknummer
  854 E4F6  DD 6E 05    	LD	L,(IX+5)
  855 E4F9  DD 66 06    	LD	H,(IX+6)	; Blockanfang
  856 E4FC  06 80       	LD	B,128		; Zaehler
  857 E4FE  7E          BLKOT:	LD	A,(HL)
  858 E4FF  CD E515     	CALL	BYTOT		; 128 Datenbyte ausgeben
  859 E502  79          	LD	A,C
  860 E503  86          	ADD	A,(HL)		; Pruefsumme
  861 E504  4F          	LD	C,A		; nebenher berechnen in Register C
  862 E505  23          	INC	HL
  863 E506  10 F6       	DJNZ	BLKOT
  864 E508  CD E515     	CALL	BYTOT		; Pruefsumme ausgeben
  865                   ;	LD	A,D		; ???
  866                   ;	CALL	BITOUT		; Endimpuls (Vollschwingung)
  867                   
  868                   ; Bei einer Halbschwingung als Endimpuls aendert sich mit jedem Block die
  869                   ; Polaritaet der Signale bei jedem Block. Das ist bei allen CAOS-Versionen
  870                   ; so ausser CAOS 4.5. Eventuell ist das ja besser - deshalb in CAOS 4.6 wieder
  871                   ; eine Halbschwingung als Endimpuls. (bemerkt von Micha im Forum am 02.02.2015)
  872                   
  873 E50B  CD E52D     	CALL	HBITOT		; Endimpuls (Halbschwingung)
  874 E50E  5D          	LD	E,L
  875 E50F  54          	LD	D,H
  876 E510  3E 03       	LD	A,3		; CTC stoppen
  877 E512  D3 8D       	OUT	(CTC1),A
  878 E514  C9          	RET
  879                   
  880                   ; Ausgabe eines Bytes auf Kassette
  881                   ; PE:	A	Datenbyte
  882                   ; PA:	CY=0
  883                   
  884 E515  C5          BYTOT:	PUSH	BC
  885 E516  4F          	LD	C,A
  886 E517  06 08       	LD	B,8		; 8 Bit ausgeben
  887 E519  CB 09       BYTOUT:	RRC	C		; mit Bit 0 beginnend
  888 E51B  1E 17       	LD	E,ZKKA0
  889 E51D  D4 E52A     	CALL	NC,BITOUT	; CY=0 / Nullbit ausgeben
  890 E520  1E 2F       	LD	E,ZKKA1	
  891 E522  DC E52A     	CALL	C,BITOUT	; CY=1 / Einsbit ausgeben
  892 E525  10 F2       	DJNZ	BYTOUT		; 8x wiederholen
  893 E527  C1          	POP	BC
  894 E528  1E 5D       ZTON:	LD	E,ZKKAT		; ZK Trennzeichen
  895 E52A  CD E52D     BITOUT:	CALL	HBITOT		; Aufrufen und reinlaufen
  896 E52D  DD 72 00    HBITOT:	LD	(IX),D
  897 E530  DD 7E 00    HBIT1:	LD	A,(IX)		; Warten bis Zeitkonstante von
  898 E533  A7          	AND	A		; Interruptroutine zurueckgesetzt
  899 E534  20 FA       	JR	NZ,HBIT1
  900 E536  53          	LD	D,E
  901 E537  C9          	RET
  902                   			
  903                   ; Initialisierung Bandeingabe

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  97
CE46    INC

  904                   ; PE:	HL	Dateiname
  905                   ; PA:	CY=1	Fehler
  906                   ;	CY=0	Block korrekt gelesen
  907                   ; VR:	AF,BC
  908                   
  909 E538  CD E44A     ISRI:	CALL	ISRI1		; **0A**
  910                   
  911                   ; Einen Block einlesen:
  912                   ; PA:	CY=1	Fehler
  913                   ;	CY=0	Block korrekt gelesen
  914                   ; VR:	AF,BC
  915                   
  916 E53B  3E 83       MBI:	LD	A,10000011b	; **05**
  917 E53D  D3 8A       	OUT	(PIOAS),A	; EI an PIO A (Kassette)
  918 E53F  E5          	PUSH	HL
  919 E540  D5          	PUSH	DE
  920 E541  06 16       MBI1:	LD	B,22
  921 E543  DD 36 0B 00 	LD	(IX+11),0	; Pruefsumme=0
  922 E547  CD E5C0     MBI2:	CALL	STOP1		; Lesen einer Vollschwingung
  923 E54A  38 F5       	JR	C,MBI1		; kein Einsbit ?
  924 E54C  FE BA       	CP	IKEG1		; Einsbit ?
  925 E54E  CD E593     	CALL	LEDOO		; LED on/off
  926 E551  38 EE       	JR	C,MBI1
  927 E553  10 F2       	DJNZ	MBI2		; 22 korrekte Schwingungen abwarten
  928 E555  06 02       MBI3:	LD	B,2
  929 E557  AF          MBI4:	XOR	A
  930 E558  CD E5C4     	CALL	STOP2		; Lesen einer Halbschwingung
  931 E55B  FE 5D       	CP	IKEGN		; Nullbit ?
  932 E55D  30 F6       	JR	NC,MBI3
  933 E55F  10 F6       	DJNZ	MBI4
  934 E561  CD E5D5     	CALL	BYTIN		; Blocknummer lesen
  935 E564  38 25       	JR	C,MBI5		; Stoerung
  936 E566  DD 77 02    	LD	(IX+2),A	; Blocknummer eintragen
  937 E569  06 80       	LD	B,128
  938 E56B  DD 6E 05    	LD	L,(IX+5)
  939 E56E  DD 66 06    	LD	H,(IX+6)
  940 E571  CD E5D5     BLKIN:	CALL	BYTIN		; Datenbyte lesen
  941 E574  38 15       	JR	C,MBI5		; Stoerung
  942 E576  77          	LD	(HL),A
  943 E577  DD 7E 0B    	LD	A,(IX+11)
  944 E57A  86          	ADD	A,(HL)		; Pruefsumme berechnen
  945 E57B  DD 77 0B    	LD	(IX+11),A
  946 E57E  23          	INC	HL
  947 E57F  10 F0       	DJNZ	BLKIN
  948 E581  CD E5D5     	CALL	BYTIN		; Pruefsumme einlesen
  949 E584  38 05       	JR	C,MBI5		; Stoerung
  950 E586  DD 96 0B    	SUB	(IX+11)		; Pruefsumme richtig?
  951 E589  C6 FF       	ADD	A,-1		; CY:=/Z
  952 E58B  D1          MBI5:	POP	DE
  953 E58C  E1          	POP	HL
  954 E58D  F3          	DI
  955 E58E  3E 03       	LD	A,3		; DI an PIO A
  956 E590  D3 8A       	OUT	(PIOAS),A
  957 E592  FB          	EI
  958 E593  DB 88       LEDOO:	IN	A,(PIOAD)	; LED ein/aus
  959 E595  CB EF       	SET	5,A		; je nach CY
  960 E597  30 02       	JR	NC,MBI6
  961 E599  CB AF       	RES	5,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  98
CE46    INC

  962 E59B  D3 88       MBI6:	OUT	(PIOAD),A
  963 E59D  C9          	RET
  964                   ;
  965                   ; ISR CTC Kanal 1 (Kassette-Out)
  966                   ;
  967 E59E  F5          ISRC1:	PUSH	AF
  968 E59F  3E 87       	LD	A,87H
  969 E5A1  D3 8D       	OUT	(CTC1),A
  970 E5A3  DD 7E 00    	LD	A,(IX)		; Uebergabezelle
  971 E5A6  D3 8D       	OUT	(CTC1),A
  972 E5A8  DD 36 00 00 	LD	(IX),0		; Quittierung
  973 E5AC  18 0E       	JR	ISR1E
  974                   ;
  975                   ; ISR PIO Kanal A (Kassette-In)
  976                   ;
  977 E5AE  F5          ISRPA:	PUSH	AF
  978 E5AF  DB 8E       	IN	A,(CTC2)
  979 E5B1  DD 77 00    	LD	(IX),A		; Uebergabezelle
  980 E5B4  3E 07       	LD	A,7
  981 E5B6  D3 8E       	OUT	(CTC2),A
  982 E5B8  3E A3       	LD	A,IKEZK
  983 E5BA  D3 8E       	OUT	(CTC2),A
  984 E5BC  F1          ISR1E:	POP	AF
  985 E5BD  FB          IRET:	EI
  986 E5BE  ED 4D       	RETI
  987                   
  988                   ; 1 Bit einlesen:
  989                   ; PA:	A	Zeitwert
  990                   ;	CY=0	Vorton
  991                   ;	CY=1	Nullbit oder Einsbit
  992                   ;
  993 E5C0  AF          STOP1:	XOR	A
  994 E5C1  CD E5C4     	CALL	STOP2		; erst aufrufen, dann reinlaufen
  995 E5C4  4F          STOP2:	LD	C,A		; erste 'Zeit' in C merken
  996 E5C5  DD 36 00 00 	LD	(IX),0
  997 E5C9  DB 88       STOP21:	IN	A,(PIOAD)
  998 E5CB  D3 88       	OUT	(PIOAD),A	; PIO-Logik freigeben
  999 E5CD  DD 7E 00    	LD	A,(IX)		; Warten auf Interrupt
 1000 E5D0  B7          	OR	A
 1001 E5D1  28 F6       	JR	Z,STOP21
 1002 E5D3  81          	ADD	A,C		; beide 'Zeiten' addieren
 1003 E5D4  C9          	RET
 1004                   
 1005                   ; Einlesen eines Bytes von Kassette
 1006                   ; PA:	A=Byte, CY=1: Stoerung
 1007                   ; VR:	AF, BC, DE
 1008                   
 1009 E5D5  11 0800     BYTIN:	LD	DE,800H
 1010 E5D8  CD E5C0     IB1:	CALL	STOP1		; Bit Eingabe
 1011 E5DB  38 03       	JR	C,IB2		; Nullbit ?
 1012 E5DD  FE BA       	CP	IKEG1		; Einsbit
 1013 E5DF  D8          	RET	C		; Trennzeichen
 1014 E5E0  3F          IB2:	CCF
 1015 E5E1  CB 1B       	RR 	E		; Bit einschieben
 1016 E5E3  15          	DEC	D
 1017 E5E4  20 F2       	JR	NZ,IB1		; 8*
 1018 E5E6  CD E5C0     	CALL	STOP1		; Trennzeichen (mit CY-Rueckmeldung)
 1019 E5E9  7B          	LD	A,E		; Byte in A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  99
CE46    INC

 1020 E5EA  C9          	RET
 1021                   
 1022                   ; ===== BASIC =====
 1023                   
 1024                   ; BASIC-Erweiterung 1: Erweiterungstoken starten
 1025                   
 1026 E5EB  78          BEXP1:	LD	A,B		; Nr.
 1027 E5EC  D6 09       	SUB	9
 1028 E5EE  38 44       	JR	C,SNERR1
 1029 E5F0  FE 1D       	CP	29		; 27 ohne "DRIVE"
 1030 E5F2  30 40       	JR	NC,SNERR1	; >28
 1031 E5F4  07          	RLCA			; *2
 1032 E5F5  4F          	LD	C,A
 1033 E5F6  06 00       	LD	B,0
 1034 E5F8  EB          	EX	DE,HL
 1035 E5F9  21 FDAF     	LD	HL,TOKJP+8
 1036 E5FC  C3 C8B7     	JP	DLI22		; Ruecksprung zu Tokenverarbeitung
 1037                   
 1038                   ; BASIC-Erweiterung 2: Print-Erweiterung?
 1039                   
 1040 E5FF  7E          BEXP2:	LD	A,(HL)
 1041 E600  FE DF       	CP	0DFH		; INK-Token?
 1042 E602  D8          	RET	C		; <DFH
 1043 E603  FE E3       	CP	0E3H		; COLOR-Token?
 1044 E605  D0          	RET	NC		; >E2H
 1045 E606  FE E1       	CP	0E1H		; AT-Token?
 1046 E608  CA E9D4     	JP	Z,PRAT
 1047 E60B  3A 03FD     	LD	A,(PRTFLG)
 1048 E60E  A7          	AND	A		; PRINT-Erweiterung?
 1049 E60F  20 23       	JR	NZ,SNERR1
 1050 E611  3C          	INC	A
 1051 E612  32 03FD     	LD	(PRTFLG),A
 1052 E615  E5          PREX1:	PUSH	HL
 1053 E616  21 B7A3     	LD	HL,COLOR
 1054 E619  CD EBCB     	CALL	IRMRD
 1055 E61C  E1          	POP	HL
 1056 E61D  32 037E     	LD	(COLRET),A 	; Farbe merken
 1057 E620  7E          	LD	A,(HL)
 1058 E621  FE DF       	CP	0DFH		; INK?
 1059 E623  28 1A       	JR	Z,PRINK
 1060 E625  FE E2       	CP	0E2H		; COLOR?
 1061 E627  28 0E       	JR	Z,PRCOL
 1062 E629  CD C8BD     	CALL	TCHAR		; naechstes Zeichen holen
 1063 E62C  CD EB3E     	CALL	PAPER
 1064 E62F  7E          PREX2:	LD	A,(HL)
 1065 E630  FE 3B       	CP	';'
 1066 E632  28 3B       	JR	Z,PREX5
 1067 E634  C3 C348     SNERR1:	JP	SNER		; SN-ERROR
 1068                   
 1069 E637  CD C8BD     PRCOL:	CALL	TCHAR		; naechstes Zeichen holen
 1070 E63A  CD EB2F     	CALL	BCOLOR
 1071 E63D  18 F0       	JR	PREX2
 1072                   
 1073 E63F  CD C8BD     PRINK:	CALL	TCHAR		; naechstes Zeichen holen
 1074 E642  CD EB18     	CALL	INK
 1075 E645  7E          	LD	A,(HL)
 1076 E646  FE 3B       	CP	';'
 1077 E648  28 25       	JR	Z,PREX5

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 100
CE46    INC

 1078 E64A  CD C8CC     	CALL	CPSTX		; Komma?
 1079 E64D  2C          	DB	','
 1080 E64E  FE E0       	CP	0E0H		; PAPER?
 1081 E650  20 E2       	JR	NZ,SNERR1
 1082 E652  CD C8BD     	CALL	TCHAR		; naechstes Zeichen holen
 1083 E655  CD EB3E     	CALL	PAPER
 1084 E658  CD C8CC     	CALL	CPSTX		; Semikolon?
 1085 E65B  3B          	DB	';'
 1086 E65C  CD CB03     PREX3:	CALL	PRINT2
 1087 E65F  3A 037E     	LD	A,(COLRET)	; Farbe
 1088 E662  E5          	PUSH	HL
 1089 E663  21 B7A3     	LD	HL,COLOR
 1090 E666  CD EBC7     	CALL	IRMWR		; eintragen
 1091 E669  E1          	POP	HL
 1092 E66A  C1          	POP	BC
 1093 E66B  C9          	RET
 1094 E66C  C5          PREX4:	PUSH	BC
 1095 E66D  18 A6       	JR	PREX1
 1096 E66F  CD C8BD     PREX5:	CALL	TCHAR		; naechstes Zeichen holen
 1097 E672  18 E8       	JR	PREX3
 1098                   
 1099                   ; String vervielfaeltigen
 1100                   
 1101 E674  CD C8CC     STRING:	CALL	CPSTX		; Klammer auf?
 1102 E677  28          	DB	'('
 1103 E678  CD D421     	CALL	ARGVL1		; Wert abholen
 1104 E67B  F5          	PUSH	AF
 1105 E67C  CD C8D6     	CALL	CPCOMM		; Komma?
 1106 E67F  CD CD3A     	CALL	SNALY
 1107 E682  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1108 E685  F1          	POP	AF
 1109 E686  E5          	PUSH	HL
 1110 E687  F5          	PUSH	AF
 1111 E688  CD D330     	CALL	LEN1		; Laenge holen
 1112 E68B  23          	INC	HL
 1113 E68C  23          	INC	HL
 1114 E68D  5E          	LD	E,(HL)
 1115 E68E  23          	INC	HL
 1116 E68F  56          	LD	D,(HL)
 1117 E690  C1          	POP	BC
 1118 E691  C5          	PUSH	BC
 1119 E692  F5          	PUSH	AF
 1120 E693  D5          	PUSH	DE
 1121 E694  4F          	LD	C,A
 1122 E695  AF          	XOR	A
 1123 E696  B9          	CP	C
 1124 E697  28 0C       	JR	Z,STR2
 1125 E699  B8          	CP	B
 1126 E69A  28 09       	JR	Z,STR2
 1127 E69C  79          	LD	A,C
 1128 E69D  05          	DEC	B
 1129 E69E  28 05       	JR	Z,STR2
 1130 E6A0  81          STR1:	ADD	A,C
 1131 E6A1  38 2B       	JR	C,STR5
 1132 E6A3  10 FB       	DJNZ	STR1
 1133 E6A5  47          STR2:	LD	B,A
 1134 E6A6  0E 00       	LD	C,0
 1135 E6A8  C5          	PUSH	BC

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 101
CE46    INC

 1136 E6A9  CD D1E1     	CALL	STROP		; String-Arithmetik
 1137 E6AC  C1          	POP	BC
 1138 E6AD  C1          	POP	BC
 1139 E6AE  C5          	PUSH	BC
 1140 E6AF  CD D17E     	CALL	SADTB1
 1141 E6B2  E1          	POP	HL
 1142 E6B3  E3          	EX	(SP),HL
 1143 E6B4  7C          	LD	A,H
 1144 E6B5  E1          	POP	HL
 1145 E6B6  E3          	EX	(SP),HL
 1146 E6B7  6F          	LD	L,A
 1147 E6B8  24          	INC	H
 1148 E6B9  25          STR3:	DEC	H
 1149 E6BA  E5          	PUSH	HL
 1150 E6BB  C5          	PUSH	BC
 1151 E6BC  28 07       	JR	Z,STR4
 1152 E6BE  CD D2F2     	CALL	STRMV1
 1153 E6C1  C1          	POP	BC
 1154 E6C2  E1          	POP	HL
 1155 E6C3  18 F4       	JR	STR3
 1156                   	;
 1157 E6C5  C1          STR4:	POP	BC
 1158 E6C6  E1          	POP	HL
 1159 E6C7  D1          	POP	DE
 1160 E6C8  CD D302     	CALL	STRZS3
 1161 E6CB  C3 D1A9     	JP	SLEN3
 1162                   	;
 1163 E6CE  1E 1C       STR5:	LD	E,1CH		; ST-ERROR
 1164 E6D0  C3 C356     	JP	ERROO		; Ausgabe Fehlercode
 1165                   
 1166                   ; Neu nummerieren
 1167                   
 1168 E6D3  E5          RENUM:	PUSH	HL
 1169 E6D4  21 000A     	LD	HL,10
 1170 E6D7  22 0354     	LD	(DISTAN),HL
 1171 E6DA  2A 035F     	LD	HL,(PSTBEG)	; Start
 1172 E6DD  F5          	PUSH	AF
 1173 E6DE  E5          	PUSH	HL
 1174 E6DF  23          	INC	HL
 1175 E6E0  23          	INC	HL
 1176 E6E1  7E          	LD	A,(HL)
 1177 E6E2  23          	INC	HL
 1178 E6E3  66          	LD	H,(HL)
 1179 E6E4  6F          	LD	L,A
 1180 E6E5  22 034E     	LD	(ANF),HL	; ZL-Nr
 1181 E6E8  22 0352     	LD	(NANF),HL
 1182 E6EB  ED 5B 03D7  	LD	DE,(SVARPT)	; Ende
 1183 E6EF  1B          	DEC	DE
 1184 E6F0  1B          	DEC	DE
 1185 E6F1  E1          REN01:	POP	HL
 1186 E6F2  E5          	PUSH	HL
 1187 E6F3  7E          	LD	A,(HL)
 1188 E6F4  23          	INC	HL
 1189 E6F5  66          	LD	H,(HL)
 1190 E6F6  6F          	LD	L,A
 1191 E6F7  CD C689     	CALL	CPREG
 1192 E6FA  E3          	EX	(SP),HL
 1193 E6FB  20 F4       	JR	NZ,REN01

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 102
CE46    INC

 1194 E6FD  D1          	POP	DE
 1195 E6FE  23          	INC	HL
 1196 E6FF  23          	INC	HL
 1197 E700  7E          	LD	A,(HL)
 1198 E701  23          	INC	HL
 1199 E702  66          	LD	H,(HL)
 1200 E703  6F          	LD	L,A
 1201 E704  22 0350     	LD	(ENDE),HL	; Zeilen-Abstand
 1202 E707  06 04       	LD	B,4
 1203 E709  F1          	POP	AF
 1204 E70A  21 034E     	LD	HL,ANF
 1205 E70D  E3          	EX	(SP),HL
 1206 E70E  28 20       REN02:	JR	Z,REN05
 1207 E710  CD C986     	CALL	DCHEX
 1208 E713  F5          	PUSH	AF
 1209 E714  7A          	LD	A,D
 1210 E715  B3          	OR	E
 1211 E716  CA C967     REN03:	JP	Z,FCER	 	; FC-ERROR
 1212 E719  F1          	POP	AF
 1213 E71A  E3          	EX	(SP),HL
 1214 E71B  73          	LD	(HL),E
 1215 E71C  23          	INC	HL
 1216 E71D  72          	LD	(HL),D
 1217 E71E  23          	INC	HL
 1218 E71F  28 0F       	JR	Z,REN05
 1219 E721  F5          	PUSH	AF
 1220 E722  05          	DEC	B
 1221 E723  28 07       	JR	Z,REN04
 1222 E725  F1          	POP	AF
 1223 E726  E3          	EX	(SP),HL
 1224 E727  CD C8D6     	CALL	CPCOMM		; Komma?
 1225 E72A  18 E2       	JR	REN02
 1226                   	;
 1227 E72C  F1          REN04:	POP	AF
 1228 E72D  C2 C348     	JP	NZ,SNER		; SN-ERROR
 1229 E730  2A 0350     REN05:	LD	HL,(ENDE)
 1230 E733  ED 5B 034E  	LD	DE,(ANF)	; ANFANG
 1231 E737  CD C689     	CALL	CPREG
 1232 E73A  DA C967     REN06:	JP	C,FCER		; FC-ERROR
 1233 E73D  2A 035F     	LD	HL,(PSTBEG)
 1234 E740  CD C4BE     REN07:	CALL	ZPOIT1		; naechste Zeile
 1235 E743  38 04       	JR	C,REN08
 1236 E745  28 CF       	JR	Z,REN03
 1237 E747  18 F7       	JR	REN07
 1238                   	;
 1239 E749  E1          REN08:	POP	HL
 1240 E74A  C5          	PUSH	BC
 1241 E74B  ED 5B 0350  	LD	DE,(ENDE)
 1242 E74F  21 0000     	LD	HL,0
 1243 E752  22 0350     	LD	(ENDE),HL
 1244 E755  60          REN09:	LD	H,B
 1245 E756  69          	LD	L,C
 1246 E757  4E          	LD	C,(HL)
 1247 E758  23          	INC	HL
 1248 E759  46          	LD	B,(HL)
 1249 E75A  78          	LD	A,B
 1250 E75B  B1          	OR	C
 1251 E75C  28 B8       	JR	Z,REN03

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 103
CE46    INC

 1252 E75E  23          	INC	HL
 1253 E75F  7E          	LD	A,(HL)
 1254 E760  23          	INC	HL
 1255 E761  66          	LD	H,(HL)
 1256 E762  6F          	LD	L,A
 1257 E763  CD C689     	CALL	CPREG
 1258 E766  2A 0350     	LD	HL,(ENDE)
 1259 E769  23          	INC	HL
 1260 E76A  22 0350     	LD	(ENDE),HL
 1261 E76D  20 E6       	JR	NZ,REN09
 1262 E76F  23          	INC	HL
 1263 E770  23          	INC	HL
 1264 E771  29          	ADD	HL,HL
 1265 E772  23          	INC	HL
 1266 E773  ED 5B 03D7  	LD	DE,(SVARPT)
 1267 E777  19          	ADD	HL,DE
 1268 E778  38 C0       	JR	C,REN06
 1269 E77A  CD C327     	CALL	TMEMO		; genug RAM?
 1270 E77D  22 03D7     	LD	(SVARPT),HL
 1271 E780  AF          	XOR	A
 1272 E781  2B          	DEC	HL
 1273 E782  77          	LD	(HL),A
 1274 E783  2B          	DEC	HL
 1275 E784  77          	LD	(HL),A
 1276 E785  1B          	DEC	DE
 1277 E786  1B          	DEC	DE
 1278 E787  EB          	EX	DE,HL
 1279 E788  73          	LD	(HL),E
 1280 E789  23          	INC	HL
 1281 E78A  72          	LD	(HL),D
 1282 E78B  23          	INC	HL
 1283 E78C  3D          	DEC	A
 1284 E78D  77          	LD	(HL),A
 1285 E78E  23          	INC	HL
 1286 E78F  77          	LD	(HL),A
 1287 E790  23          	INC	HL
 1288 E791  EB          	EX	DE,HL
 1289 E792  2A 0352     	LD	HL,(NANF)
 1290 E795  22 034E     	LD	(ANF),HL
 1291 E798  E1          REN10:	POP	HL
 1292 E799  4E          	LD	C,(HL)
 1293 E79A  23          	INC	HL
 1294 E79B  46          	LD	B,(HL)
 1295 E79C  23          	INC	HL
 1296 E79D  C5          	PUSH	BC
 1297 E79E  01 034E     	LD	BC,ANF
 1298 E7A1  7E          	LD	A,(HL)
 1299 E7A2  12          	LD	(DE),A
 1300 E7A3  0A          	LD	A,(BC)
 1301 E7A4  77          	LD	(HL),A
 1302 E7A5  23          	INC	HL
 1303 E7A6  13          	INC	DE
 1304 E7A7  03          	INC	BC
 1305 E7A8  7E          	LD	A,(HL)
 1306 E7A9  12          	LD	(DE),A
 1307 E7AA  0A          	LD	A,(BC)
 1308 E7AB  77          	LD	(HL),A
 1309 E7AC  13          	INC	DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 104
CE46    INC

 1310 E7AD  2A 034E     	LD	HL,(ANF)
 1311 E7B0  ED 4B 0354  	LD	BC,(DISTAN)
 1312 E7B4  09          	ADD	HL,BC
 1313 E7B5  22 034E     	LD	(ANF),HL
 1314 E7B8  2A 0350     	LD	HL,(ENDE)
 1315 E7BB  2B          	DEC	HL
 1316 E7BC  7C          	LD	A,H
 1317 E7BD  B5          	OR	L
 1318 E7BE  22 0350     	LD	(ENDE),HL
 1319 E7C1  20 D5       	JR	NZ,REN10
 1320 E7C3  12          	LD	(DE),A
 1321 E7C4  E1          	POP	HL
 1322 E7C5  2A 035F     	LD	HL,(PSTBEG)
 1323 E7C8  E5          	PUSH	HL
 1324 E7C9  E1          REN11:	POP	HL
 1325 E7CA  4E          	LD	C,(HL)
 1326 E7CB  23          	INC	HL
 1327 E7CC  46          	LD	B,(HL)
 1328 E7CD  23          	INC	HL
 1329 E7CE  C5          	PUSH	BC
 1330 E7CF  7E          	LD	A,(HL)
 1331 E7D0  23          	INC	HL
 1332 E7D1  A6          	AND	(HL)
 1333 E7D2  3C          	INC	A
 1334 E7D3  28 26       	JR	Z,REN15
 1335 E7D5  23          REN12:	INC	HL
 1336 E7D6  7E          REN13:	LD	A,(HL)
 1337 E7D7  B7          	OR	A
 1338 E7D8  28 EF       	JR	Z,REN11
 1339 E7DA  FE 88       	CP	88H		; GOTO
 1340 E7DC  28 2A       	JR	Z,REN16
 1341 E7DE  FE 8C       	CP	8CH		; GOSUB
 1342 E7E0  28 26       	JR	Z,REN16
 1343 E7E2  FE 8B       	CP	8BH		; RESTORE
 1344 E7E4  28 08       	JR	Z,REN14
 1345 E7E6  FE D4       	CP	0D4H		; ELSE
 1346 E7E8  28 04       	JR	Z,REN14
 1347 E7EA  FE A9       	CP	0A9H		; THEN
 1348 E7EC  20 E7       	JR	NZ,REN12
 1349 E7EE  CD C987     REN14:	CALL	DCHEX1
 1350 E7F1  7B          	LD	A,E
 1351 E7F2  B2          	OR	D
 1352 E7F3  C4 E81C     	CALL	NZ,RNUP1 	; Vergleich mit Tabelle
 1353 E7F6  C4 E84E     	CALL	NZ,RNUP2	; Zahl aendern
 1354 E7F9  18 DB       	JR	REN13
 1355                   	;
 1356 E7FB  2B          REN15:	DEC	HL
 1357 E7FC  22 03D7     	LD	(SVARPT),HL
 1358 E7FF  2B          	DEC	HL
 1359 E800  77          	LD	(HL),A
 1360 E801  2B          	DEC	HL
 1361 E802  77          	LD	(HL),A
 1362 E803  E1          	POP	HL
 1363 E804  E1          	POP	HL
 1364 E805  C3 C48A     	JP	LIN10		; Zeile neu einsortieren
 1365                   	;
 1366 E808  CD C987     REN16:	CALL	DCHEX1
 1367 E80B  7B          	LD	A,E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 105
CE46    INC

 1368 E80C  B2          	OR	D
 1369 E80D  28 C7       	JR	Z,REN13
 1370 E80F  CD E81C     	CALL	RNUP1
 1371 E812  C4 E84E     	CALL	NZ,RNUP2
 1372 E815  7E          	LD	A,(HL)
 1373 E816  FE 2C       	CP	2CH
 1374 E818  20 BC       	JR	NZ,REN13
 1375 E81A  18 EC       	JR	REN16
 1376                   
 1377 E81C  E5          RNUP1:	PUSH	HL
 1378 E81D  D5          	PUSH	DE
 1379 E81E  11 FFFF     	LD	DE,-1
 1380 E821  CD C4BB     	CALL	ZPOIT		; naechste Zeile
 1381 E824  D1          	POP	DE
 1382 E825  03          	INC	BC
 1383 E826  03          	INC	BC
 1384 E827  03          	INC	BC
 1385 E828  03          	INC	BC
 1386 E829  60          	LD	H,B
 1387 E82A  69          	LD	L,C
 1388 E82B  ED 4B 0352  	LD	BC,(NANF)
 1389 E82F  7E          RUP11:	LD	A,(HL)
 1390 E830  23          	INC	HL
 1391 E831  E5          	PUSH	HL
 1392 E832  B6          	OR	(HL)
 1393 E833  28 16       	JR	Z,RUP13
 1394 E835  7E          	LD	A,(HL)
 1395 E836  2B          	DEC	HL
 1396 E837  6E          	LD	L,(HL)
 1397 E838  67          	LD	H,A
 1398 E839  CD C689     	CALL	CPREG
 1399 E83C  28 0A       	JR	Z,RUP12
 1400 E83E  2A 0354     	LD	HL,(DISTAN)
 1401 E841  09          	ADD	HL,BC
 1402 E842  44          	LD	B,H
 1403 E843  4D          	LD	C,L
 1404 E844  E1          	POP	HL
 1405 E845  23          	INC	HL
 1406 E846  18 E7       	JR	RUP11
 1407                   	;
 1408 E848  3E FF       RUP12:	LD	A,0FFH
 1409 E84A  B7          	OR	A
 1410 E84B  E1          RUP13:	POP	HL
 1411 E84C  E1          	POP	HL
 1412 E84D  C9          	RET
 1413                   
 1414 E84E  C5          RNUP2:	PUSH	BC
 1415 E84F  EB          	EX	DE,HL
 1416 E850  2A 03D7     	LD	HL,(SVARPT)
 1417 E853  ED 52       	SBC	HL,DE
 1418 E855  E5          	PUSH	HL
 1419 E856  C1          RUP21:	POP	BC
 1420 E857  62          	LD	H,D
 1421 E858  6B          	LD	L,E
 1422 E859  1B          	DEC	DE
 1423 E85A  1A          	LD	A,(DE)
 1424 E85B  FE 2C       	CP	','
 1425 E85D  28 0B       	JR	Z,RUP22

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 106
CE46    INC

 1426 E85F  FE 3A       	CP	':'
 1427 E861  30 07       	JR	NC,RUP22
 1428 E863  C5          	PUSH	BC
 1429 E864  D5          	PUSH	DE
 1430 E865  ED B0       	LDIR
 1431 E867  D1          	POP	DE
 1432 E868  18 EC       	JR	RUP21
 1433                   	;
 1434 E86A  EB          RUP22:	EX	DE,HL
 1435 E86B  D1          	POP	DE
 1436 E86C  E5          	PUSH	HL
 1437 E86D  C5          	PUSH	BC
 1438 E86E  AF          	XOR	A
 1439 E86F  06 98       	LD	B,98H
 1440 E871  CD D6AE     	CALL	SGN1
 1441 E874  CD D834     	CALL	NUMKON
 1442 E877  C1          	POP	BC
 1443 E878  D1          	POP	DE
 1444 E879  23          	INC	HL
 1445 E87A  13          	INC	DE
 1446 E87B  7E          RUP23:	LD	A,(HL)
 1447 E87C  B7          	OR	A
 1448 E87D  28 0F       	JR	Z,RUP24
 1449 E87F  C5          	PUSH	BC
 1450 E880  E5          	PUSH	HL
 1451 E881  EB          	EX	DE,HL
 1452 E882  09          	ADD	HL,BC
 1453 E883  54          	LD	D,H
 1454 E884  5D          	LD	E,L
 1455 E885  2B          	DEC	HL
 1456 E886  ED B8       	LDDR
 1457 E888  E1          	POP	HL
 1458 E889  ED A0       	LDI
 1459 E88B  C1          	POP	BC
 1460 E88C  18 ED       	JR	RUP23
 1461                   	;
 1462 E88E  D5          RUP24:	PUSH	DE
 1463 E88F  ED 5B 035F  	LD	DE,(PSTBEG)
 1464 E893  CD C493     	CALL	LIN11
 1465 E896  23          RUP25:	INC	HL
 1466 E897  7E          	LD	A,(HL)
 1467 E898  23          	INC	HL
 1468 E899  B6          	OR	(HL)
 1469 E89A  20 FA       	JR	NZ,RUP25
 1470 E89C  EB          	EX	DE,HL
 1471 E89D  73          	LD	(HL),E
 1472 E89E  23          	INC	HL
 1473 E89F  72          	LD	(HL),D
 1474 E8A0  13          	INC	DE
 1475 E8A1  13          	INC	DE
 1476 E8A2  ED 53 03D7  	LD	(SVARPT),DE
 1477 E8A6  E1          	POP	HL
 1478 E8A7  54          	LD	D,H
 1479 E8A8  5D          	LD	E,L
 1480 E8A9  7E          RUP26:	LD	A,(HL)
 1481 E8AA  B7          	OR	A
 1482 E8AB  23          	INC	HL
 1483 E8AC  20 FB       	JR	NZ,RUP26

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 107
CE46    INC

 1484 E8AE  C1          	POP	BC
 1485 E8AF  E3          	EX	(SP),HL
 1486 E8B0  C5          	PUSH	BC
 1487 E8B1  EB          	EX	DE,HL
 1488 E8B2  C9          	RET
 1489                   
 1490                   ; Zeile(n) loeschen
 1491                   
 1492 E8B3  C8          DELETE:	RET	Z
 1493 E8B4  CD C986     	CALL	DCHEX
 1494 E8B7  CA C442     	JP	Z,LIN13		; Zeiger auf folgende Zeilennummer stellen
 1495 E8BA  CD C8D6     	CALL	CPCOMM		; Komma?
 1496 E8BD  D5          	PUSH	DE
 1497 E8BE  CD C986     	CALL	DCHEX
 1498 E8C1  E1          	POP	HL
 1499 E8C2  C0          	RET	NZ
 1500 E8C3  EB          	EX	DE,HL
 1501 E8C4  E5          	PUSH	HL
 1502 E8C5  CD C4BB     	CALL	ZPOIT		; naechste Zeile
 1503 E8C8  30 0A       	JR	NC,DELET1	; UL-ERROR
 1504 E8CA  D1          	POP	DE
 1505 E8CB  F5          	PUSH	AF
 1506 E8CC  C5          	PUSH	BC
 1507 E8CD  CD C4BE     	CALL	ZPOIT1
 1508 E8D0  C1          	POP	BC
 1509 E8D1  DA C450     	JP	C,LIN6		; einsortieren
 1510 E8D4  C3 C44D     DELET1:	JP	ULER		; UL-ERROR
 1511                   
 1512                   ; Programm unterbrechen
 1513                   
 1514 E8D7  CD C8BE     PAUSE:	CALL	TCHAR1		; mit oder ohne Paramater?
 1515 E8DA  20 0F       	JR	NZ,PAUS2
 1516 E8DC  CD E365     PAUS1:	CALL	KBDS
 1517 E8DF  30 FB       	JR	NC,PAUS1
 1518 E8E1  FE 03       	CP	3		; BRK?
 1519 E8E3  C8          	RET	Z
 1520 E8E4  FE 0A       	CP	LF		; CUU?
 1521 E8E6  20 F4       	JR	NZ,PAUS1
 1522 E8E8  C3 DDE4     	JP	CI		; Eingabe ASCII
 1523                   	;
 1524 E8EB  CD D421     PAUS2:	CALL	ARGVL1		; Wert abholen
 1525 E8EE  4F          	LD	C,A
 1526 E8EF  3E 10       PAUS3:	LD	A,16		; 16*6ms = 96 Millisekunden
 1527 E8F1  1E 14       	LD	E,14H		; WAIT
 1528 E8F3  CD F02B     	CALL	PV5
 1529 E8F6  CD E365     	CALL	KBDS
 1530 E8F9  30 0A       	JR	NC,PAUS4
 1531 E8FB  FE 03       	CP	3		; BRK?
 1532 E8FD  C8          	RET	Z
 1533 E8FE  FE 0A       	CP	LF		; CUU?
 1534 E900  20 03       	JR	NZ,PAUS4
 1535 E902  C3 DDE4     	JP	CI		; Eingabe ASCII
 1536                   	;
 1537 E905  0D          PAUS4:	DEC	C		; Zaehler verringern
 1538 E906  20 E7       	JR	NZ,PAUS3	; weiter warten
 1539 E908  C9          	RET
 1540                   
 1541                   ; Signalton

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 108
CE46    INC

 1542                   
 1543 E909  06 01       BBEEP:	LD	B,1		; ohne Angabe 1x
 1544 E90B  CD C8BE     	CALL	TCHAR1
 1545 E90E  28 04       	JR	Z,BBP1
 1546 E910  CD D421     	CALL	ARGVL1		; Wert abholen
 1547 E913  47          	LD	B,A		; Anzahl
 1548 E914  3E 07       BBP1:	LD	A,7		; Beep
 1549 E916  1E 00       	LD	E,0		; CRT
 1550 E918  CD F02B     	CALL	PV5
 1551 E91B  10 F7       	DJNZ	BBP1
 1552 E91D  C9          	RET
 1553                   
 1554                   ; Fenster einstellen
 1555                   
 1556 E91E  CD C8BE     WINDOW:	CALL	TCHAR1		; Parameter angegeben?
 1557 E921  28 65       	JR	Z,WINDO1	; nein, dann volles Fenster einstellen
 1558 E923  E5          	PUSH	HL
 1559 E924  CD D421     	CALL	ARGVL1		; Wert abholen
 1560 E927  E3          	EX	(SP),HL
 1561 E928  21 B9F6     	LD	HL,WNDFN+90	; in Fenster 9
 1562 E92B  CD EBC7     	CALL	IRMWR		; erstellen
 1563 E92E  23          	INC	HL
 1564 E92F  E3          	EX	(SP),HL
 1565 E930  CD C8D6     	CALL	CPCOMM		; Komma?
 1566 E933  CD D421     	CALL	ARGVL1		; Wert abholen
 1567 E936  E3          	EX	(SP),HL
 1568 E937  CD EBC7     	CALL	IRMWR
 1569 E93A  23          	INC	HL
 1570 E93B  E3          	EX	(SP),HL
 1571 E93C  CD C8D6     	CALL	CPCOMM		; Komma?
 1572 E93F  CD D421     	CALL	ARGVL1		; Wert abholen
 1573 E942  E3          	EX	(SP),HL
 1574 E943  CD EBC7     	CALL	IRMWR
 1575 E946  E3          	EX	(SP),HL
 1576 E947  CD C8D6     	CALL	CPCOMM		; Komma?
 1577 E94A  CD D421     	CALL	ARGVL1		; Wert abholen
 1578 E94D  E3          	EX	(SP),HL
 1579 E94E  57          	LD	D,A
 1580 E94F  CD F082     	CALL	IRMON
 1581 E952  FE 28       	CP	28H
 1582 E954  30 4D       	JR	NC,WINERR
 1583 E956  3A B9F8     	LD	A,(WNDFN+92)
 1584 E959  5F          	LD	E,A
 1585 E95A  FE 28       	CP	28H
 1586 E95C  30 45       	JR	NC,WINERR
 1587 E95E  7A          	LD	A,D
 1588 E95F  93          	SUB	E
 1589 E960  38 41       	JR	C,WINERR
 1590 E962  3C          	INC	A
 1591 E963  32 B79E     	LD	(WINLG),A
 1592 E966  7B          	LD	A,E
 1593 E967  32 B79C     	LD	(WINON),A
 1594 E96A  3A B9F7     	LD	A,(WNDFN+91)
 1595 E96D  FE 20       	CP	20H
 1596 E96F  30 32       	JR	NC,WINERR
 1597 E971  57          	LD	D,A
 1598 E972  3A B9F6     	LD	A,(WNDFN+90)
 1599 E975  FE 20       	CP	20H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 109
CE46    INC

 1600 E977  30 2A       	JR	NC,WINERR
 1601 E979  5F          	LD	E,A
 1602 E97A  7A          	LD	A,D
 1603 E97B  93          	SUB	E
 1604 E97C  38 25       	JR	C,WINERR
 1605 E97E  3C          	INC	A
 1606 E97F  32 B79F     	LD	(WINLG+1),A
 1607 E982  7B          	LD	A,E
 1608 E983  32 B79D     	LD	(WINON+1),A
 1609 E986  18 10       	JR	WINDO2
 1610                   	;
 1611 E988  E5          WINDO1:	PUSH	HL
 1612 E989  CD F082     	CALL	IRMON
 1613 E98C  21 0100     	LD	HL,100H		; Standardfenstergoesse bei BASIC:
 1614 E98F  22 B79C     	LD	(WINON),HL	; 30 Zeilen, 40 Zeichen breit
 1615 E992  21 1E28     	LD	HL,1E28H	; (oben und unten eine Zeile ungenutzt)
 1616 E995  22 B79E     	LD	(WINLG),HL
 1617 E998  21 0000     WINDO2:	LD	HL,0
 1618 E99B  22 B7A0     	LD	(CURSO),HL
 1619 E99E  CD F09F     	CALL	IRMOF
 1620 E9A1  E1          	POP	HL
 1621 E9A2  C9          	RET
 1622                   	;
 1623 E9A3  CD F09F     WINERR:	CALL	IRMOF
 1624 E9A6  C3 C348     SNERR2:	JP	SNER		; SN-ERROR
 1625                   
 1626                   ; MC-Programm laden:
 1627                   
 1628 E9A9  E5          BLOAD:	PUSH	HL
 1629 E9AA  21 B781     	LD	HL,ARGN
 1630 E9AD  AF          	XOR	A
 1631 E9AE  CD EBC7     	CALL	IRMWR		; ARGN=0
 1632 E9B1  E1          	POP	HL
 1633 E9B2  1E 10       	LD	E,10H		; LOAD
 1634 E9B4  C3 F02B     	JP	PV5
 1635                   
 1636                   ; in IRM schreiben (8000h bis BFFFh):
 1637                   
 1638 E9B7  CD C96C     VPOKE:	CALL	EPRVL4
 1639 E9BA  D5          	PUSH	DE
 1640 E9BB  CD C8D6     	CALL	CPCOMM		; Komma?
 1641 E9BE  CD D421     	CALL	ARGVL1		; Wert abholen
 1642 E9C1  E3          	EX	(SP),HL
 1643 E9C2  11 8000     	LD	DE,8000H	; IRM-Offset
 1644 E9C5  19          	ADD	HL,DE
 1645 E9C6  38 DE       	JR	C,SNERR2	; < 8000h
 1646 E9C8  57          	LD	D,A
 1647 E9C9  3E BF       	LD	A,0BFH
 1648 E9CB  BC          	CP	H
 1649 E9CC  38 D8       	JR	C,SNERR2	; > BFFFh
 1650 E9CE  7A          	LD	A,D
 1651 E9CF  CD EBC7     	CALL	IRMWR		; schreiben
 1652 E9D2  E1          	POP	HL
 1653 E9D3  C9          	RET
 1654                   
 1655                   ; alte Variante von BORDER bis CAOS 4.4
 1656                   ; schaltet RAM-8 (vermutlich nicht gewollt?)
 1657                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 110
CE46    INC

 1658                   ;BORDER:
 1659                   ;	CALL	ARGVL1	; Wert abholen
 1660                   ;	RRCA
 1661                   ;	RRCA
 1662                   ;	RRCA
 1663                   ;	AND	60H	; Auswahl
 1664                   ;	LD	C,A
 1665                   ;	LD	B,9FH	; Maske
 1666                   ;	JP	TONB
 1667                   
 1668                   ; PRINT AT:
 1669                   
 1670 E9D4  3A 03FD     PRAT:	LD	A,(PRTFLG)
 1671 E9D7  CB 4F       	BIT	1,A
 1672 E9D9  CB CF       	SET	1,A
 1673 E9DB  32 03FD     	LD	(PRTFLG),A
 1674 E9DE  20 C6       	JR	NZ,SNERR2
 1675 E9E0  D5          	PUSH	DE
 1676 E9E1  E5          	PUSH	HL
 1677 E9E2  CD F082     	CALL	IRMON
 1678 E9E5  21 B79C     	LD	HL,WINON
 1679 E9E8  22 B9F6     	LD	(WNDFN+90),HL
 1680 E9EB  11 B9EC     	LD	DE,WNDFN+80
 1681 E9EE  01 0006     	LD	BC,6
 1682 E9F1  ED B0       	LDIR			; Fenster retten
 1683 E9F3  21 0000     	LD	HL,0		; Fenster gross
 1684 E9F6  22 B79C     	LD	(WINON),HL
 1685 E9F9  21 2028     	LD	HL,2028H
 1686 E9FC  22 B79E     	LD	(WINLG),HL
 1687 E9FF  CD F09F     	CALL	IRMOF
 1688 EA02  E1          	POP	HL
 1689 EA03  CD EA34     	CALL	LOCAT
 1690 EA06  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1691 EA09  CD C8CC     	CALL	CPSTX		; Semikolon?
 1692 EA0C  3B          	DB	';'
 1693 EA0D  7E          	LD	A,(HL)
 1694 EA0E  FE DF       	CP	0DFH
 1695 EA10  38 1D       	JR	C,PRAT2		; <DFH
 1696 EA12  FE E3       	CP	0E3H
 1697 EA14  30 19       	JR	NC,PRAT2	; >E2H
 1698 EA16  CD E66C     	CALL	PREX4		; INK, PAPER, COLOR
 1699 EA19  E5          PRAT1:	PUSH	HL
 1700 EA1A  CD F082     	CALL	IRMON
 1701 EA1D  21 B9EC     	LD	HL,WNDFN+80
 1702 EA20  11 B79C     	LD	DE,WINON
 1703 EA23  01 0006     	LD	BC,6
 1704 EA26  ED B0       	LDIR			; Fenster regenerieren
 1705 EA28  CD F09F     	CALL	IRMOF
 1706 EA2B  E1          	POP	HL
 1707 EA2C  D1          	POP	DE
 1708 EA2D  C1          	POP	BC
 1709 EA2E  C9          	RET
 1710                   	;
 1711 EA2F  CD CB03     PRAT2:	CALL	PRINT2
 1712 EA32  18 E5       	JR	PRAT1
 1713                   
 1714                   ; Cursor positionieren:
 1715                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 111
CE46    INC

 1716 EA34  CD C8BD     LOCAT:	CALL	TCHAR		; naechstes Zeichen holen
 1717 EA37  CD C8CC     	CALL	CPSTX		; Klammer auf?
 1718 EA3A  28          	DB	'('
 1719 EA3B  CD D421     LOCATE:	CALL	ARGVL1		; Wert abholen
 1720 EA3E  57          	LD	D,A
 1721 EA3F  E5          	PUSH	HL
 1722 EA40  21 B79F     	LD	HL,WINLG+1
 1723 EA43  CD EBCB     	CALL	IRMRD
 1724 EA46  E1          	POP	HL
 1725 EA47  3D          	DEC	A
 1726 EA48  BA          	CP	D
 1727 EA49  38 3F       	JR	C,SNERR3
 1728 EA4B  CD C8D6     	CALL	CPCOMM		; Komma?
 1729 EA4E  D5          	PUSH	DE
 1730 EA4F  CD D421     	CALL	ARGVL1		; Wert abholen
 1731 EA52  D1          	POP	DE
 1732 EA53  4F          	LD	C,A
 1733 EA54  E5          	PUSH	HL
 1734 EA55  21 B79E     	LD	HL,WINLG
 1735 EA58  CD EBCB     	CALL	IRMRD
 1736 EA5B  E1          	POP	HL
 1737 EA5C  3D          	DEC	A
 1738 EA5D  B9          	CP	C
 1739 EA5E  38 2A       	JR	C,SNERR3
 1740 EA60  79          	LD	A,C
 1741 EA61  E5          	PUSH	HL
 1742 EA62  21 B7A0     	LD	HL,CURSO
 1743 EA65  CD EBC7     	CALL	IRMWR
 1744 EA68  7A          	LD	A,D
 1745 EA69  23          	INC	HL
 1746 EA6A  CD EBC7     LOC1:	CALL	IRMWR
 1747 EA6D  E1          	POP	HL
 1748 EA6E  C9          	RET
 1749                   
 1750                   ; Eingabe eines Zeichens:
 1751                   
 1752 EA6F  E5          INKEY:	PUSH	HL
 1753 EA70  CD E365     	CALL	KBDS
 1754 EA73  30 0F       	JR	NC,INKEY3
 1755 EA75  3E 01       	LD	A,1
 1756 EA77  CD D17B     	CALL	STADTB
 1757 EA7A  CD DDE4     	CALL	CI		; Eingabe ASCII
 1758 EA7D  2A 03C2     INKEY1:	LD	HL,(STRDAT+2)
 1759 EA80  77          	LD	(HL),A
 1760 EA81  C3 D1A9     INKEY2:	JP	SLEN3
 1761                   	;
 1762 EA84  AF          INKEY3:	XOR	A
 1763 EA85  CD D17B     	CALL	STADTB
 1764 EA88  18 F7       	JR	INKEY2
 1765                   
 1766 EA8A  C3 C348     SNERR3:	JP	SNER		; SN-ERROR
 1767                   
 1768                   ; Tonausgabe:
 1769                   
 1770 EA8D  CD D421     SOUND:	CALL	ARGVL1		; 1. Wert abholen
 1771 EA90  E5          	PUSH	HL
 1772 EA91  21 B782     	LD	HL,ARG1		; Argumente hier ablegen
 1773 EA94  06 04       	LD	B,4		; 4 Argumente holen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 112
CE46    INC

 1774 EA96  CD EBC7     SOUND1:	CALL	IRMWR		; Argument einschreiben
 1775 EA99  23          	INC	HL
 1776 EA9A  E3          	EX	(SP),HL		; Umschaltung auf Programmzeiger
 1777 EA9B  05          	DEC	B
 1778 EA9C  28 0B       	JR	Z,SOUND2	; fertig mit 4 Werten
 1779 EA9E  C5          	PUSH	BC
 1780 EA9F  CD C8D6     	CALL	CPCOMM		; Komma?
 1781 EAA2  CD D421     	CALL	ARGVL1		; 2. bis 4. Wert abholen
 1782 EAA5  C1          	POP	BC
 1783 EAA6  E3          	EX	(SP),HL		; Umschaltung auf ARG-Zeiger
 1784 EAA7  18 ED       	JR	SOUND1
 1785                   	;
 1786 EAA9  CD C8BE     SOUND2:	CALL	TCHAR1		; weiterer Parameter?
 1787 EAAC  28 1C       	JR	Z,SOUND3
 1788 EAAE  CD C8D6     	CALL	CPCOMM		; Komma?
 1789 EAB1  CD D421     	CALL	ARGVL1		; optionalen 5. Wert abholen
 1790 EAB4  E3          	EX	(SP),HL
 1791 EAB5  CD EBC7     	CALL	IRMWR
 1792 EAB8  23          	INC	HL
 1793 EAB9  E3          	EX	(SP),HL
 1794 EABA  CD C8BE     	CALL	TCHAR1		; weiterer Parameter?
 1795 EABD  28 0B       	JR	Z,SOUND3
 1796 EABF  CD C8D6     	CALL	CPCOMM		; Komma?
 1797 EAC2  CD D421     	CALL	ARGVL1		; optionalen 6. Wert abholen
 1798 EAC5  E3          	EX	(SP),HL
 1799 EAC6  CD EBC7     	CALL	IRMWR
 1800 EAC9  E3          	EX	(SP),HL
 1801 EACA  1E 35       SOUND3:	LD	E,35H		; UP-Nr. fuer TON
 1802 EACC  C1          	POP	BC		; Stack bereinigen
 1803 EACD  C3 F02B     	JP	PV5		; Tonausgabe aufrufen
 1804                   
 1805                   ; Punkt setzen:
 1806                   
 1807 EAD0  06 01       PSET:	LD	B,1		; setzen
 1808 EAD2  C5          POINT:	PUSH	BC
 1809 EAD3  CD C96C     	CALL	EPRVL4
 1810 EAD6  E5          	PUSH	HL
 1811 EAD7  7B          	LD	A,E
 1812 EAD8  21 B7D3     	LD	HL,HOR
 1813 EADB  CD EBC7     	CALL	IRMWR		; X-Koordinate (low)
 1814 EADE  7A          	LD	A,D
 1815 EADF  23          	INC	HL
 1816 EAE0  CD EBC7     	CALL	IRMWR		; X-Koordinate (high)
 1817 EAE3  E3          	EX	(SP),HL
 1818 EAE4  CD C8D6     	CALL	CPCOMM		; Komma?
 1819 EAE7  CD D421     	CALL	ARGVL1		; Wert abholen
 1820 EAEA  E3          	EX	(SP),HL
 1821 EAEB  23          	INC	HL
 1822 EAEC  CD EBC7     	CALL	IRMWR		; Y-Koordinate
 1823 EAEF  E1          	POP	HL
 1824 EAF0  CD EB04     	CALL	GFARB
 1825 EAF3  1E 30       	LD	E,30H		; UP-Nr. 30H fuer PUSE
 1826 EAF5  C1          	POP	BC
 1827 EAF6  05          	DEC	B
 1828 EAF7  28 01       	JR	Z,POINT2
 1829 EAF9  1D          	DEC	E		; UP-Nr. 2FH fuer PUDE
 1830 EAFA  CD F02B     POINT2:	CALL	PV5
 1831 EAFD  38 5B       	JR	C,FCERR		; FC-ERROR	(bisher SN-ERROR)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 113
CE46    INC

 1832 EAFF  C9          	RET
 1833                   
 1834                   ; Punkt loeschen:
 1835                   
 1836 EB00  06 00       PRESET:	LD	B,0		; loeschen
 1837 EB02  18 CE       	JR	POINT
 1838                   
 1839                   ; Grafikfarbe einstellen:
 1840                   
 1841 EB04  CD C8BE     GFARB:	CALL	TCHAR1
 1842 EB07  C8          	RET	Z
 1843 EB08  CD C8D6     	CALL	CPCOMM		; Komma?
 1844 EB0B  CD D421     	CALL	ARGVL1		; Wert abholen
 1845 EB0E  E5          	PUSH	HL
 1846 EB0F  21 B7D6     	LD	HL,FARB		; Grafik-Farbe
 1847 EB12  17          	RLA
 1848 EB13  17          	RLA
 1849 EB14  17          	RLA
 1850 EB15  C3 EA6A     	JP	LOC1		; in IRM schreiben
 1851                   
 1852                   ; Vordergrundfarbe einstellen:
 1853                   
 1854 EB18  CD D421     INK:	CALL	ARGVL1		; Wert abholen
 1855 EB1B  FE 20       	CP	32
 1856 EB1D  30 3B       	JR	NC,FCERR	; FC-ERROR	(bisher SN-ERROR)
 1857 EB1F  87          	ADD	A,A
 1858 EB20  87          	ADD	A,A
 1859 EB21  87          	ADD	A,A
 1860 EB22  57          	LD	D,A
 1861 EB23  E5          	PUSH	HL
 1862 EB24  21 B7A3     	LD	HL,COLOR
 1863 EB27  CD EBCB     	CALL	IRMRD
 1864 EB2A  E1          	POP	HL
 1865 EB2B  E6 07       	AND	7
 1866 EB2D  18 21       	JR	COL2
 1867                   
 1868                   ; Vordergrund- und Hintergrundfarbe einstellen:
 1869                   
 1870 EB2F  CD C8BE     BCOLOR:	CALL	TCHAR1
 1871 EB32  28 26       	JR	Z,FCERR		; FC-ERROR	(bisher SN-ERROR)
 1872 EB34  CD EB18     	CALL	INK		; Vordergrund
 1873 EB37  CD C8BE     	CALL	TCHAR1
 1874 EB3A  C8          	RET	Z
 1875 EB3B  CD C8D6     	CALL	CPCOMM		; Komma?
 1876                   ;	JR	PAPER		; Hintergrund
 1877                   
 1878                   ; Hintergrundfarbe einstellen:
 1879                   
 1880 EB3E  CD D421     PAPER:	CALL	ARGVL1		; Wert abholen
 1881 EB41  FE 08       COL1:	CP	8
 1882 EB43  30 15       	JR	NC,FCERR	; FC-ERROR	(bisher SN-ERROR)
 1883 EB45  57          	LD	D,A
 1884 EB46  E5          	PUSH	HL
 1885 EB47  21 B7A3     	LD	HL,COLOR
 1886 EB4A  CD EBCB     	CALL	IRMRD
 1887 EB4D  E1          	POP	HL
 1888 EB4E  E6 F8       	AND	0F8H
 1889 EB50  B2          COL2:	OR	D

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 114
CE46    INC

 1890 EB51  E5          	PUSH	HL
 1891 EB52  21 B7A3     	LD	HL,COLOR
 1892 EB55  CD EBC7     	CALL	IRMWR		; neuer Farbwert
 1893 EB58  E1          	POP	HL
 1894 EB59  C9          	RET
 1895                   	;
 1896 EB5A  C3 C967     FCERR:	JP	FCER		; FC-ERROR
 1897                   
 1898                   ; String1 in String2 suchen
 1899                   
 1900 EB5D  CD CD36     INSTR:	CALL	SNALY6		; Klammer auf?
 1901 EB60  CD C8D6     	CALL	CPCOMM		; Komma?
 1902 EB63  E5          	PUSH	HL
 1903 EB64  CD D330     	CALL	LEN1		; Laenge holen
 1904 EB67  28 F1       	JR	Z,FCERR		; FC-ERROR
 1905 EB69  47          	LD	B,A
 1906 EB6A  23          	INC	HL
 1907 EB6B  23          	INC	HL
 1908 EB6C  5E          	LD	E,(HL)
 1909 EB6D  23          	INC	HL
 1910 EB6E  56          	LD	D,(HL)
 1911 EB6F  E1          	POP	HL
 1912 EB70  D5          	PUSH	DE
 1913 EB71  C5          	PUSH	BC
 1914 EB72  CD CD3A     	CALL	SNALY
 1915 EB75  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1916 EB78  C1          	POP	BC
 1917 EB79  D1          	POP	DE
 1918 EB7A  E5          	PUSH	HL
 1919 EB7B  D5          	PUSH	DE
 1920 EB7C  C5          	PUSH	BC
 1921 EB7D  CD D330     	CALL	LEN1		; Laenge holen
 1922 EB80  28 D8       	JR	Z,FCERR		; FC-ERROR
 1923 EB82  23          	INC	HL
 1924 EB83  23          	INC	HL
 1925 EB84  4E          	LD	C,(HL)
 1926 EB85  23          	INC	HL
 1927 EB86  66          	LD	H,(HL)
 1928 EB87  69          	LD	L,C
 1929 EB88  C1          	POP	BC
 1930 EB89  4F          	LD	C,A
 1931 EB8A  D1          	POP	DE
 1932 EB8B  E5          	PUSH	HL
 1933 EB8C  C5          INSTR0:	PUSH	BC
 1934 EB8D  D5          	PUSH	DE
 1935 EB8E  1A          	LD	A,(DE)
 1936 EB8F  BE          INSTR1:	CP	(HL)
 1937 EB90  28 0F       	JR	Z,INSTR5
 1938 EB92  23          	INC	HL
 1939 EB93  0D          	DEC	C
 1940 EB94  20 F9       	JR	NZ,INSTR1
 1941 EB96  AF          INSTR2:	XOR	A
 1942 EB97  E1          	POP	HL
 1943 EB98  E1          	POP	HL
 1944 EB99  E1          	POP	HL
 1945 EB9A  11 CDF3     INSTR3:	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 1946 EB9D  D5          	PUSH	DE
 1947 EB9E  C3 D0C0     	JP	POS1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 115
CE46    INC

 1948                   	;
 1949 EBA1  23          INSTR5:	INC	HL
 1950 EBA2  E5          	PUSH	HL
 1951 EBA3  2B          	DEC	HL
 1952 EBA4  23          INSTR6:	INC	HL
 1953 EBA5  0D          	DEC	C
 1954 EBA6  28 0E       	JR	Z,INSTR7
 1955 EBA8  13          	INC	DE
 1956 EBA9  05          	DEC	B
 1957 EBAA  28 11       	JR	Z,INSTR8
 1958 EBAC  1A          	LD	A,(DE)
 1959 EBAD  BE          	CP	(HL)
 1960 EBAE  28 F4       	JR	Z,INSTR6
 1961 EBB0  E1          	POP	HL
 1962 EBB1  D1          	POP	DE
 1963 EBB2  C1          	POP	BC
 1964 EBB3  0D          	DEC	C
 1965 EBB4  18 D6       	JR	INSTR0
 1966                   	;
 1967 EBB6  13          INSTR7:	INC	DE
 1968 EBB7  05          	DEC	B
 1969 EBB8  E1          	POP	HL
 1970 EBB9  20 DB       	JR	NZ,INSTR2
 1971 EBBB  18 01       	JR	INSTR9
 1972                   	;
 1973 EBBD  E1          INSTR8:	POP	HL
 1974 EBBE  D1          INSTR9:	POP	DE
 1975 EBBF  D1          	POP	DE
 1976 EBC0  D1          	POP	DE
 1977 EBC1  A7          	AND	A
 1978 EBC2  ED 52       	SBC	HL,DE
 1979 EBC4  7D          	LD	A,L
 1980 EBC5  18 D3       	JR	INSTR3
 1981                   
 1982                   ; Byte in IRM schreiben:
 1983                   
 1984 EBC7  1E 28       IRMWR:	LD	E,28H		; UP-Nr. fuer LDMA
 1985 EBC9  18 0D       	JR	JPV5
 1986                   
 1987                   ; Byte aus IRM lesen:
 1988                   
 1989 EBCB  1E 29       IRMRD:	LD	E,29H		; UP-Nr. fuer LDAM
 1990 EBCD  18 09       	JR	JPV5
 1991                   
 1992                   ; F-Taste belegen:
 1993                   
 1994 EBCF  CD D421     BKEY:	CALL	ARGVL1		; Wert abholen
 1995 EBD2  FE 10       	CP	16		; F0 ... F15 zugelassen
 1996 EBD4  30 6F       	JR	NC,SNERR4
 1997 EBD6  1E 39       	LD	E,39H		; UP-Nr. fuer KEY
 1998 EBD8  C3 F02B     JPV5:	JP	PV5
 1999                   
 2000                   ; F-Tasten auflisten:
 2001                   
 2002 EBDB              KEYLIST:
 2003 EBDB  1E 3A       	LD	E,3AH		; UP-Nr. fuer KEYLI
 2004 EBDD  18 F9       	JR	JPV5
 2005                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 116
CE46    INC

 2006                   ; Module schalten:
 2007                   
 2008 EBDF  CD D421     SWITCH:	CALL	ARGVL1		; Wert abholen
 2009 EBE2  F5          	PUSH	AF
 2010 EBE3  CD C8D6     	CALL	CPCOMM		; Komma?
 2011 EBE6  CD D421     	CALL	ARGVL1		; Wert abholen
 2012 EBE9  57          	LD	D,A		; Steuerbyte
 2013 EBEA  F1          	POP	AF
 2014 EBEB  E5          	PUSH	HL
 2015 EBEC  6F          	LD	L,A		; Steckplatz
 2016 EBED  3E 02       	LD	A,2		; schalten
 2017 EBEF  1E 26       	LD	E,26H		; UP-Nr. fuer MODU
 2018 EBF1  CD F02B     	CALL	PV5
 2019 EBF4  E1          	POP	HL
 2020 EBF5  C9          	RET
 2021                   
 2022                   ; Testen, ob Bildpunkt gesetzt ist:
 2023                   
 2024 EBF6  CD CDE1     PTEST:	CALL	SNLY14		; Syntax-Check '('
 2025 EBF9  E3          	EX	(SP),HL
 2026 EBFA  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2027 EBFD  D5          	PUSH	DE
 2028 EBFE  CD C96F     	CALL	EPRVL3
 2029 EC01  E5          	PUSH	HL
 2030 EC02  7B          	LD	A,E
 2031 EC03  21 B7D3     	LD	HL,HOR		; nur X-Koordinate eintragen
 2032 EC06  CD EBC7     	CALL	IRMWR
 2033 EC09  7A          	LD	A,D
 2034 EC0A  23          	INC	HL		; Y-Koordinate
 2035 EC0B  CD EBC7     	CALL	IRMWR
 2036 EC0E  1E 2F       	LD	E,2FH		; UP-Nr. fuer PUDE
 2037 EC10  CD F02B     	CALL	PV5
 2038 EC13  DA C967     	JP	C,FCER		; ausserhalb -> FC-ERROR
 2039 EC16  06 00       	LD	B,0
 2040 EC18  28 0C       	JR	Z,PTST1		; war geloescht
 2041 EC1A  23          	INC	HL
 2042 EC1B  23          	INC	HL
 2043 EC1C  CD EBC7     	CALL	IRMWR		; Grafikfarbe
 2044 EC1F  1E 30       	LD	E,30H		; UP-Nr. fuer PUSE
 2045 EC21  CD F02B     	CALL	PV5		; Punkt wieder setzen
 2046 EC24  06 01       	LD	B,1
 2047 EC26  78          PTST1:	LD	A,B		; Rueckgabewert
 2048 EC27  18 65       	JR	JHPOS		; POP HL, JP POS1
 2049                   
 2050                   ; IRM lesen (8000h bis BFFFh):
 2051                   
 2052 EC29  CD CDE1     VPEEK:	CALL	SNLY14		; Syntax-Check '('
 2053 EC2C  E3          	EX	(SP),HL
 2054 EC2D  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2055 EC30  D5          	PUSH	DE
 2056 EC31  CD C96F     	CALL	EPRVL3
 2057 EC34  E5          	PUSH	HL
 2058 EC35  21 8000     	LD	HL,8000H	; IRM-Offset
 2059 EC38  19          	ADD	HL,DE
 2060 EC39  38 0A       	JR	C,SNERR4	; < 8000h
 2061 EC3B  3E BF       	LD	A,0BFH
 2062 EC3D  BC          	CP	H
 2063 EC3E  38 05       	JR	C,SNERR4	; > BFFFh

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 117
CE46    INC

 2064 EC40  CD EBCB     	CALL	IRMRD
 2065 EC43  18 49       	JR	JHPOS		; POP HL, JP POS1
 2066                   
 2067 EC45  C3 C348     SNERR4:	JP	SNER		; SN-ERROR
 2068                   
 2069                   ; BASIC-Erweiterung 3: Funktionen
 2070                   
 2071 EC48  79          BEXP3:	LD	A,C
 2072 EC49  FE 62       	CP	62H
 2073 EC4B  28 DC       	JR	Z,VPEEK
 2074 EC4D  FE 6E       	CP	6EH
 2075 EC4F  28 A5       	JR	Z,PTEST
 2076 EC51  FE 7C       	CP	7CH
 2077 EC53  28 1A       	JR	Z,CSRLN
 2078 EC55  FE 76       	CP	76H
 2079 EC57  28 39       	JR	Z,VGET
 2080 EC59  D6 3E       	SUB	3EH
 2081 EC5B  38 E8       	JR	C,SNERR4
 2082 EC5D  FE 07       	CP	7
 2083 EC5F  30 E4       	JR	NC,SNERR4
 2084 EC61  EB          	EX	DE,HL
 2085 EC62  01 FDA7     	LD	BC,TOKJP	; Token-Adresstabelle
 2086 EC65  E1          	POP	HL
 2087 EC66  6F          	LD	L,A
 2088 EC67  09          	ADD	HL,BC
 2089 EC68  4E          	LD	C,(HL)
 2090 EC69  23          	INC	HL
 2091 EC6A  66          	LD	H,(HL)
 2092 EC6B  69          	LD	L,C
 2093 EC6C  E5          	PUSH	HL		; Routine
 2094 EC6D  EB          	EX	DE,HL		; anspringen
 2095 EC6E  C9          	RET
 2096                   
 2097                   ; aktuelle Zeilennummer holen:
 2098                   
 2099 EC6F  CD CDE1     CSRLN:	CALL	SNLY14		; Syntax-Check '('
 2100 EC72  E3          	EX	(SP),HL
 2101 EC73  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2102 EC76  D5          	PUSH	DE
 2103 EC77  CD D424     	CALL	ARGVL2
 2104 EC7A  E5          	PUSH	HL
 2105 EC7B  A7          	AND	A		; Fenster beruecksichtigen?
 2106 EC7C  3E 00       	LD	A,0
 2107 EC7E  20 06       	JR	NZ,CSRLN1
 2108 EC80  21 B79D     	LD	HL,WINON+1
 2109 EC83  CD EBCB     	CALL	IRMRD
 2110 EC86  47          CSRLN1:	LD	B,A
 2111 EC87  21 B7A1     	LD	HL,CURSO+1
 2112 EC8A  CD EBCB     	CALL	IRMRD
 2113 EC8D  80          	ADD	A,B		; aktuelle Zeile
 2114 EC8E  E1          JHPOS:	POP	HL
 2115 EC8F  C3 D0C0     CSRLN2:	JP	POS1
 2116                   
 2117                   ; Zeichen von Bildschirm zurueck lesen
 2118                   
 2119 EC92  E3          VGET:	EX	(SP),HL
 2120 EC93  3E 01       	LD	A,1
 2121 EC95  CD D17B     	CALL	STADTB

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 118
CE46    INC

 2122 EC98  CD F082     	CALL	IRMON
 2123 EC9B  ED 5B B7A0  	LD	DE,(CURSO)
 2124 EC9F  CD E06D     	CALL	DABR
 2125 ECA2  7E          	LD	A,(HL)
 2126 ECA3  CD F09F     	CALL	IRMOF
 2127 ECA6  C3 EA7D     	JP	INKEY1		; als Zeichen zurueckgeben
 2128                   
 2129                   ; Kanal schliessen:
 2130                   
 2131 ECA9  0E 00       CLOSE:	LD	C,0
 2132 ECAB  7E          	LD	A,(HL)
 2133 ECAC  FE 49       	CP	'I'		; Eingabe?
 2134 ECAE  28 05       	JR	Z,CLOS1
 2135 ECB0  0C          	INC	C
 2136 ECB1  FE 4F       	CP	'O'		; Ausgabe?
 2137 ECB3  20 90       	JR	NZ,SNERR4
 2138 ECB5  C5          CLOS1:	PUSH	BC
 2139 ECB6  23          	INC	HL
 2140 ECB7  7E          	LD	A,(HL)
 2141 ECB8  FE 23       	CP	'#'
 2142 ECBA  20 89       CLOS2:	JR	NZ,SNERR4	; SN-ERROR
 2143 ECBC  23          	INC	HL
 2144 ECBD  CD D421     	CALL	ARGVL1		; Wert abholen
 2145 ECC0  E6 03       	AND	3		; 4 Geraete
 2146 ECC2  C1          	POP	BC
 2147 ECC3  C8          	RET	Z		; Console -> nichts tun
 2148 ECC4  E5          	PUSH	HL
 2149 ECC5  17          	RLA			; *2
 2150 ECC6  81          	ADD	A,C		; Ein-/Ausgabe
 2151 ECC7  F5          	PUSH	AF
 2152 ECC8  3D          	DEC	A
 2153 ECC9  47          	LD	B,A
 2154 ECCA  3E FF       	LD	A,-1
 2155 ECCC  17          CLOS3:	RLA			; Bit platzieren
 2156 ECCD  10 FD       	DJNZ	CLOS3
 2157 ECCF  21 0307     	LD	HL,IOCHNL	; E/A-Flag
 2158 ECD2  A6          	AND	(HL)		; Bit loeschen
 2159 ECD3  77          	LD	(HL),A
 2160 ECD4  F1          	POP	AF
 2161 ECD5  E1          	POP	HL
 2162 ECD6  CB F7       	SET	6,A		; close
 2163 ECD8  D5          	PUSH	DE
 2164 ECD9  5F          	LD	E,A
 2165 ECDA  16 03       	LD	D,3		; BRK-Code
 2166 ECDC  CD E00E     	CALL	BASIO		; Kanal schliessen
 2167 ECDF  D1          	POP	DE
 2168 ECE0  C9          	RET
 2169                   
 2170                   ; BASIC-Erweiterung JOYST(i)
 2171                   ; kompatibel zum KC 87 mit einem Joystick
 2172                   ;
 2173 ECE1  CD CDE1     JOYST:	CALL	SNLY14		; Syntax-Check '('
 2174 ECE4  E5          	PUSH	HL
 2175 ECE5  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2176 ECE8  D5          	PUSH	DE
 2177 ECE9  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 2178 ECEC  7B          	LD	A,E
 2179 ECED  3D          	DEC	A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 119
CE46    INC

 2180 ECEE  B2          	OR	D		; Argument gleich 1?
 2181 ECEF  3E 00       	LD	A,0
 2182 ECF1  20 9C       	JR	NZ,CSRLN2	; nein: Rueckgabewert 0
 2183 ECF3  DB 90       	IN	A,(90h)		; M008 PIO A Daten
 2184 ECF5  2F          	CPL
 2185 ECF6  57          	LD	D,A
 2186 ECF7  E6 0F       	AND	00001111b	; nur Richtungsbits, CY=0
 2187 ECF9  1F          	RRA
 2188 ECFA  30 02       	JR	NC,JOYST1
 2189 ECFC  F6 10       	OR	00010000b	; <Up> auf Bit 3, CY=0
 2190 ECFE  1F          JOYST1:	RRA
 2191 ECFF  30 02       	JR	NC,JOYST2
 2192 ED01  F6 04       	OR	00000100b	; <Down> auf Bit 2
 2193 ED03  5F          JOYST2:	LD	E,A
 2194 ED04  3E 30       	LD	A,00110000b	; Feuertasten
 2195 ED06  A2          	AND	D
 2196 ED07  B3          	OR	E
 2197 ED08  18 85       	JR	CSRLN2		; Rueckgabewert in A
 2198                   
 2199                   ; Zufallsgenerator:
 2200                   
 2201 ED0A  ED 5F       RANDOM:	LD	A,R
 2202 ED0C  32 031D     	LD	(RNDVR3+2),A
 2203 ED0F  C9          	RET
 2204                   
 2205                   ; Kanal oeffnen:
 2206                   
 2207 ED10  7E          OPEN:	LD	A,(HL)
 2208 ED11  23          	INC	HL
 2209 ED12  FE 49       	CP	'I'		; Eingabe?
 2210 ED14  28 19       	JR	Z,OPEN1
 2211 ED16  FE 4F       	CP	'O'		; Ausgabe?
 2212 ED18  20 A0       	JR	NZ,CLOS2	; SN-ERROR
 2213 ED1A  CD DE25     	CALL	OUTCHL		; Kanal-Ausgabe
 2214 ED1D  CD DDC8     	CALL	TESTCO
 2215 ED20  C8          	RET	Z
 2216 ED21  3E D5       	LD	A,0D5H		; *.UUU
 2217 ED23  CD DCB2     	CALL	CASS1		; Dateiname aufbereiten
 2218 ED26  21 03EA     	LD	HL,INTPRB	; Druckpuffer=Dateiname
 2219 ED29  AF          	XOR	A
 2220 ED2A  CD DDD5     	CALL	CO		; Ausgabe eines Zeichens
 2221 ED2D  E1          	POP	HL
 2222 ED2E  C9          	RET
 2223                   	;
 2224 ED2F  CD DE5F     OPEN1:	CALL	INCHNL		; Kanal-Eingabe
 2225 ED32  3A 0309     	LD	A,(ININD)	; IN-Index
 2226 ED35  E6 03       	AND	3
 2227 ED37  C8          	RET	Z
 2228 ED38  3E D5       	LD	A,0D5H		; *.UUU
 2229 ED3A  CD DCB2     	CALL	CASS1		; Dateiname aufbereiten
 2230 ED3D  21 03EA     	LD	HL,INTPRB	; Druckpuffer=Dateiname
 2231 ED40  CD DDE4     	CALL	CI		; Eingabe eines Zeichens
 2232 ED43  E1          	POP	HL
 2233 ED44  C9          	RET
 2234                   
 2235                   ; Linie zeichnen:
 2236                   
 2237 ED45  01 043E     BLINE:	LD	BC,43EH		; 4 Parameter, LINE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 120
CE46    INC

 2238 ED48  18 03       	JR	GRAPH
 2239                   
 2240                   ; Kreis zeichnen:
 2241                   
 2242 ED4A  01 033F     CIRCLE:	LD	BC,33FH		; 3 Parameter, CIRCLE
 2243 ED4D  C5          GRAPH:	PUSH	BC
 2244 ED4E  CD C96C     	CALL	EPRVL4
 2245 ED51  C1          	POP	BC
 2246 ED52  C5          	PUSH	BC
 2247 ED53  E5          	PUSH	HL
 2248 ED54  21 B782     	LD	HL,ARG1
 2249 ED57  7B          GRAPH1:	LD	A,E
 2250 ED58  CD EBC7     	CALL	IRMWR		; Ablage der Parameter
 2251 ED5B  23          	INC	HL
 2252 ED5C  7A          	LD	A,D
 2253 ED5D  CD EBC7     	CALL	IRMWR
 2254 ED60  23          	INC	HL
 2255 ED61  05          	DEC	B
 2256 ED62  28 0C       	JR	Z,GRAPH2	; fertig
 2257 ED64  E3          	EX	(SP),HL
 2258 ED65  C5          	PUSH	BC
 2259 ED66  CD C8D6     	CALL	CPCOMM		; Komma?
 2260 ED69  CD C96C     	CALL	EPRVL4		; naechsten Wert
 2261 ED6C  C1          	POP	BC
 2262 ED6D  E3          	EX	(SP),HL
 2263 ED6E  18 E7       	JR	GRAPH1
 2264                   	;
 2265 ED70  E1          GRAPH2:	POP	HL
 2266 ED71  CD EB04     	CALL	GFARB
 2267 ED74  D1          	POP	DE
 2268 ED75  C3 F02B     	JP	PV5
 2269                   
 2270                   ; Laufwerk wechseln
 2271                   ;	Aufruf: DRIVE Lw[,User]
 2272                   ;	Lw = Laufwerk 0..15 fuer A: bis P:
 2273                   ;	User = 0..31 (2. Parameter optional)
 2274                   
 2275 ED78  01 B3F3     BDRIVE:	LD	BC,UROK		; 0B3F3H
 2276 ED7B  ED 78       	IN	A,(C)
 2277 ED7D  FE 05       	CP	5		; D004 KC-Betriebsart?
 2278 ED7F  20 3F       	JR	NZ,BDR2		; nein -> SN-ERROR
 2279 ED81  01 83F1     	LD	BC,DEPVER	; 083F1H
 2280 ED84  ED 78       	IN	A,(C)
 2281 ED86  FE 20       	CP	20H		; DEP ab 2.0?
 2282 ED88  38 36       	JR	C,BDR2		; nein -> SN-ERROR
 2283 ED8A  CD D421     	CALL	ARGVL1		; Wert holen
 2284 ED8D  FE 10       	CP	16
 2285 ED8F  30 2F       	JR	NC,BDR2		; Laufwerk > 15
 2286 ED91  C6 41       	ADD	A,'A'		; in A..P konvertieren
 2287 ED93  01 81F1     	LD	BC,LWANF
 2288 ED96  ED 79       	OUT	(C),A		; LW-Anforderung
 2289 ED98  CD C8BE     	CALL	TCHAR1		; weiterer Parameter?
 2290 ED9B  3E 03       	LD	A,3		; nur LW-Wechsel
 2291 ED9D  28 11       	JR	Z,BDR1
 2292 ED9F  CD C8D6     	CALL	CPCOMM		; Komma?
 2293 EDA2  CD D421     	CALL	ARGVL1		; optionalen 2. Wert holen
 2294 EDA5  FE 20       	CP	32
 2295 EDA7  30 17       	JR	NC,BDR2		; USER > 31

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 121
CE46    INC

 2296 EDA9  01 82F1     	LD	BC,UANF
 2297 EDAC  ED 79       	OUT	(C),A		; USER-Anforderung
 2298 EDAE  3E 07       	LD	A,7		; Laufwerk+USER wechseln
 2299 EDB0  CD F082     BDR1:	CALL	IRMON		; IRM ein
 2300 EDB3  CD FBAD     	CALL	CON		; CAOS-C ein
 2301 EDB6  CD D799     	CALL	DRIVE5		; ueber Steuerbyte 2 anfordern
 2302 EDB9  CD FBBA     	CALL	COFF		; CAOS-C aus
 2303 EDBC  CD F09F     	CALL	IRMOF		; IRM aus
 2304 EDBF  C9          	RET
 2305 EDC0  C3 C348     BDR2:	JP	SNER		; SN-ERROR
 2306                   
 2307                   ; Sprung zu ?IO ERROR
 2308 EDC3  CD FBBA     JIOERR:	CALL	COFF
 2309 EDC6  2A B7C9     	LD	HL,(IOERR)
 2310 EDC9  CD F09F     	CALL	IRMOF
 2311 EDCC  E9          	JP	(HL)
 2312                   
 2313                   ; Initialisierungstabelle fuer M021:
 2314                   
 2315 EDCD  03          CENINI:	DB	3
 2316                   
 2317 EDCE  92 05       JOYINI:	 DB	92h,5		; PIO-A Steuerwort
 2318 EDD0  E0          	  DB	0E0h		; Interruptvektor
 2319 EDD1  CF          	  DB	11001111b	; Einzelbit-Steuermodus
 2320 EDD2  7F          	  DB	01111111b	; Nur Bit 7 = Ausgabe (Strobe)
 2321 EDD3  97          	  DB	10010111b	; Interrupt bei jeder Bitaenderung
 2322 EDD4  C0          	  DB	11000000b	; Ueberwache Bits 0..5
 2323                   
 2324 EDD5  93 02       	 DB	93h,2		; PIO-B Steuerwort
 2325 EDD7  CF          	  DB	11001111b	; Bitbetrieb
 2326 EDD8  00          	  DB	00000000b	; alles Ausgaenge
 2327                   
 2328 EDD9  90 01       	 DB	90h,1		; PIO-A Daten
 2329 EDDB  80          	  DB	10000000b	; Strobe passiv
 2330                   
 2331                   	ABSFILL	0EDFFh,<ROM-E-Ende>
    7 EDDC  FF FF FF FF 	  DS	0EDFFh - $,0FFh
 2332                   
 2333 EDFF              VERSION:
 2334 EDFF  46          	DB	46H		; CAOS-Version 4.6
  146                   	INCLUDE ZSGROSS.INC	; Zeichensatz Grossbuchstaben
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 Zeichensatz Gross	**
    3                   ;**					**
    4                   ;**	Adresse:  EE00h bis EFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 13.05.2010	**
    7                   ;*****************************************
    8                   
    9 EE00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 000H, 000H	; 20H
   10 EE08  30 78 78 30 	DB	030H, 078H, 078H, 030H, 030H, 000H, 030H, 000H	; 21H !
   11 EE10  77 33 66 00 	DB	077H, 033H, 066H, 000H, 000H, 000H, 000H, 000H	; 22H "
   12 EE18  36 36 FE 6C 	DB	036H, 036H, 0FEH, 06CH, 0FEH, 0D8H, 0D8H, 000H	; 23H #
   13 EE20  18 3E 6C 3E 	DB	018H, 03EH, 06CH, 03EH, 01BH, 01BH, 07EH, 018H	; 24H $
   14 EE28  00 C6 CC 18 	DB	000H, 0C6H, 0CCH, 018H, 030H, 066H, 0C6H, 000H	; 25H %
   15 EE30  38 6C 38 76 	DB	038H, 06CH, 038H, 076H, 0DCH, 0CCH, 076H, 000H	; 26H &
   16 EE38  1C 0C 18 00 	DB	01CH, 00CH, 018H, 000H, 000H, 000H, 000H, 000H	; 27H '
   17 EE40  18 30 60 60 	DB	018H, 030H, 060H, 060H, 060H, 030H, 018H, 000H	; 28H (

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 122
ZSGROSS INC

   18 EE48  60 30 18 18 	DB	060H, 030H, 018H, 018H, 018H, 030H, 060H, 000H	; 29H )
   19 EE50  00 66 3C FF 	DB	000H, 066H, 03CH, 0FFH, 03CH, 066H, 000H, 000H	; 2AH *
   20 EE58  00 30 30 FC 	DB	000H, 030H, 030H, 0FCH, 030H, 030H, 000H, 000H	; 2BH +
   21 EE60  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 01CH, 00CH, 018H	; 2CH ,
   22 EE68  00 00 00 FE 	DB	000H, 000H, 000H, 0FEH, 000H, 000H, 000H, 000H	; 2DH -
   23 EE70  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 030H, 030H, 000H	; 2EH .
   24 EE78  06 0C 18 30 	DB	006H, 00CH, 018H, 030H, 060H, 0C0H, 080H, 000H	; 2FH /
   25                   
   26 EE80  7C C6 CE DE 	DB	07CH, 0C6H, 0CEH, 0DEH, 0F6H, 0E6H, 07CH, 000H	; 30H 0
   27 EE88  30 70 30 30 	DB	030H, 070H, 030H, 030H, 030H, 030H, 0FCH, 000H	; 31H 1
   28 EE90  78 CC 0C 38 	DB	078H, 0CCH, 00CH, 038H, 060H, 0CCH, 0FCH, 000H	; 32H 2
   29 EE98  FC 18 30 78 	DB	0FCH, 018H, 030H, 078H, 00CH, 0CCH, 078H, 000H	; 33H 3
   30 EEA0  1C 3C 6C CC 	DB	01CH, 03CH, 06CH, 0CCH, 0FEH, 00CH, 01EH, 000H	; 34H 4
   31 EEA8  FC C0 F8 0C 	DB	0FCH, 0C0H, 0F8H, 00CH, 00CH, 0CCH, 078H, 000H	; 35H 5
   32 EEB0  38 60 C0 F8 	DB	038H, 060H, 0C0H, 0F8H, 0CCH, 0CCH, 078H, 000H	; 36H 6
   33 EEB8  FC CC 0C 18 	DB	0FCH, 0CCH, 00CH, 018H, 030H, 030H, 030H, 000H	; 37H 7
   34 EEC0  78 CC CC 78 	DB	078H, 0CCH, 0CCH, 078H, 0CCH, 0CCH, 078H, 000H	; 38H 8
   35 EEC8  78 CC CC 7C 	DB	078H, 0CCH, 0CCH, 07CH, 00CH, 018H, 070H, 000H	; 39H 9
   36 EED0  00 00 30 30 	DB	000H, 000H, 030H, 030H, 000H, 030H, 030H, 000H	; 3AH :
   37 EED8  00 00 30 30 	DB	000H, 000H, 030H, 030H, 000H, 030H, 030H, 060H	; 3BH ;
   38 EEE0  18 30 60 C0 	DB	018H, 030H, 060H, 0C0H, 060H, 030H, 018H, 000H	; 3CH <
   39 EEE8  00 00 FC 00 	DB	000H, 000H, 0FCH, 000H, 0FCH, 000H, 000H, 000H	; 3DH =
   40 EEF0  60 30 18 0C 	DB	060H, 030H, 018H, 00CH, 018H, 030H, 060H, 000H	; 3EH >
   41 EEF8  78 CC 0C 18 	DB	078H, 0CCH, 00CH, 018H, 030H, 000H, 030H, 000H	; 3FH ?
   42                   
   43 EF00  7C C6 DE D6 	DB	07CH, 0C6H, 0DEH, 0D6H, 0DEH, 0C0H, 078H, 000H	; 40H @
   44 EF08  30 78 CC CC 	DB	030H, 078H, 0CCH, 0CCH, 0FCH, 0CCH, 0CCH, 000H	; 41H A
   45 EF10  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 066H, 066H, 0FCH, 000H	; 42H B
   46 EF18  3C 66 C0 C0 	DB	03CH, 066H, 0C0H, 0C0H, 0C0H, 066H, 03CH, 000H	; 43H C
   47 EF20  F8 6C 66 66 	DB	0F8H, 06CH, 066H, 066H, 066H, 06CH, 0F8H, 000H	; 44H D
   48 EF28  FE 62 68 78 	DB	0FEH, 062H, 068H, 078H, 068H, 062H, 0FEH, 000H	; 45H E
   49 EF30  FE 62 68 78 	DB	0FEH, 062H, 068H, 078H, 068H, 060H, 0F0H, 000H	; 46H F
   50 EF38  3C 66 C0 C0 	DB	03CH, 066H, 0C0H, 0C0H, 0CEH, 066H, 03CH, 000H	; 47H G
   51 EF40  CC CC CC FC 	DB	0CCH, 0CCH, 0CCH, 0FCH, 0CCH, 0CCH, 0CCH, 000H	; 48H H
   52 EF48  78 30 30 30 	DB	078H, 030H, 030H, 030H, 030H, 030H, 078H, 000H	; 49H I
   53 EF50  1E 0C 0C 0C 	DB	01EH, 00CH, 00CH, 00CH, 0CCH, 0CCH, 078H, 000H	; 4AH J
   54 EF58  E6 66 6C 70 	DB	0E6H, 066H, 06CH, 070H, 06CH, 066H, 0E6H, 000H	; 4BH K
   55 EF60  F0 60 60 60 	DB	0F0H, 060H, 060H, 060H, 062H, 066H, 0FEH, 000H	; 4CH L
   56 EF68  C6 EE FE D6 	DB	0C6H, 0EEH, 0FEH, 0D6H, 0C6H, 0C6H, 0C6H, 000H	; 4DH M
   57 EF70  C6 E6 F6 DE 	DB	0C6H, 0E6H, 0F6H, 0DEH, 0CEH, 0C6H, 0C6H, 000H	; 4EH N
   58 EF78  38 6C C6 C6 	DB	038H, 06CH, 0C6H, 0C6H, 0C6H, 06CH, 038H, 000H	; 4FH O
   59                   
   60 EF80  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 060H, 060H, 0F0H, 000H	; 50H P
   61 EF88  78 CC CC CC 	DB	078H, 0CCH, 0CCH, 0CCH, 0DCH, 078H, 01CH, 000H	; 51H Q
   62 EF90  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 06CH, 066H, 0E6H, 000H	; 52H R
   63 EF98  7C C6 F0 3C 	DB	07CH, 0C6H, 0F0H, 03CH, 00EH, 0C6H, 07CH, 000H	; 53H S
   64 EFA0  FC B4 30 30 	DB	0FCH, 0B4H, 030H, 030H, 030H, 030H, 078H, 000H	; 54H T
   65 EFA8  CC CC CC CC 	DB	0CCH, 0CCH, 0CCH, 0CCH, 0CCH, 0CCH, 078H, 000H	; 55H U
   66 EFB0  CC CC CC 78 	DB	0CCH, 0CCH, 0CCH, 078H, 078H, 030H, 030H, 000H	; 56H V
   67 EFB8  C6 C6 C6 D6 	DB	0C6H, 0C6H, 0C6H, 0D6H, 0FEH, 0EEH, 0C6H, 000H	; 57H W
   68 EFC0  C6 C6 6C 38 	DB	0C6H, 0C6H, 06CH, 038H, 06CH, 0C6H, 0C6H, 000H	; 58H X
   69 EFC8  CC CC CC 78 	DB	0CCH, 0CCH, 0CCH, 078H, 030H, 030H, 078H, 000H	; 59H Y
   70 EFD0  FE C6 8C 18 	DB	0FEH, 0C6H, 08CH, 018H, 032H, 066H, 0FEH, 000H	; 5AH Z
   71 EFD8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH	; 5BH Vollzeichen
   72 EFE0  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 018H, 018H, 000H	; 5CH senkr. Strich
   73 EFE8  00 FE 06 06 	DB	000H, 0FEH, 006H, 006H, 000H, 000H, 000H, 000H	; 5DH Negationszeichen
   74 EFF0  10 38 6C C6 	DB	010H, 038H, 06CH, 0C6H, 000H, 000H, 000H, 000H	; 5EH ^
   75 EFF8  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 000H, 0FFH	; 5FH _

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 123
CAOS46  Z80

  147                   
  148                   	INCLUDE	CF46.INC	; ROM-F (F000-FDFF)
    1                   ;*****************************************
    2                   ;**	CAOS 4.6	ROM F		**
    3                   ;**					**
    4                   ;**	Adresse:  F000h bis FDFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 05.03.2016	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0F000H
   10                   
   11 F000  C3 F15F     	JP	PWRON
   12 F003  C3 F04F     	JP	PV1		; DEFB nr
   13 F006  C3 F06B     	JP	PV2		; (ARGC)=nr
   14 F009  C3 F07F     	JP	PV3		; E=nr
   15 F00C  C3 F037     	JP	PV4		; E=nr, IRM e/a
   16 F00F  C3 F0B6     	JP	RCALL		; DEFW offset
   17 F012  C3 F166     	JP	BYE		; JUMP-Einsprung
   18 F015  C3 F02B     	JP	PV5		; E=nr, IRM/Stack
   19 F018  C3 F082     	JP	IRMON
   20 F01B  C3 F09F     	JP	IRMOF
   21 F01E  C3 F022     	JP	PV6		; (ARGC)=nr
   22 F021  C9          JDISK:	RET			; DISK-Verteiler - entfernt in CAOS 4.6 !!!
   23                   ;	CALL	CON
   24                   ;	CALL	JDISC
   25                   ;	JP	COFF
   26                   
   27 F022  C5          PV6:	PUSH	BC
   28 F023  CD F082     	CALL	IRMON
   29 F026  CD F06B     	CALL	PV2
   30 F029  18 07       	JR	PV51
   31                   
   32 F02B  C5          PV5:	PUSH	BC
   33 F02C  CD F082     	CALL	IRMON
   34 F02F  CD F07F     	CALL	PV3
   35 F032  CD F09F     PV51:	CALL	IRMOF
   36 F035  C1          	POP	BC
   37 F036  C9          	RET
   38                   
   39 F037  CD F046     PV4:	CALL	SCRON
   40 F03A  CD F07F     	CALL	PV3
   41 F03D  F5          SCROFF:	PUSH	AF
   42 F03E  DB 88       	IN	A,(PIOAD)
   43 F040  E6 FB       	AND	11111011b	; IRM aus
   44 F042  D3 88       	OUT	(PIOAD),A
   45 F044  F1          	POP	AF
   46 F045  C9          	RET
   47                   
   48 F046  F5          SCRON:	PUSH	AF
   49 F047  DB 88       	IN	A,(PIOAD)
   50 F049  F6 04       	OR	00000100b	; IRM ein
   51 F04B  D3 88       	OUT	(PIOAD),A
   52 F04D  F1          	POP	AF
   53 F04E  C9          	RET
   54                   
   55 F04F  F3          PV1:	DI
   56 F050  E5          	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 124
CF46    INC

   57 F051  E1          	POP	HL
   58 F052  E1          	POP	HL
   59 F053  23          	INC	HL		; nr uebergehen
   60 F054  E5          	PUSH	HL
   61 F055  2B          	DEC	HL		; (HL)=nr
   62 F056  3B          	DEC	SP
   63 F057  3B          	DEC	SP
   64 F058  FB          	EI
   65 F059  F5          	PUSH	AF
   66 F05A  D5          	PUSH	DE
   67 F05B  5E          	LD	E,(HL)
   68 F05C  16 00       PV22:	LD	D,0
   69 F05E  2A B7B0     	LD	HL,(SUTAB)
   70 F061  19          	ADD	HL,DE
   71 F062  19          	ADD	HL,DE		; HL=Pos. in Tab
   72 F063  5E          	LD	E,(HL)
   73 F064  23          	INC	HL
   74 F065  56          	LD	D,(HL)
   75 F066  EB          	EX	DE,HL
   76 F067  D1          	POP	DE
   77 F068  F1          	POP	AF
   78 F069  E3          EXRT:	EX	(SP),HL
   79 F06A  C9          	RET			; UP anspringen
   80                   
   81 F06B  A7          PV2:	AND	A		; VR: F
   82 F06C  E5          PV21:	PUSH	HL
   83 F06D  D5          	PUSH	DE
   84 F06E  C5          	PUSH	BC
   85 F06F  E5          	PUSH	HL
   86 F070  21 F3FC     	LD	HL,POP3		; Returnadresse
   87 F073  E3          	EX	(SP),HL		; kellern
   88 F074  E5          	PUSH	HL
   89 F075  F5          	PUSH	AF
   90 F076  D5          	PUSH	DE
   91 F077  38 E3       	JR	C,PV22		; falls PV3
   92 F079  3A B780     	LD	A,(ARGC)	; sonst E
   93 F07C  5F          	LD	E,A		; beschaffen
   94 F07D  18 DD       	JR	PV22
   95                   
   96 F07F  37          PV3:	SCF			; VR: F
   97 F080  18 EA       	JR	PV21
   98                   
   99 F082  C1          IRMON:	POP	BC		; Rueckkehradresse
  100 F083  FD E5       	PUSH	IY
  101 F085  FD 21 0000  	LD	IY,0		; SP in IY merken
  102 F089  FD 39       	ADD	IY,SP		; (kein UP veraendert IY!)
  103 F08B  F3          	DI
  104 F08C  DD 77 0B    	LD	(IX+11),A
  105 F08F  DB 88       	IN	A,(PIOAD)
  106 F091  F6 24       	OR	00100100b	; IRM+LED ein
  107 F093  D3 88       	OUT	(PIOAD),A
  108 F095  ED 7B B7AE  	LD	SP,(SYSP)
  109 F099  FB          	EI
  110 F09A  DD 7E 0B    	LD	A,(IX+11)
  111 F09D  C5          	PUSH	BC
  112 F09E  C9          	RET			; wie JP (BC)
  113                   
  114 F09F  C1          IRMOF:	POP	BC		; analog IRMON

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 125
CF46    INC

  115 F0A0  DD 77 0B    	LD	(IX+11),A
  116 F0A3  DB 88       	IN	A,(PIOAD)
  117 F0A5  CB 97       	RES	2,A		; IRM+LED aus
  118 F0A7  CB AF       	RES	5,A		; (F unveraendert)
  119 F0A9  F3          	DI
  120 F0AA  D3 88       	OUT	(PIOAD),A
  121 F0AC  FD F9       	LD	SP,IY
  122 F0AE  FB          	EI
  123 F0AF  DD 7E 0B    	LD	A,(IX+11)
  124 F0B2  FD E1       	POP	IY
  125 F0B4  C5          	PUSH	BC
  126 F0B5  C9          	RET
  127                   
  128                   ; Relativer UP-Aufruf ohne Registerzerstoerung:
  129                   
  130 F0B6  E3          RCALL:	EX	(SP),HL
  131 F0B7  D5          	PUSH	DE
  132 F0B8  5E          	LD	E,(HL)
  133 F0B9  23          	INC	HL
  134 F0BA  56          	LD	D,(HL)		; DE=Offset
  135 F0BB  23          	INC	HL
  136 F0BC  EB          	EX	DE,HL
  137 F0BD  19          	ADD	HL,DE		; addieren
  138 F0BE  E3          	EX	(SP),HL		; Zieladresse
  139 F0BF  EB          	EX	DE,HL		; DE von Stack
  140 F0C0  F3          	DI
  141 F0C1  33          	INC	SP
  142 F0C2  33          	INC	SP
  143 F0C3  E3          	EX	(SP),HL		; HL von Stack
  144 F0C4  3B          	DEC	SP
  145 F0C5  3B          	DEC	SP
  146 F0C6  FB          	EI
  147 F0C7  C9          	RET			; Ziel anspringen
  148                   
  149 F0C8  DD 7E 02    BNROST:	LD	A,(IX+2)	; Blocknummer
  150 F0CB  CD F3D4     AHOSTR:	CALL	AHEX		; Register A und folgende Zeichenkette
  151 F0CE  E3          OSTR:	EX	(SP),HL		; **23**
  152 F0CF  7E          OSTR1:	LD	A,(HL)		; ausgeben
  153 F0D0  23          	INC	HL
  154 F0D1  A7          	AND	A		; bis NUL-Byte
  155 F0D2  28 95       	JR	Z,EXRT
  156 F0D4  CD F3E5     	CALL	OCHR
  157 F0D7  18 F6       	JR	OSTR1
  158                   
  159                   ; Module listen, lesen, schalten:
  160                   
  161 F0D9  7F7F        SWI7F:	DW	7F7FH
  162 F0DB  53 57 49 54 	DB	'SWITCH'
  163 F0E1  01          	DB	1
  164 F0E2  A7          	AND	A		; Argumente?
  165 F0E3  28 08       	JR	Z,MLIST
  166 F0E5  CD FBAD     	CALL	CON
  167 F0E8  CD C31E     	CALL	SWIC		; lesen/schalten
  168 F0EB  18 20       	JR	MCOFF
  169                   	;
  170 F0ED  CD F0F8     MLIST:	CALL	ESC6		; interne Module listen
  171                   	;
  172 F0F0  CD FBAD     ESC5:	CALL	CON

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 126
CF46    INC

  173 F0F3  CD C257     	CALL	MODULC		; externe Module listen
  174 F0F6  18 06       	JR	ESC61
  175                   
  176                   ;SYS7F:	DW	7F7FH		; Dieses Menuewort ist in CAOS 4.6 nicht
  177                   ;	DB	'SYSTEM'	; mehr erforderlich - macht SWITCH mit!
  178                   ;	DB	11H
  179 F0F8  CD FBAD     ESC6:	CALL	CON
  180 F0FB  CD C172     	CALL	SYSTC		; Systemcheck (interne Module 0-5)
  181 F0FE  ED 5B B7A0  ESC61:	LD	DE,(CURSO)	; aktuelle Cursorposition mitnehmen
  182 F102  18 09       	JR	MCOFF
  183                   
  184                   ; Module lesen und Schalten
  185 F104  3E 02       MODUL2:	LD	A,2
  186 F106  6F          	LD	L,A
  187 F107  CD FBAD     MODU:	CALL	CON		; **26**
  188 F10A  CD C36D     	CALL	MODUC
  189 F10D  C3 FBBA     MCOFF:	JP	COFF
  190                   
  191 F110  CD FBAD     ESCD:	CALL	CON		; DEVICE-Umschaltung
  192 F113  CD D6FF     	CALL	ESCDD
  193 F116  18 E6       	JR	ESC61
  194                   
  195                   ; Betriebssystem wechseln:
  196                   
  197 F118  7F7F        JUMP7F:	DW	7F7FH
  198 F11A  4A 55 4D 50 	DB	'JUMP'
  199 F11E  03          	DB	3
  200 F11F  7D          	LD	A,L
  201 F120  47          JUMP:	LD	B,A		; **27**
  202 F121  0E 80       	LD	C,80H
  203 F123  ED 78       	IN	A,(C)
  204 F125  3C          	INC	A		; Kennbyte FF?
  205 F126  20 13       	JR	NZ,JUM0
  206 F128  CD F0CE     	CALL	OSTR
  207 F12B  4B 65 69 6E 	DB	'Kein Modul!'
  208 F136  07 0D 0A 00 	DB	7,CR,LF,0
  209 F13A  C9          	RET
  210                   	;
  211 F13B  C5          JUM0:	PUSH	BC
  212 F13C  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
  213 F13E  06 07       	LD	B,7		; ab Platz 7!
  214 F140  04          JUM1:	INC	B
  215 F141  28 0D       	JR	Z,JUM2		; bis FF
  216 F143  ED 78       	IN	A,(C)
  217 F145  2F          	CPL
  218 F146  E6 70       	AND	70H		; Speichermodul?
  219 F148  20 F6       	JR	NZ,JUM1
  220 F14A  ED 79       	OUT	(C),A		; aus
  221 F14C  68          	LD	L,B
  222 F14D  77          	LD	(HL),A
  223 F14E  18 F0       	JR	JUM1
  224                   	;
  225 F150  C1          JUM2:	POP	BC
  226 F151  3E FF       	LD	A,0FFH		; Ausgabe FF
  227 F153  68          	LD	L,B
  228 F154  77          	LD	(HL),A		; Eintrag
  229 F155  F3          	DI
  230 F156  ED 79       	OUT	(C),A		; einschalten

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 127
CF46    INC

  231 F158  DB 88       	IN	A,(PIOAD)
  232 F15A  E6 7E       	AND	01111110b
  233 F15C  C3 B7B4     	JP	BJUMP		; in IRM
  234                   
  235                   ; Einschalt-Initialisierung:
  236                   
  237 F15F  3E E3       PWRON:	LD	A,0E3H		; RAM4 WR einschalten,
  238 F161  D3 86       	OUT	(86H),A		; und CAOS-C ein
  239 F163  C3 C061     	JP	PWRONC		; Programm im ROM-C weiter abarbeiten ...
  240                   ;
  241                   ; Tasten-RESET:
  242                   ;
  243 F166  31 01C4     BYE:	LD	SP,01C4H	; System-Stackpointer
  244 F169  3E E3       	LD	A,0E3H		; RAM4 WR einschalten,
  245 F16B  D3 86       	OUT	(86H),A		; und CAOS-C ein
  246 F16D  CD C0A1     	CALL	SYSI		; Systeminitialisierung
  247 F170  CD C9C2     PWR4:	CALL	V24INI		; M003 suchen und initialisieren
  248 F173  CD FBBA     	CALL	COFF		; CAOS-C ausschalten (Standard)
  249 F176  01 0880     	LD	BC,880H		; auf Steckplatz 8
  250 F179  ED 78       	IN	A,(C)		; ROM-Modul mit Strukturbyte
  251 F17B  3D          	DEC	A		; 01 vorhanden?
  252 F17C  20 14       	JR	NZ,PWR6		; nein!
  253 F17E  3E 43       	LD	A,43H
  254 F180  ED 79       	OUT	(C),A		; einschalten auf Adresse 4000H
  255 F182  32 B808     	LD	(MODST+8),A	; Schaltzustand eintragen
  256 F185  DD 7E 04    	LD	A,(IX+4)
  257 F188  E6 FC       	AND	0FCH		; internen RAM4 ausschalten
  258 F18A  DD 77 04    	LD	(IX+4),A
  259 F18D  D3 86       	OUT	(86H),A
  260 F18F  C3 4000     	JP	4000H		; Adresse 4000h im Modul anspringen
  261                   	;
  262 F192  06 FC       PWR6:	LD	B,0FCH
  263 F194  ED 78       	IN	A,(C)
  264 F196  FE A7       	CP	0A7H		; Floppy vorhanden?
  265 F198  20 39       	JR	NZ,PWR7		; nein
  266 F19A  ED 79       	OUT	(C),A		; einschalten mit Steuerbyte A7H
  267 F19C  01 B3F3     	LD	BC,UROK		; 0B3F3H
  268 F19F  ED 78       	IN	A,(C)		; Betriebsart ermitteln
  269 F1A1  3D          	DEC	A
  270 F1A2  28 2F       	JR	Z,PWR7		; CP/M-Betriebsart erkannt
  271 F1A4  FE 04       	CP	4
  272 F1A6  28 2B       	JR	Z,PWR7		; CAOS-Betriebsart erkannt
  273 F1A8  CD F0CE     	CALL	OSTR
  274 F1AB  0C 0A       	DB	0CH,LF
  275 F1AD  41 75 74 6F 	DB	'Autostart Floppy'
  276 F1BD  0D 0A 00    	DB	CR,LF,0
  277 F1C0  06 00       	LD	B,0
  278 F1C2  CD E379     PWR5:	CALL	BRKT		; BRK-Taste gedrueckt?
  279 F1C5  38 0C       	JR	C,PWR7		; ja, dann kein Floppy-Autostart
  280 F1C7  10 F9       	DJNZ	PWR5		; 256-mal abfragen
  281 F1C9  3E 01       	LD	A,1
  282 F1CB  32 B781     	LD	(ARGN),A	; 1 Parameter fuer JUMP FC vorgeben
  283 F1CE  3E FC       	LD	A,0FCH
  284 F1D0  CD F120     	CALL	JUMP		; Startversuch
  285 F1D3  AF          PWR7:	XOR	A
  286 F1D4  32 B781     	LD	(ARGN),A	; MENU ohne Parameter ausfuehren!
  287 F1D7  18 08       	JR	MEN0
  288                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 128
CF46    INC

  289 F1D9  7F7F        	DW	7F7FH
  290 F1DB  4D 45 4E 55 	DB	'MENU'
  291 F1DF  01          	DB	1
  292 F1E0  E1          	POP	HL		; Stack clear
  293 F1E1  CD F0CE     MEN0:	CALL	OSTR
  294 F1E4  0C 0A       	DB	0CH,LF
  295 F1E6  2A 20 4B 43 	DB	'* KC-CAOS 4.6 ',0
  296 F1F5  CD FBFE     	CALL	DEVANZ		; aktuelles Device anzeigen
  297 F1F8  CD F0CE     	CALL	OSTR
  298 F1FB  20 2A 00    	DB	' *',0
  299 F1FE  2A B781     MENU:	LD	HL,(ARGN)	; **46**
  300 F201  1E 00       	LD	E,0		; Parameter zum Testen in E bereithalten
  301 F203  2D          	DEC	L		; ARGN=1?
  302 F204  20 01       	JR	NZ,men9		; nein, E=0 verwenden
  303 F206  5C          	LD	E,H		; E=ARG1
  304 F207  21 C000     men9:	LD	HL,0C000H	; Menuewortsuche immer ab C000H
  305 F20A  4D          	LD	C,L
  306 F20B  45          	LD	B,L		; BC=0 (Suchlaenge)
  307 F20C  CD F4E7     MEN1:	CALL	CRLF
  308 F20F  3E 02       MEN2:	LD	A,2		; CLLN
  309 F211  CD F3B6     	CALL	OPRCHR		; Prompt ausgeben
  310 F214  CD E379     	CALL	BRKT
  311 F217  38 62       	JR	C,LOOP2		; Break
  312 F219  DD 7E 09    	LD	A,(IX+9)
  313 F21C  ED B1       MEN4:	CPIR
  314 F21E  E2 F27B     	JP	PO,LOOP2	; ausgesucht
  315 F221  ED A1       	CPI
  316 F223  E2 F27B     	JP	PO,LOOP2	; ausgesucht
  317 F226  20 F4       	JR	NZ,MEN4		; 2mal!
  318 F228  7E          MEN5:	LD	A,(HL)
  319 F229  FE 20       	CP	20h		; Epilog (0..1Fh)?
  320 F22B  38 27       	JR	C,MEN7
  321 F22D  CB 43       	bit	0,e		; versteckte Menueworte anzeigen?
  322 F22F  28 06       	jr	z,men8		; nein
  323 F231  FE 7B       	CP	'z'+1		; <= 'z'?
  324 F233  30 DA       	JR	NC,MEN2		; groesser als 'z'
  325 F235  18 10       	jr	men6
  326                   	;
  327 F237  FE 30       men8:	CP	'0'		; >= '0' und
  328 F239  38 D4       	JR	C,MEN2		; kleiner als '0'
  329 F23B  FE 5B       	CP	'Z'+1		; <= 'Z'?
  330 F23D  30 D0       	JR	NC,MEN2		; groesser als 'Z'
  331 F23F  FE 41       	CP	'A'		; >= 'A' oder
  332 F241  30 04       	JR	NC,MEN6		; groesser als 'A'
  333 F243  FE 3B       	CP	':'+1		; <= ':'?
  334 F245  30 C8       	JR	NC,MEN2		; groesser als ':'
  335 F247  CD F3E5     MEN6:	CALL	OCHR
  336 F24A  23          	INC	HL
  337 F24B  0B          	DEC	BC
  338 F24C  79          	LD	A,C
  339 F24D  B0          	OR	B
  340 F24E  20 D8       	JR	NZ,MEN5
  341 F250  3E 02       	LD	A,2		; CLLN
  342 F252  18 24       	JR	LOOP1		; ausgesucht
  343                   	;
  344 F254  CB 4B       MEN7:	bit	1,e
  345 F256  28 B4       	jr	z,men1		; keine Adressen anzeigen
  346 F258  3A B79E     	ld	a,(winlg)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 129
CF46    INC

  347 F25B  FE 0F       	cp	15		; Fensterbreite fuer Adressen ausreichend?
  348 F25D  38 AD       	jr	c,men1		; nein, dann nicht anzeigen!
  349 F25F  3E 0B       	ld	a,11
  350 F261  32 B7A0     	ld	(curso),a	; Spalte fuer Adressanzeige
  351 F264  23          	inc	hl
  352 F265  CD F3C4     	call	hlhx		; Startadresse anzeigen
  353 F268  2B          	dec	hl
  354 F269  18 A1       	JR	MEN1
  355                   
  356                   ; Eingabeschleife:
  357 F26B  DB 88       LOOP:	IN	A,(PIOAD)	; **12**
  358 F26D  E6 DF       	AND	11011111b	; LED aus
  359 F26F  F6 04       	OR	00000100b	; IRM ein
  360 F271  D3 88       	OUT	(PIOAD),A
  361 F273  CD FBBA     	CALL	COFF
  362 F276  3E 0D       	LD	A,CR		; Zeilenanfang
  363 F278  CD F3B6     LOOP1:	CALL	OPRCHR		; Prompt ausgeben
  364 F27B  CD F280     LOOP2:	CALL	INPUT
  365 F27E  18 EB       	JR	LOOP
  366                   
  367                   ; Menuekommandoroutine
  368 F280  CD F4A5     INPUT:	CALL	INLIN
  369 F283  30 0A       	JR	NC,INP1
  370 F285  3E 0B       	LD	A,0BH		; bei BRK
  371 F287  CD E091     	CALL	CRT		; Cursor hoch
  372 F28A  3E 02       	LD	A,2		; und
  373 F28C  C3 E091     	JP	CRT		; Zeile loeschen
  374                   	;
  375 F28F  13          INP1:	INC	DE		; Zeichen danach
  376 F290  1A          	LD	A,(DE)
  377 F291  E6 DF       	AND	0DFH		; leer?
  378 F293  C8          	RET	Z
  379 F294  3A B802     	LD	A,(MODST+2)	; Schaltzustand USER-ROM
  380 F297  32 B780     	LD	(ARGC),A	; CAOS 4.6: hier uebergeben an USER-Programme
  381 F29A  CD F353     	CALL	MSUCH		; Suche ab C000H
  382 F29D  38 3F       	JR	C,INP5		; gefunden
  383 F29F  3A B805     	LD	A,(MODST+5)
  384 F2A2  E6 01       	AND	1
  385 F2A4  20 0A       	JR	NZ,INP2		; CAOS-C war bereits an
  386 F2A6  CD FBAD     	CALL	CON
  387 F2A9  06 20       	LD	B,20H		; ansonsten 2000h Bytes
  388 F2AB  CD F355     	CALL	MS1		; durchsuchen im CAOS-ROM-C
  389 F2AE  38 2E       	JR	C,INP5		; gefunden
  390 F2B0  D5          INP2:	PUSH	DE
  391 F2B1  16 D1       	LD	D,0D1H		; 1. Ebene (BASIC nicht mit durchsuchen)
  392 F2B3  CD F104     INP3:	CALL	MODUL2		; USER-ROM-C Ebene ein
  393                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 F2B6  DD CB 04    	 DB	0DDh,0CBh,4
    2 F2B9  BF          	 DB	7 SHL 3 OR 10000111b
  394 F2BA  D3 86       	OUT	(86H),A		; CAOS-ROM-C aus!
  395 F2BC  EB          	EX	DE,HL
  396 F2BD  E3          	EX	(SP),HL		; DE=Suchkette
  397 F2BE  EB          	EX	DE,HL
  398 F2BF  06 20       	LD	B,20H		; Suchlaenge 2000h Bytes
  399 F2C1  CD F355     	CALL	MS1		; Menuewort in USER-ROM suchen
  400 F2C4  38 13       	JR	C,INP4		; gefunden
  401 F2C6  EB          	EX	DE,HL
  402 F2C7  E3          	EX	(SP),HL		; DE=Schaltzustand

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 130
CF46    INC

  403 F2C8  EB          	EX	DE,HL
  404 F2C9  3E 10       	LD	A,10H		; Offset zur naechsten Ebene
  405 F2CB  82          	ADD	A,D		; ergibt: D1, E1, F1
  406 F2CC  57          	LD	D,A
  407 F2CD  30 E4       	JR	NC,INP3		; naechste Ebene
  408 F2CF  ED 5B B77F  	LD	DE,(ARGC-1)	; CAOS 4.6: D = USERC-Schaltzustand vor Suche
  409 F2D3  CD F104     	CALL	MODUL2		; USER-ROMC wie zuvor
  410 F2D6  D1          	POP	DE
  411 F2D7  18 2C       	JR	ERR1		; invalid command
  412                   	;
  413 F2D9  F1          INP4:	POP	AF		; Schaltzustand USER-ROM-C vergessen
  414 F2DA  AF          	XOR	A
  415 F2DB  32 B805     	LD	(MODST+5),A	; CAOS-C ausschalten
  416 F2DE  7E          INP5:	LD	A,(HL)		; Epilog
  417 F2DF  23          	INC	HL
  418 F2E0  E5          	PUSH	HL
  419 F2E1  FE 1F       	CP	1FH
  420 F2E3  C8          	RET	Z		; ohne arg!
  421 F2E4  F5          	PUSH	AF
  422 F2E5  CD F52C     	CALL	GARG		; Arg's erfassen
  423 F2E8  C1          	POP	BC
  424 F2E9  38 46       	JR	C,ERR4		; bad args
  425 F2EB  3A B781     	LD	A,(ARGN)
  426 F2EE  48          	LD	C,B
  427 F2EF  CB A0       	RES	4,B
  428 F2F1  CB 28       	SRA	B
  429 F2F3  B8          	CP	B
  430 F2F4  38 2D       	JR	C,ERR3		; zu wenig arg
  431 F2F6  28 04       	JR	Z,INP6
  432 F2F8  CB 61       	BIT	4,C
  433 F2FA  20 19       	JR	NZ,ERR2		; zu viele arg
  434 F2FC  CB 41       INP6:	BIT	0,C
  435 F2FE  CD F609     	CALL	LARG		; Arg's laden
  436 F301  C0          	RET	NZ		; mit IRM on
  437 F302  C3 F03D     	JP	SCROFF		; mit IRM off
  438                   
  439 F305  CD F0CE     ERR1:	CALL	OSTR
  440 F308  4B 6F 6D 6D 	DB	'Kommando?',7,0
  441 F313  18 3B       	JR	ERRCR
  442 F315  CD F0CE     ERR2:	CALL	OSTR
  443 F318  5A 75 20 76 	DB	'Zu viele',0
  444 F321  18 1D       	JR	ERRA
  445 F323  CD F0CE     ERR3:	CALL	OSTR
  446 F326  5A 75 20 77 	DB	'Zu wenig',0
  447 F32F  18 0F       	JR	ERRA
  448 F331  CD F0CE     ERR4:	CALL	OSTR
  449 F334  46 65 68 6C 	DB	'Fehlerhafte',0
  450 F340  E1          ERRA:	POP	HL		; Stack clear
  451 F341  CD F0CE     	CALL	OSTR
  452 F344  20 41 72 67 	DB	' Argumente',7,0
  453 F350  C3 F4E7     ERRCR:	JP	CRLF
  454                   
  455 F353  06 00       MSUCH:	LD	B,0
  456 F355  21 C000     MS1:	LD	HL,0C000H	; Standard-Suchbeginn
  457 F358  4D          	LD	C,L
  458 F359  DD 7E 09    ZS0:	LD	A,(IX+9)	; Prologbyte
  459 F35C  ED B1       ZSUCH:	CPIR			; **1D**
  460 F35E  37          	SCF

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 131
CF46    INC

  461 F35F  3F          	CCF			; CY=0
  462 F360  E0          	RET	PO		; Prolog nicht gefunden
  463 F361  ED A1       	CPI
  464 F363  20 F7       	JR	NZ,ZSUCH
  465 F365  F5          	PUSH	AF
  466 F366  D5          	PUSH	DE		; Beginn der Vergleichskette retten
  467 F367  1A          ZS1:	LD	A,(DE)		; Zeichen von Vergleichskette
  468 F368  13          	INC	DE
  469 F369  FE 21       	CP	21H
  470 F36B  38 0D       	JR	C,ZS3		; Kettenende bei Vergleichskette erkannt
  471 F36D  CB 6E       	BIT	5,(HL)		; Grossbuchstabe im Speicher?
  472 F36F  CC F549     	CALL	Z,UPCASE	; dann Zeichen von Vergleichskette upcasen
  473 F372  ED A1       	CPI
  474 F374  28 F1       	JR	Z,ZS1		; stimmt ueberein
  475 F376  D1          ZS2:	POP	DE		; wieder zu Begenn der Vergleichskette
  476 F377  F1          	POP	AF		; und verwendetes Prologbyte restaurieren
  477 F378  18 E2       	JR	ZSUCH		; Suche fortsetzen
  478                   	;
  479 F37A  7E          ZS3:	LD	A,(HL)		; Zeichen aus Speicher weiter testen
  480 F37B  FE 20       	CP	20H		; bis Epilogbyte (0..1Fh) kommt
  481 F37D  38 08       	JR	C,ZS4		; Epilog gefunden
  482                   ;	JR	Z,ZS2		; SPC (war in CAOS 4.3 und 4.4 nicht zugelassen)
  483 F37F  FE 80       	CP	80H
  484 F381  30 F3       	JR	NC,ZS2		; Zeichen ab 80H nicht zugelassen
  485 F383  23          	INC	HL
  486 F384  0B          	DEC	BC		; Befehl am 11.04.2010 ergaenzt
  487 F385  18 F3       	JR	ZS3
  488                   	;
  489 F387  F1          ZS4:	POP	AF
  490 F388  F1          	POP	AF
  491 F389  37          	SCF			; CY=1 fuer gefunden
  492 F38A  C9          	RET
  493                   
  494 F38B  47          WAIT:	LD	B,A		; **14**
  495 F38C  AF          	XOR	A
  496 F38D  CD F393     WAIT1:	CALL	WTUP
  497 F390  10 FB       	DJNZ	WAIT1
  498 F392  C9          	RET
  499                   
  500 F393  3D          WTUP:	DEC	A		; UP fuer WAIT
  501 F394  C8          	RET	Z
  502 F395  F5          	PUSH	AF
  503 F396  F1          	POP	AF
  504 F397  18 FA       	JR	WTUP
  505                   
  506 F399  CD F3A9     NORM:	CALL	NIN		; **13**
  507 F39C  21 FC14     NOUT:	LD	HL,ZEI0		; **20**
  508 F39F  E5          SOUT:	PUSH	HL		; **1E**
  509 F3A0  2A B7B9     	LD	HL,(OUTAB)
  510 F3A3  E3          	EX	(SP),HL
  511 F3A4  22 B7B9     	LD	(OUTAB),HL
  512 F3A7  E1          	POP	HL
  513 F3A8  C9          	RET
  514                   
  515 F3A9  21 FC18     NIN:	LD	HL,ZEI4		; **21**
  516 F3AC  E5          SIN:	PUSH	HL		; **1F**
  517 F3AD  2A B7BB     	LD	HL,(INTAB)
  518 F3B0  E3          	EX	(SP),HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 132
CF46    INC

  519 F3B1  22 B7BB     	LD	(INTAB),HL
  520 F3B4  E1          	POP	HL
  521 F3B5  C9          	RET
  522                   
  523                   ; Steuerzeichen und Prompt ausgeben
  524                   ; PE: A=Steuerzeichen
  525 F3B6  CD E091     OPRCHR:	CALL	CRT
  526 F3B9  3A B7EC     	LD	A,(PROMPT)
  527 F3BC  FE 20       	CP	' '
  528 F3BE  30 02       	JR	NC,OPRCH1
  529 F3C0  3E 25       	LD	A,'%'		; Standard
  530 F3C2  18 21       OPRCH1:	JR	OCHR		; Prompt
  531                   
  532 F3C4  7C          HLHX:	LD	A,H		; **1A**
  533 F3C5  CD F3D4     	CALL	AHEX
  534 F3C8  7D          	LD	A,L
  535 F3C9  CD F3D4     AHSPC:	CALL	AHEX
  536 F3CC  3E 20       SPACE:	LD	A,20H		; **2B**
  537 F3CE  18 15       	JR	OCHR
  538                   
  539 F3D0  3E 10       HOME:	LD	A,10H		; **2D**
  540 F3D2  18 11       	JR	OCHR
  541                   
  542 F3D4  F5          AHEX:	PUSH	AF		; **1C**
  543 F3D5  0F          	RRCA			; Tetradentausch
  544 F3D6  0F          	RRCA
  545 F3D7  0F          	RRCA
  546 F3D8  0F          	RRCA
  547 F3D9  CD F3DD     	CALL	AHEX0		; erst aufrufen,
  548 F3DC  F1          	POP	AF		; dann reinlaufen
  549 F3DD  E6 0F       AHEX0:	AND	0FH		; Maske
  550 F3DF  C6 90       	ADD	A,90H		; uebliche
  551 F3E1  27          	DAA			; Routine
  552 F3E2  CE 40       	ADC	A,40H		; fuer die
  553 F3E4  27          	DAA			; Hexausgabe
  554                   	;
  555 F3E5  E5          OCHR:	PUSH	HL		; **24**
  556 F3E6  2A B7B9     	LD	HL,(OUTAB)
  557 F3E9  D5          INTA1:	PUSH	DE		; siehe auch PV1
  558 F3EA  C5          	PUSH	BC		; (sehr aehnlich)
  559 F3EB  5E          	LD	E,(HL)
  560 F3EC  16 00       	LD	D,0
  561 F3EE  2A B7B0     	LD	HL,(SUTAB)
  562 F3F1  F5          	PUSH	AF
  563 F3F2  19          	ADD	HL,DE
  564 F3F3  19          	ADD	HL,DE
  565 F3F4  F1          	POP	AF
  566 F3F5  5E          	LD	E,(HL)
  567 F3F6  23          	INC	HL
  568 F3F7  56          	LD	D,(HL)
  569 F3F8  EB          	EX	DE,HL
  570 F3F9  CD E1BE     	CALL	JPHL
  571 F3FC  C1          POP3:	POP	BC		; auch fuer PV2
  572 F3FD  D1          	POP	DE		; bis PV6!
  573 F3FE  E1          	POP	HL
  574 F3FF  C9          	RET
  575                   
  576 F400  E5          INTB:	PUSH	HL		; **16**

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 133
CF46    INC

  577 F401  2A B7BB     	LD	HL,(INTAB)
  578 F404  18 E3       	JR	INTA1
  579                   
  580 F406  E5          KBD:	PUSH	HL		; **04**
  581 F407  D5          	PUSH	DE
  582 F408  C5          	PUSH	BC
  583 F409  DD CB 08 76 KBD1:	BIT	6,(IX+8)	; F-Taste aktiv?
  584 F40D  20 5C       	JR	NZ,KBD9		; ja
  585 F40F  1E 00       KBD2:	LD	E,0
  586 F411  CD F805     KBD3:	CALL	CUCP		; blinken
  587 F414  1C          	INC	E		; e/a-Merker
  588 F415  06 0F       	LD	B,0FH		; F00h mal
  589 F417  CD E370     KBD4:	CALL	KBDZ		; abfragen
  590 F41A  38 07       	JR	C,KBD5
  591 F41C  0B          	DEC	BC
  592 F41D  78          	LD	A,B
  593 F41E  B1          	OR	C
  594 F41F  20 F6       	JR	NZ,KBD4		; dann Cursor
  595 F421  18 EE       	JR	KBD3		; wieder weg usw.
  596                   	;
  597 F423  CB 43       KBD5:	BIT	0,E		; gerade ein?
  598 F425  C4 F805     	CALL	NZ,CUCP		; ja - wegnehmen
  599 F428  57          	LD	D,A
  600 F429  DD CB 08 6E 	BIT	5,(IX+8)	; Click ein?
  601 F42D  C4 E2AB     	CALL	NZ,CLIK
  602 F430  7A          	LD	A,D
  603 F431  21 B7A2     	LD	HL,STBT
  604 F434  CB 66       	BIT	4,(HL)		; ESC aktiv?
  605 F436  28 0D       	JR	Z,KBD6
  606 F438  ED 5B B7A0  	LD	DE,(CURSO)
  607 F43C  CD E188     	CALL	CRT1		; ESC ausfuehren
  608 F43F  ED 53 B7A0  	LD	(CURSO),DE
  609 F443  18 CA       	JR	KBD2
  610                   	;
  611 F445  FE 1B       KBD6:	CP	ESC
  612 F447  20 04       	JR	NZ,KBD7
  613 F449  CB E6       	SET	4,(HL)		; ESC merken
  614 F44B  18 C2       KBD2J:	JR	KBD2
  615                   	;
  616 F44D  FE F1       KBD7:	CP	0F1H		; F-Taste?
  617 F44F  38 AB       	JR	C,POP3
  618 F451  E6 0F       	AND	0FH
  619 F453  47          	LD	B,A
  620 F454  21 B900     	LD	HL,0B900H
  621 F457  7E          KBD8:	LD	A,(HL)
  622 F458  2C          	INC	L
  623 F459  28 B4       	JR	Z,KBD2		; Speicherende
  624 F45B  A7          	AND	A
  625 F45C  20 F9       	JR	NZ,KBD8		; Position im Puffer
  626 F45E  10 F7       	DJNZ	KBD8		; auszaehlen
  627 F460  7D          	LD	A,L
  628 F461  FE 9C       	CP	9CH
  629 F463  30 AA       	JR	NC,KBD2		; Speicherende
  630 F465  DD CB 08 F6 	SET	6,(IX+8)	; F-Taste aktiv
  631 F469  18 08       	JR	KBD10
  632                   	;
  633 F46B  CD E379     KBD9:	CALL	BRKT		; Abbruch?
  634 F46E  38 1A       	JR	C,KBD12

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 134
CF46    INC

  635 F470  2A B7D1     	LD	HL,(FTAST)	; Zeiger auf
  636 F473  7E          KBD10:	LD	A,(HL)		; naechstes CHR
  637 F474  FE 1B       	CP	ESC
  638 F476  20 0B       	JR	NZ,KBD11
  639 F478  23          	INC	HL
  640 F479  22 B7D1     	LD	(FTAST),HL
  641 F47C  21 B7A2     	LD	HL,STBT
  642 F47F  CB E6       	SET	4,(HL)		; ESC merken
  643 F481  18 86       KBD1J:	JR	KBD1
  644                   	;
  645 F483  23          KBD11:	INC	HL
  646 F484  22 B7D1     	LD	(FTAST),HL	; Zeiger retten
  647 F487  A7          	AND	A		; NUL-Ende?
  648 F488  20 06       	JR	NZ,KBD13
  649 F48A  DD CB 08 B6 KBD12:	RES	6,(IX+8)	; ja - inaktiv
  650 F48E  18 BB       	JR	KBD2J
  651                   	;
  652 F490  21 B7A2     KBD13:	LD	HL,STBT
  653 F493  CB 66       	BIT	4,(HL)
  654 F495  CA F3FC     	JP	Z,POP3
  655 F498  ED 5B B7A0  	LD	DE,(CURSO)
  656 F49C  CD E188     	CALL	CRT1		; ESC ausfuehren
  657 F49F  ED 53 B7A0  	LD	(CURSO),DE
  658 F4A3  18 DC       	JR	KBD1J
  659                   
  660 F4A5  CD F400     INLIN:	CALL	INTB		; **17**
  661 F4A8  CD F3E5     	CALL	OCHR
  662 F4AB  FE 03       	CP	3		; BRK?
  663 F4AD  37          	SCF
  664 F4AE  28 04       	JR	Z,INLI1
  665 F4B0  FE 0D       	CP	CR		; ENTER?
  666 F4B2  20 F1       	JR	NZ,INLIN
  667 F4B4  F5          INLI1:	PUSH	AF
  668 F4B5  CD F4E7     	CALL	CRLF		; PA: A=0
  669 F4B8  ED 5B B7A0  	LD	DE,(CURSO)
  670 F4BC  BA          	CP	D		; Zeile 1 durch PAGE-Mode?
  671 F4BD  20 04       	JR	NZ,INLI2
  672 F4BF  3A B79F     	LD	A,(WINLG+1)
  673 F4C2  57          	LD	D,A		; D korrigieren
  674 F4C3  15          INLI2:	DEC	D		; Zeile drueber
  675 F4C4  E5          	PUSH	HL
  676 F4C5  CD E06D     	CALL	DABR
  677 F4C8  EB          	EX	DE,HL
  678 F4C9  E1          	POP	HL		; PA: DE
  679 F4CA  F1          	POP	AF		; PA: CY=BRK
  680 F4CB  C9          NOOP:	RET
  681                   ;
  682                   ; Sprung zu einer Adresse mit Registeruebergabe
  683                   ; Syntax: %go ADR [HL] [DE] [BC]
  684                   ;
  685 F4CC  7F7F        GO7F:	DW	7F7FH
  686 F4CE  67 6F       	DB	'go'
  687 F4D0  03          	DB	3		; mindestens 1 Argument erforderlich
  688 F4D1  E5          	PUSH	HL		; Adresse auf den Stack
  689 F4D2  EB          	EX	DE,HL		; ARG2 von DE nach HL
  690 F4D3  50          	LD	D,B
  691 F4D4  59          	LD	E,C		; ARG3 von BC nach DE
  692 F4D5  ED 4B B788  	LD	BC,(ARG4)	; ARG4 nach BC

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 135
CF46    INC

  693 F4D9  3A B78A     	LD	A,(ARG5)
  694 F4DC  C9          	RET
  695                   
  696 F4DD  CD F0CE     ERRM:	CALL	OSTR		; **17**
  697 F4E0  45 52 52 4F 	DB	'ERROR',7,0
  698                   	;
  699 F4E7  CD F0CE     CRLF:	CALL	OSTR		; **2C**
  700 F4EA  0D 0A 00    	DB	CR,LF,0
  701 F4ED  C9          	RET
  702                   
  703 F4EE  CD F4F1     HLDE:	CALL	HLDE1		; **1B**
  704 F4F1  CD F3C4     HLDE1:	CALL	HLHX
  705 F4F4  EB          	EX	DE,HL
  706 F4F5  C9          	RET
  707                   
  708 F4F6  13          RHEX0:	INC	DE
  709 F4F7  1A          RHEX:	LD	A,(DE)		; **18**
  710 F4F8  FE 20       	CP	' '		; Trennzeichen
  711 F4FA  28 FA       	JR	Z,RHEX0		; uebergehen
  712 F4FC  AF          	XOR	A
  713 F4FD  21 B798     	LD	HL,NUMVX+1
  714 F500  77          	LD	(HL),A
  715 F501  2B          	DEC	HL		; HL=NUMVX
  716 F502  77          	LD	(HL),A
  717 F503  2B          	DEC	HL		; HL=NUMNX
  718 F504  77          	LD	(HL),A		; alles auf 0 setzen
  719 F505  1A          RH1:	LD	A,(DE)
  720 F506  B7          	OR	A		; Ende-Dummy?
  721 F507  C8          	RET	Z
  722 F508  FE 20       	CP	' '		; Ende-Space?
  723 F50A  C8          	RET	Z
  724 F50B  D6 30       	SUB	'0'
  725 F50D  D8          	RET	C
  726 F50E  FE 0A       	CP	10
  727 F510  38 0B       	JR	C,RH2
  728 F512  D6 07       	SUB	7
  729 F514  E6 DF       	AND	11011111b	; klein -> gross
  730 F516  FE 0A       	CP	0Ah
  731 F518  D8          	RET	C
  732 F519  FE 10       	CP	10h
  733 F51B  3F          	CCF
  734 F51C  D8          	RET	C
  735 F51D  13          RH2:	INC	DE
  736 F51E  34          	INC	(HL)		; NUMNX erhoehen
  737 F51F  23          	INC	HL
  738 F520  ED 6F       	RLD			; Tetrade
  739 F522  23          	INC	HL		; durchschieben
  740 F523  ED 6F       	RLD
  741 F525  2B          	DEC	HL
  742 F526  2B          	DEC	HL
  743 F527  28 DC       	JR	Z,RH1		; RLD setzt auch Z-Flag!
  744 F529  1B          	DEC	DE
  745 F52A  37          	SCF			; Fehler: Zahl zu gross
  746 F52B  C9          	RET
  747                   
  748                   ; Bis zu 10 Argumente erfassen:
  749 F52C  01 B781     GARG:	LD	BC,ARGN		; **22**
  750 F52F  AF          	XOR	A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 136
CF46    INC

  751 F530  02          	LD	(BC),A		; (ARGN)=0
  752 F531  CD F4F7     GARG1:	CALL	RHEX
  753 F534  D8          	RET	C		; Fehler
  754 F535  7E          	LD	A,(HL)
  755 F536  B7          	OR	A		; Ende-Dummy?
  756 F537  C8          	RET	Z
  757 F538  23          	INC	HL
  758 F539  03          	INC	BC
  759 F53A  7E          	LD	A,(HL)		; LOW(NUMVX)
  760 F53B  02          	LD	(BC),A		; LOW(Argument)
  761 F53C  23          	INC	HL
  762 F53D  03          	INC	BC
  763 F53E  7E          	LD	A,(HL)		; HIGH(NUMVX)
  764 F53F  02          	LD	(BC),A		; HIGH(Argument)
  765 F540  2E 81       	LD	L,LOW(ARGN)	; HL=ARGN
  766 F542  34          	INC	(HL)
  767 F543  7E          	LD	A,(HL)
  768 F544  C6 F5       	ADD	A,-11		; 10 Argumente?
  769 F546  30 E9       	JR	NC,GARG1
  770 F548  C9          	RET			; Fehler: zu viele
  771                   
  772                   ; Kleinbuchstaben in A in Grossbuchstaben umwandeln:
  773 F549  FE 61       UPCASE:	CP	'a'
  774 F54B  D8          	RET	C
  775 F54C  FE 7B       	CP	'z' + 1
  776 F54E  D0          	RET	NC
  777 F54F  E6 DF       	AND	11011111b
  778 F551  C9          	RET
  779                   
  780 F552  DD 36 05 00 KPUFF:	LD	(IX+5),LOW(CASS)
  781 F556  DD 36 06 B7 	LD	(IX+6),HIGH(CASS)
  782 F55A  C9          	RET
  783                   
  784 F55B  C5          INIEA:	PUSH	BC		; **43**
  785 F55C  4E          	LD	C,(HL)		; erstes Byte: Portadresse
  786 F55D  23          	INC	HL
  787 F55E  46          	LD	B,(HL)		; zweites Byte: Anzahl
  788 F55F  23          	INC	HL
  789 F560  ED B3       	OTIR
  790 F562  C1          	POP	BC
  791 F563  C9          	RET
  792                   
  793 F564  56          INIMEX:	LD	D,(HL)		; Anzahl Kanaele
  794 F565  23          	INC	HL
  795 F566  CD F55B     INIMX1:	CALL	INIEA
  796 F569  15          	DEC	D
  797 F56A  20 FA       	JR	NZ,INIMX1
  798 F56C  C9          	RET
  799                   
  800 F56D  F3          INIME:	DI			;**44**
  801 F56E  CD F566     	CALL	INIMX1
  802 F571  FB          	EI
  803 F572  C9          	RET
  804                   ;
  805                   ; Dateiname abfragen
  806                   ; PA:	HL	Zeiger auf den eingegebenen Namen
  807                   ;	CY=1	mit BRK abgebrochen
  808                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 137
CF46    INC

  809 F573  21 0006     NAME:	LD	HL,6
  810 F576  CD F0CE     NAMHL:	CALL	OSTR
  811 F579  4E 61 6D 65 	DB	'Name :',0
  812 F580  CD F4A5     	CALL	INLIN		; Dateiname abfragen
  813 F583  D8          	RET	C		; BRK
  814 F584  19          	ADD	HL,DE		; Beginn Name
  815 F585  C9          	RET
  816                   
  817 F586  7F7F        SAVE7F:	DW	7F7FH
  818 F588  53 41 56 45 	DB	'SAVE'
  819 F58C  05          	DB	5
  820 F58D  CD F573     	CALL	NAME		; Dateiname abfragen
  821 F590  D8          	RET	C		; mit BRK abgebrochen
  822                   	;
  823 F591  11 B700     SAVE:	LD	DE,CASS		; **36**
  824 F594  01 000B     	LD	BC,11
  825 F597  ED B0       	LDIR			; Name in Puffer kopieren
  826 F599  AF          	XOR	A
  827 F59A  12          	LD	(DE),A		; Ende-0 anhaengen
  828 F59B  21 B781     	LD	HL,ARGN		; alle Argumente inklusive ARGN
  829 F59E  1E 10       	LD	E,10H
  830 F5A0  0E 15       	LD	C,15H
  831 F5A2  ED B0       	LDIR			; in den Puffer kopieren
  832 F5A4  CD F552     	CALL	KPUFF		; Standard-Puffer setzen
  833 F5A7  CD F04F     	CALL	PV1		; Vorblock ausgeben
  834 F5AA  08          	DB	08H		; ISRO
  835 F5AB  D8          	RET	C		; Fehler
  836 F5AC  2A B784     	LD	HL,(ARG2)	; Endadresse+1
  837 F5AF  ED 5B B782  	LD	DE,(ARG1)	; Anfangsadresse
  838 F5B3  A7          	AND	A
  839 F5B4  ED 52       	SBC	HL,DE		; Anzahl Datenbytes
  840 F5B6  E5          	push	hl		; Anzahl auf Stack 
  841 F5B7  2A B782     SAV1:	LD	HL,(ARG1)	; Adresse fuer aktuellen Block
  842 F5BA  11 B700     	LD	DE,CASS
  843 F5BD  01 0080     	LD	BC,128
  844 F5C0  3A B801     	LD	A,(MODST+1)
  845 F5C3  E6 01       	AND	1
  846 F5C5  20 0F       	JR	NZ,SAV3		; IRM ein
  847 F5C7  41          	LD	B,C
  848 F5C8  CD F03D     SAV2:	CALL	SCROFF
  849 F5CB  7E          	LD	A,(HL)		; vom RAM
  850 F5CC  CD F046     	CALL	SCRON
  851 F5CF  12          	LD	(DE),A		; in den Puffer
  852 F5D0  23          	INC	HL
  853 F5D1  13          	INC	DE
  854 F5D2  10 F4       	DJNZ	SAV2
  855 F5D4  18 02       	JR	SAV4
  856 F5D6  ED B0       SAV3:	LDIR			; kopieren
  857 F5D8  22 B782     SAV4:	LD	(ARG1),HL	; Adresse fuer naechsten Block eintragen
  858 F5DB  E1          	pop	hl		; Anzahl
  859 F5DC  CD F0CE     	CALL	OSTR
  860 F5DF  02 00       	DB	2,0		; CLLN
  861 F5E1  CD F0C8     	CALL	BNROST		; Blocknummer ausgeben
  862 F5E4  00          	DB	0
  863 F5E5  CD E379     	CALL	BRKT
  864 F5E8  38 14       	JR	C,SAV5		; BRK -> Datei schliessen
  865 F5EA  01 00A0     	LD	BC,160		; kurzer Vorton
  866 F5ED  11 0080     	ld	de,128		; Anzahl - 128

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 138
CF46    INC

  867 F5F0  ED 52       	sbc	hl,de		; Ende erreicht?
  868 F5F2  28 0A       	jr	z,SAV5		; ja, genau das Blockende
  869 F5F4  38 08       	jr	c,SAV5		; ja, letzter Block mit weniger Bytes
  870 F5F6  E5          	push	hl		; restliche Anzahl
  871 F5F7  CD F04F     	CALL	PV1		; Datenblock ausgeben
  872 F5FA  01          	DB	01H		; MBO
  873 F5FB  30 BA       	JR	NC,SAV1		; kein Fehler
  874 F5FD  E1          	pop	hl		; restliche Byte-Anzahl vom Stack nehmen
  875                   	;
  876 F5FE  CD F04F     SAV5:	CALL	PV1		; Ausgabe Endeblock 0FFH
  877 F601  09          	DB	09H		; CSRO
  878 F602  CD E4BE     	CALL	CLC		; CAOS 4.6: Puffer loeschen nicht mehr in CSRO
  879 F605  CD F4E7     	CALL	CRLF		; CAOS 4.6: Zeilenvorschub nicht mehr in CSRO
  880 F608  C9          	RET
  881                   
  882 F609  ED 4B B786  LARG:	LD	BC,(ARG3)	; **15**
  883 F60D  ED 5B B784  	LD	DE,(ARG2)
  884 F611  2A B782     	LD	HL,(ARG1)
  885 F614  3A B781     	LD	A,(ARGN)
  886 F617  C9          	RET
  887                   
  888                   ; Lesen eines Blockes von Kassette mit Ausschrift Blocknummer bzw. Name
  889                   ;
  890                   ; PE:	(IX+3)	zu lesender Block
  891                   ; VR:	AF,BC	(Block<>1) ( 00>  )
  892                   ;	AF,BC,HL (Block=1) ( Name )
  893                   ; PA:	CY=1	BRK gedrueckt nach Lesefehler
  894                   
  895 F618  DD 34 03    RDBLK:	INC	(IX+3)		; erwarteter Block
  896 F61B  CD F04F     LUP1:	CALL	PV1
  897 F61E  05          	DB	05H		; MBI
  898 F61F  30 20       LUP2:	JR	NC,LUP3		; kein Fehler aufgetreten
  899 F621  CD F0CE     	CALL	OSTR
  900 F624  09 09 09 20 	DB	9,9,9,' ',0
  901 F629  CD F0C8     	CALL	BNROST
  902 F62C  20 3F       	DB	' ?'		; Pruefsumme fehlerhaft
  903 F62E  1E 00       	DB	1EH,0
  904 F630  DD 7E 03    	LD	A,(IX+3)
  905 F633  3D          	DEC	A		; Vorblock mit Nr. 01 erwartet?
  906 F634  28 E5       	JR	Z,LUP1		; dann weiter versuchen...
  907 F636  CD F406     	CALL	KBD		; Tastaturabfrage
  908 F639  FE 03       	CP	3		; BRK?
  909 F63B  37          	SCF
  910 F63C  C8          	RET	Z
  911 F63D  FE 0A       	CP	LF		; CUD? (fehlerhaften Block uebernehmen?)
  912 F63F  20 DA       	JR	NZ,LUP1
  913 F641  DD 7E 02    LUP3:	LD	A,(IX+2)	; gelesener Block
  914 F644  DD 46 03    	LD	B,(IX+3)	; zu lesender Block
  915 F647  05          	DEC	B		; Block 01?
  916 F648  28 17       	JR	Z,LUP6		; Block 1 soll gelesen werden
  917 F64A  04          	INC	B
  918 F64B  B8          	CP	B		; richtige Blocknummer?
  919 F64C  28 0B       	JR	Z,LUP5
  920 F64E  3C          	INC	A		; Block FF?
  921 F64F  28 08       	JR	Z,LUP5		; Endeblock immer als richtig werten
  922 F651  CD F0C8     LUP4:	CALL	BNROST
  923 F654  2A 19 00    	DB	'*',19H,0	; falsche Blocknummer
  924 F657  18 C2       	JR	LUP1		; weiter versuchen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 139
CF46    INC

  925                   	;
  926 F659  CD F0C8     LUP5:	CALL	BNROST
  927 F65C  3E 20 19 00 	DB	'> ',19H,0	; korrekter Block
  928 F660  C9          	RET
  929                   	;
  930 F661  3D          LUP6:	DEC	A		; Block 01?
  931 F662  20 ED       	JR	NZ,LUP4		; nein -> falsche Blocknummer anzeigen
  932                   ;	CALL	CRLF		; Zeilenvorschub vor Dateiname ???
  933 F664  21 B700     	LD	HL,CASS		; Bei Vorblock keine Blocknummer,
  934 F667  06 0B       	LD	B,11		; sondern den Name+Typ
  935 F669  7E          LUP7:	LD	A,(HL)		; aus Kassettenpuffer anzeigen
  936 F66A  23          	INC	HL
  937 F66B  FE 20       	CP	20h		; Steuerzeichen?
  938 F66D  D4 E091     	CALL	nc,CRT		; nur anzeigen was groesser 20h ist!
  939 F670  10 F7       	DJNZ	LUP7
  940 F672  CD F3CC     	CALL	SPACE		; Leerzeichen zwischen Dateiname + Adressen
  941 F675  A7          	AND	A		; kein Fehler
  942 F676  C9          	RET
  943                   
  944 F677  CD F0CE     NOMC:	CALL	OSTR
  945 F67A  4B 65 69 6E 	DB	'Keine MC-Datei!',0
  946 F68A  CD F04F     CLJP:	CALL	PV1
  947 F68D  0B          	DB	0BH		; CSRI
  948 F68E  C9          	RET
  949                   
  950 F68F  7F7F        VERI7F:	DW	7F7FH
  951 F691  56 45 52 49 	DB	'VERIFY'
  952 F697  01          	DB	1
  953 F698  DD 36 07 00 VERIF:	LD	(IX+7),0	; **11**
  954 F69C  18 1F       	JR	LOAD1
  955                   
  956 F69E  7F7F        LOAD7F:	DW	7F7FH
  957 F6A0  4C 4F 41 44 	DB	'LOAD'
  958 F6A4  01          	DB	1
  959 F6A5  DD 7E 08    	LD	A,(IX+8)
  960 F6A8  E6 1C       	AND	00011100b
  961 F6AA  C4 F573     	CALL	NZ,NAME		; Dateiname abfragen bei Device > 0
  962 F6AD  D8          	RET	C		; mit BRK abgebrochen
  963 F6AE  DD 36 07 01 LOAD:	LD	(IX+7),1	; **10**
  964 F6B2  3A B781     	LD	A,(ARGN)
  965 F6B5  FE 02       	CP	2
  966 F6B7  38 04       	JR	C,LOAD1		; Autostart?
  967 F6B9  DD CB 07 CE 	SET	1,(IX+7)	; unterdruecken
  968 F6BD  CD F552     LOAD1:	CALL	KPUFF		; Standardpuffer setzen
  969 F6C0  CD F04F     	CALL	PV1		; HL = Dateiname
  970 F6C3  0A          	DB	0AH		; ISRI (Vorblock einlesen)
  971 F6C4  30 06       	JR	NC,LOAD0	; kein Fehler aufgetreten
  972 F6C6  DD 7E 08    	LD	A,(IX+8)
  973 F6C9  E6 1C       	AND	00011100b
  974 F6CB  C0          	RET	NZ		; Abbruch wenn DEVICE > 0
  975 F6CC  CD F61F     LOAD0:	CALL	LUP2		; Blockinhalt auswerten (Name anzeigen usw.)
  976 F6CF  38 B9       LOAD2:	JR	C,CLJP		; BRK
  977 F6D1  DD CB 07 46 	BIT	0,(IX+7)
  978 F6D5  28 4D       	JR	Z,LOAD5		; Verify
  979 F6D7  2E 10       	LD	L,10H
  980 F6D9  7E          	LD	A,(HL)		; Anzahl der Argumente beim Abspeichern
  981 F6DA  07          	RLCA
  982 F6DB  07          	RLCA			; nach Bits 2..4

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 140
CF46    INC

  983 F6DC  DD AE 07    	XOR	(IX+7)
  984 F6DF  E6 1C       	AND	00011100b	; Bits 0..1 und 5..7 zuruecksetzen
  985 F6E1  DD AE 07    	XOR	(IX+7)		; a = (a XOR b) XOR b fuer Bits 2..4
  986 F6E4  DD 77 07    	LD	(IX+7),A	; in IX+7 merken fuer spaetere Auswertung
  987 F6E7  7E          	LD	A,(HL)		; Anzahl der Argumente
  988 F6E8  D6 02       	SUB	2
  989 F6EA  FE 09       	CP	9		; MC?
  990 F6EC  30 89       	JR	NC,NOMC
  991 F6EE  2A B715     	LD	HL,(CASS+15H)	; SADR
  992 F6F1  E5          	PUSH	HL
  993 F6F2  ED 5B B713  	LD	DE,(CASS+13H)	; EADR+1
  994 F6F6  2A B711     	LD	HL,(CASS+11H)	; AADR
  995 F6F9  3A B781     	LD	A,(ARGN)
  996 F6FC  A7          	AND	A		; Ladeoffset?
  997 F6FD  28 11       	JR	Z,LOAD3		; nein
  998 F6FF  ED 4B B782  	LD	BC,(ARG1)	; Offset
  999 F703  09          	ADD	HL,BC		; Anfangsadresse und Endadresse
 1000 F704  EB          	EX	DE,HL		; umrechnen
 1001 F705  09          	ADD	HL,BC
 1002 F706  EB          	EX	DE,HL
 1003 F707  DD CB 07 66 	BIT	4,(IX+7)	; 4 bis 7 Argumente?
 1004 F70B  20 03       	JR	NZ,LOAD3
 1005 F70D  E3          	EX	(SP),HL
 1006 F70E  09          	ADD	HL,BC		; Startadresse umrechnen
 1007 F70F  E3          	EX	(SP),HL
 1008 F710  CD F4EE     LOAD3:	CALL	HLDE		; Anfangsadresse und Endadresse anzeigen
 1009 F713  3A B710     	LD	A,(CASS+10H)
 1010 F716  FE 03       	CP	3
 1011 F718  38 05       	JR	C,LOAD4		; keine Startadresse
 1012 F71A  E3          	EX	(SP),HL
 1013 F71B  CD F3C4     	CALL	HLHX		; Startadresse anzeigen
 1014 F71E  E3          	EX	(SP),HL
 1015 F71F  C1          LOAD4:	POP	BC		; Startadresse merken
 1016 F720  ED 43 B786  	LD	(ARG3),BC
 1017 F724  CD F4E7     LOAD5:	CALL	CRLF		; Zeilenvorschub nach Dateiname + Adressen
 1018 F727  EB          	EX	DE,HL		; DE = Ladeadresse
 1019                   	; Load-Hauptschleife
 1020 F728  CD F618     LOAD6:	CALL	RDBLK		; 128-Byte-Block einlesen
 1021 F72B  38 A2       	JR	C,LOAD2		; BRK -> CLJP
 1022 F72D  DD CB 07 46 	BIT	0,(IX+7)
 1023 F731  28 28       	JR	Z,LOAD11	; Verify
 1024 F733  E5          	PUSH	HL		; Endadresse
 1025 F734  ED 52       	SBC	HL,DE		; noch zu lesende Bytes
 1026 F736  01 0080     	LD	BC,128		; Blockgroesse 128 Byte
 1027 F739  ED 42       	SBC	HL,BC		; voller Block?
 1028 F73B  09          	ADD	HL,BC
 1029 F73C  30 01       	JR	NC,LOAD7	; ja
 1030 F73E  4D          	LD	C,L		; restliche Anzahl
 1031 F73F  21 B700     LOAD7:	LD	HL,CASS		; Standard-Kassettenpuffer
 1032 F742  3A B801     	LD	A,(MODST+1)
 1033 F745  E6 01       	AND	1
 1034 F747  20 0F       	JR	NZ,LOAD9	; IRM ist ein
 1035 F749  41          	LD	B,C
 1036 F74A  7E          LOAD8:	LD	A,(HL)		; Byteweise aus dem Puffer
 1037 F74B  CD F03D     	CALL	SCROFF
 1038 F74E  12          	LD	(DE),A		; in den RAM kopieren
 1039 F74F  23          	INC	HL
 1040 F750  13          	INC	DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 141
CF46    INC

 1041 F751  CD F046     	CALL	SCRON
 1042 F754  10 F4       	DJNZ	LOAD8
 1043 F756  18 02       	JR	LOAD10
 1044                   	;
 1045 F758  ED B0       LOAD9:	LDIR			; gelesenen Block kopieren
 1046 F75A  E1          LOAD10:	POP	HL
 1047 F75B              LOAD11:
 1048                   ;	INC	(IX+2)		; Blocknummer FF?
 1049                   ;	JR	Z,LOAD12	; ja, Einlesen beenden
 1050 F75B  ED 52       	SBC	HL,DE		; Endadresse erreicht?
 1051 F75D  19          	ADD	HL,DE		; EADR regenerieren (Z-Flag bleibt erhalten)
 1052                   ;
 1053                   ; CAOS 4.6:
 1054                   ; Damit das Einlesen auch bei Diskette funktioniert, muss zusaetzlich oder
 1055                   ; ausschliesslich (?) der Adressvergleich stattfinden! Da hier nur MC-Dateien
 1056                   ; gelesen werden, ist eigentlich keine Abfrage auf Blocknr. FF erforderlich
 1057                   ;
 1058                   
 1059 F75E  20 C8       	JR	NZ,LOAD6
 1060 F760  CD E4BE     LOAD12:	CALL	CLC		; CAOS 4.6: Puffer loeschen nicht mehr in CSRI
 1061 F763  CD F4E7     	CALL	CRLF		; CAOS 4.6: Zeilenvorschub nicht mehr in CSRI
 1062                   	;
 1063 F766  CD F04F     	CALL	PV1		; Datei schliessen
 1064 F769  0B          	DB	0BH		; CSRI
 1065 F76A  DA F68A     	JP	C,CLJP		; Fehler
 1066 F76D  DD 7E 07    	LD	A,(IX+7)
 1067 F770  E6 03       	AND	3
 1068 F772  3D          	DEC	A
 1069 F773  C0          	RET	NZ		; kein Start oder Verify
 1070 F774  DD 7E 07    	LD	A,(IX+7)
 1071 F777  E6 1C       	AND	1CH
 1072 F779  FE 0C       	CP	0CH
 1073 F77B  DD 36 07 00 	LD	(IX+7),0	; Befehl fehlte in CAOS 4.3!
 1074 F77F  D8          	RET	C		; keine Startadresse
 1075 F780  2A B786     	LD	HL,(ARG3)	; Startadresse
 1076 F783  E9          	JP	(HL)		; anspringen
 1077                   
 1078 F784  7F7F        	DW	7F7FH
 1079 F786  43 4F 4C 4F 	DB	'COLOR'
 1080 F78B  01          	DB	1
 1081 F78C  CD FBAD     	CALL	CON
 1082 F78F  C3 C53A     	JP	COLRC
 1083                   
 1084 F792  CD FBAD     COLR:	CALL	CON		; **0F**
 1085 F795  C3 C554     	JP	SETCO
 1086                   
 1087 F798  E5          CSTBT:	PUSH	HL		; **42**
 1088 F799  21 B7A2     	LD	HL,STBT
 1089 F79C  CB DE       	SET	3,(HL)
 1090 F79E  CD F3E5     	CALL	OCHR		; Steuerzeichen
 1091 F7A1  CB 9E       	RES	3,(HL)		; darstellen
 1092 F7A3  E1          	POP	HL
 1093 F7A4  C9          	RET
 1094                   
 1095 F7A5  7F7F        	DW	7F7FH
 1096 F7A7  44 49 53 50 	DB	'DISPLAY'
 1097 F7AE  03          	DB	3
 1098 F7AF  CD FBAD     DISP:	CALL	CON		; **3B**

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 142
CF46    INC

 1099 F7B2  CD C7CF     	CALL	DISPC
 1100 F7B5  18 0F       	JR	JCOFF
 1101                   
 1102 F7B7  7F7F        	DW	7F7FH
 1103 F7B9  4D 4F 44 49 	DB	'MODIFY'
 1104 F7BF  03          	DB	3
 1105 F7C0  CD FBAD     MODI:	CALL	CON		; **2E**
 1106 F7C3  CD C800     	CALL	MODIC
 1107 F7C6  C3 FBBA     JCOFF:	JP	COFF
 1108                   
 1109 F7C9  7F7F        WIND7F:	DW	7F7FH
 1110 F7CB  57 49 4E 44 	DB	'WINDOW'
 1111 F7D1  01          	DB	1
 1112 F7D2  CD FBAD     	CALL	CON
 1113 F7D5  CD C56F     	CALL	WINDC
 1114 F7D8  18 EC       	JR	JCOFF
 1115                   
 1116 F7DA  CD FBAD     WININ:	CALL	CON		; **3C**
 1117 F7DD  CD C5CE     	CALL	WININC
 1118 F7E0  18 E4       	JR	JCOFF
 1119                   
 1120 F7E2  CD FBAD     WINAK:	CALL	CON		; **3D**
 1121 F7E5  CD C59E     	CALL	WINAKC
 1122 F7E8  18 DC       	JR	JCOFF
 1123                   ;
 1124 F7EA  7F7F        KEY7F:	DW	7F7FH
 1125 F7EC  4B 45 59    	DB	'KEY'
 1126 F7EF  01          	DB	1
 1127 F7F0  FE 01       	CP	1
 1128 F7F2  30 08       	JR	NC,KEYL
 1129 F7F4  CD FBAD     KEYLI:	CALL	CON		; **3A**
 1130 F7F7  CD C4F0     	CALL	KEYLIC		; Keylist
 1131 F7FA  18 CA       	JR	JCOFF
 1132                   
 1133 F7FC  7D          KEYL:	LD	A,L		; Nummer
 1134 F7FD  CD FBAD     KEY:	CALL	CON		; **39**
 1135 F800  CD C444     	CALL	KEYC
 1136 F803  18 C1       	JR	JCOFF
 1137                   
 1138                   ; Komplement des Cursors
 1139 F805  D5          CUCP:	PUSH	DE		; **25**
 1140 F806  F5          	PUSH	AF
 1141 F807  E5          	PUSH	HL
 1142 F808  CD E043     	CALL	PADR0
 1143 F80B  38 22       	JR	C,CUCP3		; ausserhalb
 1144 F80D  E5          	PUSH	HL
 1145 F80E  CD E06D     	CALL	DABR
 1146 F811  7E          	LD	A,(HL)
 1147 F812  E1          	POP	HL
 1148 F813  A7          	AND	A		; Dummy?
 1149 F814  20 0A       	JR	NZ,CUCP1
 1150 F816  3E 06       	LD	A,6		; vorletzte
 1151 F818  B5          	OR	L		; Cursorzeile
 1152 F819  6F          	LD	L,A
 1153 F81A  7E          	LD	A,(HL)
 1154 F81B  EE 7F       	XOR	7FH		; Strichcursor
 1155 F81D  77          	LD	(HL),A
 1156 F81E  18 0F       	JR	CUCP3

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 143
CF46    INC

 1157                   	;
 1158 F820  C5          CUCP1:	PUSH	BC
 1159 F821  ED 5B B7EE  	LD	DE,(CUMUST)	; Muster
 1160 F825  06 08       	LD	B,8		; Zeichenhoehe
 1161 F827  1A          CUCP2:	LD	A,(DE)
 1162 F828  AE          	XOR	(HL)		; verknuepfen
 1163 F829  77          	LD	(HL),A
 1164 F82A  13          	INC	DE
 1165 F82B  2C          	INC	L
 1166 F82C  10 F9       	DJNZ	CUCP2		; 8-mal
 1167 F82E  C1          	POP	BC
 1168 F82F  E1          CUCP3:	POP	HL
 1169 F830  F1          	POP	AF
 1170 F831  D1          	POP	DE
 1171 F832  C9          	RET
 1172                   
 1173 F833  CD FBAD     PUSE:	CALL	CON		; **30**
 1174 F836  CD C681     	CALL	PUSEC		; Punkt setzen
 1175 F839  18 66       	JR	COF
 1176                   
 1177 F83B  CD FBAD     PUDE:	CALL	CON		; **2F**
 1178 F83E  CD C75B     	CALL	PUDEC		; Punkt loeschen
 1179 F841  18 5E       	JR	COF
 1180                   
 1181 F843  CD FBAD     CIRCL:	CALL	CON		; **3F**
 1182 F846  CD C68D     	CALL	CIRCLC		; Kreis
 1183 F849  18 56       	JR	COF
 1184                   
 1185 F84B  CD FBAD     LINE:	CALL	CON		; **3E**
 1186 F84E  CD C604     	CALL	LINEC		; Linie
 1187 F851  18 4E       	JR	COF
 1188                   
 1189 F853  CD FBAD     MBOUT:	CALL	CON		; **38**
 1190 F856  CD CD40     	CALL	MBOC		; Byte ausgeben
 1191 F859  18 46       	JR	COF
 1192                   
 1193 F85B  CD FBAD     MBIN:	CALL	CON		; **37**
 1194 F85E  CD CDBD     	CALL	MBIC		; Byte einlesen
 1195 F861  18 3E       	JR	COF
 1196                   
 1197                   ; CAOS 4.6 - Floppy-Treiber (Sprung in ROM D):
 1198                   
 1199 F863  CD FBAD     FISRI:	CALL	CON		; ** 0A **
 1200 F866  CD D000     	CALL	FISRID		; Eingabedatei oeffnen
 1201 F869  18 36       	JR	COF
 1202                   
 1203 F86B  CD FBAD     FMBI:	CALL	CON		; ** 05 **
 1204 F86E  CD D00E     	CALL	FMBID		; Datenblock einlesen
 1205 F871  18 2E       	JR	COF
 1206                   
 1207 F873  CD FBAD     FCSRI:	CALL	CON		; ** 0B **
 1208 F876  CD D02A     	CALL	FCSRID		; Eingabedatei schliessen
 1209 F879  18 26       	JR	COF
 1210                   
 1211 F87B  CD FBAD     FISRO:	CALL	CON		; ** 08 **
 1212 F87E  CD D02E     	CALL	FISROD		; Ausgabedatei oeffnen
 1213 F881  18 1E       	JR	COF
 1214                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 144
CF46    INC

 1215 F883  CD FBAD     FMBO:	CALL	CON		; ** 01 **
 1216 F886  CD D03E     	CALL	FMBOD		; Datenblock schreiben
 1217 F889  18 16       	JR	COF
 1218                   
 1219 F88B  CD FBAD     FCSRO:	CALL	CON		; ** 09 **
 1220 F88E  CD D098     	CALL	FCSROD		; Ausgabedatei schliessen
 1221 F891  18 0E       	JR	COF
 1222                   
 1223 F893  CD FBAD     FMBIN:	CALL	CON		; ** 37 **
 1224 F896  CD D0B1     	CALL	FMBIND		; Datenbyte einlesen
 1225 F899  18 06       	JR	COF
 1226                   
 1227 F89B  CD FBAD     FMBOUT:	CALL	CON		; ** 38 **
 1228 F89E  CD D0BE     	CALL	FMBOUD		; Datenbyte schreiben
 1229 F8A1  C3 FBBA     COF:	JP	COFF
 1230                   
 1231                   ; BASIC-I/O-Verteiler
 1232 F8A4  E5          BASPV:	PUSH	HL
 1233 F8A5  C5          	PUSH	BC
 1234 F8A6  CD F082     	CALL	IRMON
 1235 F8A9  CB 6B       	BIT	5,E
 1236 F8AB  20 53       	JR	NZ,BASBYE	; BYE
 1237 F8AD  D5          	PUSH	DE
 1238 F8AE  23          	INC	HL
 1239 F8AF  23          	INC	HL
 1240 F8B0  CB 7B       	BIT	7,E
 1241 F8B2  20 41       	JR	NZ,BSA2
 1242 F8B4  E5          	PUSH	HL
 1243 F8B5  7B          	LD	A,E
 1244 F8B6  E6 07       	AND	7
 1245 F8B8  21 FDF0     	LD	HL,BUPTAB
 1246 F8BB  85          	ADD	A,L
 1247 F8BC  6F          	LD	L,A
 1248 F8BD  7A          	LD	A,D		; Parameter
 1249 F8BE  53          	LD	D,E		; Steuerbyte
 1250 F8BF  5E          	LD	E,(HL)		; UP-Nummer
 1251 F8C0  E1          	POP	HL		; Dateiname
 1252 F8C1  CD F07F     	CALL	PV3		; Aufruf
 1253 F8C4  D1          	POP	DE
 1254 F8C5  57          	LD	D,A		; Ausgabeparameter
 1255 F8C6  7B          	LD	A,E
 1256 F8C7  E6 4F       	AND	4FH
 1257 F8C9  EE 43       	XOR	43H
 1258 F8CB  20 1F       	JR	NZ,BSA1
 1259 F8CD  DD 7E 08    	LD	A,(IX+8)	; Device ausfiltern
 1260 F8D0  E6 1C       	AND	00011100b
 1261 F8D2  20 18       	JR	NZ,BSA1		; VERIFY nur bei 00=Tape ausfuehren
 1262 F8D4  CD F0CE     	CALL	OSTR
 1263 F8D7  56 45 52 49 	DB	'VERIFY ?(Y):',0
 1264 F8E4  CD F406     	CALL	KBD
 1265 F8E7  FE 59       	CP	'Y'
 1266 F8E9  CC F698     	CALL	Z,VERIF
 1267 F8EC  7A          BSA1:	LD	A,D
 1268 F8ED  CB 9B       	RES	3,E
 1269 F8EF  CD F09F     	CALL	IRMOF
 1270 F8F2  C1          	POP	BC
 1271 F8F3  E1          	POP	HL
 1272 F8F4  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 145
CF46    INC

 1273                   
 1274 F8F5  CD E365     BSA2:	CALL	KBDS
 1275 F8F8  D1          	POP	DE
 1276 F8F9  57          	LD	D,A
 1277 F8FA  30 F0       	JR	NC,BSA1
 1278 F8FC  CB BB       	RES	7,E
 1279 F8FE  18 EC       	JR	BSA1
 1280                   
 1281 F900  3A 035E     BASBYE:	LD	A,(DATFLG)	; geschuetzt?
 1282 F903  A7          	AND	A
 1283 F904  28 09       	JR	Z,BASB1
 1284 F906  CD F09F     	CALL	IRMOF
 1285 F909  CD C641     	CALL	0C641H		; NEW
 1286 F90C  CD F082     	CALL	IRMON
 1287 F90F  16 00       BASB1:	LD	D,0
 1288 F911  3E 02       	LD	A,2		; BASIC-ROM
 1289 F913  6F          	LD	L,A		; abschalten
 1290 F914  CD F107     	CALL	MODU
 1291 F917  C3 F26B     	JP	LOOP
 1292                   
 1293 F91A  CD F3E5     ZKOUT0:	CALL	OCHR
 1294 F91D  7E          ZKOUT:	LD	A,(HL)		; **45**
 1295 F91E  23          	INC	HL
 1296 F91F  A7          	AND	A
 1297 F920  20 F8       	JR	NZ,ZKOUT0
 1298 F922  C9          	RET
 1299                   
 1300 F923  CD F609     TON:	CALL	LARG		; **35**
 1301 F926  DD CB 08 4E TON1:	BIT	1,(IX+8)	; noch alter Ton
 1302 F92A  20 FA       	JR	NZ,TON1
 1303 F92C  C5          TON2:	PUSH	BC
 1304 F92D  0E 8C       	LD	C,CTC0
 1305 F92F  CD F959     	CALL	TON4		; starten
 1306 F932  0C          	INC	C		; CTC1
 1307 F933  EB          	EX	DE,HL
 1308 F934  CD F959     	CALL	TON4		; starten
 1309 F937  C1          	POP	BC
 1310 F938  79          	LD	A,C		; Lautstaerke
 1311 F939  E6 1E       	AND	00011110b	; maskieren
 1312 F93B  EE 9F       	XOR	10011111b	; Komplement da nullaktiv
 1313 F93D  4F          	LD	C,A
 1314 F93E  78          	LD	A,B
 1315 F93F  A7          	AND	A		; Dauerton?
 1316 F940  F3          	DI
 1317 F941  28 0D       	JR	Z,TON3
 1318 F943  CB B9       	RES	7,C		; nein, Blinkaus
 1319 F945  DD CB 08 CE 	SET	1,(IX+8)	; neuer Ton
 1320 F949  3E C7       	LD	A,11000111b	; EI,Zaehler 50Hz
 1321 F94B  D3 8E       	OUT	(CTC2),A	; CTC2
 1322 F94D  78          	LD	A,B		; Dauer
 1323 F94E  D3 8E       	OUT	(CTC2),A
 1324 F950  DB 89       TON3:	IN	A,(PIOBD)
 1325 F952  E6 60       	AND	01100000b	; RAM8 maskieren
 1326 F954  B1          	OR	C
 1327 F955  D3 89       	OUT	(PIOBD),A	; Lautstaerke ausgeben
 1328 F957  FB          	EI
 1329 F958  C9          	RET
 1330                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 146
CF46    INC

 1331                   ; CTC (C) programmieren mit HL:
 1332 F959  7D          TON4:	LD	A,L
 1333 F95A  A7          	AND	A		; Ton?
 1334 F95B  2E 03       	LD	L,00000011b
 1335 F95D  28 0D       	JR	Z,TON6		; kein Ton
 1336 F95F  6F          	LD	L,A
 1337 F960  3E 01       	LD	A,00000001b
 1338 F962  A4          	AND	H		; Vorteiler
 1339 F963  0F          	RRCA			; nach Bit 5 rotieren
 1340 F964  0F          	RRCA
 1341 F965  0F          	RRCA
 1342 F966  F6 07       	OR	00000111b	; Zeitgeber
 1343 F968  F3          	DI
 1344 F969  ED 79       	OUT	(C),A
 1345 F96B  FB          	EI			; Interrupts wieder ein nach zweitem OUT
 1346 F96C  ED 69       TON6:	OUT	(C),L
 1347 F96E  C9          	RET
 1348                   
 1349                   ; ESC-Funktionen:
 1350                   
 1351 F96F  21 B7A2     ESCPRG:	LD	HL,STBT		; ShSTOP
 1352 F972  CB E6       	SET	4,(HL)		; Kennung, dass ESC-Funktion folgt
 1353 F974  C9          	RET
 1354                   
 1355 F975  01 B200     ESC1:	LD	BC,VRAM0	; 0B200H
 1356 F978  18 0D       	JR	ESCVR
 1357                   
 1358 F97A  01 AD05     ESC2:	LD	BC,VRAM1+05H	; 0AD05H
 1359 F97D  18 08       	JR	ESCVR
 1360                   
 1361 F97F  01 AD04     ESC3:	LD	BC,VRAM1+04H	; 0AD04H
 1362 F982  18 03       	JR	ESCVR
 1363                   
 1364 F984  01 B201     ESC4:	LD	BC,VRAM0+01H	; 0B201H
 1365 F987  60          ESCVR:	LD	H,B
 1366 F988  2E 00       	LD	L,0
 1367 F98A  22 B7CB     	LD	(VRAM),HL
 1368 F98D  06 FA       	LD	B,0FAH
 1369 F98F  78          AXO84:	LD	A,B		; AND/XOR/OUT84
 1370 F990  F3          	DI
 1371 F991  DD A6 01    	AND	(IX+1)
 1372 F994  A9          	XOR	C
 1373 F995  DD 77 01    OUT84:	LD	(IX+1),A
 1374 F998  D3 84       	OUT	(84H),A
 1375 F99A  FB          	EI
 1376 F99B  C9          	RET
 1377                   
 1378 F99C  0E 04       ESC7:	LD	C,00000100b	; Invers-Bit
 1379 F99E  21 B7A2     XORSTB:	LD	HL,STBT
 1380 F9A1  7E          	LD	A,(HL)
 1381 F9A2  A9          	XOR	C
 1382 F9A3  77          	LD	(HL),A
 1383 F9A4  C9          	RET
 1384                   
 1385 F9A5  F3          ESC9:	DI
 1386 F9A6  DD 7E 01    	LD	A,(IX+1)	; VR: A
 1387 F9A9  EE 02       	XOR	2
 1388 F9AB  18 E8       	JR	OUT84		; BC unveraendert

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 147
CF46    INC

 1389                   
 1390 F9AD  21 B7A2     ESCA:	LD	HL,STBT
 1391 F9B0  CB B6       	RES	6,(HL)		; HRG aus
 1392 F9B2  01 FF08     ESCAB:	LD	BC,0FF08h
 1393 F9B5  CD F98F     	CALL	AXO84
 1394 F9B8  A1          	AND	C
 1395 F9B9  80          	ADD	A,B		; CY = Bit 3
 1396 F9BA  F3          	DI
 1397 F9BB  DB 89       	IN	A,(PIOBD)
 1398 F9BD  17          	RLA			; als Bit 0 einschieben
 1399 F9BE  0F          	RRCA			; auf Bit 7 rotieren
 1400 F9BF  D3 89       	OUT	(PIOBD),A
 1401 F9C1  FB          	EI
 1402 F9C2  C9          	RET
 1403                   
 1404 F9C3  21 B7A2     ESCB:	LD	HL,STBT
 1405 F9C6  CB F6       	SET	6,(HL)		; HRG ein
 1406 F9C8  18 E8       	JR	ESCAB
 1407                   
 1408 F9CA  0E 20       ESCC:	LD	C,00100000b	; IBM <-> CAOS
 1409 F9CC  18 D0       	JR	XORSTB
 1410                   
 1411                   ; Druckerinitialisierung V.24 oder Centronics:
 1412 F9CE  7F7F        LST7F:	DW	7F7FH
 1413 F9D0  4C 53 54 44 	DB	'LSTDEV'
 1414 F9D6  01          	DB	1
 1415 F9D7  CD FBAD     V24OUT:	CALL	CON		; **47**
 1416 F9DA  CD C876     	CALL	LSTC
 1417 F9DD  C3 FBBA     COF1:	JP	COFF
 1418                   
 1419                   ; Reaktion auf ShCLR:
 1420 F9E0  F5          HCPGM:	PUSH	AF
 1421 F9E1  DD 7E 04    	LD	A,(IX+4)	; CAOS-C merken
 1422 F9E4  F5          	PUSH	AF
 1423                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 F9E5  DD CB 04    	 DB	0DDh,0CBh,4
    2 F9E8  FF          	 DB	7 SHL 3 OR 11000111b
 1424 F9E9  D3 86       	OUT	(86h),A		; CAOS-C on
 1425 F9EB  CD CA34     	CALL	HCPGMC
 1426 F9EE  F1          	POP	AF
 1427 F9EF  DD 77 04    	LD	(IX+4),A	; wie vorher
 1428 F9F2  D3 86       	OUT	(86h),A
 1429 F9F4  F1          	POP	AF
 1430 F9F5  C9          	RET
 1431                   
 1432                   ; Duplexroutine
 1433 F9F6  7F7F        V24D7F:	DW	7F7FH
 1434 F9F8  56 32 34 44 	DB	'V24DUP'
 1435 F9FE  01          	DB	1
 1436 F9FF  CD FBAD     V24DUP:	CALL	CON		; **48**
 1437 FA02  CD C957     	CALL	V24DC
 1438 FA05  DC F4DD     	CALL	C,ERRM
 1439 FA08  18 D3       	JR	COF1
 1440                   
 1441                   ; Druckroutine mit Protokoll
 1442 FA0A  CD E091     ECHO:	CALL	CRT
 1443 FA0D  DD CB 04 7E PRINT:	BIT	7,(IX+4)
 1444 FA11  20 08       	JR	NZ,PR1		; CAOSC on!

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 148
CF46    INC

 1445 FA13  E5          	PUSH	HL
 1446 FA14  21 FBBA     	LD	HL,COFF		; nach PRINTC
 1447 FA17  E3          	EX	(SP),HL		; wieder aus
 1448 FA18  CD FBAD     	CALL	CON
 1449 FA1B  C3 C9E4     PR1:	JP	PRINTC		; drucken
 1450                   ; Druckroutine fuer M001:			17 Byte
 1451                   ;
 1452                   ; PE:	A	Zeichen
 1453                   ; VR:	-
 1454                   
 1455 FA1E  C5          M001PR:	PUSH	BC
 1456 FA1F  F5          	PUSH	AF
 1457 FA20  0E 05       	LD	C,05h		; M001 PIO Port B (Steuersignale)
 1458 FA22  ED 40       CBUSY1:	IN	B,(C)
 1459 FA24  CB 50       	BIT	2,B		; BUSY?
 1460 FA26  20 FA       	JR	NZ,CBUSY1
 1461 FA28  06 01       	LD	B,00000001b	; Bit 0 = Strobe
 1462 FA2A  F3          	DI			; DI wegen Joysticktreiber
 1463 FA2B  D3 04       	OUT	(04h),A		; M001 PIO Port A (Daten)
 1464 FA2D  18 0F       	JR	CSTROB
 1465                    
 1466                   ; Druckroutine fuer M021:
 1467                   ;
 1468                   ; PE:	A	Zeichen
 1469                   ; VR:	-
 1470                   
 1471 FA2F  C5          M021PR:	PUSH	BC
 1472 FA30  F5          	PUSH	AF
 1473 FA31  0E 90       	LD	C,90h		; M021 PIO Port A (Steuersignale)
 1474 FA33  ED 40       CBUSY2:	IN	B,(C)
 1475 FA35  CB 70       	BIT	6,B		; BUSY?
 1476 FA37  20 FA       	JR	NZ,CBUSY2
 1477 FA39  06 80       	LD	B,10000000b	; Bit 7 = Strobe
 1478 FA3B  F3          	DI			; DI wegen Joysticktreiber
 1479 FA3C  D3 91       	OUT	(91h),A		; M021 PIO Port B (Daten)
 1480 FA3E  AF          CSTROB:	XOR	A		; Strobe-Impuls aktiv
 1481 FA3F  ED 79       	OUT	(C),A		; war vorher ED 71 = OUT (C),0
 1482 FA41  FB          	EI			; (erst nach naechstem Befehl)
 1483 FA42  ED 41       	OUT	(C),B		; Strobe-Impuls passiv
 1484 FA44  F1          	POP	AF
 1485 FA45  C1          	POP	BC
 1486 FA46  C9          	RET
 1487                   
 1488                   ; Druckroutine fuer V.24:
 1489                   ;
 1490                   ; PE:	A	Zeichen
 1491                   ; VR:	-
 1492                   
 1493 FA47  C5          V24PR:	PUSH	BC
 1494 FA48  F5          	PUSH	AF
 1495 FA49  CD FAA1     	CALL	LCSO
 1496 FA4C  C6 0A       V24PR0:	ADD	A,0Ah		; SIO-Steuerport
 1497 FA4E  4F          	LD	C,A
 1498 FA4F  ED 78       V24PR1:	IN	A,(C)
 1499 FA51  E6 04       	AND	00000100b	; bereit?
 1500 FA53  20 03       	JR	NZ,V24PR2
 1501 FA55  3C          	INC	A		; A=1
 1502                   ;	CALL	WAIT		; nein: warten (wofuer?)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 149
CF46    INC

 1503 FA56  18 F7       	JR	V24PR1
 1504 FA58  0D          V24PR2:	DEC	C		; SIO-Datenport
 1505 FA59  0D          	DEC	C
 1506 FA5A  F1          	POP	AF
 1507 FA5B  ED 79       	OUT	(C),A		; Ausgabe
 1508 FA5D  C1          	POP	BC
 1509 FA5E  C9          	RET
 1510                   
 1511                   ; Ausgabe V.24-Duplex:
 1512                   ;
 1513                   ; PE:	A	Zeichen
 1514                   ; VR:	-
 1515                   ;
 1516 FA5F  C5          V24OT:	PUSH	BC
 1517 FA60  F5          	PUSH	AF
 1518 FA61  CD FAA9     	CALL	LCSOD		; Adresse holen
 1519 FA64  18 E6       	JR	V24PR0
 1520                   
 1521                   ; Eingabe V.24-Duplex (Interrupt):
 1522                   ;
 1523                   ; PA:	A	Zeichen
 1524                   ;	CY	Status (1 = BRK, 0 = Zeichen gueltig)
 1525                   ; VR:	AF
 1526                   ;
 1527 FA66  3E EE       V24I:	LD	A,11101110b	; Steuerbyte fuer Interrupt-Betrieb
 1528 FA68  18 03       	JR	V24IN0
 1529                   
 1530                   ; Eingabe V.24-Duplex (Polling):
 1531                   ;
 1532                   ; PA:	A	Zeichen
 1533                   ;	CY	Status (1 = BRK, 0 = Zeichen gueltig)
 1534                   ; VR:	AF
 1535                   ;
 1536 FA6A  3A B7E8     V24IN:	LD	A,(HCPZ2)
 1537 FA6D  C5          V24IN0:	PUSH	BC
 1538 FA6E  D5          	PUSH	DE
 1539 FA6F  57          	LD	D,A		; Steuerbyte
 1540 FA70  E6 04       	AND	00000100b	; Kanal A oder B?
 1541 FA72  0F          	RRCA
 1542 FA73  0F          	RRCA
 1543 FA74  C6 0A       	ADD	A,0Ah		; SIO-Steuerport
 1544 FA76  4F          	LD	C,A
 1545 FA77  3E 68       	LD	A,01101000b	; Sendeeinstellungen
 1546 FA79  A2          	AND	D
 1547 FA7A  5F          	LD	E,A
 1548 FA7B  ED 78       V24IN1:	IN	A,(C)
 1549 FA7D  E6 01       	AND	00000001b	; CY=0, Daten abholbereit?
 1550 FA7F  3E 05       	LD	A,5		; WR5 auswaehlen
 1551 FA81  F3          	DI			; Interrupts waehrend I/O-Sequenz sperren
 1552 FA82  ED 79       	OUT	(C),A
 1553 FA84  20 0B       	JR	NZ,V24IN2
 1554 FA86  3E 82       	LD	A,10000010b	; DTR+RTS ein
 1555 FA88  B3          	OR	E
 1556 FA89  ED 79       	OUT	(C),A		; Senderfreigabe
 1557 FA8B  FB          	EI
 1558 FA8C  CD E379     	CALL	BRKT
 1559 FA8F  30 EA       	JR	NC,V24IN1
 1560 FA91  ED 59       V24IN2:	OUT	(C),E		; DTR+RTS aus: Sender sperren

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 150
CF46    INC

 1561 FA93  FB          	EI
 1562 FA94  38 08       	JR	C,V24IN3
 1563 FA96  0D          	DEC	C		; SIO-Datenport auswaehlen
 1564 FA97  0D          	DEC	C
 1565 FA98  ED 40       	IN	B,(C)
 1566 FA9A  3E 7F       	LD	A,01111111b	; Maske fuer 7 Bit
 1567 FA9C  B2          	OR	D
 1568 FA9D  A0          	AND	B		; maskieren, CY=0
 1569 FA9E  D1          V24IN3:	POP	DE
 1570 FA9F  C1          	POP	BC
 1571 FAA0  C9          	RET
 1572                   
 1573                   ; SIO-Offset fuer V24OUT
 1574                   ; PA: A (SIO-Offset)
 1575                   ; VR: AF
 1576 FAA1  3A B7E1     LCSO:	LD	A,(HCPZ)
 1577 FAA4  E6 04       LCSO1:	AND	00000100b	; Kanal A oder B?
 1578 FAA6  0F          	RRCA
 1579 FAA7  0F          	RRCA
 1580 FAA8  C9          	RET
 1581                   
 1582                   ; SIO-Offset fuer V24DUP
 1583 FAA9  3A B7E8     LCSOD:	LD	A,(HCPZ2)
 1584 FAAC  18 F6       	JR	LCSO1
 1585                   
 1586                   ;
 1587                   ; ISR SIO B (Empfangsinterrupt)
 1588                   ; fuer MC-Load, MC-Start, Umschaltung auf Fremdtastatur
 1589                   ;
 1590 FAAE  E5          ISRSB:	PUSH	HL
 1591 FAAF  D5          	PUSH	DE
 1592 FAB0  C5          	PUSH	BC
 1593 FAB1  F5          	PUSH	AF
 1594 FAB2  21 A800     	LD	HL,V24PL	; Steckplatz M003
 1595 FAB5  CD E383     	CALL	IRMGET		; aus IRM lesen (Rueckkehr mit EI)
 1596 FAB8  47          	LD	B,A		; Steckplatz M003 holen
 1597 FAB9  0E 80       	LD	C,80h
 1598 FABB  3E 01       	LD	A,1
 1599 FABD  ED 79       	OUT	(C),A		; Modul einschalten
 1600 FABF  D9          	EXX			; auf Zweitregistersatz wechseln
 1601 FAC0  D5          	 PUSH	DE		; DE' sichern
 1602 FAC1  C5          	 PUSH	BC		; BC' sichern
 1603 FAC2  DB 88       	 IN	A,(PIOAD)
 1604 FAC4  47          	 LD	B,A		; Schaltzustand IRM in Register B' merken
 1605 FAC5  DD 4E 04    	 LD	C,(IX+4)	; Schaltzustand CAOS-C  in Reg. C' merken
 1606                   	 SETIXA	7,4		; SET 7,(IX+4),A
    1 FAC8  DD CB 04    	 DB	0DDh,0CBh,4
    2 FACB  FF          	 DB	7 SHL 3 OR 11000111b
 1607 FACC  D3 86       	 OUT	(86h),A		; CAOS-C einschalten
 1608 FACE  D9          	EXX
 1609 FACF  21 CD37     	LD	HL,V24POL
 1610 FAD2  F3          	DI
 1611 FAD3  DB 09       	IN	A,(9)		; empfangenes Zeichen von SIO abholen
 1612 FAD5  CD F55B     	CALL	INIEA		; DTR off
 1613 FAD8  CD E5BD     	CALL	IRET		; EI; RETI
 1614                   
 1615 FADB  FE 0D       	CP	CR		; Fremdtastatur?
 1616 FADD  28 2D       	JR	Z,ISB2

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 151
CF46    INC

 1617 FADF  FE 1B       	CP	ESC		; MC-Programm?
 1618 FAE1  20 0A       	JR	NZ,ISB1
 1619                   
 1620 FAE3  CD FA66     	CALL	V24I		; Folgezeichen nach ESC abholen
 1621 FAE6  D6 54       	SUB	'T'		; ESC-T ?
 1622 FAE8  28 2E       	JR	Z,ISB4		; -> MC laden
 1623 FAEA  3D          	DEC	A		; ESC-U ?
 1624 FAEB  28 74       	JR	Z,ISB6		; -> MC starten
 1625                   
 1626 FAED  26 B8       ISB1:	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
 1627 FAEF  68          	LD	L,B		; Steckplatz
 1628 FAF0  CD E383     	CALL	IRMGET		; Schaltzustand vor ISR ermitteln
 1629 FAF3  21 CD2A     	LD	HL,V24INT	; SIO Kanal B wieder auf Interrupt einstellen
 1630 FAF6  0E 80       	LD	C,80h
 1631 FAF8  F3          	DI
 1632 FAF9  CD F55B     	CALL	INIEA		; initialisieren
 1633 FAFC  ED 79       	OUT	(C),A		; M003-Schaltzustand wiederherstellen
 1634 FAFE  FB          	EI
 1635 FAFF  D9          	EXX
 1636 FB00  79          	 LD	A,C
 1637 FB01  DD 77 04    	 LD	(IX+4),A
 1638 FB04  D3 86       	 OUT	(86h),A		; CAOS-C wie vor Interrupt
 1639 FB06  C1          	 POP	BC		; BC' regenerieren
 1640 FB07  D1          	 POP	DE		; DE' regenerieren
 1641 FB08  D9          	EXX
 1642 FB09  C3 E09C     	JP	POP4		; POP	AF,BC,DE,HL   RET
 1643                   
 1644 FB0C  F3          ISB2:	DI
 1645 FB0D  DD 36 F2 94 	LD	(IX-14),LOW(ISRT)	; neue Tastatur-ISR fuer SIO-B in
 1646 FB11  DD 36 F3 E3 	LD	(IX-13),HIGH(ISRT)	; Interrupttabelle 01E2H+01E3H
 1647 FB15  FB          	EI
 1648 FB16  18 D5       	JR	ISB1
 1649                   ;
 1650                   ; MC laden (ESC-T, Adresse, Anzahl, Daten):
 1651                   ;
 1652 FB18  21 B801     ISB4:	LD	HL,MODST+1	; IRM = internes Modul 1
 1653 FB1B  CD E383     	CALL	IRMGET		; Modulsteuerwort holen
 1654 FB1E  E6 01       	AND	1
 1655 FB20  07          	RLCA			; auf Bit 2 rotieren
 1656 FB21  07          	RLCA
 1657 FB22  D9          	EXX			; auf Zweitregistersatz wechseln
 1658 FB23  57          	 LD	D,A
 1659 FB24  3E 7B       	 LD	A,01111011b	; USER-C aus
 1660 FB26  A0          	 AND	B		; gemerkte Schaltzustaende
 1661 FB27  B2          	 OR	D		; gewuenschter IRM-Schaltzustand
 1662 FB28  57          	 LD	D,A
 1663 FB29  D9          	EXX
 1664                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FB2A  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB2D  BF          	 DB	7 SHL 3 OR 10000111b
 1665 FB2E  D3 86       	OUT	(86h),A		; CAOS-C ausschalten
 1666 FB30  CD FA66     	CALL	V24I
 1667 FB33  6F          	LD	L,A		; HL = Adresse
 1668 FB34  CD FA66     	CALL	V24I
 1669 FB37  67          	LD	H,A
 1670 FB38  CD FA66     	CALL	V24I
 1671 FB3B  5F          	LD	E,A		; DE = Anzahl Bytes
 1672 FB3C  CD FA66     	CALL	V24I

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 152
CF46    INC

 1673 FB3F  57          	LD	D,A
 1674 FB40  CD FA66     ISB5:	CALL	V24I
 1675 FB43  38 14       	JR	C,ISB8		; Break
 1676 FB45  4F          	LD	C,A		; C = Datenbyte
 1677 FB46  D9          	EXX
 1678 FB47  7A          	 LD	A,D		; logischer IRM-Schaltzustand
 1679 FB48  D9          	EXX
 1680 FB49  F3          	DI
 1681 FB4A  D3 88       	OUT	(PIOAD),A	; USER-C aus und IRM schalten
 1682 FB4C  71          	LD	(HL),C		; Daten in Speicher poken
 1683 FB4D  D9          	EXX
 1684 FB4E  78          	 LD	A,B		; gemerkter IRM-Schaltzustand
 1685 FB4F  D3 88       	 OUT	(PIOAD),A	; USER-C und IRM wiederherstellen
 1686 FB51  FB          	 EI
 1687 FB52  D9          	EXX
 1688 FB53  23          	INC	HL
 1689 FB54  1B          	DEC	DE		; Zaehler verringern
 1690 FB55  7B          	LD	A,E
 1691 FB56  B2          	OR	D		; bis Anzahl=0
 1692 FB57  20 E7       	JR	NZ,ISB5
 1693 FB59              ISB8:	SETIXA	7,4		; SET 7,(IX+4),A
    1 FB59  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB5C  FF          	 DB	7 SHL 3 OR 11000111b
 1694 FB5D  D3 86       	OUT	(86h),A		; CAOS-C einschalten
 1695 FB5F  18 8C       	JR	ISB1
 1696                   ;
 1697                   ; MC starten (ESC-U, Adresse):
 1698                   ;
 1699 FB61  CD FA66     ISB6:	CALL	V24I
 1700 FB64  5F          	LD	E,A		; DE = Startadresse
 1701 FB65  CD FA66     	CALL	V24I
 1702 FB68  57          	LD	D,A
 1703 FB69  21 CD2A     	LD	HL,V24INT	; SIO Kanal B wieder auf Interrupt einstellen
 1704 FB6C  D9          	EXX
 1705 FB6D  78          	 LD	A,B		; gemerkter IRM-Schaltzustand
 1706 FB6E  D9          	EXX
 1707 FB6F  F6 04       	OR	00000100b	; IRM einschalten
 1708 FB71  F3          	DI
 1709 FB72  CD F55B     	CALL	INIEA		; uminitialisieren
 1710 FB75  D3 88       	OUT	(PIOAD),A	; IRM schalten
 1711                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FB77  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB7A  BF          	 DB	7 SHL 3 OR 10000111b
 1712 FB7B  D3 86       	OUT	(86h),A		; CAOS-C ausschalten
 1713 FB7D  ED 7B B7AE  	LD	SP,(SYSP)
 1714 FB81  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerbytespeicher
 1715 FB83  68          	LD	L,B		; Steckplatz
 1716 FB84  7E          	LD	A,(HL)		; M003-Schaltzustand vor ISR ermitteln
 1717 FB85  ED 79       	OUT	(C),A		; und wiederherstellen
 1718 FB87  FB          	EI
 1719 FB88  21 F26B     	LD	HL,LOOP		; Rueckkehradresse nach Programmaufruf
 1720 FB8B  E5          	PUSH	HL
 1721 FB8C  EB          	EX	DE,HL
 1722 FB8D  E9          	JP	(HL)		; Programm jetzt starten
 1723                   
 1724                   ; fuer MODIC, FLOAD
 1725 FB8E  CD FBBA     LDMAE:	CALL	COFF
 1726 FB91  F5          	PUSH	AF

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 153
CF46    INC

 1727 FB92  3A B801     	LD	A,(MODST+1)
 1728 FB95  E6 01       	AND	1		; IRM off?
 1729 FB97  CC F03D     	CALL	Z,SCROFF
 1730 FB9A  F1          	POP	AF
 1731 FB9B  77          	LD	(HL),A		; Byte eintragen
 1732 FB9C  18 0F       	JR	CON
 1733                   
 1734                   ; Datenbyte holen (fuer DISPC, MODIC, FSAVE, view)
 1735 FB9E  CD FBBA     LDAME:	CALL	COFF		; CAOS-C aus
 1736 FBA1  3A B801     	LD	A,(MODST+1)
 1737 FBA4  E6 01       	AND	1		; IRM aus?
 1738 FBA6  CC F03D     	CALL	Z,SCROFF
 1739 FBA9  7E          	LD	A,(HL)		; Byte holen
 1740 FBAA  CD F046     	CALL	SCRON
 1741                   ;	JP	CON		; reinlaufen...
 1742                   
 1743                   ; CAOS-ROM-C einschalten:
 1744 FBAD  F5          CON:	PUSH	AF
 1745                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 FBAE  DD CB 04    	 DB	0DDh,0CBh,4
    2 FBB1  FF          	 DB	7 SHL 3 OR 11000111b
 1746 FBB2  18 12       	JR	CSW
 1747                   
 1748 FBB4  CD FBAD     SIXD:	CALL	CON		; **31**
 1749 FBB7  CD C0DE     	CALL	SIXC
 1750                   ;	JP	COFF		; reinlaufen...
 1751                   
 1752                   ; CAOS-ROM-C ausschalten falls erforderlich:
 1753 FBBA  F5          COFF:	PUSH	AF
 1754 FBBB  3A B805     	LD	A,(MODST+5)	; Schaltzustand Moduladresse 5
 1755 FBBE  E6 01       	AND	1
 1756 FBC0  20 06       	JR	NZ,CNSW		; bleibt ein!
 1757                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FBC2  DD CB 04    	 DB	0DDh,0CBh,4
    2 FBC5  BF          	 DB	7 SHL 3 OR 10000111b
 1758 FBC6  D3 86       CSW:	OUT	(86h),A
 1759 FBC8  F1          CNSW:	POP	AF
 1760 FBC9  C9          	RET
 1761                   
 1762 FBCA  CD FBAD     MULT:	CALL	CON		; **41**
 1763 FBCD  C3 D328     	JP	MULC		; BA=D*C
 1764                   
 1765 FBD0  CD FBAD     SQR:	CALL	CON		; **40**
 1766 FBD3  C3 D317     	JP	SQRC
 1767                   ;
 1768                   ; ISR fuer CTC2: Tonlaenge
 1769                   ;
 1770 FBD6  F5          ISRC2:	PUSH	AF
 1771 FBD7  E5          	PUSH	HL
 1772 FBD8  CD E467     	CALL	TOFF		; kehrt mit EI zurueck
 1773 FBDB  E1          	POP	HL
 1774 FBDC  F1          	POP	AF
 1775 FBDD  ED 4D       	RETI
 1776                   ;
 1777                   ; Kassette ein/aus (CD im Tape-Mode)
 1778                   ;
 1779 FBDF  DB 88       MOT:	IN	A,(PIOAD)
 1780 FBE1  EE 40       	XOR	01000000b	; Motor ein/aus

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 154
CF46    INC

 1781 FBE3  D3 88       	OUT	(PIOAD),A
 1782 FBE5  C9          	RET
 1783                   ;
 1784                   ; CAOS 4.6 - Geraeteumschaltung und Anzeige
 1785                   ; %DEVICE	Auflisten der installierten Treiber
 1786                   ; %DEVICE n	Umschaltung Geraet n (0..7)
 1787                   ;
 1788 FBE6  7F7F        	DW	7F7Fh
 1789 FBE8  44 45 56 49 	DB	'DEVICE',1
 1790 FBEF  A7          	AND	A		; Parameter angegeben?
 1791 FBF0  28 0F       	JR	Z,DRLIST	; nein, Treiber auflisten
 1792 FBF2  7D          	LD	A,L
 1793 FBF3  FE 08       	CP	8		; falls n<8
 1794 FBF5  DC FC03     	CALL	C,SETDEV	; Treiber einstellen
 1795 FBF8  CD FBFE     	CALL	DEVANZ		; Ergebnis anzeigen
 1796 FBFB  C3 F4E7     	JP	CRLF
 1797                   
 1798                   ; Geraetecode in Bits 2-4 (IX+8) eintragen und Treiberadressen in SUTAB kopieren
 1799                   ; PE:	A	Geraetecode 0...7
 1800                   ;		0 = Kassette - Standard
 1801                   ;		1 = Diskette - D004/D008
 1802                   ;		2 = USB (M052)
 1803                   ;		3 = Netzwerk (M052)
 1804                   ;		4-7 noch nicht benutzt
 1805                   ;		8-FE	Name des aktuellen Treibers anzeigen
 1806                   ;		FF	alle Treiber auflisten
 1807                   ; PA:	CY=1	ausgewaehlter Treiber nicht aktiv
 1808                   ;	IX+8	Bit 2-4 entsprechend Treibernummer gesetzt
 1809                   ; VR:	AF,BC,DE,HL
 1810                   
 1811 FBFE  3E FE       DEVANZ:	LD	A,0FEh		; aktuellen Treiber anzeigen
 1812 FC00  21          	db	21h
 1813 FC01  3E FF       DRLIST:	LD	A,0FFh		; Treiber auflisten
 1814 FC03  CD FBAD     SETDEV:	CALL	CON		;					**49**
 1815 FC06  CD D676     	CALL	SET_DD		; Routine im ROM C/D aufrufen
 1816 FC09  C3 FBBA     SETDC:	JP	COFF
 1817                   
 1818                   ; Geraetetreiber-Funktion aufrufen
 1819                   ; PE:	A	Funktionsnummer
 1820                   ;	A=0	DIR bzw. TAPELIST
 1821                   ;	A=1	DRIVE oder CD
 1822                   ;	A=2	ERA (Datei loeschen)
 1823                   ;	A=3	REN (Datei umbenennen)
 1824                   ;	DE	Dateiname, Maske...
 1825                   ; PA:		entsprechend Treiber
 1826                   ; VR:	AF,BC,DE,HL
 1827                   
 1828 FC0C  CD FBAD     DEVFKT:	CALL	CON		; Treiberfunktionen			**4A**
 1829 FC0F  CD D7C1     	CALL	FKT_DD		; Routine im ROM C/D aufrufen
 1830 FC12  18 F5       	JR	SETDC
 1831                   ;
 1832                   ; Zeigertabelle fuer Unterprogramme
 1833                   ;
 1834 FC14  00          ZEI0:	DB	0	; CRT
 1835 FC15  38          	DB	38H	; MBOUT
 1836 FC16  02          ZEI2:	DB	2	; UOUT1
 1837 FC17  03          ZEI3:	DB	3	; UOUT2
 1838 FC18  04          ZEI4:	DB	4	; KBD

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 155
CF46    INC

 1839 FC19  37          	DB	37H	; MBIN
 1840 FC1A  06          	DB	6	; UIN1
 1841 FC1B  07          	DB	7	; UIN2
 1842                   ;
 1843                   ; Tastaturcodetabelle:
 1844                   ;				 Taste		Scancode:
 1845 FC1C  57 77       KTAB:	DB	'Ww'		;		00 01
 1846 FC1E  41 61       	DB	'Aa'		;		02 03
 1847 FC20  32 22       	DB	'2"'		;		04 05
 1848 FC22  08 19       	DB	8,19H		; CUL		06 07
 1849 FC24  10 0C       	DB	10H,0CH		; HOME		08 09
 1850 FC26  2D 3D       	DB	'-='		;		0A 0B
 1851 FC28  F2 F8       	DB	0F2H,0F8H	; F2		0C 0D
 1852 FC2A  59 79       	DB	'Yy'		;		0E 0F	
 1853 FC2C  45 65       	DB	'Ee'		;		10 11
 1854 FC2E  53 73       	DB	'Ss'		;		12 13
 1855 FC30  33 23       	DB	'3#'		;		14 15
 1856 FC32  5E 5D       	DB	'^]'		;		16 17
 1857 FC34  01 0F       	DB	1,0FH		; CLR		18 19
 1858 FC36  3A 2A       	DB	':*'		;		1A 1B
 1859 FC38  F3 F9       	DB	0F3H,0F9H	; F3		1C 1D
 1860 FC3A  58 78       	DB	'Xx'		;		1E 1F
 1861 FC3C  54 74       	DB	'Tt'		;		20 21
 1862 FC3E  46 66       	DB	'Ff'		;		22 23
 1863 FC40  35 25       	DB	'5%'		;		24 25
 1864 FC42  50 70       	DB	'Pp'		;		26 27
 1865 FC44  1F 02       	DB	1FH,2		; DEL		28 29
 1866 FC46  30 40       	DB	'0',40H		;		2A 2B
 1867 FC48  F5 FB       	DB	0F5H,0FBH	; F5		2C 2D
 1868 FC4A  56 76       	DB	'Vv'		;		2E 2F
 1869 FC4C  55 75       	DB	'Uu'		;		30 31
 1870 FC4E  48 68       	DB	'Hh'		;		32 33
 1871 FC50  37 27       	DB	'7',27H		; 7 / Apostroph	34 35
 1872 FC52  4F 6F       	DB	'Oo'		;		36 37
 1873 FC54  1A 14       	DB	1AH,14H		; INS		38 39
 1874 FC56  39 29       	DB	'9)'		;		3A 3B
 1875 FC58  03 04       	DB	3,4		; BRK		3C 3D
 1876 FC5A  4E 6E       	DB	'Nn'		;		3E 3F
 1877 FC5C  49 69       	DB	'Ii'		;		40 41
 1878 FC5E  4A 6A       	DB	'Jj'		;		42 43
 1879 FC60  38 28       	DB	'8('		;		44 45
 1880 FC62  20 5B       	DB	' ['		; SPC		46 47
 1881 FC64  4B 6B       	DB	'Kk'		;		48 49
 1882 FC66  2C 3C       	DB	',<'		;		4A 4B
 1883 FC68  13 1B       	DB	13H,ESC		; STOP		4C 4D
 1884 FC6A  4D 6D       	DB	'Mm'		;		4E 4F
 1885 FC6C  5A 7A       	DB	'Zz'		;		50 51
 1886 FC6E  47 67       	DB	'Gg'		;		52 53
 1887 FC70  36 26       	DB	'6&'		;		54 55
 1888 FC72  1C 1D       	DB	1CH,1DH		; LIST/RUN	56 57
 1889 FC74  4C 6C       	DB	'Ll'		;		58 59
 1890 FC76  2E 3E       	DB	'.>'		;		5A 5B
 1891 FC78  F6 FC       	DB	0F6H,0FCH	; F6		5C 5D
 1892 FC7A  42 62       	DB	'Bb'		;		5E 5F
 1893 FC7C  52 72       	DB	'Rr'		;		60 61
 1894 FC7E  44 64       	DB	'Dd'		;		62 63
 1895 FC80  34 24       	DB	'4$'		;		64 65
 1896 FC82  5F 5C       	DB	'_\'		;		66 67

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 156
CF46    INC

 1897 FC84  2B 3B       	DB	'+;'		;		68 69
 1898 FC86  2F 3F       	DB	'/?'		;		6A 6B
 1899 FC88  F4 FA       	DB	0F4H,0FAH	; F4		6C 6D
 1900 FC8A  43 63       	DB	'Cc'		;		6E 6F
 1901 FC8C  51 71       	DB	'Qq'		;		70 71
 1902 FC8E  16 05       	DB	16H,5		; CAPS		72 73
 1903 FC90  31 21       	DB	'1!'		;		74 75
 1904 FC92  0A 12       	DB	LF,12H		; CUD		76 77
 1905 FC94  0B 11       	DB	0BH,11H		; CUU		78 79
 1906 FC96  09 18       	DB	9,18H		; CUR		7A 7B
 1907 FC98  F1 F7       	DB	0F1H,0F7H	; F1		7C 7D
 1908 FC9A  0D 0E       	DB	CR,0EH		; ENTER		7E 7F
 1909                   ;
 1910                   ; Tabelle der ESC-Funktionen:
 1911                   ;
 1912 FC9C  E1BF        ESCTAB:	DW	ESC0		; Tabulator
 1913 FC9E  F975        	DW	ESC1		; Anzeige Bild 0	Zugriff Bild 0
 1914 FCA0  F97A        	DW	ESC2		;	  Bild 1		Bild 1
 1915 FCA2  F97F        	DW	ESC3		;	  Bild 0		Bild 1
 1916 FCA4  F984        	DW	ESC4		;	  Bild 1		Bild 0
 1917 FCA6  F0F0        	DW	ESC5		; MODUL
 1918 FCA8  F0F8        	DW	ESC6		; SYSTEM
 1919 FCAA  F99C        	DW	ESC7		; PixInvers o/o
 1920 FCAC  E2B8        	DW	ESC8		; ColSwap o/o
 1921 FCAE  F9A5        	DW	ESC9		; Farbebene o/o
 1922 FCB0  F9AD        	DW	ESCA		; HiRes o/o
 1923 FCB2  F9C3        	DW	ESCB		; HRG o/o
 1924 FCB4  F9CA        	DW	ESCC		; IBM/CAOS
 1925 FCB6  F110        	DW	ESCD		; DEVICE-Umschaltung
 1926                   ;
 1927                   ; Steuercodetabelle:
 1928                   ;
 1929 FCB8  F4CB        CRTTAB:	DW	NOOP	; 00
 1930 FCBA  E206        	DW	CLR	; 01
 1931 FCBC  E27D        	DW	CLLN	; 02
 1932 FCBE  F4CB        	DW	NOOP	; 03=BRK
 1933 FCC0  F4CB        	DW	NOOP	; 04=Sh-BRK
 1934 FCC2  E1BF        	DW	ESC0	; 05=TAB
 1935 FCC4  F4CB        	DW	NOOP	; 06
 1936 FCC6  E291        	DW	BEEP	; 07
 1937 FCC8  E1E5        	DW	CUL	; 08
 1938 FCCA  E1CE        	DW	CUR	; 09
 1939 FCCC  E1D7        	DW	CUD	; 0A
 1940 FCCE  E1F5        	DW	CUU	; 0B
 1941 FCD0  E25B        	DW	CLS	; 0C
 1942 FCD2  E26B        	DW	CBL	; 0D=Enter
 1943 FCD4  F4CB        	DW	NOOP	; 0E=Sh-Enter
 1944 FCD6  E1E1        	DW	HCOPY	; 0F
 1945 FCD8  E269        	DW	HOMEPG	; 10
 1946 FCDA  E1FA        	DW	PAGEM	; 11
 1947 FCDC  E201        	DW	SCROL	; 12
 1948 FCDE  F4CB        	DW	NOOP	; 13=STOP
 1949 FCE0  E2D2        	DW	CLICK	; 14
 1950 FCE2  F4CB        	DW	NOOP	; 15
 1951 FCE4  F4CB        	DW	NOOP	; 16=CAPS
 1952 FCE6  F4CB        	DW	NOOP	; 17
 1953 FCE8  E1EF        	DW	CEL	; 18
 1954 FCEA  E26B        	DW	CBL	; 19

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 157
CF46    INC

 1955 FCEC  E23C        	DW	INS	; 1A
 1956 FCEE  F96F        	DW	ESCPRG	; 1B
 1957 FCF0  F4CB        	DW	NOOP	; 1C=LIST
 1958 FCF2  F4CB        	DW	NOOP	; 1D=RUN
 1959 FCF4  E1D5        	DW	NL	; 1E=CONT
 1960 FCF6  E209        	DW	DEL	; 1F
 1961                   ;
 1962                   ; BASIC-Token	(Bit 7 im 1. Byte gesetzt!)
 1963                   ;
 1964 FCF8              TOKTAB:	TOKEN	INKEY$		; D5
    1 FCF8  C9          	  DB	'I' + Y
    1 FCF9  4E          	  DB	'N' + Y
    1 FCFA  4B          	  DB	'K' + Y
    1 FCFB  45          	  DB	'E' + Y
    1 FCFC  59          	  DB	'Y' + Y
    1 FCFD  24          	  DB	'$' + Y
 1965                   	TOKEN	JOYST		; D6
    1 FCFE  CA          	  DB	'J' + Y
    1 FCFF  4F          	  DB	'O' + Y
    1 FD00  59          	  DB	'Y' + Y
    1 FD01  53          	  DB	'S' + Y
    1 FD02  54          	  DB	'T' + Y
 1966                   	TOKEN	STRING$		; D7
    1 FD03  D3          	  DB	'S' + Y
    1 FD04  54          	  DB	'T' + Y
    1 FD05  52          	  DB	'R' + Y
    1 FD06  49          	  DB	'I' + Y
    1 FD07  4E          	  DB	'N' + Y
    1 FD08  47          	  DB	'G' + Y
    1 FD09  24          	  DB	'$' + Y
 1967                   	TOKEN	INSTR		; D8
    1 FD0A  C9          	  DB	'I' + Y
    1 FD0B  4E          	  DB	'N' + Y
    1 FD0C  53          	  DB	'S' + Y
    1 FD0D  54          	  DB	'T' + Y
    1 FD0E  52          	  DB	'R' + Y
 1968                   	TOKEN	RENUMBER	; D9
    1 FD0F  D2          	  DB	'R' + Y
    1 FD10  45          	  DB	'E' + Y
    1 FD11  4E          	  DB	'N' + Y
    1 FD12  55          	  DB	'U' + Y
    1 FD13  4D          	  DB	'M' + Y
    1 FD14  42          	  DB	'B' + Y
    1 FD15  45          	  DB	'E' + Y
    1 FD16  52          	  DB	'R' + Y
 1969                   	TOKEN	DELETE		; DA
    1 FD17  C4          	  DB	'D' + Y
    1 FD18  45          	  DB	'E' + Y
    1 FD19  4C          	  DB	'L' + Y
    1 FD1A  45          	  DB	'E' + Y
    1 FD1B  54          	  DB	'T' + Y
    1 FD1C  45          	  DB	'E' + Y
 1970                   	TOKEN	PAUSE		; DB
    1 FD1D  D0          	  DB	'P' + Y
    1 FD1E  41          	  DB	'A' + Y
    1 FD1F  55          	  DB	'U' + Y
    1 FD20  53          	  DB	'S' + Y
    1 FD21  45          	  DB	'E' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 158
CF46    INC

 1971                   	TOKEN	BEEP		; DC
    1 FD22  C2          	  DB	'B' + Y
    1 FD23  45          	  DB	'E' + Y
    1 FD24  45          	  DB	'E' + Y
    1 FD25  50          	  DB	'P' + Y
 1972                   	TOKEN	WINDOW		; DD
    1 FD26  D7          	  DB	'W' + Y
    1 FD27  49          	  DB	'I' + Y
    1 FD28  4E          	  DB	'N' + Y
    1 FD29  44          	  DB	'D' + Y
    1 FD2A  4F          	  DB	'O' + Y
    1 FD2B  57          	  DB	'W' + Y
 1973                   	TOKEN	BORDER		; DE
    1 FD2C  C2          	  DB	'B' + Y
    1 FD2D  4F          	  DB	'O' + Y
    1 FD2E  52          	  DB	'R' + Y
    1 FD2F  44          	  DB	'D' + Y
    1 FD30  45          	  DB	'E' + Y
    1 FD31  52          	  DB	'R' + Y
 1974                   	TOKEN	INK		; DF
    1 FD32  C9          	  DB	'I' + Y
    1 FD33  4E          	  DB	'N' + Y
    1 FD34  4B          	  DB	'K' + Y
 1975                   	TOKEN	PAPER		; E0
    1 FD35  D0          	  DB	'P' + Y
    1 FD36  41          	  DB	'A' + Y
    1 FD37  50          	  DB	'P' + Y
    1 FD38  45          	  DB	'E' + Y
    1 FD39  52          	  DB	'R' + Y
 1976                   	TOKEN	AT		; E1
    1 FD3A  C1          	  DB	'A' + Y
    1 FD3B  54          	  DB	'T' + Y
 1977                   	TOKEN	COLOR		; E2
    1 FD3C  C3          	  DB	'C' + Y
    1 FD3D  4F          	  DB	'O' + Y
    1 FD3E  4C          	  DB	'L' + Y
    1 FD3F  4F          	  DB	'O' + Y
    1 FD40  52          	  DB	'R' + Y
 1978                   	TOKEN	SOUND		; E3
    1 FD41  D3          	  DB	'S' + Y
    1 FD42  4F          	  DB	'O' + Y
    1 FD43  55          	  DB	'U' + Y
    1 FD44  4E          	  DB	'N' + Y
    1 FD45  44          	  DB	'D' + Y
 1979                   	TOKEN	PSET		; E4
    1 FD46  D0          	  DB	'P' + Y
    1 FD47  53          	  DB	'S' + Y
    1 FD48  45          	  DB	'E' + Y
    1 FD49  54          	  DB	'T' + Y
 1980                   	TOKEN	PRESET		; E5
    1 FD4A  D0          	  DB	'P' + Y
    1 FD4B  52          	  DB	'R' + Y
    1 FD4C  45          	  DB	'E' + Y
    1 FD4D  53          	  DB	'S' + Y
    1 FD4E  45          	  DB	'E' + Y
    1 FD4F  54          	  DB	'T' + Y
 1981                   	TOKEN	BLOAD		; E6
    1 FD50  C2          	  DB	'B' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 159
CF46    INC

    1 FD51  4C          	  DB	'L' + Y
    1 FD52  4F          	  DB	'O' + Y
    1 FD53  41          	  DB	'A' + Y
    1 FD54  44          	  DB	'D' + Y
 1982                   	TOKEN	VPEEK		; E7
    1 FD55  D6          	  DB	'V' + Y
    1 FD56  50          	  DB	'P' + Y
    1 FD57  45          	  DB	'E' + Y
    1 FD58  45          	  DB	'E' + Y
    1 FD59  4B          	  DB	'K' + Y
 1983                   	TOKEN	VPOKE		; E8
    1 FD5A  D6          	  DB	'V' + Y
    1 FD5B  50          	  DB	'P' + Y
    1 FD5C  4F          	  DB	'O' + Y
    1 FD5D  4B          	  DB	'K' + Y
    1 FD5E  45          	  DB	'E' + Y
 1984                   	TOKEN	LOCATE		; E9
    1 FD5F  CC          	  DB	'L' + Y
    1 FD60  4F          	  DB	'O' + Y
    1 FD61  43          	  DB	'C' + Y
    1 FD62  41          	  DB	'A' + Y
    1 FD63  54          	  DB	'T' + Y
    1 FD64  45          	  DB	'E' + Y
 1985                   	TOKEN	KEYLIST		; EA
    1 FD65  CB          	  DB	'K' + Y
    1 FD66  45          	  DB	'E' + Y
    1 FD67  59          	  DB	'Y' + Y
    1 FD68  4C          	  DB	'L' + Y
    1 FD69  49          	  DB	'I' + Y
    1 FD6A  53          	  DB	'S' + Y
    1 FD6B  54          	  DB	'T' + Y
 1986                   	TOKEN	KEY		; EB
    1 FD6C  CB          	  DB	'K' + Y
    1 FD6D  45          	  DB	'E' + Y
    1 FD6E  59          	  DB	'Y' + Y
 1987                   	TOKEN	SWITCH		; EC
    1 FD6F  D3          	  DB	'S' + Y
    1 FD70  57          	  DB	'W' + Y
    1 FD71  49          	  DB	'I' + Y
    1 FD72  54          	  DB	'T' + Y
    1 FD73  43          	  DB	'C' + Y
    1 FD74  48          	  DB	'H' + Y
 1988                   	TOKEN	PTEST		; ED
    1 FD75  D0          	  DB	'P' + Y
    1 FD76  54          	  DB	'T' + Y
    1 FD77  45          	  DB	'E' + Y
    1 FD78  53          	  DB	'S' + Y
    1 FD79  54          	  DB	'T' + Y
 1989                   	TOKEN	CLOSE		; EE
    1 FD7A  C3          	  DB	'C' + Y
    1 FD7B  4C          	  DB	'L' + Y
    1 FD7C  4F          	  DB	'O' + Y
    1 FD7D  53          	  DB	'S' + Y
    1 FD7E  45          	  DB	'E' + Y
 1990                   	TOKEN	OPEN		; EF
    1 FD7F  CF          	  DB	'O' + Y
    1 FD80  50          	  DB	'P' + Y
    1 FD81  45          	  DB	'E' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 160
CF46    INC

    1 FD82  4E          	  DB	'N' + Y
 1991                   	TOKEN	RANDOMIZE	; F0
    1 FD83  D2          	  DB	'R' + Y
    1 FD84  41          	  DB	'A' + Y
    1 FD85  4E          	  DB	'N' + Y
    1 FD86  44          	  DB	'D' + Y
    1 FD87  4F          	  DB	'O' + Y
    1 FD88  4D          	  DB	'M' + Y
    1 FD89  49          	  DB	'I' + Y
    1 FD8A  5A          	  DB	'Z' + Y
    1 FD8B  45          	  DB	'E' + Y
 1992                   	TOKEN	VGET$		; F1
    1 FD8C  D6          	  DB	'V' + Y
    1 FD8D  47          	  DB	'G' + Y
    1 FD8E  45          	  DB	'E' + Y
    1 FD8F  54          	  DB	'T' + Y
    1 FD90  24          	  DB	'$' + Y
 1993                   	TOKEN	LINE		; F2
    1 FD91  CC          	  DB	'L' + Y
    1 FD92  49          	  DB	'I' + Y
    1 FD93  4E          	  DB	'N' + Y
    1 FD94  45          	  DB	'E' + Y
 1994                   	TOKEN	CIRCLE		; F3
    1 FD95  C3          	  DB	'C' + Y
    1 FD96  49          	  DB	'I' + Y
    1 FD97  52          	  DB	'R' + Y
    1 FD98  43          	  DB	'C' + Y
    1 FD99  4C          	  DB	'L' + Y
    1 FD9A  45          	  DB	'E' + Y
 1995                   	TOKEN	CSRLIN		; F4
    1 FD9B  C3          	  DB	'C' + Y
    1 FD9C  53          	  DB	'S' + Y
    1 FD9D  52          	  DB	'R' + Y
    1 FD9E  4C          	  DB	'L' + Y
    1 FD9F  49          	  DB	'I' + Y
    1 FDA0  4E          	  DB	'N' + Y
 1996                   	TOKEN	DRIVE		; F5
    1 FDA1  C4          	  DB	'D' + Y
    1 FDA2  52          	  DB	'R' + Y
    1 FDA3  49          	  DB	'I' + Y
    1 FDA4  56          	  DB	'V' + Y
    1 FDA5  45          	  DB	'E' + Y
 1997 FDA6  80          	DB	80H		; Ende-Kennung
 1998                   ;
 1999                   ; Sprungtabelle fuer BASIC-Token
 2000                   ;
 2001 FDA7  EA6F        TOKJP:	DW	INKEY
 2002 FDA9  ECE1        	DW	JOYST
 2003 FDAB  E674        	DW	STRING
 2004 FDAD  EB5D        	DW	INSTR
 2005 FDAF  E6D3        	DW	RENUM
 2006 FDB1  E8B3        	DW	DELETE
 2007 FDB3  E8D7        	DW	PAUSE
 2008 FDB5  E909        	DW	BBEEP
 2009 FDB7  E91E        	DW	WINDOW
 2010 FDB9  D421        	DW	0D421H		; BORDER
 2011 FDBB  EB18        	DW	INK
 2012 FDBD  EB3E        	DW	PAPER

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 161
CF46    INC

 2013 FDBF  C348        	DW	SNER		; AT
 2014 FDC1  EB2F        	DW	BCOLOR
 2015 FDC3  EA8D        	DW	SOUND
 2016 FDC5  EAD0        	DW	PSET
 2017 FDC7  EB00        	DW	PRESET
 2018 FDC9  E9A9        	DW	BLOAD
 2019 FDCB  C348        	DW	SNER		; VPEEK
 2020 FDCD  E9B7        	DW	VPOKE
 2021 FDCF  EA3B        	DW	LOCATE
 2022 FDD1  EBDB        	DW	KEYLIST
 2023 FDD3  EBCF        	DW	BKEY
 2024 FDD5  EBDF        	DW	SWITCH
 2025 FDD7  C348        	DW	SNER		; PTEST
 2026 FDD9  ECA9        	DW	CLOSE
 2027 FDDB  ED10        	DW	OPEN
 2028 FDDD  ED0A        	DW	RANDOM
 2029 FDDF  C348        	DW	SNER		; VGET
 2030 FDE1  ED45        	DW	BLINE
 2031 FDE3  ED4A        	DW	CIRCLE
 2032 FDE5  C348        	DW	SNER		; CSRLIN
 2033 FDE7  ED78        	DW	BDRIVE		; Laufwerk wechseln
 2034                   
 2035                   	ABSFILL	0FDF0h,<ROM-F-Ende>
    7 FDE9  FF FF FF FF 	  DS	0FDF0h - $,0FFh
 2036                   
 2037                   ; High-Byte der Adresse muss konstant sein!
 2038 FDF0  16          BUPTAB:	DB	16H		; INTB #0
 2039 FDF1  24          	DB	24H		; OCHR
 2040 FDF2  37          	DB	37H		; MBIN #1
 2041 FDF3  38          	DB	38H		; MBOUT
 2042 FDF4  06          	DB	06H		; USIN1 #2
 2043 FDF5  02          	DB	02H		; UOT1
 2044 FDF6  07          	DB	07H		; USIN2	#3
 2045 FDF7  03          	DB	03H		; UOT2
 2046                   
 2047                   ; Adresse FDF8h fest - wird von anderen Programmen (z.B. TEMO) miz genutzt!
 2048 FDF8  80 40 20 10 BITTAB:	DB	80H,40H,20H,10H,8,4,2,1
  149                   	INCLUDE	ZSKLEIN.INC	; Zeichensatz Kleinbuchstaben
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 Zeichensatz Klein	**
    3                   ;**					**
    4                   ;**	Adresse:  FE00h bis FFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 13.05.2010	**
    7                   ;*****************************************
    8                   
    9 FE00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 081H, 0FFH	; 00H Dummy
   10 FE08  00 00 22 72 	DB	000H, 000H, 022H, 072H, 022H, 03EH, 000H, 000H	; 01H Backspace
   11 FE10  00 00 12 32 	DB	000H, 000H, 012H, 032H, 07EH, 032H, 012H, 000H	; 02H Zeile loeschen
   12 FE18  7E 81 B9 A5 	DB	07EH, 081H, 0B9H, 0A5H, 0B9H, 0A5H, 0B9H, 081H	; 03H Break
   13 FE20  55 FF 55 FF 	DB	055H, 0FFH, 055H, 0FFH, 055H, 0FFH, 055H, 0FFH	; 04H
   14 FE28  AA AA AA AA 	DB	0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH	; 05H
   15 FE30  FF 00 FF 00 	DB	0FFH, 000H, 0FFH, 000H, 0FFH, 000H, 0FFH, 000H	; 06H
   16 FE38  00 00 3C 42 	DB	000H, 000H, 03CH, 042H, 042H, 07EH, 000H, 000H	; 07H Beep
   17 FE40  00 10 30 7E 	DB	000H, 010H, 030H, 07EH, 030H, 010H, 000H, 000H	; 08H Cursor links
   18 FE48  00 08 0C 7E 	DB	000H, 008H, 00CH, 07EH, 00CH, 008H, 000H, 000H	; 09H Cursor rechts
   19 FE50  00 10 10 10 	DB	000H, 010H, 010H, 010H, 07CH, 038H, 010H, 000H	; 0AH Cursor unten
   20 FE58  08 1C 3E 08 	DB	008H, 01CH, 03EH, 008H, 008H, 008H, 008H, 000H	; 0BH Cursor oben

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 162
ZSKLEIN INC

   21 FE60  38 30 28 08 	DB	038H, 030H, 028H, 008H, 008H, 008H, 03EH, 000H	; 0CH Bildschirm loeschen
   22 FE68  00 00 12 32 	DB	000H, 000H, 012H, 032H, 07EH, 030H, 010H, 000H	; 0DH Enter
   23 FE70  AA 55 AA 55 	DB	0AAH, 055H, 0AAH, 055H, 0AAH, 055H, 0AAH, 055H	; 0EH
   24 FE78  3E 7C 7C 3E 	DB	03EH, 07CH, 07CH, 03EH, 03EH, 07CH, 0F8H, 0F8H	; 0FH Hardcopy
   25                   
   26 FE80  38 30 28 04 	DB	038H, 030H, 028H, 004H, 004H, 004H, 004H, 000H	; 10H Cursor Home
   27 FE88  7F 08 1C 3E 	DB	07FH, 008H, 01CH, 03EH, 008H, 008H, 008H, 000H	; 11H Page-Modus
   28 FE90  00 08 08 08 	DB	000H, 008H, 008H, 008H, 03EH, 01CH, 008H, 07FH	; 12H Scroll-Modus
   29 FE98  7E 81 9D A1 	DB	07EH, 081H, 09DH, 0A1H, 0B9H, 085H, 085H, 0B9H	; 13H Stop
   30 FEA0  00 3C 42 5A 	DB	000H, 03CH, 042H, 05AH, 05AH, 042H, 03CH, 000H	; 14H Tastenclick
   31 FEA8  88 44 22 11 	DB	088H, 044H, 022H, 011H, 088H, 044H, 022H, 011H	; 15H
   32 FEB0  00 7F 22 72 	DB	000H, 07FH, 022H, 072H, 027H, 022H, 07FH, 000H	; 16H Shift-Lock
   33 FEB8  11 22 44 88 	DB	011H, 022H, 044H, 088H, 011H, 022H, 044H, 088H	; 17H
   34 FEC0  00 01 09 0D 	DB	000H, 001H, 009H, 00DH, 07FH, 00DH, 009H, 001H	; 18H Cursor an Zeilenende
   35 FEC8  00 80 90 B0 	DB	000H, 080H, 090H, 0B0H, 0FEH, 0B0H, 090H, 080H	; 19H Cursor an Zeilenanfang
   36 FED0  00 08 7C 06 	DB	000H, 008H, 07CH, 006H, 07CH, 008H, 000H, 000H	; 1AH INS
   37 FED8  CC CC 33 33 	DB	0CCH, 0CCH, 033H, 033H, 0CCH, 0CCH, 033H, 033H	; 1BH ESC
   38 FEE0  7E 81 A1 A1 	DB	07EH, 081H, 0A1H, 0A1H, 0A1H, 0A1H, 0BDH, 081H	; 1CH List
   39 FEE8  7E 81 B9 A5 	DB	07EH, 081H, 0B9H, 0A5H, 0B9H, 0A5H, 0A5H, 081H	; 1DH Run
   40 FEF0  7E 81 99 A1 	DB	07EH, 081H, 099H, 0A1H, 0A1H, 0A1H, 099H, 081H	; 1EH Cont
   41 FEF8  00 10 3E 60 	DB	000H, 010H, 03EH, 060H, 03EH, 010H, 000H, 000H	; 1FH DEL
   42                   
   43 FF00  3C 42 99 A1 	DB	03CH, 042H, 099H, 0A1H, 0A1H, 099H, 042H, 03CH	; 60H (c)
   44 FF08  00 00 78 0C 	DB	000H, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 61H a
   45 FF10  E0 60 7C 66 	DB	0E0H, 060H, 07CH, 066H, 066H, 066H, 0DCH, 000H	; 62H b
   46 FF18  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0C0H, 0CCH, 078H, 000H	; 63H c
   47 FF20  1C 0C 7C CC 	DB	01CH, 00CH, 07CH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 64H d
   48 FF28  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 65H e
   49 FF30  38 6C 60 F0 	DB	038H, 06CH, 060H, 0F0H, 060H, 060H, 0F0H, 000H	; 66H f
   50 FF38  00 00 76 CC 	DB	000H, 000H, 076H, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 67H g
   51 FF40  E0 60 6C 76 	DB	0E0H, 060H, 06CH, 076H, 066H, 066H, 0E6H, 000H	; 68H h
   52 FF48  30 00 70 30 	DB	030H, 000H, 070H, 030H, 030H, 030H, 0FCH, 000H	; 69H i
   53 FF50  0C 00 1C 0C 	DB	00CH, 000H, 01CH, 00CH, 00CH, 0CCH, 0CCH, 078H	; 6AH j
   54 FF58  E0 60 66 6C 	DB	0E0H, 060H, 066H, 06CH, 078H, 06CH, 0E6H, 000H	; 6BH k
   55 FF60  70 30 30 30 	DB	070H, 030H, 030H, 030H, 030H, 030H, 0FCH, 000H	; 6CH l
   56 FF68  00 00 CC FE 	DB	000H, 000H, 0CCH, 0FEH, 0FEH, 0D6H, 0C6H, 000H	; 6DH m
   57 FF70  00 00 F8 CC 	DB	000H, 000H, 0F8H, 0CCH, 0CCH, 0CCH, 0CCH, 000H	; 6EH n
   58 FF78  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0CCH, 0CCH, 078H, 000H	; 6FH o
   59                   
   60 FF80  00 00 DC 66 	DB	000H, 000H, 0DCH, 066H, 066H, 07CH, 060H, 0F0H	; 70H p
   61 FF88  00 00 76 CC 	DB	000H, 000H, 076H, 0CCH, 0CCH, 07CH, 00CH, 01EH	; 71H q
   62 FF90  00 00 DC 76 	DB	000H, 000H, 0DCH, 076H, 066H, 060H, 0F0H, 000H	; 72H r
   63 FF98  00 00 7C C0 	DB	000H, 000H, 07CH, 0C0H, 078H, 00CH, 0F8H, 000H	; 73H s
   64 FFA0  10 30 7C 30 	DB	010H, 030H, 07CH, 030H, 030H, 034H, 018H, 000H	; 74H t
   65 FFA8  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 75H u
   66 FFB0  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 078H, 030H, 000H	; 76H v
   67 FFB8  00 00 C6 D6 	DB	000H, 000H, 0C6H, 0D6H, 0FEH, 0FEH, 06CH, 000H	; 77H w
   68 FFC0  00 00 C6 6C 	DB	000H, 000H, 0C6H, 06CH, 038H, 06CH, 0C6H, 000H	; 78H x
   69 FFC8  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 79H y
   70 FFD0  00 00 FC 98 	DB	000H, 000H, 0FCH, 098H, 030H, 064H, 0FCH, 000H	; 7AH z
   71 FFD8  6C 00 78 0C 	DB	06CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 7BH ae
   72 FFE0  CC 00 78 CC 	DB	0CCH, 000H, 078H, 0CCH, 0CCH, 0CCH, 078H, 000H	; 7CH oe
   73 FFE8  CC 00 CC CC 	DB	0CCH, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 7DH ue
   74 FFF0  3C 66 66 6C 	DB	03CH, 066H, 066H, 06CH, 066H, 066H, 06CH, 0F0H	; 7EH sz
   75 FFF8  FF 81 81 81 	DB	0FFH, 081H, 081H, 081H, 081H, 081H, 081H, 0FFH	; 7FH
  150                   
  151                   	.DEPHASE
  152                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 163
CAOS46  Z80

  153                   	END
 0 Error(s) Detected.
 16512 Absolute Bytes. 1191 Symbols Detected.

C6 D6 	DB	000H, 000H, 0C6H, 0D6H, 0FEH,
