
          0200          ;**     CAOS 4.4 ROM C          **
          0200          ;       (08.02.2003)
          0200
          0200                  ORG     0C000H
          C000
          C000          KCTAB   ;IRM-Defaulttabelle
          C000 F0E3             DW      NOT     ;Hardcopy
          C002 00               DB      0       ;WINNR
          C003 0000             DW      0       ;WINON
          C005 2820             DW      2028H   ;WINLG
          C007 0000             DW      0       ;CURSO
          C009 00               DB      0       ;STBT
          C00A 39               DB      39H     ;COLOR
          C00B F2E2             DW      SCRLPG  ;WEND
          C00D 00EE             DW      0EE00H  ;CCTL0
          C00F 00FE             DW      0FE00H  ;1
          C011 00EE             DW      0EE00H  ;2
          C013 00FE             DW      0FE00H  ;3
          C015 C401             DW      1C4H    ;SYSP
          C017 AEFB             DW      SUTB    ;SUTAB
          C019 CEFC             DW      CRTTAB  ;CTAB
          C01B D388             OUT     88H     ;BJUMP
          C01D C312F0           JP      0F012H
          C020 A6FB             DW      ZEI0    ;OUTAB
          C022 AAFB             DW      ZEI4    ;INTAB
          C024 C362F4           JP      NOOP    ;UOUT1
          C027 C362F4           JP      NOOP    ;UIN1
          C02A C362F4           JP      NOOP    ;UOUT2
          C02D C362F4           JP      NOOP    ;UIN2
          C030 82DC             DW      0DC82H  ;IOERR (BASIC)
          C032 00B2             DW      0B200H  ;VRAM
          C034
          C034 470C             DB      47H,0CH ;CTC2 (blinken)
          C036 DEED             DW      ESCTAB  ;L3TAB
          C038 0D               DB      13      ;L3SIZ (0-C)
          C039 05               DB      5       ;COUNT
          C03A 00               DB      0       ;HCPZ
          C03B 01A8             DW      0A801H  ;INTV1
          C03D 08               DB      8       ;INTV1L
          C03E 09A8             DW      0A809H  ;INTV2
          C040 09               DB      9       ;INTV2L
          C041 06               DB      6       ;HCPZ2
          C042 C362F4           JP      NOOP    ;OFILT
          C045 25               DB      '%'     ;PROMPT
          C046 FF               DB      0FFH    ;LINTYP
          C047 D8EF             DW      0EFD8H  ;CUMUST
          C049
          C049 03               DB      3       ;RAM0
          C04A 01               DB      1       ;IRM
          C04B 00               DB      0       ;USER-ROMC
          C04C 03               DB      3       ;RAM8
          C04D 03               DB      3       ;RAM4
          C04E 00               DB      0       ;CAOSC
          C04F
          C04F          PWRONC  ;Power-ON Initialisierung
          C04F F3               DI
          C050 3100C0           LD      SP,0C000H
          C053 210000           LD      HL,0
          C056 010060           LD      BC,6000H
          C059 E5       PWRC1   PUSH    HL      ;Speicher lîsch.
          C05A 0D               DEC     C       ;0-BFFFH
          C05B 20FC             JR      NZ,PWRC1
          C05D 10FA             DJNZ    PWRC1
          C05F 31C401           LD      SP,01C4H
          C062 AF               XOR     A
          C063 0E80             LD      C,80H   ;Module
          C065 ED79     PWRC2   OUT     (C),A   ;abschalten
          C067 10FC             DJNZ    PWRC2
          C069 CD86C0           CALL    SYSI
          C06C AF               XOR     A
          C06D 329BB7   PWRC3   LD      (WINNR),A
          C070 CDF5C5           CALL    WCOPY   ;Fenstervektor-
          C073 3C               INC     A       ;speicher init.
          C074 FE0A             CP      10
          C076 38F5             JR      C,PWRC3
          C078 CD03F9           CALL    ESC3    ;Zugriff Bild 1
          C07B 3E0C             LD      A,0CH
          C07D CDF7E3           CALL    CRT     ;CLS
          C080 CDF9F8           CALL    ESC1
          C083 C34EF1           JP      PWR4
          C086
          C086          SYSI    ;Systeminitialisierung
          C086 F3               DI
          C087 ED5E             IM      2
          C089 21FCC0           LD      HL,IOTAB
          C08C CD1DF5           CALL    INIMEX  ;Ports init.
          C08F DD21F001         LD      IX,1F0H
          C093 DD360128         LD      (IX+1),28H      ;OUT84
          C097 DD3604E3         LD      (IX+4),0E3H     ;OUT86
          C09B 1199B7           LD      DE,HCADR
          C09E 2100C0           LD      HL,KCTAB;Defaulttab.
          C0A1 013400           LD      BC,34H
          C0A4 EDB0             LDIR            ;1.StÅck
          C0A6 0E15             LD      C,15H
          C0A8 1EDB             LD      E,CTCMD
          C0AA EDB0             LDIR            ;2.StÅck
          C0AC 1100B8           LD      DE,0B800H
          C0AF 0E04             LD      C,4
          C0B1 EDB0             LDIR            ;3. StÅck
          C0B3 1A               LD      A,(DE)
          C0B4 E604             AND     4       ;RAM4-Ebene!
          C0B6 B6               OR      M
          C0B7 12               LD      (DE),A  ;RAM4
          C0B8 13               INC     DE
          C0B9 23               INC     HL
          C0BA EDA0             LDI             ;CAOSC
          C0BC 3E01             LD      A,1
          C0BE 21C0FC   SIXC    LD      HL,ISRTAB
          C0C1 32D7B7           LD      (MIXIT),A
          C0C4 1EE2             LD      E,0E2H
          C0C6 57               LD      D,A
          C0C7 010E00           LD      BC,0EH  ;Interrupttab.
          C0CA EDB0             LDIR            ;kopieren
          C0CC DD6601           LD      H,(IX+1);alte Merker
          C0CF DD6E04           LD      L,(IX+4);mitnehmen
          C0D2 D5               PUSH    DE
          C0D3 DDE1             POP     IX
          C0D5 DD360888         LD      (IX+8),88H
          C0D9 DD7401           LD      (IX+1),H;und eintragen
          C0DC DD7504           LD      (IX+4),L
          C0DF DD360E40         LD      (IX+14),KTAB    ;Low
          C0E3 DD360FFC         LD      (IX+15),KTAB/256;High
          C0E7 DD36097F         LD      (IX+9),7FH
          C0EB F3               DI
          C0EC ED5E             IM      2
          C0EE 3AD7B7           LD      A,(MIXIT)
          C0F1 ED47             LD      I,A
          C0F3 2116C1           LD      HL,IOTAB2
          C0F6 CD1DF5           CALL    INIMEX  ;KanÑle init.
          C0F9 C30BF5           JP      KPUFF
          C0FC
          C0FC          IOTAB   ;Portinittabelle
          C0FC 07               DB      7
          C0FD 8A               DB      8AH     ;PIO-A-Steuerw.
          C0FE 01                DB     1
          C0FF E4                 DB    0E4H    ;Int-Vektor
          C100 88               DB      88H     ;PIO-A-Daten
          C101 02                DB     2
          C102 1F                 DB    1FH     ;D005-Reset
          C103 0F                 DB    0FH     ;IRM,RAM0,CAOSE
          C104 8A               DB      8AH     ;PIO-A-Steuerw.
          C105 02                DB     2
          C106 0F                 DB    0FH     ;Byte-Out
          C107 03                 DB    3       ;DI
          C108 8B               DB      8BH     ;PIO-B-Steuerw.
          C109 03                DB     3
          C10A E6                 DB    0E6H    ;Int-Vektor
          C10B 0F                 DB    0FH     ;Byte-Out
          C10C 83                 DB    83H     ;EI
          C10D 89               DB      89H     ;PIO-B-Daten
          C10E 01                DB     1
          C10F FF                 DB    0FFH    ;Daten
          C110 84               DB      84H     ;Port 84H
          C111 01                DB     1
          C112 28                 DB    28H     ;Ausgabebyte
          C113 86               DB      86H     ;Port 86H
          C114 01                DB     1
          C115 E3                 DB    0E3H    ;Ausgabebyte
          C116
          C116 04       IOTAB2  DB      4
          C117 8A               DB      8AH     ;PIO-A-Steuerw.
          C118 01                DB     1
          C119 E4                 DB    0E4H    ;Int-Vektor
          C11A 8B               DB      8BH     ;PIO-B-Steuerw.
          C11B 01                DB     1
          C11C E6                 DB    0E6H    ;Int-Vektor
          C11D 8C               DB      8CH     ;CTC0
          C11E 01                DB     1
          C11F E8                 DB    0E8H    ;Int-Vektor CTC
          C120 8E               DB      8EH     ;CTC2 (blinken)
          C121 02                DB     2
          C122 47                 DB    47H     ;DI,ZÑhler,RES
          C123 0C                 DB    0CH     ;Zeitkonstante
          C124
          C124          SYSTC   ;Systemcheck
          C124 D5               PUSH    DE
          C125 CD51F3           CALL    OSTR
          C128 0D43414F         DB      CR,'CAOSE',0
          C12F DB88             IN      A,88H
          C131 E601             AND     1
          C133 CDF4C1           CALL    WONOF   ;Bit 0
          C136 CD51F3           CALL    OSTR
          C139 43414F53         DB      'CAOSC',0
          C13F 3A05B8           LD      A,(0B805H)
          C142 E601             AND     1
          C144 CDF4C1           CALL    WONOF
          C147 CD51F3           CALL    OSTR
          C14A 524F4D43         DB      'ROMC ',0
          C150 DD7E04           LD      A,(IX+4)
          C153 CB3F             SRL     A       ;Bits 5,6
          C155 CB3F             SRL     A
          C157 CB3F             SRL     A
          C159 CB3F             SRL     A
          C15B CB3F             SRL     A       ;nach Bits 0,1
          C15D 2F               CPL
          C15E E633             AND     '3'
          C160 CD80F3           CALL    OCHR    ;Ebene ausgeben
          C163 DB88             IN      A,88H
          C165 5F               LD      E,A
          C166 E680             AND     80H
          C168 CDF4C1           CALL    WONOF   ;Bit 7
          C16B 1630             LD      D,'0'
          C16D CDE7C1           CALL    WRAM    ;RAM0
          C170 CB5B             BIT     3,E
          C172 2001             JR      NZ,SYSC1
          C174 37               SCF             ;Schreibschutz
          C175 CB4B     SYSC1   BIT     1,E
          C177 CDF4C1           CALL    WONOF
          C17A 1634             LD      D,'4'
          C17C CDE7C1           CALL    WRAM    ;RAM4
          C17F CD71F4           CALL    SPACE
          C182 3A04B8           LD      A,(0B804H)
          C185 0F               RRCA
          C186 0F               RRCA            ;Bit 2
          C187 E601             AND     1
          C189 C630             ADD     '0'
          C18B CD80F3           CALL    OCHR    ;Ebene 0/1
          C18E DDCB044E         BIT     1,(IX+4)
          C192 2001             JR      NZ,SYSC2
          C194 37               SCF             ;Schreibschutz
          C195 DDCB0446 SYSC2   BIT     0,(IX+4)
          C199 CDF4C1           CALL    WONOF
          C19C 1638             LD      D,'8'
          C19E CDE7C1           CALL    WRAM    ;RAM8
          C1A1 3E20             LD      A,' '
          C1A3 CD80F3           CALL    OCHR
          C1A6 DD7E01           LD      A,(IX+1)
          C1A9 CB3F             SRL     A       ;Bits 4,5,6,7
          C1AB CB3F             SRL     A
          C1AD CB3F             SRL     A
          C1AF CB3F             SRL     A       ;nach 0,1,2,3
          C1B1 D602             SUB     2
          C1B3 CD94F4           CALL    AHEX0   ;Ebene ausg.
          C1B6 DB89             IN      A,89H
          C1B8 A7               AND     A
          C1B9 CB77             BIT     6,A
          C1BB 2001             JR      NZ,SYSC3
          C1BD 37               SCF             ;Schreibschutz
          C1BE CB6F     SYSC3   BIT     5,A
          C1C0 CDF4C1           CALL    WONOF
          C1C3 DD7E01           LD      A,(IX+1)
          C1C6 5F               LD      E,A
          C1C7 CD51F3           CALL    OSTR
          C1CA 42494C44         DB      'BILD ',0
          C1D0 CB53             BIT     2,E     ;Zugriffs-Bit
          C1D2 3E30             LD      A,'0'
          C1D4 2801             JR      Z,SYSC4
          C1D6 3C               INC     A
          C1D7 CD80F3   SYSC4   CALL    OCHR    ;Bildnummer
          C1DA 3A01B8           LD      A,(0B801H)
          C1DD E601             AND     1       ;IRM on?
          C1DF CDF4C1           CALL    WONOF
          C1E2 CD80F4           CALL    CRLF
          C1E5 D1               POP     DE
          C1E6 C9               RET
          C1E7
          C1E7          WRAM    ;Schreibe 'RAMn'
          C1E7 CD51F3           CALL    OSTR
          C1EA 52414D00         DB      'RAM',0
          C1EE 7A               LD      A,D
          C1EF CD80F3           CALL    OCHR
          C1F2 A7               AND     A       ;CY=0
          C1F3 C9               RET
          C1F4
          C1F4          WONOF   ;Schreibe ON, ON* oder OFF
          C1F4 2816             JR      Z,WOF
          C1F6 F5               PUSH    AF
          C1F7 CD51F3           CALL    OSTR
          C1FA 204F4E00         DB      ' ON',0
          C1FE F1               POP     AF
          C1FF 3E20             LD      A,' '
          C201 3002             JR      NC,WRR
          C203 3E2A             LD      A,'*'   ;Schreibschutz
          C205 CD80F3   WRR     CALL    OCHR
          C208 CD80F4           CALL    CRLF
          C20B C9               RET
          C20C                  ;
          C20C CD51F3   WOF     CALL    OSTR
          C20F 204F4646         DB      ' OFF',CR,LF,0
          C216 C9               RET
          C217
          C217          MODULC  ;Modulkontrollanzeige
          C217 D5               PUSH    DE
          C218 2E07             LD      L,7     ;ab Platz 7
          C21A E5       MODC1   PUSH    HL
          C21B 3E01             LD      A,1     ;lesen
          C21D CD85C3           CALL    MODUC
          C220 7C               LD      A,H
          C221 3C               INC     A       ;Kennbyte=FFh?
          C222 2824             JR      Z,MODC2 ;kein Modul
          C224 7D               LD      A,L
          C225 CD6EF4           CALL    AHSPC   ;Platz
          C228 7C               LD      A,H
          C229 CD6EF4           CALL    AHSPC   ;Kennbyte
          C22C 7A               LD      A,D
          C22D CD6EF4           CALL    AHSPC   ;Steuerbyte
          C230 4C               LD      C,H
          C231 061B             LD      B,27    ;Anzahl in MTAB
          C233 2151C2           LD      HL,MTAB
          C236 7E       MODCC   LD      A,M
          C237 23               INC     HL
          C238 B9               CP      C
          C239 2807             JR      Z,MODCA ;Text gefunden
          C23B 7E       MODCB   LD      A,M
          C23C 23               INC     HL
          C23D A7               AND     A       ;Stringende?
          C23E 20FB             JR      NZ,MODCB
          C240 10F4             DJNZ    MODCC
          C242 CDA7F8   MODCA   CALL    ZKOUT   ;Modulname
          C245 CD80F4           CALL    CRLF
          C248 E1       MODC2   POP     HL
          C249 2C               INC     L       ;Platz+1
          C24A 20CE             JR      NZ,MODC1;bis FFh
          C24C CD80F4           CALL    CRLF
          C24F D1               POP     DE
          C250 C9               RET
          C251
          C251          MTAB    ;Tabelle der Modulnamen
          C251 01535441         DB      001H,'START-ROM',0
          C25C 7033324B         DB      070H,'32K EPROM',0
          C267 72313238         DB      072H,'128K EPROM',0
          C273 73323536         DB      073H,'256K EPROM',0
          C27F 7136344B         DB      071H,'64K EPROM',0
          C28A 78313238         DB      078H,'128K RAM',0
          C294 79323536         DB      079H,'256K RAM',0
          C29E 7A353132         DB      07AH,'512K RAM',0
          C2A8 7B314D20         DB      07BH,'1M RAM',0
          C2B0 A7464C4F         DB      0A7H,'FLOPPY',0
          C2B8 DA50494F         DB      0DAH,'PIO-3',0
          C2BF DB455052         DB      0DBH,'EPROMMER',0
          C2C9 E3444155         DB      0E3H,'DAU1',0
          C2CF E7414455         DB      0E7H,'ADU1',0
          C2D5 EC534341         DB      0ECH,'SCANNER',0
          C2DE EE562E32         DB      0EEH,'V.24',0
          C2E4 EF444947         DB      0EFH,'DIG. IN/OUT',0
          C2F1 F0384B20         DB      0F0H,'8K CMOS-RAM',0
          C2FE F131364B         DB      0F1H,'16K CMOS-RAM',0
          C30C F233324B         DB      0F2H,'32K CMOS-RAM',0
          C31A F431364B         DB      0F4H,'16K RAM',0
          C323 F533324B         DB      0F5H,'32K RAM',0
          C32C F636344B         DB      0F6H,'64K RAM',0
          C335 F7384B20         DB      0F7H,'8K EPROM',0
          C33F F831364B         DB      0F8H,'16K EPROM',0
          C34A FB384B20         DB      0FBH,'8K SOFTWARE',0
          C357 FC424153         DB      0FCH,'BASIC',0
          C35E 3F3F3F00         DB      '???',0
          C362
          C362          ;Module lesen und schalten (MenÅwort):
          C362
          C362 53       SWIC    LD      D,E     ;Steuerbyte
          C363 2D               DEC     L
          C364 200C             JR      NZ,SWI2 ;nicht IRM
          C366 FE01             CP      1
          C368 2808             JR      Z,SWI2  ;nur lesen
          C36A 2C               INC     L
          C36B 26B8             LD      H,0B8H  ;IRM nur
          C36D 72               LD      M,D     ;eintragen!
          C36E 26FF             LD      H,0FFH
          C370 1804             JR      SWI3
          C372 2C       SWI2    INC     L
          C373 CD85C3           CALL    MODUC   ;lesen/schalten
          C376 7D       SWI3    LD      A,L
          C377 CD6EF4           CALL    AHSPC   ;Platz anzeigen
          C37A 7C               LD      A,H
          C37B CD6EF4           CALL    AHSPC   ;Kennbyte
          C37E 7A               LD      A,D
          C37F CD8BF4           CALL    AHEX    ;Steuerbyte
          C382 C380F4           JP      CRLF
          C385
          C385          MODUC   ;Module schalten
          C385 26B8             LD      H,0B8H  ;H(ModulStSp)
          C387 0E80             LD      C,80H   ;I/O-Adr.
          C389 45               LD      B,L
          C38A FE02             CP      2       ;Parameter?
          C38C 3004             JR      NC,MODU1
          C38E 56               LD      D,M     ;nur lesen
          C38F ED60     RSTRB   IN      H,(C)
          C391 C9               RET
          C392
          C392 7E       MODU1   LD      A,M     ;alter Zustand
          C393 72               LD      M,D     ;eintragen
          C394 67               LD      H,A     ;fÅr 2. RAM4
          C395 7D               LD      A,L
          C396 FE06             CP      6       ;interne Module?
          C398 3804             JR      C,MODU2
          C39A ED51             OUT     (C),D   ;Senden Steuerb.
          C39C 18F1             JR      RSTRB
          C39E
          C39E 45       MODU2   LD      B,L
          C39F 04               INC     B
          C3A0 DB88             IN      A,(88H)
          C3A2 1010             DJNZ    MODU3
          C3A4 E6F5             AND     0F5H    ;0=RAM0
          C3A6 CB42             BIT     0,D
          C3A8 2835             JR      Z,OUT88
          C3AA CBCF             SET     1,A
          C3AC CB4A             BIT     1,D
          C3AE 282F             JR      Z,OUT88
          C3B0 CBDF             SET     3,A
          C3B2 182B             JR      OUT88
          C3B4
          C3B4 100A     MODU3   DJNZ    MODU4
          C3B6 CB42             BIT     0,D     ;1=IRM
          C3B8 CB97             RES     2,A
          C3BA 2823             JR      Z,OUT88
          C3BC CBD7             SET     2,A
          C3BE 181F             JR      OUT88
          C3C0
          C3C0 1021     MODU4   DJNZ    MODU5
          C3C2 7A               LD      A,D     ;2=ROMC
          C3C3 2F               CPL             ;negieren
          C3C4 87               ADD     A
          C3C5 E660             AND     60H     ;ausfiltern
          C3C7 67               LD      H,A
          C3C8 F3               DI
          C3C9 DD7E04           LD      A,(IX+4)
          C3CC E69F             AND     9FH
          C3CE B4               OR      H       ;einbauen
          C3CF DD7704           LD      (IX+4),A
          C3D2 D386             OUT     86H
          C3D4 FB               EI
          C3D5 DB88             IN      A,88H
          C3D7 CB42             BIT     0,D
          C3D9 CBBF             RES     7,A     ;aus
          C3DB 2802             JR      Z,OUT88
          C3DD CBFF             SET     7,A     ;ein
          C3DF D388     OUT88   OUT     88H
          C3E1 1827             JR      STBFF
          C3E3
          C3E3 1028     MODU5   DJNZ    MODU6
          C3E5 DB89             IN      A,89H   ;3=RAM8
          C3E7 E69F             AND     9FH
          C3E9 CB42             BIT     0,D
          C3EB 2808             JR      Z,SRAM8 ;wenn aus dann
          C3ED CBEF             SET     5,A
          C3EF CB4A             BIT     1,D     ;Schreibschutz
          C3F1 2802             JR      Z,SRAM8 ;unerheblich
          C3F3 CBF7             SET     6,A
          C3F5 D389     SRAM8   OUT     89H
          C3F7 7A               LD      A,D
          C3F8 07               RLCA
          C3F9 07               RLCA
          C3FA C620             ADD     20H     ;Segm.-Verschieb
          C3FC E6F0             AND     0F0H
          C3FE 67               LD      H,A
          C3FF DD7E01           LD      A,(IX+1)
          C402 E60F             AND     0FH
          C404 B4               OR      H       ;RAM8-Segment
          C405 D384             OUT     84H
          C407 DD7701           LD      (IX+1),A
          C40A 26FF     STBFF   LD      H,0FFH
          C40C C9               RET
          C40D
          C40D 10FB     MODU6   DJNZ    STBFF   ;5=CAOSC
          C40F 7A               LD      A,D     ;4=RAM4
          C410 AC               XOR     H
          C411 E604             AND     4       ;Aenderung?
          C413 2840             JR      Z,RAM41
          C415 DD7E04           LD      A,(IX+4)
          C418 F603             OR      3
          C41A F3               DI
          C41B D386             OUT     86H     ;RAM4 on
          C41D D5               PUSH    DE
          C41E E5               PUSH    HL
          C41F DB88             IN      A,(88H)
          C421 F5               PUSH    AF
          C422 CB87             RES     0,A
          C424 D388             OUT     (88H),A ;CAOSE off
          C426 DD7E01           LD      A,(IX+1)
          C429 F5               PUSH    AF
          C42A E6F9             AND     0F9H
          C42C 2E03             LD      L,3     ;3 IRM-Ebenen
          C42E 010010           LD      BC,1000H;800H frei!
          C431 110040           LD      DE,4000H
          C434 C602     R4IS    ADD     2
          C436 D384             OUT     (84H),A ;IRM-Ebene
          C438 67               LD      H,A
          C439 E5               PUSH    HL
          C43A 2100A8           LD      HL,0A800H
          C43D 1A       R4MV    LD      A,(DE)
          C43E EDA0             LDI
          C440 2B               DEC     HL
          C441 77               LD      M,A
          C442 23               INC     HL
          C443 EA3DC4           JP      PE,R4MV
          C446 E1               POP     HL
          C447 7C               LD      A,H
          C448 0618             LD      B,18H   ;jetzt 1800H!
          C44A 2D               DEC     L
          C44B 20E7             JR      NZ,R4IS
          C44D F1               POP     AF
          C44E D384             OUT     (84H)   ;IRM wie zuvor
          C450 F1               POP     AF
          C451 D388             OUT     (88H)   ;CAOSE on
          C453 E1               POP     HL
          C454 D1               POP     DE
          C455 DD7E04   RAM41   LD      A,(IX+4)
          C458 E6FC             AND     0FCH
          C45A CB42             BIT     0,D
          C45C 2808             JR      Z,SRAM4
          C45E CBC7             SET     0,A
          C460 CB4A             BIT     1,D
          C462 2802             JR      Z,SRAM4
          C464 CBCF             SET     1,A
          C466 DD7704   SRAM4   LD      (IX+4),A
          C469 D386             OUT     86H
          C46B FB               EI
          C46C 189C             JR      STBFF
          C46E
          C46E          KEYC    ;F-Taste belegen
          C46E 2100B9           LD      HL,0B900H
          C471 A7               AND     A
          C472 2007             JR      NZ,KEY0
          C474 069C             LD      B,9CH
          C476 77       KEYCL   LD      M,A     ;lîschen
          C477 2C               INC     L
          C478 10FC             DJNZ    KEYCL
          C47A C9               RET
          C47B FE10     KEY0    CP      16
          C47D D0               RET     NC      ;nur F1 bis FF
          C47E 47               LD      B,A
          C47F F6F0             OR      0F0H
          C481 4F               LD      C,A
          C482 7E       KEY1    LD      A,M     ;B Dummys
          C483 2C               INC     L       ;auszÑhlen
          C484 C8               RET     Z
          C485 A7               AND     A
          C486 20FA             JR      NZ,KEY1
          C488 10F8             DJNZ    KEY1
          C48A 7D               LD      A,L
          C48B FE9C             CP      9CH
          C48D D0               RET     NC
          C48E ED5BA0B7         LD      DE,(CURSO)
          C492 CD4BC5           CALL    KEYDI   ;prÑsentieren
          C495 CD7AF3   KEY2    CALL    INTB
          C498 FE13             CP      13H
          C49A 2003             JR      NZ,KEY3
          C49C 04               INC     B       ;Umschaltung
          C49D 18F6             JR      KEY2
          C49F CB40     KEY3    BIT     0,B
          C4A1 280D             JR      Z,KEY4  ;interpret.
          C4A3 FE03             CP      3
          C4A5 2870             JR      Z,KEY12 ;BRK=Abbruch
          C4A7 FE0D             CP      CR
          C4A9 280A             JR      Z,KEY5  ;Enter=belegen
          C4AB CD80F3           CALL    OCHR
          C4AE 18E5             JR      KEY2
          C4B0 CD15F7   KEY4    CALL    CSTBT
          C4B3 18E0             JR      KEY2
          C4B5                  ;
          C4B5 E5       KEY5    PUSH    HL      ;Pos. in Puffer
          C4B6 CD7CE0           CALL    DABR
          C4B9 EB               EX      DE,HL
          C4BA CDA7F4           CALL    RHEX    ;Fn lesen
          C4BD E1               POP     HL
          C4BE 3806             JR      C,KERR  ;Formatfehler
          C4C0 3A97B7           LD      A,(NUMVX)
          C4C3 B9               CP      C       ;geÑndert!
          C4C4 2806             JR      Z,KEY6
          C4C6 CD80F4   KERR    CALL    CRLF
          C4C9 C376F4           JP      ERRM
          C4CC 13       KEY6    INC     DE
          C4CD 13               INC     DE
          C4CE 069B             LD      B,9BH
          C4D0 2F               CPL
          C4D1 A7               AND     A
          C4D2 2821             JR      Z,KEY8  ;KEY F
          C4D4 3C               INC     A
          C4D5 47               LD      B,A
          C4D6 4D               LD      C,L
          C4D7 7E       KEY7    LD      A,M
          C4D8 2C               INC     L
          C4D9 28EB             JR      Z,KERR  ;Puffer voll!
          C4DB A7               AND     A
          C4DC 20F9             JR      NZ,KEY7
          C4DE 10F7             DJNZ    KEY7    ;Ende suchen
          C4E0 2D               DEC     L
          C4E1 7D               LD      A,L
          C4E2 FE9C             CP      9CH
          C4E4 30E0             JR      NC,KERR ;Puffer voll!
          C4E6 44               LD      B,H
          C4E7 C5               PUSH    BC
          C4E8 91               SUB     C
          C4E9 4F               LD      C,A
          C4EA 0600             LD      B,0
          C4EC D5               PUSH    DE
          C4ED 119BB9           LD      DE,0B99BH
          C4F0 EDB8             LDDR            ;Rest hinter
          C4F2 43               LD      B,E
          C4F3 D1               POP     DE
          C4F4 E1               POP     HL
          C4F5 4F       KEY8    LD      C,A
          C4F6 2D       KEY9    DEC     L
          C4F7 7E               LD      A,M
          C4F8 A7               AND     A
          C4F9 20FB             JR      NZ,KEY9 ;zurÅck bis 0
          C4FB 2C       KEY10   INC     L
          C4FC 1A               LD      A,(DE)
          C4FD 13               INC     DE
          C4FE 77               LD      M,A     ;belegen
          C4FF B7               OR      A
          C500 2808             JR      Z,KEY11
          C502 78               LD      A,B
          C503 95               SUB     L
          C504 20F5             JR      NZ,KEY10
          C506 3600             LD      M,0
          C508 18BC             JR      KERR
          C50A 79       KEY11   LD      A,C
          C50B A7               AND     A
          C50C 2809             JR      Z,KEY12 ;KEY F
          C50E 04               INC     B
          C50F 2C               INC     L
          C510 5D               LD      E,L
          C511 54               LD      D,H
          C512 68               LD      L,B
          C513 0600             LD      B,0
          C515 EDB0             LDIR            ;Rest nach vorn
          C517 C380F4   KEY12   JP      CRLF
          C51A
          C51A          KEYLIC  ;Anzeige belegter F-Tasten
          C51A 2101B9           LD      HL,0B901H
          C51D 01F100           LD      BC,0F1H
          C520 7E       KEYLC1  LD      A,M
          C521 A7               AND     A
          C522 2807             JR      Z,KEYLC2
          C524 CD4BC5           CALL    KEYDI   ;Belegung
          C527 CD80F4           CALL    CRLF
          C52A 04               INC     B       ;ZÑhler
          C52B 2C       KEYLC2  INC     L
          C52C 7D               LD      A,L
          C52D FE9C             CP      9CH
          C52F 3003             JR      NC,KEYLC3
          C531 0C               INC     C
          C532 20EC             JR      NZ,KEYLC1 ;F1 bis FF
          C534 04       KEYLC3  INC     B
          C535 05               DEC     B
          C536 C0               RET     NZ
          C537 CD51F3           CALL    OSTR
          C53A 462D5461         DB      'F-Tasten leer'
          C547 0D0A00           DB      CR,LF,0
          C54A C9               RET
          C54B
          C54B 3E02     KEYDI   LD      A,2
          C54D CD80F3           CALL    OCHR    ;Zeile lîschen
          C550 79               LD      A,C
          C551 CD4EF3           CALL    AHOSTR  ;Fn
          C554 203A00           DB      ' :',0
          C557 7E       KEYD1   LD      A,M
          C558 B7               OR      A
          C559 C8               RET     Z
          C55A CD15F7           CALL    CSTBT
          C55D 23               INC     HL
          C55E 7D               LD      A,L
          C55F FE9C             CP      9CH
          C561 D0               RET     NC
          C562 18F3             JR      KEYD1
          C564
          C564          SQRC    ;Quadratwurzel 16Bit A=SQR(HL)
          C564 A7               AND     A       ;CY=0
          C565 11FFFF           LD      DE,0FFFFH
          C568 13       SQ1     INC     DE
          C569 13               INC     DE
          C56A ED52             SBC     HL,DE
          C56C 30FA             JR      NC,SQ1
          C56E 7B               LD      A,E
          C56F CB3A             SRL     D
          C571 1F               RRA             ;A=RADIUS
          C572 C9               RET
          C573
          C573          MULC    ;Multiplikation BA=C*D
          C573 0600             LD      B,0
          C575 1E09             LD      E,9
          C577 7A       MULC1   LD      A,D
          C578 1F               RRA
          C579 1D               DEC     E
          C57A C8               RET     Z
          C57B 57               LD      D,A
          C57C 78               LD      A,B
          C57D 3001             JR      NC,MULC2
          C57F 81               ADD     C
          C580 1F       MULC2   RRA
          C581 47               LD      B,A
          C582 18F3             JR      MULC1   ;8*
          C584
          C584 A7       COLRC   AND     A
          C585 2015             JR      NZ,SETCO
          C587                  ;aktuelle Farben anzeigen
          C587 3AA3B7           LD      A,(COLOR)
          C58A 6F               LD      L,A
          C58B 0F               RRCA
          C58C 0F               RRCA
          C58D 0F               RRCA
          C58E E61F             AND     1FH
          C590 CD6EF4           CALL    AHSPC
          C593 7D               LD      A,L
          C594 E607             AND     7
          C596 CD8BF4           CALL    AHEX
          C599 C380F4           JP      CRLF
          C59C          SETCO   ;Farbe setzen (aus L und E)
          C59C 3E1F             LD      A,1FH
          C59E A5               AND     L
          C59F 17               RLA
          C5A0 17               RLA
          C5A1 17               RLA
          C5A2 6F               LD      L,A
          C5A3 3A81B7           LD      A,(ARGN)
          C5A6 FE02             CP      2
          C5A8 7B               LD      A,E
          C5A9 3003             JR      NC,COLRC1
          C5AB 3AA3B7           LD      A,(COLOR);Hintergrund
          C5AE E607     COLRC1  AND     7
          C5B0 B5               OR      L
          C5B1 32A3B7           LD      (COLOR),A
          C5B4 C9               RET
          C5B5
          C5B5          WINDC   ;WINDOW-MenÅwort
          C5B5 A7               AND     A       ;Kein Arg?
          C5B6 2820             JR      Z,WINAKC;Aufruf No.0
          C5B8 3D               DEC     A       ;1 Arg?
          C5B9 7D               LD      A,L     ;nr
          C5BA 281C             JR      Z,WINAKC;Aufruf No.L
          C5BC 65               LD      H,L     ;za
          C5BD 69               LD      L,C     ;sa
          C5BE 53               LD      D,E     ;zn
          C5BF 3A88B7           LD      A,(ARG4)
          C5C2 5F               LD      E,A     ;sn
          C5C3 3A81B7           LD      A,(ARGN)
          C5C6 FE04             CP      4
          C5C8 380A             JR      C,WINC2 ;2..3 Arg
          C5CA 3E00             LD      A,0
          C5CC 2803             JR      Z,WINC1 ;4 Arg
          C5CE 3A8AB7           LD      A,(ARG5);nr
          C5D1 CD08C6   WINC1   CALL    WININC
          C5D4 DA76F4   WINC2   JP      C,ERRM
          C5D7 C9               RET
          C5D8
          C5D8          WINAKC  ;def. Fenster aufrufen
          C5D8 CDF5C5           CALL    WCOPY
          C5DB 329BB7           LD      (WINNR),A
          C5DE CDE8C5           CALL    PART    ;Fenster A
          C5E1 D8               RET     C       ;holen
          C5E2 EB               EX      DE,HL
          C5E3 119CB7           LD      DE,WINON
          C5E6 181A             JR      WCOP1
          C5E8
          C5E8          PART    ;Testet A und berechnet Pos.
          C5E8                  ;in Fenstervektorspeicher =DE
          C5E8 C6F6             ADD     0F6H
          C5EA D8               RET     C       ;zu gro·
          C5EB 87               ADD     A
          C5EC 5F               LD      E,A
          C5ED 87               ADD     A
          C5EE 87               ADD     A
          C5EF 83               ADD     E
          C5F0 5F               LD      E,A
          C5F1 16B9             LD      D,0B9H
          C5F3 A7               AND     A       ;CY=0
          C5F4 C9               RET
          C5F5
          C5F5          WCOPY   ;Fenster (WINNR) retten
          C5F5 F5               PUSH    AF
          C5F6 3A9BB7           LD      A,(WINNR)
          C5F9 CDE8C5           CALL    PART
          C5FC 383D             JR      C,WINIE ;Fehler
          C5FE F1               POP     AF
          C5FF 219CB7           LD      HL,WINON
          C602 010A00   WCOP1   LD      BC,10
          C605 EDB0             LDIR
          C607 C9               RET
          C608
          C608          WININC  ;Initialisierung eines Fensters
          C608 F5               PUSH    AF
          C609 FE0A             CP      10      ;No.
          C60B 302E             JR      NC,WINIE
          C60D 7A               LD      A,D     ;Zeilen
          C60E A7               AND     A
          C60F 282A             JR      Z,WINIE
          C611 84               ADD     H
          C612 3827             JR      C,WINIE
          C614 FE21             CP      21H
          C616 3023             JR      NC,WINIE
          C618 7B               LD      A,E     ;Spalten
          C619 A7               AND     A
          C61A 281F             JR      Z,WINIE
          C61C 85               ADD     L
          C61D 381C             JR      C,WINIE
          C61F FE29             CP      29H
          C621 3018             JR      NC,WINIE
          C623 F1               POP     AF
          C624 D5               PUSH    DE
          C625 E5               PUSH    HL
          C626 CDF5C5           CALL    WCOPY
          C629 E1               POP     HL
          C62A D1               POP     DE
          C62B 229CB7           LD      (WINON),HL
          C62E ED539EB7         LD      (WINLG),DE
          C632 ED43A0B7         LD      (CURSO),BC      ;BC=0
          C636 329BB7           LD      (WINNR),A
          C639 A7               AND     A
          C63A C9               RET
          C63B                  ;
          C63B F1       WINIE   POP     AF      ;Fehlerende
          C63C 37               SCF
          C63D C9               RET
          C63E
          C63E          LINEC   ;Linie zeichnen von
          C63E          ;       (ARG1)/(ARG2) nach (ARG3)/(ARG4)
          C63E ED5B84B7          LD     DE,(ARG2) ;YANF
          C642 2A88B7            LD     HL,(ARG4) ;YEND
          C645 D9                EXX
          C646 ED5B82B7         LD      DE,(ARG1) ;XANF
          C64A D5               PUSH    DE
          C64B 2A86B7           LD      HL,(ARG3) ;XEND
          C64E 3E08             LD      A,8     ;X=Master
          C650 B7               OR      A
          C651 ED52             SBC     HL,DE   ;HL=XSTEPS
          C653 3006             JR      NC,LINC1;vorwÑrts
          C655 19               ADD     HL,DE
          C656 EB               EX      DE,HL
          C657 F601             OR      1       ;rÅckwÑrts
          C659 ED52             SBC     HL,DE
          C65B D9       LINC1    EXX
          C65C D5                PUSH   DE      ;YANF
          C65D ED52              SBC    HL,DE   ;HL'=YSTEPS
          C65F 3006              JR     NC,LINC2;steigend
          C661 19                ADD    HL,DE
          C662 EB                EX     DE,HL
          C663 F602              OR     2       ;fallend
          C665 ED52              SBC    HL,DE
          C667 E5       LINC2    PUSH   HL      ;YSTEPS
          C668 D9                EXX            ;HL=XSTEPS
          C669 C1               POP     BC      ;BC=YSTEPS
          C66A E5               PUSH    HL
          C66B ED42             SBC     HL,BC   ;flach/steil?
          C66D E1               POP     HL
          C66E C5               PUSH    BC
          C66F 3005             JR      NC,LINC3;flach
          C671 E3               EX      (SP),HL
          C672 CB9F             RES     3,A     ;X=Slave
          C674 CBD7             SET     2,A     ;Y=Master
          C676 E5       LINC3   PUSH    HL      ;HL=MAX(STEPS)
          C677 44               LD      B,H
          C678 4D               LD      C,L     ;PixelzÑhler
          C679 D9                EXX
          C67A C1                POP    BC      ;BC'=MAX(...)
          C67B D1                POP    DE      ;DE'=MIN(...)
          C67C 60                LD     H,B
          C67D 69                LD     L,C
          C67E CB3C              SRL    H       ;Slave mit 1/2
          C680 CB1D              RR     L       ;HL=1/2*MAX(...)
          C682 D9                EXX
          C683 D1               POP     DE      ;DE=YANF
          C684 E1               POP     HL      ;HL=XANF
          C685
          C685                  ;Hauptschleife
          C685          ;AF Bitregister
          C685          ;HL lfd. X-Koordinate   HL' Slave
          C685          ;DE lfd. Y-Koordinate   DE' -Master
          C685          ;BC PunktezÑhler        BC' +Master
          C685
          C685 F5       LINCS   PUSH    AF
          C686 08               EX      AF,AF'  ;Bitreg merken
          C687 F1               POP     AF
          C688 E5               PUSH    HL
          C689 21EDB7           LD      HL,LINTYP
          C68C CB06             RLC     M
          C68E E1               POP     HL
          C68F DC3FC7           CALL    C,SHLDE;Punkt setzen
          C692 D9                EXX
          C693 A7                AND    A
          C694 ED52              SBC    HL,DE   ;-Master subtr.
          C696 3001              JR     NC,LINC4;kein Uebertrag-
          C698                                  ;kein Sprung!
          C698 09                ADD    HL,BC   ;+Master add.
          C699                                  ;CY bleibt =1!
          C699 D9       LINC4    EXX
          C69A 3002             JR      NC,LINC5
          C69C F60C             OR      0CH     ;X und Y!
          C69E CB5F     LINC5   BIT     3,A     ;X?
          C6A0 2807             JR      Z,LINC6
          C6A2 23               INC     HL
          C6A3 CB47             BIT     0,A
          C6A5 2802             JR      Z,LINC6
          C6A7 2B               DEC     HL
          C6A8 2B               DEC     HL
          C6A9 CB57     LINC6   BIT     2,A     ;Y?
          C6AB 2807             JR      Z,LINC7
          C6AD 13               INC     DE
          C6AE CB4F             BIT     1,A
          C6B0 2802             JR      Z,LINC7
          C6B2 1B               DEC     DE
          C6B3 1B               DEC     DE
          C6B4 78       LINC7   LD      A,B
          C6B5 B1               OR      C       ;letzter Punkt?
          C6B6 C8               RET     Z
          C6B7 0B               DEC     BC
          C6B8 08               EX      AF,AF'  ;Bitreg
          C6B9 18CA             JR      LINCS
          C6BB
          C6BB          PUSEC   ;Punkt setzen
          C6BB E5               PUSH    HL
          C6BC D5               PUSH    DE
          C6BD C5               PUSH    BC
          C6BE CDBAC7           CALL    CALHV   ;berechnen
          C6C1 D44EC7           CALL    NC,PUSET;& setzen
          C6C4 C1               POP     BC
          C6C5 D1               POP     DE
          C6C6 E1               POP     HL
          C6C7 C9               RET
          C6C8
          C6C8          CIRCLC  ;Kreis zeichnen
          C6C8 3A86B7           LD      A,(ARG3)
          C6CB 4F               LD      C,A
          C6CC 69               LD      L,C
          C6CD AF               XOR     A
          C6CE 0608             LD      B,8
          C6D0 CB1D             RR      L
          C6D2 3001     CIR1    JR      NC,CIR2
          C6D4 81               ADD     C
          C6D5 1F       CIR2    RRA
          C6D6 CB1D             RR      L
          C6D8 10F8             DJNZ    CIR1
          C6DA 67               LD      H,A     ;Achtelkreis
          C6DB 54               LD      D,H     ;berechnen
          C6DC 5D               LD      E,L
          C6DD 79               LD      A,C
          C6DE CB21             SLA     C
          C6E0 CB10             RL      B
          C6E2 0B               DEC     BC
          C6E3 C5               PUSH    BC
          C6E4 010100           LD      BC,1
          C6E7 D9               EXX
          C6E8 4F               LD      C,A
          C6E9 0600             LD      B,0H
          C6EB E5       CIR3    PUSH    HL
          C6EC 21EDB7           LD      HL,LINTYP
          C6EF CB06             RLC     M
          C6F1 E1               POP     HL
          C6F2 3006             JR      NC,CIRN
          C6F4 CD19C7           CALL    CIRUP   ;und jeweils 8
          C6F7 CD19C7           CALL    CIRUP   ;Punkte setzen
          C6FA D9       CIRN    EXX
          C6FB A7               AND     A
          C6FC ED42             SBC     HL,BC
          C6FE 03               INC     BC
          C6FF 03               INC     BC
          C700 ED52             SBC     HL,DE
          C702 19               ADD     HL,DE
          C703 D9               EXX
          C704 300C             JR      NC,CIR4
          C706 D9               EXX
          C707 E3               EX      (SP),HL
          C708 EB               EX      DE,HL
          C709 A7               AND     A
          C70A ED52             SBC     HL,DE
          C70C 1B               DEC     DE
          C70D 1B               DEC     DE
          C70E EB               EX      DE,HL
          C70F E3               EX      (SP),HL
          C710 D9               EXX
          C711 0D               DEC     C
          C712 04       CIR4    INC     B
          C713 79               LD      A,C
          C714 B8               CP      B
          C715 30D4             JR      NC,CIR3
          C717 F1               POP     AF
          C718 C9               RET
          C719
          C719          CIRUP   ;setzt 4 Punkte um Mittelpunkt
          C719 78               LD      A,B
          C71A 41               LD      B,C
          C71B 4F               LD      C,A
          C71C AF               XOR     A
          C71D 57               LD      D,A
          C71E 2A84B7           LD      HL,(ARG2)
          C721 E5               PUSH    HL
          C722 59               LD      E,C
          C723 19               ADD     HL,DE
          C724 CD2DC7           CALL    CIRUP1
          C727 AF               XOR     A
          C728 57               LD      D,A
          C729 E1               POP     HL
          C72A 59               LD      E,C
          C72B ED52             SBC     HL,DE
          C72D E5       CIRUP1  PUSH    HL
          C72E 2A82B7           LD      HL,(ARG1)
          C731 58               LD      E,B
          C732 A7               AND     A
          C733 ED52             SBC     HL,DE
          C735 D1               POP     DE
          C736 CD3FC7           CALL    SHLDE
          C739 D5               PUSH    DE
          C73A 57               LD      D,A
          C73B 58               LD      E,B
          C73C 19               ADD     HL,DE
          C73D 19               ADD     HL,DE
          C73E D1               POP     DE
          C73F                  ;
          C73F          SHLDE   ;setzt Punkt auf Pos. HL/DE
          C73F                  ;(wenn mîglich)
          C73F E5               PUSH    HL
          C740 D5               PUSH    DE
          C741 C5               PUSH    BC
          C742 F5               PUSH    AF
          C743 CDC3C7           CALL    CALXY   ;berechnen
          C746 D44EC7           CALL    NC,PUSET;& setzen
          C749 F1               POP     AF
          C74A C1               POP     BC
          C74B D1               POP     DE
          C74C E1               POP     HL
          C74D C9               RET
          C74E                  ;
          C74E DDCB015E PUSET   BIT     3,(IX+1)
          C752 2826             JR      Z,HIRES ;HiRes
          C754 CB4A             BIT     1,D
          C756 201E             JR      NZ,PUERA
          C758 CB42             BIT     0,D
          C75A 2003             JR      NZ,PUXOR
          C75C B6               OR      M       ;setzen
          C75D 1803             JR      PUCOL
          C75F AE       PUXOR   XOR     M       ;alternierend
          C760 CB82             RES     0,D
          C762 77       PUCOL   LD      M,A
          C763 DD7E01           LD      A,(IX+1)
          C766 5F               LD      E,A
          C767 EE02             XOR     2       ;Farbebene
          C769 F3               DI
          C76A D384             OUT     84H
          C76C 7E               LD      A,M
          C76D E607             AND     7
          C76F B2               OR      D
          C770 77               LD      M,A     ;neue vFarbe
          C771 7B               LD      A,E
          C772 D384             OUT     84H
          C774 FB               EI
          C775 C9               RET
          C776 2F       PUERA   CPL
          C777 A6               AND     M       ;lîschen
          C778 77               LD      M,A
          C779 C9               RET
          C77A                  ;
          C77A 47       HIRES   LD      B,A
          C77B B6               OR      M       ;Bit setzen in
          C77C CB5A             BIT     3,D     ;Pixelebene?
          C77E 2001             JR      NZ,HIR1
          C780 A8               XOR     B       ;wieder lîschen
          C781 77       HIR1    LD      M,A
          C782 DD7E01           LD      A,(IX+1)
          C785 4F               LD      C,A
          C786 EE02             XOR     2
          C788 F3               DI
          C789 D384             OUT     84H
          C78B 78               LD      A,B
          C78C B6               OR      M       ;Bit setzen in
          C78D CB62             BIT     4,D     ;Farbebene?
          C78F 2001             JR      NZ,HIR2
          C791 A8               XOR     B       ;wieder lîschen
          C792 77       HIR2    LD      M,A
          C793 79               LD      A,C
          C794 D384             OUT     84H
          C796 FB               EI
          C797 C9               RET
          C798
          C798          PUDEC   ;Punkt lîschen, PA: A=Farbbyte
          C798 E5               PUSH    HL
          C799 D5               PUSH    DE
          C79A C5               PUSH    BC
          C79B CDBAC7           CALL    CALHV
          C79E 3816             JR      C,PUDEE ;au·erhalb
          C7A0 47               LD      B,A     ;Bit
          C7A1 4E               LD      C,M
          C7A2 2F               CPL
          C7A3 A1               AND     C
          C7A4 77               LD      M,A     ;lîschen
          C7A5 DD7E01           LD      A,(IX+1)
          C7A8 5F               LD      E,A
          C7A9 EE02             XOR     2
          C7AB F3               DI
          C7AC D384             OUT     84H
          C7AE 56               LD      D,M     ;Farbbyte
          C7AF 7B               LD      A,E
          C7B0 D384             OUT     84H
          C7B2 FB               EI
          C7B3 78               LD      A,B     ;Z=1: Punkt
          C7B4 A1               AND     C       ;war gelîscht
          C7B5 7A               LD      A,D     ;Farbbyte
          C7B6 C1       PUDEE   POP     BC
          C7B7 D1               POP     DE
          C7B8 E1               POP     HL
          C7B9 C9               RET
          C7BA
          C7BA          ;Grafikposition berechnen
          C7BA          ;HL=X-Koor., DE=Y-Koor.
          C7BA          ;PA:    CY=1    au·erhalb
          C7BA          ;HL=IRM-Adr, A=Bitmaske, D=Farb
          C7BA
          C7BA 2AD3B7   CALHV   LD      HL,(HOR)
          C7BD ED5BD5B7         LD      DE,(VERT)
          C7C1 1600             LD      D,0
          C7C3 C5       CALXY   PUSH    BC
          C7C4 01F8FD           LD      BC,BITTAB
          C7C7 7D               LD      A,L
          C7C8 E607             AND     7
          C7CA 81               ADD     C
          C7CB 4F               LD      C,A     ;Bit
          C7CC 7D               LD      A,L
          C7CD CB3C             SRL     H
          C7CF 1F               RRA
          C7D0 CB3C             SRL     H
          C7D2 1F               RRA
          C7D3 CB3C             SRL     H
          C7D5 1F               RRA             ;Spalte
          C7D6 FE28             CP      28H
          C7D8 3011             JR      NC,CALEN
          C7DA F680             OR      80H     ;IRM
          C7DC 67               LD      H,A
          C7DD 3EFF             LD      A,0FFH
          C7DF 82               ADD     D
          C7E0 3809             JR      C,CALEN
          C7E2 AB               XOR     E       ;CY=0!
          C7E3 6F               LD      L,A     ;Zeile
          C7E4 3AD6B7           LD      A,(FARB)
          C7E7 57               LD      D,A
          C7E8 0A               LD      A,(BC)  ;MASKE fuer X
          C7E9 C1               POP     BC
          C7EA C9               RET
          C7EB C1       CALEN   POP     BC      ;au·erhalb
          C7EC 37               SCF
          C7ED C9               RET
          C7EE
          C7EE          DPMEMO  ;Ausgabe einer Displayzeile
          C7EE                  ;HL=Adr, C=Anzahl Bytes
          C7EE CD69F4           CALL    HLHX    ;Adresse
          C7F1 E5               PUSH    HL
          C7F2 41               LD      B,C
          C7F3 CD35F7   DPME1   CALL    LDAME   ;Byte holen
          C7F6 23               INC     HL
          C7F7 CD6EF4           CALL    AHSPC   ;anzeigen
          C7FA 10F7             DJNZ    DPME1   ;C*
          C7FC E1               POP     HL
          C7FD 41               LD      B,C
          C7FE 3E09             LD      A,9
          C800 CD80F3           CALL    OCHR    ;CUR
          C803 CD35F7   DPME2   CALL    LDAME   ;Byte holen
          C806 23               INC     HL
          C807 CD15F7           CALL    CSTBT   ;als ASCII
          C80A 10F7             DJNZ    DPME2   ;C*
          C80C C9               RET
          C80D
          C80D          DISPC   ;Anzeige Speicherbereich
          C80D                  ;HL=Adr, E=ListblocklÑnge
          C80D                  ;C=Anzahl Bytes pro Zeile
          C80D                  ;A=Anzahl Argumente
          C80D FE03             CP      3
          C80F 3008             JR      NC,DISP1
          C811 0E08             LD      C,8     ;default
          C813 FE02             CP      2
          C815 3002             JR      NC,DISP1
          C817 1E04             LD      E,4     ;default
          C819 D5       DISP1   PUSH    DE
          C81A CDEEC7   DISP2   CALL    DPMEMO  ;1 Zeile
          C81D CD80F4           CALL    CRLF
          C820 CDACE4           CALL    BRKT
          C823 3806             JR      C,DISP4
          C825 1D               DEC     E
          C826 20F2             JR      NZ,DISP2;E*
          C828 CD7AF3   DISP3   CALL    INTB    ;Warten Taste
          C82B D1       DISP4   POP     DE
          C82C FE03             CP      3       ;BRK?
          C82E C8               RET     Z
          C82F FE0F             CP      0FH
          C831 2005             JR      NZ,DISP5
          C833 CD80F3           CALL    OCHR    ;Hardcopy
          C836 18F0             JR      DISP3
          C838 FE13     DISP5   CP      13H     ;STOP?
          C83A 20DD             JR      NZ,DISP1
          C83C 1807             JR      MODI1
          C83E
          C83E          MODIC   ;Anzeige/VerÑndern Speicher-
          C83E                  ;bereich, Par. wie DISPC
          C83E 4B               LD      C,E     ;Breite
          C83F FE02             CP      2
          C841 3002             JR      NC,MODI1
          C843 0E01             LD      C,1     ;default
          C845 CDEEC7   MODI1   CALL    DPMEMO
          C848 3E05             LD      A,5
          C84A 32A0B7           LD      (CURSO),A
          C84D CD3CF4           CALL    INLIN
          C850 D8               RET     C       ;BRK
          C851 E5               PUSH    HL
          C852 CDA7F4           CALL    RHEX    ;Adresse
          C855 7E               LD      A,M
          C856 E1               POP     HL
          C857 3856             JR      C,MODI9 ;Fehler
          C859 A7               AND     A
          C85A 28E9             JR      Z,MODI1
          C85C 2A97B7           LD      HL,(NUMVX)
          C85F E5       MODI2   PUSH    HL
          C860 CDA7F4           CALL    RHEX    ;Datenbyte
          C863 7E               LD      A,M
          C864 A7               AND     A       ;kein Zeichen
          C865 23               INC     HL      ;einlesbar?
          C866 7E               LD      A,M
          C867 E1               POP     HL
          C868 2804             JR      Z,MODI4
          C86A CD58F7   MODI3   CALL    LDMAE   ;eintragen
          C86D 23               INC     HL
          C86E 1A       MODI4   LD      A,(DE)
          C86F FE2E             CP      '.'     ;Abschlu·?
          C871 C8               RET     Z
          C872 FE2C             CP      ','     ;1 Zeichen?
          C874 2005             JR      NZ,MODI5
          C876 13               INC     DE
          C877 1A               LD      A,(DE)  ;vom Video-RAM
          C878 13               INC     DE
          C879 18EF             JR      MODI3   ;eintragen
          C87B
          C87B FE3A     MODI5   CP      ':'     ;RÅckschritt?
          C87D 2006             JR      NZ,MODI6
          C87F 0600             LD      B,0
          C881 ED42             SBC     HL,BC   ;C Bytes zurÅck
          C883 18C0             JR      MODI1
          C885
          C885 FE2F     MODI6   CP      '/'     ;neue Adresse?
          C887 200B             JR      NZ,MODI0
          C889 13               INC     DE
          C88A CDA7F4           CALL    RHEX
          C88D 3820             JR      C,MODI9
          C88F 2A97B7           LD      HL,(NUMVX)
          C892 18B1             JR      MODI1
          C894
          C894 FE27     MODI0   CP      27H     ;Zeichenkette?
          C896 2010             JR      NZ,MODI8
          C898 13               INC     DE
          C899 1A       MODI7   LD      A,(DE)  ;Zeichen holen
          C89A 13               INC     DE
          C89B A7               AND     A       ;Dummy-Ende?
          C89C 28A7             JR      Z,MODI1
          C89E FE27             CP      27H     ;Ende Kette?
          C8A0 28CC             JR      Z,MODI4
          C8A2 CD58F7           CALL    LDMAE   ;eintragen
          C8A5 23               INC     HL
          C8A6 18F1             JR      MODI7
          C8A8
          C8A8 A7       MODI8   AND     A       ;Ende Zeile?
          C8A9 289A             JR      Z,MODI1
          C8AB FE20             CP      ' '     ;Leerzeichen?
          C8AD 28B0             JR      Z,MODI2
          C8AF CD76F4   MODI9   CALL    ERRM    ;sonst ERROR
          C8B2 1891             JR      MODI1
          C8B4
          C8B4
          C8B4          CENC    ;Initialisierung Centronics-
          C8B4                  ;Drucker, PE:Args
          C8B4 2181B7           LD      HL,ARGN
          C8B7 7E               LD      A,M
          C8B8 34               INC     M       ;Args wie V24!
          C8B9 A7               AND     A
          C8BA 2817             JR      Z,CEN1  ;kein Arg
          C8BC 23               INC     HL
          C8BD 46               LD      B,M     ;Platz
          C8BE 0E80             LD      C,80H
          C8C0 ED78             IN      A,(C)
          C8C2 FEEF             CP      0EFH    ;M001?
          C8C4 200D             JR      NZ,CEN1
          C8C6 68               LD      L,B
          C8C7 3E02             LD      A,2
          C8C9 1601             LD      D,1
          C8CB CD85C3           CALL    MODUC   ;M001 ein
          C8CE 21C6F9           LD      HL,M001PR
          C8D1 1803             JR      CEN2
          C8D3 21D9F9   CEN1    LD      HL,M021PR
          C8D6 22EAB7   CEN2    LD      (OFILT+1),HL
          C8D9 2182B7           LD      HL,ARG1
          C8DC 1812             JR      CEN3
          C8DE
          C8DE          V24OC   ;Initialisieren Druckerausgabe
          C8DE                  ;PE: Argumente
          C8DE 2181B7           LD      HL,ARGN
          C8E1 7E               LD      A,M
          C8E2 FE02             CP      2
          C8E4 302E             JR      NC,V24O3;mehr als 1 Arg
          C8E6 0608             LD      B,8     ;ab Platz 8
          C8E8 CDEEC9           CALL    V24SU   ;M003 suchen
          C8EB 385F             JR      C,V24O6 ;nicht gef.
          C8ED 2184B7           LD      HL,ARG2
          C8F0 3A81B7   CEN3    LD      A,(ARGN)
          C8F3 FE03             CP      3
          C8F5 303F             JR      NC,V24O5;USER angegeben
          C8F7 2173F9           LD      HL,HCPGM
          C8FA 2299B7           LD      (HCADR),HL;ShCLR belegen
          C8FD 11B4F9           LD      DE,PRINT
          C900 21E1B7           LD      HL,HCPZ
          C903 CB4E             BIT     1,M     ;UOUT1 oder 2?
          C905 2006             JR      NZ,V24O1
          C907 ED53BEB7         LD      (UOUT1+1),DE
          C90B 1804             JR      V24O2
          C90D ED53C4B7 V24O1   LD      (UOUT2+1),DE
          C911 C3A5C9   V24O2   JP      V24O12
          C914
          C914 23       V24O3   INC     HL      ;ARG1
          C915 46               LD      B,M     ;ab Platz
          C916 CDEEC9           CALL    V24SU   ;M003 suchen
          C919 3831             JR      C,V24O6 ;nicht gef.
          C91B 23               INC     HL
          C91C 23               INC     HL      ;ARG2
          C91D 7E               LD      A,M     ;SIO A oder B?
          C91E 3D               DEC     A
          C91F 200A             JR      NZ,V24O4
          C921 3AE1B7           LD      A,(HCPZ)
          C924 CB97             RES     2,A     ;merken SIOA
          C926 32E1B7           LD      (HCPZ),A
          C929 180B             JR      V24O5
          C92B
          C92B 3D       V24O4   DEC     A
          C92C 201E             JR      NZ,V24O6;Fehler
          C92E 3AE1B7           LD      A,(HCPZ)
          C931 CBD7             SET     2,A     ;merken SIOB
          C933 32E1B7           LD      (HCPZ),A
          C936 23       V24O5   INC     HL
          C937 23               INC     HL
          C938 11B4F9           LD      DE,PRINT
          C93B 7E               LD      A,M     ;USER1 oder 2?
          C93C 3D               DEC     A
          C93D 3D               DEC     A
          C93E 200F             JR      NZ,V24O7
          C940 ED53BEB7         LD      (UOUT1+1),DE
          C944 11E1B7           LD      DE,HCPZ
          C947 1A               LD      A,(DE)
          C948 CB8F             RES     1,A     ;merken USER1
          C94A 1810             JR      V24O8
          C94C
          C94C C376F4   V24O6   JP      ERRM    ;Fehlersprung
          C94F
          C94F 3D       V24O7   DEC     A
          C950 20FA             JR      NZ,V24O6;Fehler
          C952 ED53C4B7         LD      (UOUT2+1),DE
          C956 11E1B7           LD      DE,HCPZ
          C959 1A               LD      A,(DE)
          C95A CBCF             SET     1,A     ;merken USER2
          C95C 12       V24O8   LD      (DE),A
          C95D 3A81B7           LD      A,(ARGN)
          C960 FE04             CP      4       ;4. Argument?
          C962 3841             JR      C,V24O12;nein
          C964 23               INC     HL
          C965 23               INC     HL
          C966 7E               LD      A,M     ;ShCLR?
          C967 A7               AND     A
          C968 11F0E3           LD      DE,NOT
          C96B 2818             JR      Z,V24O11;keine Fkt.
          C96D 3D               DEC     A
          C96E 280A             JR      Z,V24O9 ;Protokoll
          C970 3D               DEC     A       ;Hardcopy?
          C971 20D9             JR      NZ,V24O6
          C973 3AE1B7           LD      A,(HCPZ)
          C976 CBC7             SET     0,A     ;Hcopy merken
          C978 1805             JR      V24O10
          C97A
          C97A 3AE1B7   V24O9   LD      A,(HCPZ)
          C97D CB87             RES     0,A     ;Hcopy aus
          C97F 32E1B7   V24O10  LD      (HCPZ),A
          C982 1173F9           LD      DE,HCPGM
          C985 ED5399B7 V24O11  LD      (HCADR),DE
          C989 3A81B7           LD      A,(ARGN)
          C98C FE05             CP      5       ;5. Argument?
          C98E 3815             JR      C,V24O12;nein
          C990 23               INC     HL
          C991 23               INC     HL
          C992 7E               LD      A,M     ;Druckertyp
          C993 CB27             SLA     A
          C995 CB27             SLA     A
          C997 CB27             SLA     A       ;nach obere
          C999 CB27             SLA     A       ;Tetrade
          C99B 4F               LD      C,A
          C99C 3AE1B7           LD      A,(HCPZ)
          C99F E60F             AND     0FH     ;in (HCPZ)
          C9A1 B1               OR      C       ;einbauen
          C9A2 32E1B7           LD      (HCPZ),A
          C9A5 3AEAB7   V24O12  LD      A,(OFILT+1)
          C9A8 FEC6             CP      M001PR
          C9AA 21D6C9           LD      HL,IN01
          C9AD 2805             JR      Z,INICEN
          C9AF FED9             CP      M021PR
          C9B1 21E2C9           LD      HL,IN21
          C9B4 CA1DF5   INICEN  JP      Z,INIMEX;Init Centron.
          C9B7                  ;Init V.24-Druck
          C9B7 CD6EFA           CALL    LCSO
          C9BA 3E0C             LD      A,0CH   ;CTC-Adresse
          C9BC C5               PUSH    BC
          C9BD 81               ADD     C
          C9BE 0602             LD      B,2     ;2 Steuerbytes
          C9C0 4F               LD      C,A
          C9C1 2AE2B7           LD      HL,(INTV1)
          C9C4 F3               DI
          C9C5 EDB3             OTIR            ;CTC init.
          C9C7 C1               POP     BC
          C9C8 3AE4B7           LD      A,(INTV1L)
          C9CB 3D               DEC     A
          C9CC 3D               DEC     A       ;-2
          C9CD 47               LD      B,A
          C9CE 3E0A             LD      A,0AH   ;SIO-Adresse
          C9D0 81               ADD     C
          C9D1 4F               LD      C,A
          C9D2 EDB3             OTIR            ;SIO init.
          C9D4 FB               EI
          C9D5 C9               RET
          C9D6
          C9D6          IN01    ;Inittabelle fÅr M001
          C9D6 03               DB      3
          C9D7 06               DB      6       ;PIO-A Stw
          C9D8 02                DB     2
          C9D9 CF                 DB    0CFH    ;Bitbetrieb
          C9DA 00                 DB    0       ;alles Ausg.
          C9DB 07               DB      7       ;PIO-B Stw
          C9DC 02                DB     2
          C9DD CF                 DB    0CFH    ;Bitbetrieb
          C9DE FE                 DB    0FEH    ;Bit 0 Ausg.
          C9DF 05               DB      5       ;POI-B Daten
          C9E0 01                DB     1
          C9E1 01                 DB    1       ;Strobe passiv
          C9E2
          C9E2          IN21    ;Inittabelle fÅr M021
          C9E2 03               DB      3
          C9E3 93               DB      93H     ;PIO-B Stw
          C9E4 02                DB     2
          C9E5 CF                 DB    0CFH    ;Bitbetrieb
          C9E6 00                 DB    0       ;alles Ausg.
          C9E7 92               DB      92H     ;PIO-A Stw
          C9E8 02                DB     2
          C9E9 CF                 DB    0CFH    ;Bitbetrieb
          C9EA 7F                 DB    7FH     ;Bit 7 Ausg.
          C9EB 90               DB      90H     ;PIO-A Daten
          C9EC 01                DB     1
          C9ED 80                 DB    80H     ;Strobe passiv
          C9EE
          C9EE          V24SU   ;Suche 1. V24-Modul
          C9EE 0E80             LD      C,80H
          C9F0 ED78     V24S1   IN      A,(C)
          C9F2 FEEE             CP      0EEH    ;M003?
          C9F4 2805             JR      Z,V24S2 ;ja
          C9F6 04               INC     B
          C9F7 20F7             JR      NZ,V24S1
          C9F9 37               SCF             ;nicht gef.
          C9FA C9               RET
          C9FB                  ;
          C9FB E5       V24S2   PUSH    HL
          C9FC 68               LD      L,B
          C9FD 3E02             LD      A,2
          C9FF 1601             LD      D,1
          CA01 CD85C3           CALL    MODUC   ;einschalten
          CA04 21EDF9           LD      HL,V24PR
          CA07 22EAB7           LD      (OFILT+1),HL
          CA0A E1               POP     HL
          CA0B C9               RET
          CA0C
          CA0C          PRINTC  ;allgemeine Druckroutine
          CA0C F5               PUSH    AF
          CA0D 3AE1B7           LD      A,(HCPZ)
          CA10 CB7F             BIT     7,A
          CA12 2829             JR      Z,PRINT3;Drucker
          CA14                  ;Schreibmaschine
          CA14 E6F0             AND     0F0H
          CA16 FE90             CP      90H
          CA18 2817             JR      Z,S6005
          CA1A FEA0             CP      0A0H
          CA1C 201F             JR      NZ,PRINT3
          CA1E F1       S6010   POP     AF
          CA1F E5               PUSH    HL
          CA20 C5               PUSH    BC
          CA21 215CCA           LD      HL,ZIBM
          CA24 010700           LD      BC,7
          CA27 EDB1             CPIR
          CA29 200F             JR      NZ,PRINT2
          CA2B 0E06             LD      C,6
          CA2D 09               ADD     HL,BC
          CA2E 7E               LD      A,M
          CA2F 1809             JR      PRINT2
          CA31
          CA31 F1       S6005   POP     AF
          CA32 FE7E             CP      '·'
          CA34 2008             JR      NZ,PRINT4
          CA36 3E83             LD      A,83H
          CA38 1804             JR      PRINT4
          CA3A C1       PRINT2  POP     BC
          CA3B E1               POP     HL
          CA3C F5               PUSH    AF
          CA3D F1       PRINT3  POP     AF
          CA3E FE09     PRINT4  CP      9       ;CUR
          CA40 280D             JR      Z,PRINT5
          CA42 F5               PUSH    AF
          CA43 3AA2B7           LD      A,(STBT)
          CA46 CB5F             BIT     3,A     ;Steuerzeichen
          CA48 280E             JR      Z,PRINT7;ausfÅhren
          CA4A F1               POP     AF
          CA4B FE7F             CP      7FH     ;und 7Fh
          CA4D 2002             JR      NZ,PRINT6
          CA4F 3E20     PRINT5  LD      A,20H   ;nach SPC
          CA51 FE20     PRINT6  CP      20H     ;und Steuerzei-
          CA53 3004             JR      NC,PRINT8;chen nach '_'
          CA55 3E5F             LD      A,'_'   ;wandeln
          CA57 F5               PUSH    AF
          CA58 F1       PRINT7  POP     AF
          CA59 C3E9B7   PRINT8  JP      OFILT   ;in IRM
          CA5C
          CA5C          ZIBM    ;IBM-Kodierungen
          CA5C 7B7C7D7E         DB      'ÑîÅ·'
          CA60 5B5C5D           DB      'éôö'
          CA63 849481E1         DB      84H,94H,81H,0E1H
          CA67 8E999A           DB      8EH,99H,9AH
          CA6A
          CA6A          HCPGMC  ;ShCLR-Reaktionsprogramm
          CA6A E5               PUSH    HL
          CA6B D5               PUSH    DE
          CA6C 3AE1B7           LD      A,(HCPZ)
          CA6F CB47             BIT     0,A     ;Hardcopy?
          CA71 C2A9CA           JP      NZ,COPIES
          CA74
          CA74                  ;Protokollfunktion
          CA74 2AB9B7           LD      HL,(OUTAB)
          CA77 AF               XOR     A
          CA78 B6               OR      M       ;CRT?
          CA79 2014             JR      NZ,PROTO2
          CA7B 11B1F9           LD      DE,ECHO ;CRT+PRINT
          CA7E 21A9FB           LD      HL,ZEI3 ;UOUT2
          CA81 3AE1B7           LD      A,(HCPZ)
          CA84 CB4F             BIT     1,A     ;USER1/2?
          CA86 2802             JR      Z,PROTO1
          CA88 180F             JR      PROTO3
          CA8A
          CA8A 21A8FB   PROTO1  LD      HL,ZEI2 ;UOUT1
          CA8D 1810             JR      PROTO4
          CA8F
          CA8F          PROTO2  ;Protokoll deaktivieren
          CA8F 11B4F9           LD      DE,PRINT
          CA92 21A6FB           LD      HL,ZEI0 ;CRT
          CA95 3D               DEC     A
          CA96 3D               DEC     A
          CA97 2806             JR      Z,PROTO4
          CA99 ED53C4B7 PROTO3  LD      (UOUT2+1),DE
          CA9D 1804             JR      PROTO5
          CA9F                  ;
          CA9F ED53BEB7 PROTO4  LD      (UOUT1+1),DE
          CAA3 22B9B7   PROTO5  LD      (OUTAB),HL ;Zeiger
          CAA6 D1               POP     DE
          CAA7 E1               POP     HL
          CAA8 C9               RET
          CAA9
          CAA9          COPIES  ;Hard- oder Screencopy
          CAA9 C5               PUSH    BC
          CAAA F5               PUSH    AF
          CAAB 3AE1B7           LD      A,(HCPZ)
          CAAE E6F0             AND     0F0H
          CAB0 CB7F             BIT     7,A
          CAB2 2826             JR      Z,HCOPYC;Hardcopy
          CAB4          ;Screencopy
          CAB4 2ACBB7           LD      HL,(VRAM)
          CAB7 0620             LD      B,32
          CAB9 0E28     SCOPY1  LD      C,40
          CABB 7E       SCOPY2  LD      A,M
          CABC 23               INC     HL
          CABD FE20             CP      20H
          CABF 3002             JR      NC,SCOPY4
          CAC1 3E20             LD      A,' '   ;statt Steuerz.
          CAC3 CDB4F9   SCOPY4  CALL    PRINT
          CAC6 0D               DEC     C       ;40 Spalten
          CAC7 20F2             JR      NZ,SCOPY2
          CAC9 3E0D             LD      A,CR
          CACB CD3ECA           CALL    PRINT4
          CACE 3E0A             LD      A,LF
          CAD0 CD3ECA           CALL    PRINT4
          CAD3 10E4             DJNZ    SCOPY1  ;32 Zeilen
          CAD5 F1       HCEND   POP     AF
          CAD6 C1               POP     BC
          CAD7 D1               POP     DE
          CAD8 E1               POP     HL
          CAD9 C9               RET
          CADA
          CADA          HCOPYC  ;..nach Typ verzweigen
          CADA E6F0             AND     0F0H
          CADC FE10             CP      10H
          CADE CAA9CB           JP      Z,K6314 ;ESC/P breit
          CAE1 FE20             CP      20H
          CAE3 CAE7CB           JP      Z,K6311 ;mit ANSI
          CAE6 FE30             CP      30H
          CAE8 CA16CC           JP      Z,K6312 ;ANSI breit
          CAEB FE50             CP      50H
          CAED 283B             JR      Z,HCMIN ;ESC/P2 (Mini)
          CAEF FE70             CP      70H
          CAF1 2867             JR      Z,ESCP2 ;ESC/P2 24 Nadel
          CAF3
          CAF3          ;K6313, K6304, ESC/P2 mit 8 Nadeln
          CAF3 2600     K6313   LD      H,0     ;Zeile 0
          CAF5 CDD9CC   K6313a  CALL    PRZK    ;Grafik init
          CAF8 2E00             LD      L,0     ;Spalte 0
          CAFA 0E08     K6313b  LD      C,8
          CAFC CD43CC           CALL    CBYTES
          CAFF E5               PUSH    HL
          CB00 0608     K6313c  LD      B,8
          CB02 2100B7           LD      HL,CASS
          CB05 CB16     K6313d  RL      M
          CB07 17               RLA
          CB08 23               INC     HL
          CB09 10FA             DJNZ    K6313d
          CB0B CDE9B7           CALL    OFILT
          CB0E 0D               DEC     C
          CB0F 20EF             JR      NZ,K6313c ;nÑchster
          CB11 E1               POP     HL        ;Cursor
          CB12 2C               INC     L
          CB13 3E28             LD      A,40
          CB15 BD               CP      L
          CB16 20E2             JR      NZ,K6313b
          CB18 7C               LD      A,H
          CB19 C608             ADD     8       ;nÑchste Zeile
          CB1B 67               LD      H,A
          CB1C 30D7             JR      NC,K6313a
          CB1E 3E0D     HCCRLF  LD      A,CR
          CB20 CDE9B7           CALL    OFILT
          CB23 3E0A             LD      A,LF
          CB25 CDE9B7           CALL    OFILT
          CB28 18AB             JR      HCEND
          CB2A
          CB2A          HCMIN   ;ESC/P2 Miniformat
          CB2A 210000           LD      HL,0    ;Z=0, Sp=0
          CB2D CDD9CC   MINIa   CALL    PRZK
          CB30 0E18     MINIb   LD      C,24    ;24 Pixel
          CB32 CD43CC           CALL    CBYTES
          CB35 CDBACC           CALL    S3PRS
          CB38 20F6             JR      NZ,MINIb
          CB3A 7C               LD      A,H
          CB3B C618             ADD     24
          CB3D 67               LD      H,A
          CB3E 2E00             LD      L,0     ;Sp=0
          CB40 FEF0             CP      240
          CB42 20E9             JR      NZ,MINIa
          CB44 CDD9CC           CALL    PRZK
          CB47 0E10     MINIc   LD      C,16
          CB49 CD43CC           CALL    CBYTES
          CB4C 0608             LD      B,8
          CB4E AF               XOR     A
          CB4F 12       MINId   LD      (DE),A  ;8 Nadeln frei
          CB50 13               INC     DE
          CB51 10FC             DJNZ    MINId
          CB53 CDBACC           CALL    S3PRS
          CB56 20EF             JR      NZ,MINIc
          CB58 18C4             JR      HCCRLF
          CB5A
          CB5A          ESCP2   ;ESC/P2 mit 24 Nadeln
          CB5A 2600             LD      H,0     ;Zeile 0
          CB5C CDD9CC   ESCP2a  CALL    PRZK
          CB5F 2E00             LD      L,0     ;Spalte 0
          CB61 0608     ESCP2b  LD      B,8     ;8 Pixel
          CB63 E5               PUSH    HL
          CB64 CD60E0           CALL    PADR
          CB67 1100B7           LD      DE,CASS
          CB6A 7E       ESCP2c  LD      A,M
          CB6B 12               LD      (DE),A
          CB6C 13               INC     DE
          CB6D 12               LD      (DE),A  ;3 mal ablegen
          CB6E 13               INC     DE
          CB6F 12               LD      (DE),A
          CB70 13               INC     DE
          CB71 2C               INC     L
          CB72 10F6             DJNZ    ESCP2c
          CB74 0E08             LD      C,8
          CB76 0618     ESCP2d  LD      B,24    ;3*8 Bytes
          CB78 2100B7           LD      HL,CASS
          CB7B CB16     ESCP2e  RL      M
          CB7D CB13             RL      E
          CB7F CB12             RL      D
          CB81 17               RLA
          CB82 23               INC     HL
          CB83 10F6             DJNZ    ESCP2e  ;Wandlung
          CB85 77               LD      M,A
          CB86 0603             LD      B,3     ;3 mal drucken
          CB88 7E       ESCP2f  LD      A,M
          CB89 CDE9B7           CALL    OFILT   ;1.
          CB8C 7A               LD      A,D
          CB8D CDE9B7           CALL    OFILT   ;2.
          CB90 7B               LD      A,E
          CB91 CDE9B7           CALL    OFILT   ;3. Byte
          CB94 10F2             DJNZ    ESCP2f
          CB96 0D               DEC     C
          CB97 20DD             JR      NZ,ESCP2d
          CB99 E1               POP     HL
          CB9A 2C               INC     L
          CB9B 3E28             LD      A,40    ;Zeilenende?
          CB9D BD               CP      L
          CB9E 20C1             JR      NZ,ESCP2b
          CBA0 7C               LD      A,H
          CBA1 C608             ADD     A,8
          CBA3 67               LD      H,A
          CBA4 30B6             JR      NC,ESCP2a
          CBA6 C31ECB           JP      HCCRLF
          CBA9
          CBA9          K6314   ;ESC/P 9-Nadeln (breit)
          CBA9 2600             LD      H,0
          CBAB CDD9CC   K6314a  CALL    PRZK
          CBAE 2E00             LD      L,0
          CBB0 0604     K6314b  LD      B,4
          CBB2 E5               PUSH    HL
          CBB3 CD60E0           CALL    PADR
          CBB6 1100B7           LD      DE,CASS
          CBB9 7E       K6314c  LD      A,M
          CBBA 12               LD      (DE),A
          CBBB 13               INC     DE
          CBBC 12               LD      (DE),A
          CBBD 13               INC     DE
          CBBE 2C               INC     L
          CBBF 10F8             DJNZ    K6314c  ;4*
          CBC1 0E08             LD      C,8
          CBC3 0608     K6314d  LD      B,8
          CBC5 2100B7           LD      HL,CASS
          CBC8 CB16     K6314e  RL      M
          CBCA 17               RLA
          CBCB 23               INC     HL
          CBCC 10FA             DJNZ    K6314e
          CBCE CDE9B7           CALL    OFILT
          CBD1 CDE9B7           CALL    OFILT
          CBD4 0D               DEC     C
          CBD5 20EC             JR      NZ,K6314d
          CBD7 E1               POP     HL
          CBD8 2C               INC     L
          CBD9 3E28             LD      A,40
          CBDB BD               CP      L
          CBDC 20D2             JR      NZ,K6314b
          CBDE 7C               LD      A,H
          CBDF C604             ADD     4
          CBE1 67               LD      H,A
          CBE2 30C7             JR      NC,K6314a
          CBE4 C31ECB           JP      HCCRLF
          CBE7
          CBE7          K6311   ;ANSI-Drucker
          CBE7 CDD9CC           CALL    PRZK
          CBEA 062A             LD      B,256/6
          CBEC 210000           LD      HL,0
          CBEF 0E06     K6311a  LD      C,6
          CBF1 CD43CC           CALL    CBYTES
          CBF4 CD64CC           CALL    SPRS    ;6*8-Feld ausg.
          CBF7 20F6             JR      NZ,K6311a
          CBF9 3E06             LD      A,6     ;6 Pixel tiefer
          CBFB 84               ADD     H
          CBFC 67               LD      H,A
          CBFD 2E00             LD      L,0
          CBFF CDD9CC           CALL    PRZK
          CC02 05               DEC     B
          CC03 20EA             JR      NZ,K6311a
          CC05 0E04     K6311b  LD      C,256%6 ;den Rest
          CC07 CD43CC           CALL    CBYTES
          CC0A AF               XOR     A
          CC0B 12               LD      (DE),A  ;letzte beiden
          CC0C 13               INC     DE      ;Zeilen leeren
          CC0D 12               LD      (DE),A
          CC0E CD64CC           CALL    SPRS
          CC11 20F2             JR      NZ,K6311b
          CC13 C31ECB           JP      HCCRLF
          CC16
          CC16          K6312   ;ANSI breit
          CC16 CDD9CC           CALL    PRZK
          CC19 0655             LD      B,256/3
          CC1B 210000           LD      HL,0
          CC1E 0E03     K6312a  LD      C,3
          CC20 CD52CC           CALL    CBYTS2
          CC23 CD8ECC           CALL    S2PRS
          CC26 20F6             JR      NZ,K6312a
          CC28 24               INC     H
          CC29 24               INC     H
          CC2A 24               INC     H
          CC2B 2E00             LD      L,0
          CC2D CDD9CC           CALL    PRZK
          CC30 10EC             DJNZ    K6312a
          CC32 0E04     K6312b  LD      C,256%6 ;den Rest
          CC34 CD52CC           CALL    CBYTS2
          CC37 AF               XOR     A
          CC38 12               LD      (DE),A
          CC39 13               INC     DE
          CC3A 12               LD      (DE),A
          CC3B CD8ECC           CALL    S2PRS
          CC3E 20F2             JR      NZ,K6312b
          CC40 C31ECB           JP      HCCRLF
          CC43
          CC43          CBYTES  ;C Bytes zum Puffer
          CC43 E5               PUSH    HL
          CC44 C5               PUSH    BC
          CC45 CD60E0           CALL    PADR
          CC48 1100B7           LD      DE,CASS
          CC4B 0600             LD      B,0
          CC4D EDB0             LDIR
          CC4F C1               POP     BC
          CC50 E1               POP     HL
          CC51 C9               RET
          CC52
          CC52          CBYTS2  ;C Bytes zum Puffer & doppeln
          CC52 E5               PUSH    HL
          CC53 CD60E0           CALL    PADR
          CC56 1100B7           LD      DE,CASS
          CC59 7E       C2BYTL  LD      A,M
          CC5A 12               LD      (DE),A
          CC5B 13               INC     DE
          CC5C 12               LD      (DE),A
          CC5D 13               INC     DE
          CC5E 2C               INC     L
          CC5F 0D               DEC     C
          CC60 20F7             JR      NZ,C2BYTL
          CC62 E1               POP     HL
          CC63 C9               RET
          CC64
          CC64          SPRS    ;8* 6-Nadel-Sprosse ausgeben
          CC64 E5               PUSH    HL
          CC65 C5               PUSH    BC
          CC66 2E80             LD      L,80H
          CC68 0600     SPRS1   LD      B,0
          CC6A 1100B7           LD      DE,CASS
          CC6D 1A       SPRS2   LD      A,(DE)
          CC6E A5               AND     L       ;CY=0
          CC6F 2801             JR      Z,SPRS3
          CC71 37               SCF             ;CY=1
          CC72 CB10     SPRS3   RL      B
          CC74 13               INC     DE
          CC75 3E06             LD      A,6     ;fÅr 6 Bit
          CC77 BB               CP      E
          CC78 20F3             JR      NZ,SPRS2;ob. Nadel war 0
          CC7A A7               AND     A       ;unt. Nadel = 0
          CC7B CB10             RL      B
          CC7D 78               LD      A,B
          CC7E CDE9B7           CALL    OFILT
          CC81 CB0D             RRC     L
          CC83 CB7D             BIT     7,L
          CC85 28E1             JR      Z,SPRS1
          CC87 C1               POP     BC
          CC88 E1               POP     HL
          CC89 2C               INC     L
          CC8A 3E28             LD      A,40
          CC8C BD               CP      L
          CC8D C9               RET
          CC8E
          CC8E          S2PRS   ;8* 6-Nadel-Sprosse doppelt out
          CC8E E5               PUSH    HL
          CC8F C5               PUSH    BC
          CC90 2E80             LD      L,80H
          CC92 0600     S2PR1   LD      B,0
          CC94 1100B7           LD      DE,CASS ;KassPuff
          CC97 1A       S2PR2   LD      A,(DE)
          CC98 A5               AND     L
          CC99 2801             JR      Z,S2PR3
          CC9B 37               SCF
          CC9C CB10     S2PR3   RL      B
          CC9E 13               INC     DE
          CC9F 3E06             LD      A,6
          CCA1 BB               CP      E
          CCA2 20F3             JR      NZ,S2PR2
          CCA4 78               LD      A,B
          CCA5 17               RLA             ;untere beiden
          CCA6 17               RLA             ;Nadeln tot
          CCA7 CDE9B7           CALL    OFILT
          CCAA CDE9B7           CALL    OFILT
          CCAD CB0D             RRC     L
          CCAF CB7D             BIT     7,L
          CCB1 28DF             JR      Z,S2PR1
          CCB3 C1               POP     BC
          CCB4 E1               POP     HL
          CCB5 2C               INC     L
          CCB6 3E28             LD      A,40
          CCB8 BD               CP      L
          CCB9 C9               RET
          CCBA
          CCBA          S3PRS   ;8* 24-Nadel-Sprosse ausgeben
          CCBA E5               PUSH    HL
          CCBB 1E08             LD      E,8
          CCBD 0E03     S3PR1   LD      C,3     ;3 Byte
          CCBF 2100B7           LD      HL,CASS
          CCC2 0608     S3PR2   LD      B,8
          CCC4 CB16     S3PR3   RL      M
          CCC6 17               RLA
          CCC7 23               INC     HL
          CCC8 10FA             DJNZ    S3PR3   ;Wandlung
          CCCA CDE9B7           CALL    OFILT
          CCCD 0D               DEC     C
          CCCE 20F2             JR      NZ,S3PR2
          CCD0 1D               DEC     E
          CCD1 20EA             JR      NZ,S3PR1
          CCD3 E1               POP     HL
          CCD4 2C               INC     L
          CCD5 3E28             LD      A,40
          CCD7 BD               CP      L
          CCD8 C9               RET
          CCD9
          CCD9          PRZK    ;Druckerinit entsprechend HCPZ
          CCD9 E5               PUSH    HL
          CCDA C5               PUSH    BC
          CCDB AF               XOR     A
          CCDC 21E1B7           LD      HL,HCPZ
          CCDF ED6F             RLD
          CCE1 4F               LD      C,A     ;Druckertyp
          CCE2 ED67             RRD
          CCE4 0C               INC     C
          CCE5 21FFCC           LD      HL,C6313
          CCE8 46       PRZK1   LD      B,M     ;LÑnge
          CCE9 0D               DEC     C
          CCEA 2809             JR      Z,PRZK2
          CCEC 04               INC     B
          CCED 7D               LD      A,L
          CCEE 80               ADD     B
          CCEF 6F               LD      L,A
          CCF0 30F6             JR      NC,PRZK1
          CCF2 24               INC     H
          CCF3 18F3             JR      PRZK1
          CCF5 23       PRZK2   INC     HL
          CCF6 7E               LD      A,M
          CCF7 CDE9B7           CALL    OFILT
          CCFA 10F9             DJNZ    PRZK2
          CCFC C1               POP     BC
          CCFD E1               POP     HL
          CCFE C9               RET
          CCFF
          CCFF          ;Grafiksteuersequenzen fÅr die Drucker
          CCFF          ;
          CCFF 0A       C6313   DB      10      ;LÑnge
          CD00 0D09             DB      CR,9
          CD02 1B4A18           DB      ESC,'J',24
          CD05 1B2A05           DB      ESC,'*',5
          CD08 4001             DW      320
          CD0A
          CD0A 0A       C6314   DB      10
          CD0B 0D09             DB      CR,9
          CD0D 1B4A18           DB      ESC,'J',24
          CD10 1B2A05           DB      ESC,'*',5
          CD13 8002             DW      640
          CD15
          CD15 0E       C6311   DB      14
          CD16 1B5B3031         DB      ESC,'é01e'
          CD1B 1B5B3132         DB      ESC,'é12`'
          CD20 1B4B             DB      ESC,'K'
          CD22 4001             DW      320
          CD24
          CD24 0E       C6312   DB      14
          CD25 1B5B3031         DB      ESC,'é01e'
          CD2A 1B5B3132         DB      ESC,'é12`'
          CD2F 1B4B             DB      ESC,'K'
          CD31 8002             DW      640
          CD33
          CD33 09       C6304   DB      9
          CD34 0D09             DB      CR,9
          CD36 1B4A18           DB      ESC,'J',24
          CD39 1B4B             DB      ESC,'K'
          CD3B 4001             DW      320
          CD3D
          CD3D 0A       CMINI   DB      10
          CD3E 0D09             DB      CR,9
          CD40 1B4A18           DB      ESC,'J',24
          CD43 1B2A27           DB      ESC,'*',39
          CD46 4001             DW      320
          CD48
          CD48 0A       C24N1   DB      10
          CD49 0D09             DB      CR,9
          CD4B 1B4A18           DB      ESC,'J',24
          CD4E 1B2A00           DB      ESC,'*',0
          CD51 4001             DW      320
          CD53
          CD53 0A       C24N2   DB      10
          CD54 0D09             DB      CR,9
          CD56 1B4A18           DB      ESC,'J',24
          CD59 1B2A27           DB      ESC,'*',39
          CD5C C003             DW      960
          CD5E
          CD5E          V24DC   ;Duplex-Init
          CD5E                  ;PE: Argumente
          CD5E 3A81B7           LD      A,(ARGN)
          CD61 FE03             CP      3
          CD63 3829             JR      C,V24DC2;<3 Argumente
          CD65 2182B7           LD      HL,ARG1
          CD68 46               LD      B,M     ;ab Platz B
          CD69 CDEEC9           CALL    V24SU   ;M003 suchen
          CD6C DA76F4           JP      C,ERRM
          CD6F 23               INC     HL
          CD70 23               INC     HL
          CD71 3AE8B7           LD      A,(HCPZ2)
          CD74 CB46             BIT     0,M     ;SIO A oder B?
          CD76 CB97             RES     2,A
          CD78 2002             JR      NZ,V24DC1
          CD7A CBD7             SET     2,A
          CD7C 47       V24DC1  LD      B,A
          CD7D 23               INC     HL
          CD7E 23               INC     HL
          CD7F 7E               LD      A,M
          CD80 D602             SUB     2       ;USER1 oder 2?
          CD82 CB88             RES     1,B
          CD84 2802             JR      Z,V24DC6
          CD86 CBC8             SET     1,B
          CD88 78       V24DC6  LD      A,B
          CD89 32E8B7   V24DCF  LD      (HCPZ2),A
          CD8C 1808             JR      V24DC3
          CD8E
          CD8E 0607     V24DC2  LD      B,7     ;ab Platz 7
          CD90 CDEEC9           CALL    V24SU
          CD93 DA76F4           JP      C,ERRM
          CD96 1114FA   V24DC3  LD      DE,V24OT
          CD99 0134FA           LD      BC,V24IN
          CD9C 3AE8B7           LD      A,(HCPZ2)
          CD9F CB4F             BIT     1,A     ;USER-Kanal ?
          CDA1 200A             JR      NZ,V24DC4
          CDA3 ED53BEB7         LD      (UOUT1+1),DE
          CDA7 ED43C1B7         LD      (UIN1+1),BC
          CDAB 1808             JR      V24DC5
          CDAD                  ;
          CDAD ED53C4B7 V24DC4  LD      (UOUT2+1),DE
          CDB1 ED43C7B7         LD      (UIN2+1),BC
          CDB5 CD7BFA   V24DC5  CALL    LCSOD   ;Kanal-Offset
          CDB8 3E0C             LD      A,0CH   ;CTC
          CDBA C5               PUSH    BC
          CDBB 81               ADD     C
          CDBC 0602             LD      B,2     ;2 Initbytes
          CDBE 4F               LD      C,A
          CDBF 2AE5B7           LD      HL,(INTV2)
          CDC2 F3               DI
          CDC3 EDB3             OTIR            ;CTC init.
          CDC5 C1               POP     BC
          CDC6 3AE7B7           LD      A,(INTV2L)
          CDC9 3D               DEC     A
          CDCA 3D               DEC     A
          CDCB 47               LD      B,A
          CDCC 3E0A             LD      A,0AH   ;SIO
          CDCE 81               ADD     C
          CDCF 4F               LD      C,A
          CDD0 EDB3             OTIR            ;SIO init.
          CDD2 FB               EI
          CDD3 C9               RET
          CDD4
          CDD4          UMINIT  ;SIO B auf Interruptbetrieb
          CDD4 2114FA           LD      HL,V24OT
          CDD7 22C4B7           LD      (UOUT2+1),HL
          CDDA 210ACE           LD      HL,V24UMT
          CDDD C31DF5           JP      INIMEX
          CDE0
          CDE0          V24INI  ;-Tabellen in IRM kopieren
          CDE0                  ;-M003 suchen und einschalten
          CDE0                  ;-M003-Steckplatz merken
          CDE0 21F8CD           LD      HL,V24TAB-1
          CDE3 1100A8           LD      DE,V24PL;A800H
          CDE6 011200           LD      BC,18
          CDE9 EDB0             LDIR
          CDEB 0607             LD      B,7     ;ab Platz 7
          CDED CDEEC9           CALL    V24SU   ;suchen
          CDF0 D8               RET     C
          CDF1 78               LD      A,B     ;Platz merken
          CDF2 3200A8           LD      (V24PL),A
          CDF5 3E01             LD      A,1
          CDF7 C9               RET
          CDF8
          CDF8 00               DB      0       ;Steckplatz M003
          CDF9 47       V24TAB  DB      47H
          CDFA 5B               DB      5BH     ;Kanal 1
          CDFB 0404             DB      4,4     ;9600 Baud
          CDFD 0320             DB      3,20H
          CDFF 056A             DB      5,6AH
          CE01
          CE01 47               DB      47H     ;Kanal 2
          CE02 2E               DB      2EH     ;1200 Baud
          CE03 18               DB      18H
          CE04 0444             DB      4,44H   ;WR4
          CE06 03E1             DB      3,0E1H  ;WR3
          CE08 056A             DB      5,6AH   ;WR5 DTR off
          CE0A
          CE0A          V24UMT  ;V24-Init fÅr Interrupt SIO-B
          CE0A 02               DB      2
          CE0B 0D               DB      0DH     ;CTC-1
          CE0C 02                DB     2
          CE0D 47                 DB    47H     ;fÅr Interrupt
          CE0E 2E                 DB    2EH     ;2EH = 1200Bd
          CE0F                                  ;17H = 2400Bd
          CE0F
          CE0F 0B       DTRON   DB      0BH     ;SIO-B Steuerw.
          CE10 0B                DB     11
          CE11 18                 DB    18H     ;Port RESET
          CE12 02E2               DB    2,0E2H  ;WR2 INT-Vektor
          CE14 1444               DB    14H,44H ;WR4
          CE16 03E1               DB    3,0E1H  ;WR3
          CE18 05EA               DB    5,0EAH  ;WR5 DTR on
          CE1A 1118               DB    11H,18H ;WR1
          CE1C
          CE1C          MBOC    ;Byteweise MB-Ausgabe
          CE1C 5A               LD      E,D     ;Steuerbyte
          CE1D 57               LD      D,A     ;Datenbyte
          CE1E D5               PUSH    DE
          CE1F C5               PUSH    BC
          CE20 CB5B             BIT     3,E
          CE22 2829             JR      Z,NOINIT
          CE24 DDCB07CE         SET     1,(IX+7);merken INIT
          CE28 3ED5             LD      A,'U'+80H
          CE2A BE               CP      M
          CE2B D5               PUSH    DE
          CE2C 11A000           LD      DE,0A0H ;VortonlÑnge
          CE2F 2003             JR      NZ,NOHIU;bei 'U'
          CE31 110005           LD      DE,500H ;gedehnt
          CE34 ED53D8B7 NOHIU   LD      (VORTN),DE
          CE38 1100B7           LD      DE,CASS
          CE3B 010B00           LD      BC,11
          CE3E EDB0             LDIR            ;Name
          CE40 EB               EX      DE,HL
          CE41 D1               POP     DE
          CE42 72               LD      M,D     ;1.Byte
          CE43 2C               INC     L
          CE44 7D       MBOC1   LD      A,L
          CE45 32DAB7           LD      (DTPTR),A
          CE48 C1       MBOCE   POP     BC
          CE49 D1               POP     DE
          CE4A CB9B             RES     3,E
          CE4C C9               RET
          CE4D
          CE4D 2ADAB7   NOINIT  LD      HL,(DTPTR)
          CE50 26B7             LD      H,0B7H
          CE52 72               LD      M,D     ;Byte eintragen
          CE53 CB73             BIT     6,E
          CE55 201F             JR      NZ,MCLOS;Close
          CE57 2C               INC     L
          CE58 CB7D             BIT     7,L
          CE5A 28E8             JR      Z,MBOC1
          CE5C DDCB074E         BIT     1,(IX+7)
          CE60 2008             JR      NZ,MBOC2;erst mal Init!
          CE62 CD6ACF           CALL    MBLO    ;Blockout
          CE65 2100B7   MBOC6   LD      HL,CASS
          CE68 18DA             JR      MBOC1
          CE6A
          CE6A DDCB078E MBOC2   RES     1,(IX+7);rÅcksetzen
          CE6E CD28E5           CALL    ISRO    ;Init
          CE71 CD71CF           CALL    MBLNR   ;Blocknr.
          CE74 18EF             JR      MBOC6
          CE76
          CE76 DDCB074E MCLOS   BIT     1,(IX+7);Init?
          CE7A 2805             JR      Z,MBOC3
          CE7C CD28E5           CALL    ISRO    ;erst noch Init!
          CE7F 1803             JR      MBOC4
          CE81 CD6ACF   MBOC3   CALL    MBLO    ;Blockout
          CE84 ED4BD8B7 MBOC4   LD      BC,(VORTN)
          CE88 CDDBE4           CALL    CSRO
          CE8B D5       MBOC5   PUSH    DE
          CE8C CDEBF6           CALL    CSRI
          CE8F DDCB07AE         RES     5,(IX+7);'U'-Merker
          CE93 D1               POP     DE      ;rÅcksetzen
          CE94 18B2             JR      MBOCE
          CE96
          CE96          MBIC    ;Byteweise MB-Eingabe
          CE96 5A               LD      E,D     ;Steuerbyte
          CE97 57               LD      D,A     ;Datenbyte (PA!)
          CE98 D5               PUSH    DE
          CE99 C5               PUSH    BC
          CE9A CB73             BIT     6,E     ;Close?
          CE9C 20ED             JR      NZ,MBOC5
          CE9E CB5B             BIT     3,E     ;Init?
          CEA0 2866             JR      Z,MBIU
          CEA2 3E01             LD      A,1     ;erwarteter Blk
          CEA4 DD7703           LD      (IX+3),A
          CEA7 E5               PUSH    HL
          CEA8 CD9AE5           CALL    ISRI
          CEAB E1       MBIC1   POP     HL
          CEAC DA5ACF           JP      C,JBLERR;Fehler: '*'
          CEAF DD7E02           LD      A,(IX+2);gelesener Blk.
          CEB2 FE01             CP      1
          CEB4 C25ACF           JP      NZ,JBLERR ;Fehler: '*'
          CEB7 DDCB07BE         RES     7,(IX+7);Kopfblk geladen
          CEBB DD3403           INC     (IX+3)  ;erw. Block
          CEBE 1100B7           LD      DE,CASS
          CEC1 060B             LD      B,11
          CEC3 1A               LD      A,(DE)
          CEC4 FED5             CP      'U'+80H ;hohes 'U'?
          CEC6 2004             JR      NZ,MBIC2
          CEC8 DDCB07EE         SET     5,(IX+7);merken zur
          CECC           ;BlocknummernausgabeunterdrÅckung
          CECC C629     MBIC2   ADD     29H     ;GeschÅtzte
          CECE 3012             JR      NC,MBIC3;BASIC-
          CED0 1A               LD      A,(DE)  ;Programme
          CED1 D604             SUB     4       ;als un-
          CED3 12               LD      (DE),A  ;geschÅtzt
          CED4 13               INC     DE      ;anzeigen
          CED5 12               LD      (DE),A  ;und Setzen
          CED6 13               INC     DE      ;LIST/EDIT/BYE-
          CED7 12               LD      (DE),A  ;Schutz
          CED8 325E03           LD      (35EH),A;<=hier
          CEDB DDCB07F6         SET     6,(IX+7);merken wofÅr?
          CEDF 1100B7           LD      DE,CASS
          CEE2 1A       MBIC3   LD      A,(DE)  ;Name
          CEE3 CDF7E3           CALL    CRT     ;anzeigen
          CEE6 BE               CP      M       ;stimmt Name?
          CEE7 2804             JR      Z,MBIC4
          CEE9 DDCB07FE         SET     7,(IX+7);nein-merken
          CEED 23       MBIC4   INC     HL
          CEEE 13               INC     DE
          CEEF 10F1             DJNZ    MBIC3
          CEF1 CD80F4           CALL    CRLF
          CEF4 DDCB077E         BIT     7,(IX+7)
          CEF8 C203F8           JP      NZ,JIOERR ;zu ?IO ERROR
          CEFB EB               EX      DE,HL
          CEFC 56       MBIC5   LD      D,M     ;Daten lesen
          CEFD 2C               INC     L
          CEFE 7D               LD      A,L
          CEFF 32DAB7           LD      (DTPTR),A
          CF02 7A               LD      A,D
          CF03 C1               POP     BC
          CF04 D1               POP     DE
          CF05 CB9B             RES     3,E
          CF07 C9               RET
          CF08
          CF08 2ADAB7   MBIU    LD      HL,(DTPTR)
          CF0B 26B7             LD      H,0B7H
          CF0D CB7D             BIT     7,L
          CF0F 28EB             JR      Z,MBIC5 ;aus Puffer
          CF11 CD9DE5   MBIU1   CALL    MBI
          CF14 3833             JR      C,MERR
          CF16 3EFF             LD      A,0FFH
          CF18 DDBE02           CP      (IX+2)  ;Block FF?
          CF1B 2817             JR      Z,MBIU3
          CF1D DD7E03           LD      A,(IX+3)
          CF20 DDBE02           CP      (IX+2)  ;erwarteter?
          CF23 280F             JR      Z,MBIU3
          CF25 3E2A             LD      A,'*'
          CF27 CDF7E3           CALL    CRT     ;nicht
          CF2A CD4BF3           CALL    BNROST  ;erwartet
          CF2D 1900             DB      19H,0
          CF2F CD77CF   MBIU2   CALL    JBRKT
          CF32 18DD             JR      MBIU1
          CF34
          CF34 DD3403   MBIU3   INC     (IX+3)  ;nÑchsten
          CF37 3D               DEC     A       ;erwarten
          CF38 DDCB076E         BIT     5,(IX+7)
          CF3C 2006             JR      NZ,MBIU4
          CF3E CD4BF3           CALL    BNROST  ;Blocknummer
          CF41 3E               DB      '>'     ;unter Vorbe-
          CF42 1900             DB      19H,0   ;halt ausgeben
          CF44 2100B7   MBIU4   LD      HL,CASS
          CF47 18B3             JR      MBIC5
          CF49
          CF49 CD51F3   MERR    CALL    OSTR    ;Fehler im
          CF4C 09090909         DB      9,9,9,9 ;Block
          CF50 3F00             DB      '?',0
          CF52 CD4BF3           CALL    BNROST
          CF55 0D0A00           DB      CR,LF,0
          CF58 18D5             JR      MBIU2
          CF5A
          CF5A CD51F3   JBLERR  CALL    OSTR    ;nicht erwarte-
          CF5D 2A0800           DB      '*',8,0 ;ter 1. Block
          CF60 CD77CF           CALL    JBRKT
          CF63 CD9DE5           CALL    MBI
          CF66 E5               PUSH    HL
          CF67 C3ABCE           JP      MBIC1
          CF6A
          CF6A ED4BD8B7 MBLO    LD      BC,(VORTN)
          CF6E CD37E5           CALL    MBO
          CF71 CD4BF3   MBLNR   CALL    BNROST
          CF74 3E1900           DB      '>',19H,0
          CF77 CDACE4   JBRKT   CALL    BRKT    ;bei BRK
          CF7A D0               RET     NC      ;auch ?IO ERROR
          CF7B C303F8           JP      JIOERR
          CF7E
          CF7E 7F7F     VIEW7F  DW      7F7FH
          CF80 76696577         DB      'view'
          CF84 03               DB      3
          CF85 7D               LD      A,L
          CF86 FE10             CP      10H
          CF88 300C             JR      NC,VIEW1;L>0Fh
          CF8A 7C               LD      A,H
          CF8B A7               AND     A
          CF8C 2008             JR      NZ,VIEW1;H>0
          CF8E 2182B7           LD      HL,ARG1
          CF91 ED6F             RLD
          CF93 66               LD      H,M
          CF94 2E00             LD      L,0
          CF96 110088   VIEW1   LD      DE,8800H
          CF99 010020           LD      BC,2000H
          CF9C CD35F7   VIEW2   CALL    LDAME   ;Byte holen
          CF9F 12               LD      (DE),A  ;in IRM poken
          CFA0 23               INC     HL
          CFA1 13               INC     DE
          CFA2 0D               DEC     C
          CFA3 20F7             JR      NZ,VIEW2
          CFA5 10F5             DJNZ    VIEW2
          CFA7 3E0B     VIEW3   LD      A,0BH   ;Zeile hoch
          CFA9 CDF7E3           CALL    CRT
          CFAC 3E08             LD      A,8
          CFAE 32A0B7           LD      (CURSO),A
          CFB1 CDB4CF           CALL    VIEW4
          CFB4 3E01     VIEW4   LD      A,1
          CFB6 4F       VIEW5   LD      C,A
          CFB7 CD8BF4           CALL    AHEX    ;HEX-Leiste
          CFBA 79               LD      A,C
          CFBB C622             ADD     22H
          CFBD 30F7             JR      NC,VIEW5
          CFBF C9               RET
          CFC0
          CFC0          ;Druckereinstellungen
          CFC0
          CFC0 7F7F     PRI7F   DW      7F7FH
          CFC2 5052494E         DB      'PRINT',1FH
          CFC8 1A       PRI     LD      A,(DE)
          CFC9 A7               AND     A
          CFCA C8               RET     Z       ;fertig
          CFCB FE20             CP      ' '
          CFCD 2814             JR      Z,PRINC
          CFCF FE2C             CP      ','
          CFD1 2813             JR      Z,PRK   ;Zeichen
          CFD3 FE27             CP      27H
          CFD5 2813             JR      Z,PRSTR ;String
          CFD7 CDA7F4           CALL    RHEX
          CFDA DA76F4           JP      C,ERRM  ;Fehler!
          CFDD 3A97B7           LD      A,(NUMVX)
          CFE0 CDE9B7   PRIC    CALL    OFILT
          CFE3 13       PRINC   INC     DE
          CFE4 18E2             JR      PRI
          CFE6 13       PRK     INC     DE
          CFE7 1A               LD      A,(DE)  ;Zeichen
          CFE8 18F6             JR      PRIC
          CFEA 13       PRSTR   INC     DE
          CFEB 1A               LD      A,(DE)
          CFEC A7               AND     A
          CFED C8               RET     Z       ;Ende-0
          CFEE FE27             CP      27H
          CFF0 28F1             JR      Z,PRINC ;Stringende
          CFF2 CDE9B7           CALL    OFILT
          CFF5 18F3             JR      PRSTR
          CFF7
          CFF7          FREIC   ;Rest frei
          CFF7
          CFF7                  END

        Errors: 0000
        End+1 : CFF7

          0200
          0200          ;**     CAOS 4.4 ROM D          **
          0200          ;       (09.02.2003)
          0200
          0200                  ORG     0D000H
          D000
          D000          JDISC   ;MC-Sprungverteiler
          D000                  ;(fÅr die 9 Grundfunktionen)
          D000                  ;
          D000 FE09             CP      9       ;Funktion 0-8
          D002 D0               RET     NC      ;zugelassen
          D003 F5               PUSH    AF
          D004 210000           LD      HL,0
          D007 CD80D0           CALL    NAM2    ;Name ausgeben
          D00A 2156D0           LD      HL,DTAB
          D00D F1               POP     AF
          D00E 87               ADD     A
          D00F 1600             LD      D,0
          D011 5F               LD      E,A
          D012 19               ADD     HL,DE
          D013 5E               LD      E,M     ;Tab. lesen
          D014 23               INC     HL
          D015 56               LD      D,M
          D016 D5               PUSH    DE      ;Sprungadresse
          D017
          D017          DISK    ;testet ob Floppy arbeitet
          D017 0180FC           LD      BC,0FC80H
          D01A ED78             IN      A,(C)
          D01C FEA7             CP      0A7H    ;Floppy?
          D01E 2813             JR      Z,DISK1
          D020 CD51F3           CALL    OSTR
          D023 6B65696E         DB      'kein D004!'
          D02D 070D0A00         DB      7,CR,LF,0
          D031 E1               POP     HL
          D032 C9               RET
          D033 01F3B3   DISK1   LD      BC,0B3F3H
          D036 ED78             IN      A,(C)
          D038 FE05             CP      5       ;KC-BA?
          D03A C8               RET     Z
          D03B CD51F3           CALL    OSTR
          D03E 43414F53         DB      'CAOS-Disk starten!'
          D050 070D0A00         DB      7,CR,LF,0
          D054 E1               POP     HL
          D055 C9               RET
          D056          ;
          D056          DTAB    ;Sprungtabelle Diskroutinen
          D056 DDD1             DW      FLOAD
          D058 9BD2             DW      FSAVE
          D05A FAD2             DW      DIR
          D05C 6ED3             DW      STAT
          D05E BDD3             DW      REN
          D060 0FD4             DW      SETRO
          D062 26D4             DW      SETWR
          D064 F8D3             DW      ERA
          D066 3AD4             DW      DRIVE
          D068          ;
          D068          NAME    ;Name ein-, ausgeben
          D068 EB               EX      DE,HL
          D069 7E               LD      A,M
          D06A E6DF             AND     0DFH
          D06C 2012             JR      NZ,NAM2 ;mit arg!
          D06E 210600   NAM0    LD      HL,6
          D071 CD51F3   NAM1    CALL    OSTR
          D074 4E616D65         DB      'Name :',0
          D07B CD3CF4           CALL    INLIN
          D07E D8               RET     C       ;BRK
          D07F 19               ADD     HL,DE
          D080 1E0C     NAM2    LD      E,12
          D082 01F382           LD      BC,82F3H
          D085 7E       NAM3    LD      A,M
          D086 ED79             OUT     (C),A
          D088 23               INC     HL
          D089 04               INC     B
          D08A 1D               DEC     E
          D08B 20F8             JR      NZ,NAM3
          D08D 0680             LD      B,80H
          D08F C9               RET
          D090          ;
          D090          STEUER2 ;Steuerbyte 2 ausgeben
          D090 01F180           LD      BC,80F1H
          D093 1803             JR      STEU0
          D095                  ;
          D095          STEUER  ;Steuerbyte 1 ausgeben
          D095 01F380           LD      BC,80F3H
          D098 ED79     STEU0   OUT     (C),A
          D09A C5       STEU1   PUSH    BC
          D09B 3E01             LD      A,1
          D09D CD3DF3           CALL    WAIT
          D0A0 C1               POP     BC
          D0A1 ED78             IN      A,(C)
          D0A3 CB47             BIT     0,A
          D0A5 20F3             JR      NZ,STEU1;fertig?
          D0A7 CB7F             BIT     7,A
          D0A9 C8               RET     Z       ;kein Fehler
          D0AA C1               POP     BC      ;RET-Adresse!
          D0AB 01F183   FLERR   LD      BC,83F1H
          D0AE ED78             IN      A,(C)
          D0B0 FE20             CP      20H     ;DEP ab 2.0?
          D0B2 300B             JR      NC,FLER1;ja
          D0B4 01F381           LD      BC,81F3H
          D0B7 ED78             IN      A,(C)   ;Fehlernummer
          D0B9 CD8BF4           CALL    AHEX
          D0BC C376F4           JP      ERRM
          D0BF                  ;
          D0BF 01F100   FLER1   LD      BC,0F1H ;Fehlertext
          D0C2 ED78     FLER2   IN      A,(C)
          D0C4 04               INC     B
          D0C5 A7               AND     A
          D0C6 C8               RET     Z       ;00=Ende
          D0C7 CD80F3           CALL    OCHR
          D0CA 18F6             JR      FLER2
          D0CC          ;
          D0CC          ;BASEX-Programmteil mit Fehlertexten
          D0CC          ;
          D0CC 219ED1   BASEX   LD      HL,BAS
          D0CF 11D800           LD      DE,0D8H
          D0D2 013000           LD      BC,BASE-BAS
          D0D5 EDB0             LDIR            ;Verteiler
          D0D7 2176D1           LD      HL,UMS
          D0DA 115001           LD      DE,150H
          D0DD 012800           LD      BC,UMSE-UMS
          D0E0 EDB0             LDIR            ;Umschaltung
          D0E2 210CD1           LD      HL,BASEC
          D0E5 110002           LD      DE,200H
          D0E8 016A00           LD      BC,UMS-BASEC
          D0EB EDB0             LDIR            ;BASEX selbst
          D0ED 2AB0B7           LD      HL,(SUTAB)
          D0F0 220102           LD      (SUSP),HL
          D0F3 116A02           LD      DE,SUBAS
          D0F6 ED53B0B7         LD      (SUTAB),DE
          D0FA 019200           LD      BC,92H
          D0FD EDB0             LDIR            ;SUTAB
          D0FF 215202           LD      HL,MBIND
          D102 22D802           LD      (SUBAS+6EH),HL
          D105 210302           LD      HL,MBOUTD
          D108 22DA02           LD      (SUBAS+70H),HL
          D10B C9               RET
          D10C
          D10C          BASEC   EQU     $       ;Adresse im ROMC
          D10C          RUN     EQU     $-BASEC+200H
          D10C 00               DB      0       ;1 ->RUN-Switch
          D10D          SUSP    EQU     $-BASEC+200H
          D10D 0000             DW      0       ;Speicher SUTAB
          D10F
          D10F          MBOUTD  EQU     $-BASEC+200H
          D10F 01F38E           LD      BC,8EF3H
          D112 ED79             OUT     (C),A   ;Datenbyte
          D114 7A               LD      A,D
          D115 E648             AND     48H
          D117 F637             OR      37H
          D119 CD6501           CALL    NAMBAS
          D11C CB77             BIT     6,A     ;close?
          D11E 280A             JR      Z,O1
          D120 57               LD      D,A
          D121 3A0002           LD      A,(RUN)
          D124 A7               AND     A
          D125 7A               LD      A,D
          D126 2802             JR      Z,O1
          D128 CBFF             SET     7,A     ;run-switch
          D12A ED79     O1      OUT     (C),A   ;Steuerbyte
          D12C ED78     O2      IN      A,(C)
          D12E CB47             BIT     0,A     ;fertig?
          D130 20FA             JR      NZ,O2
          D132 07               RLCA
          D133 DDCB08C6         SET     0,(IX+8);Taste gedrÅckt
          D137 D0               RET     NC
          D138 01F183   BASERR  LD      BC,83F1H
          D13B ED78             IN      A,(C)
          D13D FE20             CP      20H     ;DEP ab 2.0?
          D13F 3010             JR      NC,BERR2;ja
          D141 01F381           LD      BC,81F3H
          D144 ED78             IN      A,(C)
          D146 CD03F0           CALL    0F003H
          D149 1C               DB      1CH     ;Fehler-Nr.
          D14A 2AC9B7   BERR1   LD      HL,(IOERR)
          D14D E5               PUSH    HL
          D14E C31BF0           JP      0F01BH
          D151 0600     BERR2   LD      B,0     ;Fehlertext
          D153 ED78     BERR3   IN      A,(C)
          D155 28F3             JR      Z,BERR1 ;00-Ende
          D157 04               INC     B
          D158 CD03F0           CALL    0F003H
          D15B 24               DB      24H     ;OCHR
          D15C 18F5             JR      BERR3
          D15E
          D15E          MBIND   EQU     $-BASEC+200H
          D15E 7A               LD      A,D
          D15F E648             AND     48H
          D161 F635             OR      35H
          D163 CD6501           CALL    NAMBAS
          D166 ED79             OUT     (C),A   ;Steuerbyte
          D168 ED78     I1      IN      A,(C)
          D16A CB47             BIT     0,A     ;fertig?
          D16C 20FA             JR      NZ,I1
          D16E 07               RLCA
          D16F 38C7             JR      C,BASERR;Fehler
          D171 068E             LD      B,8EH
          D173 ED78             IN      A,(C)   ;Datenbyte
          D175 C9               RET
          D176
          D176          SUBAS   EQU     $-BASEC+200H
          D176                  ;hier wird die SUTAB hin kopiert
          D176
          D176          UMS     ;Umschaltung Tape/Disk
          D176 CD18F0           CALL    0F018H
          D179 2A0102           LD      HL,(SUSP)
          D17C ED5BB0B7         LD      DE,(SUTAB)
          D180 22B0B7           LD      (SUTAB),HL
          D183 ED530102         LD      (SUSP),DE
          D187 CD1BF0           CALL    0F01BH
          D18A C9               RET
          D18B
          D18B          ;Dateiname (in BASEX) ausgeben:
          D18B
          D18B          NAMBAS  EQU     $-UMS+150H
          D18B 01F383           LD      BC,83F3H
          D18E CB5F             BIT     3,A     ;open?
          D190 2809             JR      Z,NAMB2
          D192 1E0B             LD      E,11    ;Anzahl
          D194 EDA3     NAMB1   OUTI
          D196 04               INC     B
          D197 04               INC     B
          D198 1D               DEC     E
          D199 20F9             JR      NZ,NAMB1
          D19B 0680     NAMB2   LD      B,80H   ;BC fÅr Steuer-
          D19D C9               RET             ;byte
          D19E          UMSE    ;Ende der Umschaltroutine
          D19E
          D19E          BAS     ;BASIC-Schnittstelle
          D19E                  ;(vorbereitet fÅr 12 Funktionen)
          D19E 3E00             LD      A,0     ;CALL*D8
          D1A0 01               DB      1
          D1A1 3E01             LD      A,1     ;CALL*DB
          D1A3 01               DB      1
          D1A4 3E02             LD      A,2     ;CALL*DE
          D1A6 01               DB      1
          D1A7 3E03             LD      A,3     ;CALL*E1
          D1A9 01               DB      1
          D1AA 3E04             LD      A,4     ;CALL*E4
          D1AC 01               DB      1
          D1AD 3E05             LD      A,5     ;CALL*E7
          D1AF 01               DB      1
          D1B0 3E06             LD      A,6     ;CALL*EA
          D1B2 01               DB      1
          D1B3 3E07             LD      A,7     ;CALL*ED
          D1B5 01               DB      1
          D1B6 3E08             LD      A,8     ;CALL*F0
          D1B8 01               DB      1
          D1B9 3E09             LD      A,9     ;CALL*F3
          D1BB 01               DB      1
          D1BC 3E0A             LD      A,10    ;CALL*F6
          D1BE 01               DB      1
          D1BF 3E0B             LD      A,11    ;CALL*F9
          D1C1 01               DB      1
          D1C2 3E0C             LD      A,12    ;CALL*FC
          D1C4 CD18F0           CALL    0F018H
          D1C7 CD21F0           CALL    JDISK   ;Disk-Verteiler
          D1CA CD1BF0           CALL    0F01BH
          D1CD C9               RET
          D1CE          BASE    ;Ende BASIC-Verteiler
          D1CE
          D1CE 7F7F     FLOA7F  DW      7F7FH
          D1D0 464C4F41         DB      'FLOAD'
          D1D5 01               DB      1
          D1D6 CD17D0           CALL    DISK
          D1D9 CD6ED0           CALL    NAM0
          D1DC D8               RET     C       ;BRK
          D1DD 3A81B7   FLOAD   LD      A,(ARGN)
          D1E0 FE02             CP      2
          D1E2 3E00             LD      A,0
          D1E4 3802             JR      C,FLO0
          D1E6 CBCF             SET     1,A     ;kein Autostart
          D1E8 DD7707   FLO0    LD      (IX+7),A
          D1EB 3E09             LD      A,9     ;Lesen open
          D1ED CD95D0           CALL    STEUER
          D1F0 01F290           LD      BC,90F2H
          D1F3 ED78             IN      A,(C)   ;Anzahl
          D1F5 CB27             SLA     A
          D1F7 CB27             SLA     A
          D1F9 E61C             AND     1CH
          D1FB DDB607           OR      (IX+7)
          D1FE DD7707           LD      (IX+7),A
          D201 ED78             IN      A,(C)   ;Anzahl
          D203 FE02             CP      2
          D205 3804             JR      C,FLO1  ;wenn<2
          D207 FE0A             CP      10
          D209 3817             JR      C,FLO2  ;wenn>10
          D20B CD51F3   FLO1    CALL    OSTR
          D20E 6B65696E         DB      'keine MC-Datei!'
          D21D 070D0A00         DB      7,CR,LF,0
          D221 C9               RET
          D222 04       FLO2    INC     B
          D223 ED68             IN      L,(C)
          D225 04               INC     B
          D226 ED60             IN      H,(C)   ;HL=Ladeadr
          D228 04               INC     B
          D229 ED58             IN      E,(C)
          D22B 04               INC     B
          D22C ED50             IN      D,(C)   ;DE=Endadr
          D22E FE03             CP      3
          D230 3808             JR      C,FLO3  ;keine Startadr
          D232 E5               PUSH    HL
          D233 04               INC     B
          D234 ED68             IN      L,(C)
          D236 04               INC     B
          D237 ED60             IN      H,(C)   ;Startadr
          D239 E3               EX      (SP),HL
          D23A 08       FLO3    EX      AF,AF'
          D23B 3A81B7           LD      A,(ARGN)
          D23E A7               AND     A
          D23F 280F             JR      Z,FLO5  ;ohne Offset
          D241 ED4B82B7         LD      BC,(ARG1);Offset
          D245 09               ADD     HL,BC
          D246 EB               EX      DE,HL
          D247 09               ADD     HL,BC
          D248 EB               EX      DE,HL
          D249 08               EX      AF,AF'
          D24A 3803             JR      C,FLO4  ;keine Startadr
          D24C E3               EX      (SP),HL
          D24D 09               ADD     HL,BC
          D24E E3               EX      (SP),HL
          D24F 08       FLO4    EX      AF,AF'
          D250 CD9EF4   FLO5    CALL    HLDE    ;Aadr Eadr
          D253 08               EX      AF,AF'
          D254 3808             JR      C,FLO6  ;keine Startadr
          D256 E3               EX      (SP),HL
          D257 2286B7           LD      (ARG3),HL
          D25A CD69F4           CALL    HLHX    ;Sadr
          D25D E1               POP     HL
          D25E CD80F4   FLO6    CALL    CRLF
          D261 3E01     FLO7    LD      A,1     ;Lesen normal
          D263 CD95D0           CALL    STEUER
          D266 0D               DEC     C
          D267 ED78     FLO8    IN      A,(C)
          D269 CD58F7           CALL    LDMAE   ;in Speicher
          D26C 23               INC     HL
          D26D 04               INC     B
          D26E E5               PUSH    HL
          D26F ED52             SBC     HL,DE   ;Ende?
          D271 E1               POP     HL
          D272 3006             JR      NC,FLO9 ;ja
          D274 78               LD      A,B
          D275 A7               AND     A
          D276 20EF             JR      NZ,FLO8
          D278 18E7             JR      FLO7
          D27A DD7E07   FLO9    LD      A,(IX+7)
          D27D CB4F             BIT     1,A
          D27F C0               RET     NZ      ;kein Start
          D280 E61C             AND     1CH
          D282 FE0C             CP      0CH
          D284 D8               RET     C       ;keine Sadr
          D285 2A86B7           LD      HL,(ARG3);Sadr
          D288 E5               PUSH    HL
          D289 C371FB           JP      COFF    ;erst CAOSC off!
          D28C
          D28C 7F7F     FSAV7F  DW      7F7FH
          D28E 46534156         DB      'FSAVE'
          D293 05               DB      5
          D294 CD17D0           CALL    DISK
          D297 CD6ED0           CALL    NAM0
          D29A D8               RET     C       ;BRK
          D29B CD1FE5   FSAVE   CALL    CLC     ;Puffer lîschen
          D29E 2E81             LD      L,ARGN
          D2A0 1110B7           LD      DE,CASS+10H
          D2A3 011500           LD      BC,15H
          D2A6 EDB0             LDIR            ;Arg's
          D2A8 2E00             LD      L,0
          D2AA 01F281           LD      BC,81F2H
          D2AD 1E80             LD      E,80H
          D2AF EDA3     FSA2    OUTI            ;Vorblock
          D2B1 04               INC     B
          D2B2 04               INC     B
          D2B3 1D               DEC     E
          D2B4 20F9             JR      NZ,FSA2
          D2B6 3E0B             LD      A,0BH   ;Schreib open
          D2B8 CD95D0           CALL    STEUER
          D2BB 2A82B7           LD      HL,(ARG1);Aadr
          D2BE 01F280   FSA3    LD      BC,80F2H
          D2C1 1E80             LD      E,80H
          D2C3 CD35F7   FSA4    CALL    LDAME   ;Daten
          D2C6 23               INC     HL
          D2C7 ED79             OUT     (C),A
          D2C9 04               INC     B
          D2CA 1D               DEC     E
          D2CB 20F6             JR      NZ,FSA4
          D2CD 3E03             LD      A,3     ;Schreib normal
          D2CF CD95D0           CALL    STEUER
          D2D2 E5               PUSH    HL
          D2D3 ED5B84B7         LD      DE,(ARG2);Eadr
          D2D7 A7               AND     A
          D2D8 ED52             SBC     HL,DE   ;fertig?
          D2DA E1               POP     HL
          D2DB 38E1             JR      C,FSA3  ;nein
          D2DD 3E43             LD      A,43H   ;Schreib close
          D2DF CD95D0           CALL    STEUER
          D2E2 CD1FE5           CALL    CLC     ;Puffer lîschen
          D2E5 C9               RET
          D2E6
          D2E6          ;Directory mit Maske
          D2E6          ;
          D2E6 7F7F     DIR7F   DW      7F7FH
          D2E8 444952           DB      'DIR'
          D2EB 1F               DB      1FH
          D2EC CD17D0           CALL    DISK
          D2EF EB               EX      DE,HL   ;Maske
          D2F0 1100B7           LD      DE,CASS
          D2F3 010B00           LD      BC,11   ;LÑnge
          D2F6 EDB0             LDIR
          D2F8 1803             JR      DIR0
          D2FA 1100B7   DIR     LD      DE,CASS
          D2FD AF       DIR0    XOR     A       ;Abschlu· Maske
          D2FE 12               LD      (DE),A
          D2FF 3E0D             LD      A,0DH   ;Directory open
          D301 CD95D0   DIR1    CALL    STEUER
          D304 CB57             BIT     2,A
          D306 2041             JR      NZ,DIR6 ;Ende
          D308 0682             LD      B,82H
          D30A 210CB7           LD      HL,CASS+0CH
          D30D A7               AND     A       ;CY=0
          D30E 1603             LD      D,3     ;3 EintrÑge
          D310 1E0B     DIR2    LD      E,11    ;11 Zeichen lang
          D312 ED78     DIR3    IN      A,(C)   ;einlesen
          D314 F5               PUSH    AF
          D315 E67F             AND     7FH
          D317 04               INC     B
          D318 77               LD      M,A
          D319 23               INC     HL
          D31A 7B               LD      A,E
          D31B FE03             CP      3       ;RO-Byte?
          D31D 2801             JR      Z,DIR4
          D31F F1               POP     AF
          D320 1D       DIR4    DEC     E
          D321 20EF             JR      NZ,DIR3
          D323 3600             LD      M,0     ;Ende-Kennung
          D325 23               INC     HL
          D326 04               INC     B
          D327 F1               POP     AF
          D328 77               LD      M,A     ;RO-Byte
          D329 23               INC     HL
          D32A 15               DEC     D
          D32B 20E3             JR      NZ,DIR2
          D32D 210CB7           LD      HL,CASS+0CH
          D330 0603             LD      B,3
          D332 E5       DIR5    PUSH    HL
          D333 1100B7           LD      DE,CASS
          D336 1A               LD      A,(DE)
          D337 A7               AND     A
          D338 C487D3           CALL    NZ,GLOB ;Vergleich
          D33B E1               POP     HL
          D33C D452D3           CALL    NC,DIR7 ;Anzeige
          D33F 110D00           LD      DE,13
          D342 19               ADD     HL,DE
          D343 10ED             DJNZ    DIR5    ;3 EintrÑge
          D345 3E05             LD      A,5     ;DIR weiter
          D347 18B8             JR      DIR1
          D349                  ;
          D349 3AA0B7   DIR6    LD      A,(CURSO)
          D34C A7               AND     A
          D34D C480F4           CALL    NZ,CRLF
          D350 181C             JR      STAT
          D352                  ;
          D352 E5       DIR7    PUSH    HL
          D353 3AA0B7           LD      A,(CURSO)
          D356 FE27             CP      3*13
          D358 CC80F4           CALL    Z,CRLF
          D35B CDA7F8           CALL    ZKOUT
          D35E 3E20             LD      A,' '   ;WR
          D360 CB7E             BIT     7,M
          D362 2802             JR      Z,DIR8
          D364 3E2A             LD      A,'*'   ;RO
          D366 CD80F3   DIR8    CALL    OCHR
          D369 CD71F4           CALL    SPACE
          D36C E1               POP     HL
          D36D C9               RET
          D36E          ;
          D36E 3E15     STAT    LD      A,15H   ;Status
          D370 CD95D0           CALL    STEUER
          D373 1E14             LD      E,20
          D375 0682             LD      B,82H
          D377 ED78     STAT1   IN      A,(C)
          D379 E67F             AND     7FH
          D37B 04               INC     B
          D37C F5               PUSH    AF
          D37D CD80F3           CALL    OCHR
          D380 F1               POP     AF
          D381 1D               DEC     E
          D382 20F3             JR      NZ,STAT1
          D384 C9               RET
          D385
          D385          ;Vergleich mit Maske
          D385          ;
          D385 23       MAT0    INC     HL
          D386 13       MAT0E   INC     DE
          D387          GLOB    ;Eintritt, HL=Name, DE=Maske
          D387                  ;PA: CY=1: nicht gefunden
          D387 1A               LD      A,(DE)
          D388 B6               OR      M       ;Beide Ende?
          D389 C8               RET     Z       ;->OK
          D38A 1A               LD      A,(DE)
          D38B FE2A             CP      '*'
          D38D 2816             JR      Z,MAT0S
          D38F FE01             CP      1
          D391 D8               RET     C       ;M Ende
          D392 7E               LD      A,M
          D393 FE01             CP      1
          D395 D8               RET     C       ;N Ende
          D396 1A               LD      A,(DE)
          D397 FE3F             CP      '?'
          D399 28EA             JR      Z,MAT0  ;Joker
          D39B CB6E             BIT     5,M
          D39D CCF9F4           CALL    Z,UPCASE
          D3A0 BE               CP      M
          D3A1 28E2             JR      Z,MAT0
          D3A3 37               SCF
          D3A4 C9               RET
          D3A5                  ;
          D3A5 E5       MAT0S   PUSH    HL
          D3A6 D5               PUSH    DE
          D3A7 CD86D3           CALL    MAT0E   ;Rekursion!
          D3AA D1               POP     DE
          D3AB E1               POP     HL
          D3AC D0               RET     NC      ;-> OK
          D3AD 7E               LD      A,M
          D3AE 23               INC     HL
          D3AF B7               OR      A
          D3B0 20F3             JR      NZ,MAT0S
          D3B2 37               SCF
          D3B3 C9               RET
          D3B4          ;
          D3B4 7F7F     REN7F   DW      7F7FH
          D3B6 52454E           DB      'REN'
          D3B9 1F               DB      1FH
          D3BA CD17D0           CALL    DISK
          D3BD CD51F3   REN     CALL    OSTR
          D3C0 416C7465         DB      'Alter ',0
          D3C7 210C00           LD      HL,12
          D3CA CD71D0           CALL    NAM1
          D3CD D8               RET     C       ;BRK
          D3CE 3E29             LD      A,29H   ;Ren old
          D3D0 CD95D0           CALL    STEUER
          D3D3 CD51F3           CALL    OSTR
          D3D6 4E657565         DB      'Neuer ',0
          D3DD 210C00           LD      HL,12
          D3E0 CD71D0           CALL    NAM1
          D3E3 3E21             LD      A,21H   ;Ren new
          D3E5 D8       OUT     RET     C       ;BRK
          D3E6 CD95D0           CALL    STEUER
          D3E9 C9               RET
          D3EA          ;
          D3EA 7F7F     ERA7F   DW      7F7FH
          D3EC 455241           DB      'ERA'
          D3EF 1F               DB      1FH
          D3F0 CD17D0           CALL    DISK
          D3F3 CD68D0           CALL    NAME
          D3F6 1803             JR      ERA1
          D3F8 CD6ED0   ERA     CALL    NAM0
          D3FB 3E11     ERA1    LD      A,11H   ;Era
          D3FD 18E6             JR      OUT
          D3FF          ;
          D3FF 7F7F     SRO7F   DW      7F7FH
          D401 53455452         DB      'SETRO'
          D406 1F               DB      1FH
          D407 CD17D0           CALL    DISK
          D40A CD68D0           CALL    NAME
          D40D 1803             JR      SETR1
          D40F CD6ED0   SETRO   CALL    NAM0
          D412 3E25     SETR1   LD      A,25H   ;Setro
          D414 18CF             JR      OUT
          D416          ;
          D416 7F7F     SWR7F   DW      7F7FH
          D418 53455457         DB      'SETWR'
          D41D 1F               DB      1FH
          D41E CD17D0           CALL    DISK
          D421 CD68D0           CALL    NAME
          D424 1803             JR      SETW1
          D426 CD6ED0   SETWR   CALL    NAM0
          D429 3E31     SETW1   LD      A,31H   ;Setwr
          D42B 18B8             JR      OUT
          D42D          ;
          D42D 7F7F     DRIV7F  DW      7F7FH
          D42F 44524956         DB      'DRIVE'
          D434 1F               DB      1FH
          D435 CD17D0           CALL    DISK
          D438 1803             JR      DRIV0
          D43A 1156D4   DRIVE   LD      DE,DRIV1
          D43D 01F183   DRIV0   LD      BC,83F1H
          D440 ED78             IN      A,(C)
          D442 FE20             CP      20H     ;DEP ab 2.0?
          D444 3012             JR      NC,DRIV2;nein
          D446 CD51F3           CALL    OSTR
          D449 6B65696E         DB      'kein DEP2!'
          D453 070D0A           DB      7,CR,LF
          D456 00       DRIV1   NOP
          D457 C9               RET
          D458 EB       DRIV2   EX      DE,HL
          D459 7E               LD      A,M
          D45A E6DF             AND     0DFH
          D45C 202F             JR      NZ,DRIV3;mit arg
          D45E CD51F3           CALL    OSTR
          D461 4C617566         DB      'Laufwerk:',0
          D46B 3E01             LD      A,1     ;akt. lesen
          D46D CD90D0           CALL    STEUER2
          D470 01F181           LD      BC,81F1H
          D473 ED78             IN      A,(C)
          D475 CD80F3           CALL    OCHR    ;Laufwerk
          D478 04               INC     B
          D479 ED78             IN      A,(C)   ;akt. User
          D47B E60F             AND     0FH
          D47D C494F4           CALL    NZ,AHEX0;Userbereich
          D480 3E09             LD      A,9
          D482 32A0B7           LD      (CURSO),A
          D485 CD3CF4           CALL    INLIN   ;Eingabe
          D488 D8               RET     C       ;BRK
          D489 210900           LD      HL,9
          D48C 19               ADD     HL,DE
          D48D 01F181   DRIV3   LD      BC,81F1H
          D490 7E               LD      A,M
          D491 A7               AND     A       ;leer?
          D492 C8               RET     Z
          D493 CDF9F4           CALL    UPCASE
          D496 ED79             OUT     (C),A   ;LW-Code
          D498 23               INC     HL
          D499 7E               LD      A,M
          D49A A7               AND     A       ;USER angeg.?
          D49B 3E03             LD      A,3     ;nur LW anf.
          D49D 2810             JR      Z,DRIV5
          D49F EB               EX      DE,HL
          D4A0 CDA7F4           CALL    RHEX
          D4A3 3E00             LD      A,0     ;USER 0, weil
          D4A5 3803             JR      C,DRIV4 ;keine HEX-Zahl
          D4A7 3A97B7           LD      A,(NUMVX)
          D4AA 04       DRIV4   INC     B
          D4AB ED79             OUT     (C),A   ;USER-Nr.
          D4AD 3E07             LD      A,7     ;LW+User anf.
          D4AF CD90D0   DRIV5   CALL    STEUER2
          D4B2 C9               RET
          D4B3          ;
          D4B3 7F7F     TYPE7F  DW      7F7FH
          D4B5 54595045         DB      'TYPE'
          D4B9 1F               DB      1FH
          D4BA CD17D0           CALL    DISK
          D4BD CD68D0           CALL    NAME
          D4C0 D8               RET     C       ;BRK
          D4C1 3E09             LD      A,9     ;read-open
          D4C3 CD95D0           CALL    STEUER
          D4C6 01F290           LD      BC,90F2H
          D4C9 ED70             INF
          D4CB 0680             LD      B,80H
          D4CD 2006             JR      NZ,TYPE2;kein Vorblock
          D4CF 3E01     TYPE1   LD      A,1     ;read
          D4D1 CD95D0           CALL    STEUER
          D4D4 0D               DEC     C
          D4D5 ED78     TYPE2   IN      A,(C)   ;Zeichen
          D4D7 FE03             CP      3
          D4D9 CA80F4           JP      Z,CRLF  ;CAOS-Ende
          D4DC FE1A             CP      1AH
          D4DE CA80F4           JP      Z,CRLF  ;CP/M-Ende
          D4E1 FE20             CP      20H
          D4E3 301C             JR      NC,TYPE5
          D4E5 FE0A             CP      LF
          D4E7 2818             JR      Z,TYPE5
          D4E9 FE0D             CP      CR
          D4EB 2814             JR      Z,TYPE5
          D4ED FE09             CP      9
          D4EF 200E             JR      NZ,TYPE4
          D4F1 3E20     TYPE3   LD      A,' '
          D4F3 CD80F3           CALL    OCHR
          D4F6 3AA0B7           LD      A,(CURSO)
          D4F9 E607             AND     7
          D4FB 20F4             JR      NZ,TYPE3
          D4FD 1805             JR      TYPE6
          D4FF 3E2E     TYPE4   LD      A,'.'   ;statt Steuerz.
          D501 CD80F3   TYPE5   CALL    OCHR
          D504 3AA1B7   TYPE6   LD      A,(CURSO+1)
          D507 3C               INC     A
          D508 219FB7           LD      HL,WINLG+1
          D50B BE               CP      (HL)    ;Seite voll?
          D50C 2019             JR      NZ,TYPE9
          D50E CD7AF3   TYPE7   CALL    INTB
          D511 FE03             CP      3
          D513 C8               RET     Z       ;BRK
          D514 FE0F             CP      0FH
          D516 2005             JR      NZ,TYPE8
          D518 CD80F3           CALL    OCHR    ;Hardcopy
          D51B 18F1             JR      TYPE7
          D51D 3E0C     TYPE8   LD      A,0CH
          D51F CDF7E3           CALL    CRT
          D522 3E0A             LD      A,LF
          D524 CDF7E3           CALL    CRT
          D527 04       TYPE9   INC     B
          D528 20AB             JR      NZ,TYPE2;weiter
          D52A 18A3             JR      TYPE1   ;neuen Block
          D52C          ;
          D52C 7F7F     DUMP7F  DW      7F7FH
          D52E 44554D50         DB      'DUMP'
          D532 1F               DB      1FH
          D533 CD17D0           CALL    DISK
          D536 CD68D0           CALL    NAME
          D539 D8               RET     C       ;BRK
          D53A 3E09             LD      A,9     ;read-open
          D53C CD95D0           CALL    STEUER
          D53F 1805             JR      DUMP2
          D541 3E01     DUMP1   LD      A,1     ;read
          D543 CD95D0           CALL    STEUER
          D546 0D       DUMP2   DEC     C
          D547 C5       DUMP3   PUSH    BC
          D548 3E20     DUMP4   LD      A,' '
          D54A CD80F3           CALL    OCHR
          D54D ED78             IN      A,(C)
          D54F CD8BF4           CALL    AHEX
          D552 04               INC     B
          D553 3E07             LD      A,7
          D555 A0               AND     B       ;8*Hexwert
          D556 20F0             JR      NZ,DUMP4
          D558 CD51F3           CALL    OSTR
          D55B 20202000         DB      '   ',0
          D55F C1               POP     BC
          D560 ED78     DUMP5   IN      A,(C)
          D562 CD15F7           CALL    CSTBT
          D565 04               INC     B
          D566 3E07             LD      A,7
          D568 A0               AND     B       ;8*Ascii
          D569 20F5             JR      NZ,DUMP5
          D56B CD80F4           CALL    CRLF
          D56E 3AA1B7           LD      A,(CURSO+1)
          D571 3C               INC     A
          D572 219FB7           LD      HL,WINLG+1
          D575 BE               CP      (HL)    ;Seite voll?
          D576 2019             JR      NZ,DUMP8
          D578 CD7AF3   DUMP6   CALL    INTB
          D57B FE03             CP      3       ;BRK?
          D57D C8               RET     Z       ;ja
          D57E FE0F             CP      0FH
          D580 2005             JR      NZ,DUMP7
          D582 CD80F3           CALL    OCHR    ;Hardcopy
          D585 18F1             JR      DUMP6
          D587 3E0C     DUMP7   LD      A,0CH
          D589 CDF7E3           CALL    CRT
          D58C 3E0A             LD      A,LF
          D58E CDF7E3           CALL    CRT
          D591 78       DUMP8   LD      A,B
          D592 A7               AND     A
          D593 20B2             JR      NZ,DUMP3
          D595 18AA             JR      DUMP1
          D597          ;
          D597 494E4954 UUU     DB      'INITIAL.UUU',0
          D5A3 7F7F             DW      7F7FH
          D5A5 494E4954         DB      'INIT'
          D5A9 1F               DB      1FH
          D5AA CD17D0           CALL    DISK
          D5AD EB               EX      DE,HL
          D5AE 7E               LD      A,M
          D5AF E6DF             AND     0DFH
          D5B1 282C             JR      Z,INIT3 ;Standard
          D5B3 E5               PUSH    HL
          D5B4 7E       INIT1   LD      A,M
          D5B5 A7               AND     A
          D5B6 282B             JR      Z,INIT4 ;Ende Dateiname
          D5B8 23               INC     HL
          D5B9 FE3A             CP      ':'     ;LW?
          D5BB 20F7             JR      NZ,INIT1
          D5BD 7E               LD      A,M
          D5BE E1               POP     HL
          D5BF A7               AND     A
          D5C0 2021             JR      NZ,INIT4        ;LW & Na
          D5C2 01F181           LD      BC,81F1H
          D5C5 7E               LD      A,M
          D5C6 ED79             OUT     (C),A   ;LW-Code
          D5C8 23               INC     HL
          D5C9 7E               LD      A,M
          D5CA FE3A             CP      ':'
          D5CC 3E03             LD      A,3     ;ohne USER
          D5CE 280C             JR      Z,INIT2 ;nur LW
          D5D0 EB               EX      DE,HL
          D5D1 CDA7F4           CALL    RHEX
          D5D4 3A97B7           LD      A,(NUMVX)
          D5D7 04               INC     B
          D5D8 ED79             OUT     (C),A   ;User
          D5DA 3E07             LD      A,7
          D5DC CD90D0   INIT2   CALL    STEUER2
          D5DF 2197D5   INIT3   LD      HL,UUU
          D5E2 E5               PUSH    HL
          D5E3 E1       INIT4   POP     HL
          D5E4 CD80D0   INIT5   CALL    NAM2
          D5E7 1100B7           LD      DE,CASS
          D5EA 3E09             LD      A,9     ;read-open
          D5EC CD95D0   INIT6   CALL    STEUER
          D5EF 0D               DEC     C
          D5F0 ED78     INIT7   IN      A,(C)   ;Zeichen
          D5F2 A7               AND     A
          D5F3 2813             JR      Z,INIT8 ;00 ignorieren
          D5F5 FE03             CP      3
          D5F7 2816             JR      Z,INIT9 ;CAOS-Ende
          D5F9 FE0A             CP      0AH
          D5FB 280B             JR      Z,INIT8 ;LF ignorieren
          D5FD FE1A             CP      1AH
          D5FF 280E             JR      Z,INIT9 ;CP/M-Ende
          D601 12               LD      (DE),A
          D602 1C               INC     E
          D603 7B               LD      A,E
          D604 FE7F             CP      7FH
          D606 2807             JR      Z,INIT9 ;Puffer voll!
          D608 04       INIT8   INC     B
          D609 20E5             JR      NZ,INIT7;weiter
          D60B 3E01             LD      A,1
          D60D 18DD             JR      INIT6   ;neuen Block
          D60F 3E00     INIT9   LD      A,0
          D611 12               LD      (DE),A  ;Ende
          D612 2100B7           LD      HL,CASS
          D615 22D1B7           LD      (FTAST),HL
          D618 DDCB08F6         SET     6,(IX+8)
          D61C C9               RET
          D61D
          D61D 7F7F     HELP7F  DW      7F7FH
          D61F 68656C70         DB      'help'
          D623 01               DB      1
          D624 CD51F3           CALL    OSTR
          D627 204D4C2D         DB      ' ML-CAOS 4.4'
          D633 20283039         DB      ' (09.02.2003)'
          D640 0D0A00           DB      CR,LF,0
          D643 C9               RET
          D644
          D644          FREID   ;Rest frei
          D644
          D644                  END

        Errors: 0000
        End+1 : D644

          0200
          0200          ;**     CAOS 4.4 ROM E          **
          0200          ;       (02.11.2001)
          0200
          0200                  ORG     0E000H
          E000
          E000 C345F1           JP      BYE     ;Tasten-RESET
          E003 C35BE6           JP      BEXP1   ;BASIC-
          E006 C36FE6           JP      BEXP2   ;Expansionen
          E009 C3E7E6           JP      BEXP3
          E00C 0EFD             DW      TOKTAB
          E00E C31FF8   BASIO   JP      BASPV
          E011
          E011 7F7F             DW      7F7FH
          E013 42415349         DB      'BASIC'
          E018 11               DB      11H
          E019 CD2FE0           CALL    BASON
          E01C C30DC0           JP      0C00DH  ;Kaltstart
          E01F
          E01F 7F7F             DW      7F7FH
          E021 52454241         DB      'REBASIC'
          E028 11               DB      11H
          E029 CD2FE0           CALL    BASON
          E02C C38CC0           JP      0C08CH  ;Warmstart
          E02F
          E02F          BASON   ;BASIC vorbereiten
          E02F 01F3B3           LD      BC,0B3F3H
          E032 ED78             IN      A,(C)
          E034 FE05             CP      5       ;KC-BA?
          E036 2006             JR      NZ,BASO1
          E038 CD6AFB           CALL    CON
          E03B CDCCD0           CALL    BASEX   ;DISK-Treiber
          E03E 1600     BASO1   LD      D,0
          E040 3E02             LD      A,2
          E042 2E05             LD      L,5
          E044 CDEEF0           CALL    MODU    ;CAOSC off
          E047 16C1             LD      D,0C1H
          E049 3E02             LD      A,2
          E04B 6F               LD      L,A
          E04C CDEEF0           CALL    MODU    ;BASIC-Ebene on
          E04F C345F0           JP      SCROFF  ;IRM off
          E052
          E052          ;CRT-Treiber
          E052
          E052 ED5BA0B7 PADR0   LD      DE,(CURSO)
          E056 2A9CB7   PADR1   LD      HL,(WINON)
          E059 19               ADD     HL,DE
          E05A CB24             SLA     H
          E05C CB24             SLA     H
          E05E CB24             SLA     H
          E060                  ;
          E060 F5       PADR    PUSH    AF              ;**34**
          E061 7D               LD      A,L     ;Spalte
          E062 6C               LD      L,H     ;Pixelzeile
          E063 FE28             CP      28H
          E065 3006             JR      NC,IAD2 ;zu gro·
          E067 F680             OR      80H
          E069 67               LD      H,A     ;HL=Pixeladr.
          E06A F1               POP     AF
          E06B A7               AND     A       ;CY=0
          E06C C9               RET
          E06D F1       IAD2    POP     AF
          E06E 37               SCF             ;CY=1
          E06F C9               RET
          E070
          E070          TCIF    ;Test Cursor im Fenster  **33**
          E070 3A9EB7           LD      A,(WINLG)
          E073 3D               DEC     A
          E074 93               SUB     E       ;Cursor-Spalte
          E075 D8               RET     C
          E076 3A9FB7           LD      A,(WINLG+1)
          E079 3D               DEC     A
          E07A 92               SUB     D       ;Cursor-Zeile
          E07B C9               RET
          E07C
          E07C F5       DABR    PUSH    AF              ;**32**
          E07D CD70E0           CALL    TCIF
          E080 38EB             JR      C,IAD2
          E082 3A9CB7           LD      A,(WINON)
          E085 83               ADD     E       ;Cursor-Spalte
          E086 D5               PUSH    DE
          E087 5F               LD      E,A     ;absolut
          E088 3A9DB7           LD      A,(WINON+1)
          E08B 82               ADD     D       ;Cursor-Zeile
          E08C 87               ADD     A
          E08D 87               ADD     A
          E08E 87               ADD     A       ;*8
          E08F 6F               LD      L,A     ;Pixelzeile
          E090 2600             LD      H,0
          E092 54               LD      D,H     ;D=0
          E093 29               ADD     HL,HL
          E094 29               ADD     HL,HL   ;*4
          E095 19               ADD     HL,DE   ;*5, zus. *40
          E096 ED5BCBB7         LD      DE,(VRAM)
          E09A 5F               LD      E,A
          E09B 19               ADD     HL,DE
          E09C D1               POP     DE
          E09D F1               POP     AF
          E09E A7               AND     A
          E09F C9               RET
          E0A0
          E0A0          WPIX    ;Zeichen auf Grafikbildschirm
          E0A0                  ;sichtbar machen
          E0A0                  ;PE:    DE, A, STBT
          E0A0 E5               PUSH    HL
          E0A1 D5               PUSH    DE
          E0A2 C5               PUSH    BC
          E0A3 F5               PUSH    AF
          E0A4 4F               LD      C,A     ;Zeichen
          E0A5 2A9CB7           LD      HL,(WINON)
          E0A8 19               ADD     HL,DE
          E0A9 EB               EX      DE,HL   ;DE:Absolut-Curs
          E0AA          ;       LD      A,D
          E0AA          ;       CP      20H
          E0AA          ;       JP      NC,WPX13;au·erhalb
          E0AA 7B               LD      A,E
          E0AB FE28             CP      28H
          E0AD D25CE1           JP      NC,WPX13;au·erhalb!
          E0B0 21A2B7           LD      HL,STBT
          E0B3 CB6E             BIT     5,M     ;IBM?
          E0B5 2844             JR      Z,WPX03 ;nein
          E0B7 DD7E04           LD      A,(IX+4);CAOSC merken
          E0BA F5               PUSH    AF
          E0BB CBFF             SET     7,A     ;CAOSC on
          E0BD DD7704           LD      (IX+4),A;fÅr IBM-Tab.
          E0C0 D386             OUT     86H
          E0C2 79               LD      A,C
          E0C3 0100DC           LD      BC,0DC00H
          E0C6 87               ADD     A
          E0C7 382C             JR      C,WPX02 ;80..FF
          E0C9 05               DEC     B
          E0CA FE40             CP      40H
          E0CC 3827             JR      C,WPX02 ;00..1F
          E0CE 06ED             LD      B,0EEH-1;Gro·buchst.
          E0D0 FEB6             CP      2*5BH
          E0D2 3821             JR      C,WPX02 ;20..5A
          E0D4 FEBC             CP      2*5EH
          E0D6 380C             JR      C,WPX01 ;5B..5D
          E0D8 FEC0             CP      2*60H
          E0DA 3819             JR      C,WPX02 ;5E..5F
          E0DC 2806             JR      Z,WPX01 ;60
          E0DE 06FC             LD      B,0FEH-2;Kleinbuchst.
          E0E0 FEF6             CP      2*7BH
          E0E2 3811             JR      C,WPX02 ;61..7A
          E0E4 01B8DA   WPX01   LD      BC,0DAB8H;Zusatztabelle
          E0E7 D6B6             SUB     2*5BH
          E0E9 FE06             CP      6
          E0EB 3808             JR      C,WPX02 ;5B..5D
          E0ED D604             SUB     4
          E0EF FE06             CP      6
          E0F1 2802             JR      Z,WPX02 ;60
          E0F3 D634             SUB     34H
          E0F5 6F       WPX02   LD      L,A
          E0F6 2600             LD      H,0
          E0F8 29               ADD     HL,HL   ;*4
          E0F9 1819             JR      WPX07
          E0FB
          E0FB 79       WPX03   LD      A,C
          E0FC 21A6B7           LD      HL,CCTL0
          E0FF 87               ADD     A       ;*2
          E100 3002             JR      NC,WPX04
          E102 2EAA             LD      L,CCTL2
          E104 D640     WPX04   SUB     40H
          E106 F20DE1           JP      P,WPX06 ;CCTL0/2
          E109 2C               INC     L
          E10A 2C               INC     L       ;CCTL1/3
          E10B EEC0             XOR     0C0H
          E10D 4E       WPX06   LD      C,M
          E10E 2C               INC     L       ;BC=(CCTL)
          E10F 46               LD      B,M
          E110 87               ADD     A       ;*4
          E111 6F               LD      L,A
          E112 2600             LD      H,0
          E114 29       WPX07   ADD     HL,HL   ;*8
          E115 09               ADD     HL,BC   ;HL=Pixelmuster
          E116 7A               LD      A,D
          E117 87               ADD     A
          E118 87               ADD     A
          E119 87               ADD     A
          E11A 53               LD      D,E
          E11B 5F               LD      E,A
          E11C CBFA             SET     7,D     ;DE=IRM-Adresse
          E11E ED4BA2B7         LD      BC,(STBT)
          E122 CB49             BIT     1,C
          E124 2016             JR      NZ,WPIXNC;Farbe AUS
          E126 CD29F9           CALL    ESC9
          E129 DDCB015E         BIT     3,(IX+1)
          E12D 2004             JR      NZ,WPIXA;LORES
          E12F CB71             BIT     6,C
          E131 202E             JR      NZ,WPIXH1;HRG-Modus
          E133 78       WPIXA   LD      A,B     ;Farbe
          E134 43               LD      B,E
          E135 CDA9E1           CALL    WCOLOR  ;8 Farbbytes
          E138 58               LD      E,B
          E139 CD29F9   WPIXHE  CALL    ESC9
          E13C CB41     WPIXNC  BIT     0,C
          E13E 2012             JR      NZ,WPX11;Farbe AUS
          E140 DDCB015E         BIT     3,(IX+1)
          E144 2004             JR      NZ,WPIXB;LORES
          E146 CB71             BIT     6,C
          E148 2022             JR      NZ,WPIXH2;HRG-Modus
          E14A CB51     WPIXB   BIT     2,C
          E14C CC88E1           CALL    Z,WPIXEL;normal
          E14F C49BE1           CALL    NZ,WPIXI;invers
          E152 CB69     WPX11   BIT     5,C     ;IBM?
          E154 2806             JR      Z,WPX13 ;nein
          E156 F1               POP     AF
          E157 DD7704           LD      (IX+4),A;CAOSC
          E15A D386             OUT     86H     ;wie vorher
          E15C F1       WPX13   POP     AF
          E15D C1               POP     BC
          E15E D1               POP     DE
          E15F E1               POP     HL
          E160 C9               RET
          E161
          E161          WPIXH1  ;Farbebene im HRG-Modus
          E161 78               LD      A,B
          E162 0F               RRCA
          E163 E5               PUSH    HL
          E164 D5               PUSH    DE
          E165 CD76E1           CALL    WPHRG
          E168 D1               POP     DE
          E169 E1               POP     HL
          E16A 18CD             JR      WPIXHE
          E16C
          E16C          WPIXH2  ;Pixelebene im HRG-Modus
          E16C 78               LD      A,B
          E16D E5               PUSH    HL
          E16E D5               PUSH    DE
          E16F CD76E1           CALL    WPHRG
          E172 D1               POP     DE
          E173 E1               POP     HL
          E174 18DC             JR      WPX11
          E176
          E176                  ;Reaktion im HRG-Modus
          E176 E609     WPHRG   AND     9       ;Bits 0&3
          E178 282F             JR      Z,WCOLOR;Ebene rÅcks.
          E17A FE09             CP      9
          E17C 2829             JR      Z,COLFF ;Ebene setzen
          E17E CB51             BIT     2,C
          E180 2803             JR      Z,WPHN
          E182 2F               CPL             ;invers
          E183 E609             AND     9
          E185 3D       WPHN    DEC     A
          E186 2813             JR      Z,WPIXI ;Pixel invers
          E188          WPIXEL  ;8 Pixelbytes kopieren
          E188 C5               PUSH    BC
          E189 EDA0             LDI
          E18B EDA0             LDI
          E18D EDA0             LDI
          E18F EDA0             LDI
          E191 EDA0             LDI
          E193 EDA0             LDI
          E195 EDA0             LDI
          E197 EDA0             LDI
          E199 C1               POP     BC
          E19A C9               RET
          E19B
          E19B C5       WPIXI   PUSH    BC
          E19C 0608             LD      B,8     ;8 Pixelmuster
          E19E 7E       WPIXI1  LD      A,M     ;invers
          E19F 2F               CPL
          E1A0 12               LD      (DE),A
          E1A1 23               INC     HL
          E1A2 1C               INC     E
          E1A3 10F9             DJNZ    WPIXI1
          E1A5 C1               POP     BC
          E1A6 C9               RET
          E1A7
          E1A7 3EFF     COLFF   LD      A,0FFH
          E1A9 12       WCOLOR  LD      (DE),A  ;8 Farbbytes
          E1AA 1C               INC     E
          E1AB 12               LD      (DE),A
          E1AC 1C               INC     E
          E1AD 12               LD      (DE),A
          E1AE 1C               INC     E
          E1AF 12               LD      (DE),A
          E1B0 1C               INC     E
          E1B1 12               LD      (DE),A
          E1B2 1C               INC     E
          E1B3 12               LD      (DE),A
          E1B4 1C               INC     E
          E1B5 12               LD      (DE),A
          E1B6 1C               INC     E
          E1B7 12               LD      (DE),A
          E1B8 C9               RET
          E1B9
          E1B9          MOVELN  ;Rolle Fenster fÅr Scrolling
          E1B9 E5               PUSH    HL
          E1BA D5               PUSH    DE
          E1BB C5               PUSH    BC
          E1BC F5               PUSH    AF
          E1BD 08               EX      AF,AF'
          E1BE F5               PUSH    AF
          E1BF 79               LD      A,C     ;BC:Pixelzeilen
          E1C0 08               EX      AF,AF'
          E1C1 3A9EB7           LD      A,(WINLG) ;Spalten
          E1C4 E5       MOLN1   PUSH    HL
          E1C5 D5               PUSH    DE
          E1C6 EDA0     MOLN2   LDI             ;zeichenweise
          E1C8 EDA0             LDI
          E1CA EDA0             LDI
          E1CC EDA0             LDI
          E1CE EDA0             LDI
          E1D0 EDA0             LDI
          E1D2 EDA0             LDI
          E1D4 EDA0             LDI
          E1D6 EAC6E1           JP      PE,MOLN2
          E1D9 D1               POP     DE
          E1DA E1               POP     HL
          E1DB 24               INC     H       ;neue Spalte
          E1DC 14               INC     D
          E1DD 08               EX      AF,AF'
          E1DE 4F               LD      C,A
          E1DF 08               EX      AF,AF'
          E1E0 3D               DEC     A       ;SpaltenzÑhler
          E1E1 20E1             JR      NZ,MOLN1
          E1E3 08               EX      AF,AF'
          E1E4 F1               POP     AF
          E1E5 08               EX      AF,AF'
          E1E6 F1               POP     AF
          E1E7 C1               POP     BC
          E1E8 D1               POP     DE
          E1E9 E1               POP     HL
          E1EA C9               RET
          E1EB
          E1EB          PCHR    ;CRT-Grundprogramm
          E1EB ED5BA0B7         LD      DE,(CURSO)
          E1EF 21A2B7           LD      HL,STBT
          E1F2 CB66             BIT     4,M     ;ESC aktiv?
          E1F4 2822             JR      Z,PCHR3
          E1F6 CBA6     CRT1    RES     4,M
          E1F8 FE30             CP      '0'
          E1FA D8               RET     C
          E1FB FE3A             CP      '9'+1
          E1FD 3004             JR      NC,PCHR1
          E1FF D630             SUB     '0'
          E201 180A             JR      PCHR2
          E203                  ;
          E203 FE41     PCHR1   CP      'A'
          E205 D8               RET     C
          E206 CBAF             RES     5,A
          E208 FE5B             CP      'Z'+1
          E20A D0               RET     NC
          E20B D637             SUB     'A'-10
          E20D 21DFB7   PCHR2   LD      HL,L3SIZ;Tabelle
          E210 BE               CP      M       ;lang genug?
          E211 D0               RET     NC
          E212 87               ADD     A       ;*2
          E213 2ADDB7           LD      HL,(L3TAB) ;klar zum
          E216 180C             JR      PCHR4   ;Ansprung
          E218                  ;
          E218 FE20     PCHR3   CP      20H     ;Steuerfunktion?
          E21A 3018             JR      NC,PCHR5
          E21C CB5E             BIT     3,M     ;darstellen?
          E21E 2014             JR      NZ,PCHR5
          E220 87               ADD     A       ;*2
          E221 2AB2B7           LD      HL,(CTAB)
          E224 4F       PCHR4   LD      C,A
          E225 0600             LD      B,0
          E227 09               ADD     HL,BC
          E228 7E               LD      A,M
          E229 23               INC     HL
          E22A 66               LD      H,M
          E22B 6F               LD      L,A
          E22C E9       JPHL    JP      (HL)    ;anspringen
          E22D
          E22D 7B       ESC0    LD      A,E     ;Tabulator
          E22E F607             OR      7       ;8er Step
          E230 3C               INC     A
          E231 5F               LD      E,A
          E232 1809             JR      CUR1
          E234                  ;
          E234 CD7CE0   PCHR5   CALL    DABR
          E237 D8               RET     C       ;au·erhalb
          E238 77               LD      M,A     ;ASCII eintragen
          E239 CDA0E0           CALL    WPIX    ;darstellen
          E23C 1C       CUR     INC     E
          E23D 3A9EB7   CUR1    LD      A,(WINLG)
          E240 3D               DEC     A
          E241 BB               CP      E
          E242 D0               RET     NC
          E243 1E00     NL      LD      E,0     ;NL fÅr 1E
          E245 14       CUD     INC     D
          E246 3A9FB7           LD      A,(WINLG+1)
          E249 BA               CP      D
          E24A C0               RET     NZ
          E24B 2AA4B7           LD      HL,(WEND)
          E24E E9               JP      (HL)    ;PAGE o. SCROLL
          E24F
          E24F 2A99B7   HCOPY   LD      HL,(HCADR) ;ShCLR
          E252 E9               JP      (HL)
          E253
          E253 7B       CUL     LD      A,E
          E254 A7               AND     A
          E255 2802             JR      Z,CUL1
          E257 1D               DEC     E
          E258 C9               RET
          E259
          E259 7A       CUL1    LD      A,D
          E25A A7               AND     A
          E25B C8               RET     Z
          E25C 15               DEC     D
          E25D 3A9EB7   CEL     LD      A,(WINLG)
          E260 3D               DEC     A
          E261 5F               LD      E,A
          E262 C9               RET
          E263
          E263 7A       CUU     LD      A,D
          E264 A7               AND     A
          E265 C8               RET     Z
          E266 15               DEC     D
          E267 C9               RET
          E268
          E268 21D7E2   PAGE    LD      HL,HOMEPG ;ShCUU
          E26B 22A4B7   WADR    LD      (WEND),HL
          E26E C9               RET
          E26F
          E26F 21F2E2   SCROL   LD      HL,SCRLPG ;ShCUD
          E272 18F7             JR      WADR
          E274
          E274 CD53E2   CLR     CALL    CUL
          E277 D5       DEL     PUSH    DE      ;Cursor retten
          E278 CD7CE0           CALL    DABR
          E27B 7E               LD      A,M
          E27C A7               AND     A       ;Ende?
          E27D 2829             JR      Z,POPDE
          E27F E5               PUSH    HL      ;VRAM
          E280 D5       DEL1    PUSH    DE      ;Cursor
          E281 1C               INC     E       ;nÑchste Spalte
          E282 CD7CE0           CALL    DABR    ;raus?
          E285 3008             JR      NC,DEL2
          E287 1E00             LD      E,0     ;ja, wie NL
          E289 14               INC     D
          E28A CD7CE0           CALL    DABR    ;raus?
          E28D 3810             JR      C,DEL3  ;ja-wie Ende
          E28F 7E       DEL2    LD      A,M
          E290 A7               AND     A       ;Ende?
          E291 280C             JR      Z,DEL3
          E293 42               LD      B,D
          E294 4B               LD      C,E     ;BC:=DE
          E295 D1               POP     DE      ;DE=links davon
          E296 E3               EX      (SP),HL ;HL=VRAM links
          E297 77               LD      M,A     ;eintragen
          E298 CDA0E0           CALL    WPIX    ;zeichnen
          E29B 50               LD      D,B
          E29C 59               LD      E,C     ;DE:=BC
          E29D 18E1             JR      DEL1    ;von vorn
          E29F
          E29F D1       DEL3    POP     DE
          E2A0 E1               POP     HL
          E2A1 3600             LD      M,0
          E2A3 3E20             LD      A,' '
          E2A5 CDA0E0           CALL    WPIX
          E2A8 D1       POPDE   POP     DE
          E2A9 C9               RET
          E2AA
          E2AA D5       INS     PUSH    DE      ;Cursor
          E2AB 3E20             LD      A,' '
          E2AD CD7CE0           CALL    DABR
          E2B0 46       INS1    LD      B,M     ;VRAM
          E2B1 77               LD      M,A     ;neues Zeichen
          E2B2 CDA0E0           CALL    WPIX    ;zeichnen
          E2B5 78               LD      A,B
          E2B6 A7               AND     A       ;Dummy?
          E2B7 280E             JR      Z,INS2
          E2B9 1C               INC     E       ;CUR
          E2BA CD7CE0           CALL    DABR    ;raus?
          E2BD 30F1             JR      NC,INS1
          E2BF 1E00             LD      E,0     ;wie NL
          E2C1 14               INC     D
          E2C2 CD7CE0           CALL    DABR    ;raus?
          E2C5 30E9             JR      NC,INS1
          E2C7 D1       INS2    POP     DE      ;wenn ja Schlu·
          E2C8 C9               RET
          E2C9
          E2C9 3A9FB7   CLS     LD      A,(WINLG+1) ;ShHOME
          E2CC 1600             LD      D,0
          E2CE F5       CLS1    PUSH    AF
          E2CF CD3CE3           CALL    CLLN
          E2D2 F1               POP     AF
          E2D3 14               INC     D
          E2D4 3D               DEC     A
          E2D5 20F7             JR      NZ,CLS1 ;A Zeilen
          E2D7 1600     HOMEPG  LD      D,0
          E2D9 1E00     CBL     LD      E,0
          E2DB C9               RET
          E2DC
          E2DC          CLLINE  ;Lîschen einer Zeile
          E2DC                  ;HL: Adr. C: LÑnge, A: Byte
          E2DC 41               LD      B,C
          E2DD 55       CLL1    LD      D,L     ;L retten
          E2DE 77               LD      M,A     ;zeichenweise
          E2DF 2C               INC     L       ;ohne Schleife
          E2E0 77               LD      M,A
          E2E1 2C               INC     L
          E2E2 77               LD      M,A
          E2E3 2C               INC     L
          E2E4 77               LD      M,A
          E2E5 2C               INC     L
          E2E6 77               LD      M,A
          E2E7 2C               INC     L
          E2E8 77               LD      M,A
          E2E9 2C               INC     L
          E2EA 77               LD      M,A
          E2EB 2C               INC     L
          E2EC 77               LD      M,A
          E2ED 6A               LD      L,D     ;L holen
          E2EE 24               INC     H
          E2EF 10EC             DJNZ    CLL1
          E2F1 C9               RET
          E2F2
          E2F2 3A9EB7   SCRLPG  LD      A,(WINLG) ;Spalten
          E2F5 4F               LD      C,A
          E2F6 0600             LD      B,0
          E2F8 3A9FB7           LD      A,(WINLG+1) ;Zeilen
          E2FB 3D               DEC     A       ;nur 1 Zeile?
          E2FC 283D             JR      Z,SCRL3 ;nur CLLN
          E2FE D5               PUSH    DE
          E2FF F5               PUSH    AF
          E300 110000           LD      DE,0    ;Cursor li/oben
          E303 CD7CE0           CALL    DABR
          E306 EB               EX      DE,HL
          E307 212800   SCRL1   LD      HL,40   ;1 Zeile tiefer
          E30A 19               ADD     HL,DE
          E30B E5               PUSH    HL
          E30C C5               PUSH    BC
          E30D EDB0             LDIR            ;im VRAM eine
          E30F C1               POP     BC      ;Zeile rollen
          E310 D1               POP     DE
          E311 3D               DEC     A
          E312 20F3             JR      NZ,SCRL1;A*
          E314 F1               POP     AF
          E315 87               ADD     A
          E316 87               ADD     A
          E317 87               ADD     A       ;*8: Pixelzeile
          E318 4F               LD      C,A
          E319 110000           LD      DE,0
          E31C 42               LD      B,D
          E31D CD56E0           CALL    PADR1
          E320 EB               EX      DE,HL   ;DE=PixAdr.
          E321 2E08             LD      L,8     ;H war 0
          E323 19               ADD     HL,DE
          E324 3AA2B7           LD      A,(STBT)
          E327 1F               RRA
          E328 1F               RRA
          E329 380B             JR      C,SCRL2 ;Farbe AUS
          E32B F5               PUSH    AF
          E32C CD29F9           CALL    ESC9
          E32F CDB9E1           CALL    MOVELN
          E332 CD29F9           CALL    ESC9
          E335 F1               POP     AF
          E336 17       SCRL2   RLA             ;Pixel AUS?
          E337 D4B9E1           CALL    NC,MOVELN
          E33A D1               POP     DE
          E33B 15       SCRL3   DEC     D
          E33C                  ;
          E33C 1E00     CLLN    LD      E,0     ;ShDEL
          E33E CD7CE0           CALL    DABR    ;au·erhalb?
          E341 D8               RET     C       ;(Selbstschutz)
          E342 3A9EB7           LD      A,(WINLG)
          E345 47               LD      B,A     ;Spalten
          E346 4F               LD      C,A
          E347 AF               XOR     A
          E348 77       CLLN1   LD      M,A     ;VRAM lîschen
          E349 23               INC     HL
          E34A 10FC             DJNZ    CLLN1
          E34C CD56E0           CALL    PADR1
          E34F D8               RET     C
          E350 D5               PUSH    DE
          E351 DDCB015E         BIT     3,(IX+1)
          E355 3AA2B7           LD      A,(STBT)
          E358 2004             JR      NZ,CLLALT;LORES
          E35A CB77             BIT     6,A
          E35C 201C             JR      NZ,CLLHR;HRG-Modus
          E35E 0F       CLLALT  RRCA            ;Pixel AUS?
          E35F 5F               LD      E,A     ;nach E merken
          E360 3806             JR      C,CLLN2
          E362 AF               XOR     A
          E363 E5               PUSH    HL
          E364 CDDCE2           CALL    CLLINE  ;Pixel lîschen
          E367 E1               POP     HL
          E368 CB0B     CLLN2   RRC     E       ;Farbe AUS?
          E36A 380C             JR      C,CLLN3
          E36C CD29F9           CALL    ESC9
          E36F 3AA3B7           LD      A,(COLOR)
          E372 CDDCE2           CALL    CLLINE  ;Farbe setzen
          E375 CD29F9           CALL    ESC9
          E378 D1       CLLN3   POP     DE
          E379 C9               RET
          E37A                  ;
          E37A 3AA3B7   CLLHR   LD      A,(COLOR)
          E37D E603             AND     3       ;Paper
          E37F 110000           LD      DE,0    ;schwarz
          E382 B7               OR      A
          E383 2809             JR      Z,CLLH2
          E385 15               DEC     D       ;rot
          E386 3D               DEC     A
          E387 2805             JR      Z,CLLH2
          E389 1D               DEC     E       ;wei·
          E38A 3D               DEC     A
          E38B 2001             JR      NZ,CLLH2
          E38D 14               INC     D       ;tÅrkis
          E38E 7A       CLLH2   LD      A,D     ;Pixel
          E38F 0602             LD      B,2
          E391 1804             JR      CLLH4
          E393 CD29F9   CLLH3   CALL    ESC9
          E396 7B               LD      A,E     ;Color
          E397 E5       CLLH4   PUSH    HL
          E398 C5               PUSH    BC
          E399 CDDCE2           CALL    CLLINE
          E39C C1               POP     BC
          E39D E1               POP     HL
          E39E 10F3             DJNZ    CLLH3
          E3A0 CD29F9           CALL    ESC9
          E3A3 D1               POP     DE
          E3A4 C9               RET
          E3A5
          E3A5 010F0A   BEEP    LD      BC,0A0FH
          E3A8 213000           LD      HL,48
          E3AB D5               PUSH    DE
          E3AC 5C               LD      E,H     ;E=0
          E3AD CDB9F8           CALL    TON2
          E3B0 3E1E             LD      A,1EH
          E3B2 CD3DF3           CALL    WAIT
          E3B5 3E03             LD      A,3
          E3B7 D38C             OUT     8CH
          E3B9 3E10             LD      A,10H
          E3BB D1               POP     DE
          E3BC C33DF3           JP      WAIT
          E3BF
          E3BF 010703   CLIK    LD      BC,0307H
          E3C2 212400           LD      HL,36
          E3C5 D5               PUSH    DE
          E3C6 5C               LD      E,H     ;E=0
          E3C7 CDB9F8           CALL    TON2
          E3CA D1               POP     DE
          E3CB C9               RET
          E3CC
          E3CC 21A3B7   ESC8    LD      HL,COLOR;Farbtausch
          E3CF 7E               LD      A,M
          E3D0 F5               PUSH    AF
          E3D1 E6C0             AND     0C0H
          E3D3 4F               LD      C,A     ;Bit 6,7
          E3D4 F1               POP     AF
          E3D5 F5               PUSH    AF
          E3D6 E607             AND     7       ;hFarbe
          E3D8 07               RLCA
          E3D9 07               RLCA
          E3DA 07               RLCA
          E3DB B1               OR      C
          E3DC 4F               LD      C,A
          E3DD F1               POP     AF
          E3DE 0F               RRCA
          E3DF 0F               RRCA
          E3E0 0F               RRCA
          E3E1 E607             AND     7       ;vFarbe
          E3E3 B1               OR      C
          E3E4 77       LDMA    LD      M,A             ;**28**
          E3E5 C9               RET
          E3E6
          E3E6 7E       LDAM    LD      A,M             ;**29**
          E3E7 C9               RET
          E3E8
          E3E8 DD7E08   CLICK   LD      A,(IX+8);ShINS
          E3EB EE20             XOR     20H
          E3ED DD7708           LD      (IX+8),A
          E3F0 C9       NOT     RET
          E3F1
          E3F1 21A2B7   ESCPRG  LD      HL,STBT ;ShSTOP
          E3F4 CBE6             SET     4,M
          E3F6 C9               RET
          E3F7
          E3F7 E5       CRT     PUSH    HL              ;**00**
          E3F8 D5               PUSH    DE
          E3F9 C5               PUSH    BC
          E3FA F5               PUSH    AF
          E3FB CDEBE1           CALL    PCHR
          E3FE ED53A0B7         LD      (CURSO),DE
          E402 F1               POP     AF
          E403 C1               POP     BC
          E404 D1               POP     DE
          E405 E1               POP     HL
          E406 C9               RET
          E407
          E407          ;KBD-Treiber
          E407
          E407          ISRC3   ;ISR CTC Kanal 3 (Tastatur)
          E407 FB               EI
          E408 F5               PUSH    AF
          E409 3E23             LD      A,23H     ;DI,ZG256,Res
          E40B D38F             OUT     8FH       ;CTC K3
          E40D DD360D00         LD      (IX+13),0 ;Zeichen tot
          E411 1864             JR      TST5      ;freigeben
          E413
          E413          ISRPB   ;ISR PIO Kanal B (Tastatur)
          E413 F5               PUSH    AF
          E414 DB8F             IN      A,8FH   ;gemessene Zeit
          E416 F5               PUSH    AF
          E417 3EA7             LD      A,0A7H  ;EI,ZG256,Res
          E419 D38F             OUT     8FH,A
          E41B 3E8F             LD      A,8FH   ;Zeitkonstante
          E41D D38F             OUT     8FH
          E41F F1               POP     AF
          E420 FB               EI
          E421 FE14             CP      20
          E423 3852             JR      C,TST5  ;zu lang
          E425 FE78             CP      120
          E427 304E             JR      NC,TST5 ;zu kurz
          E429 FE65             CP      101     ;Diskriminator
          E42B 3004             JR      NC,TST1
          E42D C6BE             ADD     190
          E42F 3006             JR      NC,TST2 ;Stop-Bit
          E431 DDCB0C1E TST1    RR      (IX+12) ;Bit einschieben
          E435 1840             JR      TST5
          E437 E5       TST2    PUSH    HL
          E438 D5               PUSH    DE
          E439 DD7E0C           LD      A,(IX+12)
          E43C 1F               RRA             ;7bit-Scancode
          E43D EE01             XOR     1       ;Startbit neg.
          E43F DD6E0E           LD      L,(IX+14)
          E442 DD660F           LD      H,(IX+15)
          E445 1600             LD      D,0
          E447 5F               LD      E,A
          E448 19               ADD     HL,DE   ;Pos. in KTAB
          E449 7E               LD      A,M     ;ASCII holen
          E44A DDCB087E         BIT     7,(IX+8);CAPS aktiv?
          E44E 200A             JR      NZ,TST3 ;1=nein
          E450 FE40             CP      40H
          E452 3806             JR      C,TST3
          E454 FE80             CP      80H
          E456 3002             JR      NC,TST3
          E458 EE20             XOR     20H     ;klein<=>gro·
          E45A 57       TST3    LD      D,A     ;Code merken
          E45B DDBE0D           CP      (IX+13) ;= letzter Code?
          E45E 201E             JR      NZ,TST6 ;nein
          E460 DB88             IN      A,88H
          E462 5F               LD      E,A
          E463 CBD7             SET     2,A     ;IRM on
          E465 D388             OUT     88H
          E467 3AE0B7           LD      A,(COUNT)
          E46A DDBE0A           CP      (IX+10) ;FastRepeat?
          E46D 7B               LD      A,E
          E46E D388             OUT     88H
          E470 381C             JR      C,TST7
          E472 DD340A           INC     (IX+10) ;Zeit abwarten
          E475 D1       TST4    POP     DE
          E476 E1               POP     HL
          E477 DB89     TST5    IN      A,89H   ;PIO-Logik
          E479 D389             OUT     89H     ;freigeben
          E47B F1               POP     AF
          E47C ED4D             RETI
          E47E
          E47E DD360A00 TST6    LD      (IX+10),0 ;neuer Code
          E482 FE16             CP      16H       ;CAPS?
          E484 2009             JR      NZ,TST8
          E486 DD7E08           LD      A,(IX+8)
          E489 EE80             XOR     80H       ;CAPS on/off
          E48B DD7708           LD      (IX+8),A
          E48E 7A       TST7    LD      A,D       ;Code
          E48F DD770D   TST8    LD      (IX+13),A ;eintragen
          E492 DDCB08C6         SET     0,(IX+8)  ;gÅltig machen
          E496 18DD             JR      TST4
          E498
          E498          KBDS    ;Abfrage ohne Quittung   **0C**
          E498 B7               OR      A
          E499 DDCB0846         BIT     0,(IX+8);Code gÅltig?
          E49D C8               RET     Z
          E49E DD7E0D           LD      A,(IX+13)
          E4A1 37               SCF             ;wenn ja
          E4A2 C9               RET
          E4A3
          E4A3          KBDZ    ;Abfrage mit Quittung    **0E**
          E4A3 CD98E4           CALL    KBDS
          E4A6 D0               RET     NC
          E4A7 DDCB0886         RES     0,(IX+8)
          E4AB C9               RET
          E4AC
          E4AC          BRKT    ;Test auf BRK-Anforderung**2A**
          E4AC CD98E4           CALL    KBDS
          E4AF D0               RET     NC
          E4B0 FE03             CP      3
          E4B2 37               SCF
          E4B3 C8               RET     Z
          E4B4 A7               AND     A
          E4B5 C9               RET
          E4B6
          E4B6          ;TAPE-Treiber
          E4B6
          E4B6 F3       ISRI1   DI
          E4B7 DB88             IN      A,88H
          E4B9 F640             OR      40H     ;Motor ein
          E4BB E6DF             AND     0DFH    ;LED aus
          E4BD D388     ISRO1   OUT     88H
          E4BF FB               EI
          E4C0 2AA4B7           LD      HL,(WEND)
          E4C3 22CFB7           LD      (ZWEND),HL
          E4C6 CD60F3           CALL    NOUT    ;kein Drucker!
          E4C9 22CDB7           LD      (ZOTAB),HL
          E4CC CD68E2           CALL    PAGE    ;Page Mode
          E4CF 3E03     TOFF    LD      A,3     ;Ton aus
          E4D1 D38C             OUT     8CH     ;CTC0
          E4D3 D38D             OUT     8DH     ;CTC1
          E4D5 DDCB088E         RES     1,(IX+8)
          E4D9 1823             JR      CSRO2
          E4DB
          E4DB          CSRO    ;Abschlu· Bandausgabe    **09**
          E4DB DD3602FE         LD      (IX+2),0FEH
          E4DF CD37E5           CALL    MBO
          E4E2 2ACDB7   CSROI   LD      HL,(ZOTAB) ;intern
          E4E5 22B9B7           LD      (OUTAB),HL
          E4E8 2ACFB7           LD      HL,(ZWEND) ;gro·es
          E4EB 22A4B7           LD      (WEND),HL  ;RÅcksetzen
          E4EE CD1FE5           CALL    CLC     ;KassPuff lî.
          E4F1 DB88             IN      A,88H
          E4F3 E69F             AND     9FH     ;Motor,LED aus
          E4F5 D388             OUT     88H
          E4F7 CD80F4           CALL    CRLF
          E4FA DDCB0886         RES     0,(IX+8)
          E4FE DDCB015E CSRO2   BIT     3,(IX+1);HiRes?
          E502 2806             JR      Z,CSRO3
          E504 DB89             IN      A,89H   ;nein-
          E506 CBFF             SET     7,A     ;Blinken ein
          E508 D389             OUT     89H
          E50A DDCB084E CSRO3   BIT     1,(IX+8);neuer Ton?
          E50E 20FA             JR      NZ,CSRO3;Ende abwarten
          E510 3ADBB7           LD      A,(CTCMD);CTC2 auf
          E513 E660             AND     60H
          E515 F607             OR      7
          E517 D38E             OUT     8EH     ;Blinken
          E519 3ADCB7           LD      A,(BLINK);ZK laden
          E51C D38E             OUT     8EH
          E51E C9               RET
          E51F
          E51F 2180B7   CLC     LD      HL,CASS+80H
          E522 AF               XOR     A
          E523 2D       CLC1    DEC     L
          E524 77               LD      M,A
          E525 20FC             JR      NZ,CLC1
          E527 C9               RET
          E528
          E528          ISRO    ;Init. Bandausgabe       **08**
          E528 F3               DI
          E529 DB88             IN      A,88H
          E52B F660             OR      60H     ;Motor,LED ein
          E52D CDBDE4           CALL    ISRO1
          E530 DD360200         LD      (IX+2),0
          E534 010010           LD      BC,1000H
          E537                  ;
          E537          MBO     ;Ausgabe 1 Block         **01**
          E537 DD3402           INC     (IX+2)
          E53A F3               DI
          E53B 3E87             LD      A,87H   ;EI,ZG16,Res
          E53D D38D             OUT     8DH
          E53F 3E2F             LD      A,2FH   ;Vorton
          E541 D38D             OUT     8DH
          E543 FB               EI
          E544 57               LD      D,A     ;D=2Fh
          E545 5F               LD      E,A     ;E=2Fh
          E546 CD8CE5   MBO1    CALL    BITOUT
          E549 EDA1             CPI
          E54B EA46E5           JP      PE,MBO1 ;BC mal
          E54E CD8AE5           CALL    ZTON    ;Trennzeichen
          E551 DD7E02           LD      A,(IX+2)
          E554 CD77E5           CALL    BYTOT   ;Blocknummer
          E557 DD6E05           LD      L,(IX+5)
          E55A DD6606           LD      H,(IX+6)
          E55D 0680             LD      B,80H
          E55F 7E       BLKOT   LD      A,M
          E560 CD77E5           CALL    BYTOT   ;Datenbyte
          E563 79               LD      A,C
          E564 86               ADD     M       ;Pruefsumme
          E565 4F               LD      C,A     ;nebenher
          E566 23               INC     HL
          E567 10F6             DJNZ    BLKOT
          E569 CD77E5           CALL    BYTOT   ;und ausgeben
          E56C 7A               LD      A,D
          E56D CD8FE5           CALL    HBITOT  ;noch ein
          E570 5D               LD      E,L     ;Knacks
          E571 54               LD      D,H
          E572 3E03             LD      A,3     ;CTC stoppen
          E574 D38D             OUT     8DH
          E576 C9               RET
          E577
          E577          BYTOT   ;Ausgabe eines Bytes
          E577 C5               PUSH    BC
          E578 4F               LD      C,A
          E579 0608             LD      B,8
          E57B CB09     BYTOUT  RRC     C       ;mit Bit0
          E57D 1E17             LD      E,17H   ;beginnend
          E57F D48CE5           CALL    NC,BITOUT
          E582 1E2F             LD      E,2FH   ;Zeitkonstanten
          E584 DC8CE5           CALL    C,BITOUT
          E587 10F2             DJNZ    BYTOUT  ;8*
          E589 C1               POP     BC
          E58A 1E5D     ZTON    LD      E,5DH   ;ZK Trennz.
          E58C CD8FE5   BITOUT  CALL    HBITOT  ;Aufrufen und
          E58F DD7200   HBITOT  LD      (IX),D  ;reinlaufen
          E592 DD7E00   HBIT1   LD      A,(IX)  ;Warten auf
          E595 A7               AND     A       ;Interrupt
          E596 20FA             JR      NZ,HBIT1
          E598 53               LD      D,E
          E599 C9               RET
          E59A
          E59A          ISRI    ;Init. Bandeingabe       **0A**
          E59A CDB6E4           CALL    ISRI1
          E59D                  ;
          E59D          MBI     ;Einlesen 1 Block        **05**
          E59D 3E83             LD      A,83H   ;EI
          E59F D38A             OUT     8AH     ;an PIO A
          E5A1 E5               PUSH    HL
          E5A2 D5               PUSH    DE
          E5A3 0616     MBI1    LD      B,16H
          E5A5 DD360D00         LD      (IX+13),0 ;Pruefsumme=0
          E5A9 CD26E6   MBI2    CALL    STOP1
          E5AC 38F5             JR      C,MBI1
          E5AE FEBA             CP      0BAH
          E5B0 CDF9E5           CALL    LEDOO
          E5B3 38EE             JR      C,MBI1  ;16h korrekte
          E5B5 10F2             DJNZ    MBI2    ;Schwingungen
          E5B7 0602     MBI3    LD      B,2     ;erkennen
          E5B9 AF       MBI4    XOR     A
          E5BA 4F               LD      C,A
          E5BB DD7700           LD      (IX),A
          E5BE CD39E6           CALL    STOP21  ;2 halbe Trenn-
          E5C1 FE5D             CP      5DH     ;zeichen er-
          E5C3 30F2             JR      NC,MBI3 ;kennen
          E5C5 10F2             DJNZ    MBI4
          E5C7 CD45E6           CALL    BYTIN   ;Blocknummer
          E5CA 3825             JR      C,MBI5  ;Stîrung
          E5CC DD7702           LD      (IX+2),A
          E5CF 0680             LD      B,80H
          E5D1 DD6E05           LD      L,(IX+5)
          E5D4 DD6606           LD      H,(IX+6)
          E5D7 CD45E6   BLKIN   CALL    BYTIN   ;Datenbyte
          E5DA 3815             JR      C,MBI5  ;Stîrung
          E5DC 77               LD      M,A
          E5DD DD7E0D           LD      A,(IX+13)
          E5E0 86               ADD     M       ;aufsummieren
          E5E1 DD770D           LD      (IX+13),A
          E5E4 23               INC     HL
          E5E5 10F0             DJNZ    BLKIN
          E5E7 CD45E6           CALL    BYTIN   ;PrÅfsumme
          E5EA 3805             JR      C,MBI5  ;Stîrung
          E5EC DD960D           SUB     (IX+13) ;gleich?
          E5EF C6FF             ADD     0FFH    ;CY:=/Z
          E5F1 D1       MBI5    POP     DE
          E5F2 E1               POP     HL
          E5F3 F3               DI
          E5F4 3E03             LD      A,3     ;DI an PIO A
          E5F6 D38A             OUT     8AH
          E5F8 FB               EI
          E5F9 DB88     LEDOO   IN      A,88H   ;LED ein/aus
          E5FB CBEF             SET     5,A     ;je nach CY
          E5FD 3002             JR      NC,MBI6
          E5FF CBAF             RES     5,A
          E601 D388     MBI6    OUT     88H
          E603 C9               RET
          E604
          E604          ISRC1   ;ISR CTC Kanal 1 (Kassette-Out)
          E604 F5               PUSH    AF
          E605 3E87             LD      A,87H
          E607 D38D             OUT     8DH
          E609 DD7E00           LD      A,(IX)  ;Uebergabezelle
          E60C D38D             OUT     8DH
          E60E DD360000         LD      (IX),0  ;Quittierung
          E612 180E             JR      ISR1E
          E614
          E614          ISRPA   ;ISR PIO Kanal A (Kassette-In)
          E614 F5               PUSH    AF
          E615 DB8E             IN      A,8EH
          E617 DD7700           LD      (IX),A  ;Uebergabezelle
          E61A 3E07             LD      A,7
          E61C D38E             OUT     8EH
          E61E 3EA3             LD      A,0A3H
          E620 D38E             OUT     8EH
          E622 F1       ISR1E   POP     AF
          E623 FB       IRET    EI
          E624 ED4D             RETI
          E626
          E626 DD360000 STOP1   LD      (IX),0  ;1 Bit einlesen
          E62A DB88     STOP11  IN      A,88H   ;PIO-Logik
          E62C D388             OUT     88H     ;freigeben
          E62E DD7E00           LD      A,(IX)  ;Warten auf
          E631 B7               OR      A       ;Interrupt
          E632 28F6             JR      Z,STOP11
          E634 4F               LD      C,A
          E635 DD360000         LD      (IX),0
          E639 DB88     STOP21  IN      A,88H   ;dto.
          E63B D388             OUT     88H,A
          E63D DD7E00           LD      A,(IX)
          E640 B7               OR      A
          E641 28F6             JR      Z,STOP21
          E643 81               ADD     C       ;beide 'Zeiten'
          E644 C9               RET             ;addieren
          E645
          E645          BYTIN   ;Einlesen eines Bytes
          E645                  ;PA: A:Byte, CY=1: Stîrung
          E645 110008           LD      DE,800H
          E648 CD26E6   TRN1    CALL    STOP1
          E64B 3803             JR      C,TRN2
          E64D FEBA             CP      0BAH    ;zu intolerant
          E64F D8               RET     C
          E650 3F       TRN2    CCF
          E651 CB1B             RR      E       ;Bit einschieben
          E653 15               DEC     D
          E654 20F2             JR      NZ,TRN1 ;8*
          E656 CD26E6           CALL    STOP1   ;Trennzeichen
          E659 7B               LD      A,E     ;mit CY-
          E65A C9               RET             ;RÅckmeldung
          E65B
          E65B          ;BASIC:
          E65B
          E65B          BEXP1   ;BASIC-Exp 1
          E65B 78               LD      A,B
          E65C D609             SUB     9
          E65E 384F             JR      C,SNERR1
          E660 FE1B             CP      27
          E662 304B             JR      NC,SNERR1       ;>26
          E664 07               RLCA            ;*2
          E665 4F               LD      C,A
          E666 0600             LD      B,0
          E668 EB               EX      DE,HL
          E669 21C0FD           LD      HL,TOKJP+8
          E66C C3B7C8           JP      0C8B7H  ;RÅcksprung
          E66F
          E66F          BEXP2   ;BASIC-Exp 2
          E66F 7E               LD      A,M
          E670 FEDF             CP      0DFH
          E672 D8               RET     C               ;<DFH
          E673 FEE3             CP      0E3H
          E675 D0               RET     NC              ;>E2H
          E676 FEE1             CP      0E1H    ;AT?
          E678 CAA1EA           JP      Z,PRAT
          E67B 3AFD03           LD      A,(3FDH)
          E67E A7               AND     A       ;PRINT-Erw.?
          E67F 202E             JR      NZ,SNERR1
          E681 3C               INC     A
          E682 32FD03           LD      (3FDH),A
          E685 E5       PREX1   PUSH    HL
          E686 21A3B7           LD      HL,COLOR
          E689 CD9EEC           CALL    IRMRD
          E68C E1               POP     HL
          E68D 327E03           LD      (37EH),A ;Farbe merken
          E690 7E               LD      A,M
          E691 FEDF             CP      0DFH    ;INK?
          E693 281D             JR      Z,PRINK
          E695 FEE2             CP      0E2H    ;COLOR?
          E697 CAA7E6           JP      Z,PRCOL
          E69A CDBDC8           CALL    0C8BDH
          E69D CD1EEB           CALL    PAPER
          E6A0 7E       PREX2   LD      A,M
          E6A1 FE3B             CP      ';'
          E6A3 283D             JR      Z,PREX5
          E6A5 1808             JR      SNERR1
          E6A7
          E6A7 CDBDC8   PRCOL   CALL    0C8BDH
          E6AA CD3AEB           CALL    BCOLOR
          E6AD 18F1             JR      PREX2
          E6AF
          E6AF C348C3   SNERR1  JP      0C348H  ;SN-ERROR
          E6B2
          E6B2 CDBDC8   PRINK   CALL    0C8BDH
          E6B5 CD04EB           CALL    INK
          E6B8 7E               LD      A,M
          E6B9 FE3B             CP      ';'
          E6BB 2825             JR      Z,PREX5
          E6BD CDCCC8           CALL    0C8CCH  ;Komma?
          E6C0 2C               DB      ','
          E6C1 FEE0             CP      0E0H    ;PAPER?
          E6C3 20EA             JR      NZ,SNERR1
          E6C5 CDBDC8           CALL    0C8BDH
          E6C8 CD1EEB           CALL    PAPER
          E6CB CDCCC8           CALL    0C8CCH
          E6CE 3B               DB      ';'
          E6CF CD03CB   PREX3   CALL    0CB03H
          E6D2 3A7E03           LD      A,(37EH)  ;Farbe
          E6D5 E5               PUSH    HL
          E6D6 21A3B7           LD      HL,COLOR
          E6D9 CD9AEC           CALL    IRMWR     ;eintragen
          E6DC E1               POP     HL
          E6DD C1               POP     BC
          E6DE C9               RET
          E6DF C5       PREX4   PUSH    BC
          E6E0 18A3             JR      PREX1
          E6E2 CDBDC8   PREX5   CALL    0C8BDH
          E6E5 18E8             JR      PREX3
          E6E7
          E6E7          BEXP3   ;BASIC-Exp 3
          E6E7 79               LD      A,C
          E6E8 FE62             CP      62H
          E6EA CA55EA           JP      Z,VPEEK
          E6ED FE6E             CP      6EH
          E6EF CAC9EC           JP      Z,PTEST
          E6F2 FE7C             CP      7CH
          E6F4 CAA4ED           JP      Z,CSRLN
          E6F7 FE76             CP      76H
          E6F9 CAC7ED           JP      Z,VGET
          E6FC D63E             SUB     3EH
          E6FE 38AF             JR      C,SNERR1
          E700 FE07             CP      7
          E702 30AB             JR      NC,SNERR1
          E704 EB               EX      DE,HL
          E705 01B8FD           LD      BC,TOKJP ;Tokentab.
          E708 E1               POP     HL
          E709 6F               LD      L,A
          E70A 09               ADD     HL,BC
          E70B 4E               LD      C,M
          E70C 23               INC     HL
          E70D 66               LD      H,M
          E70E 69               LD      L,C
          E70F E5               PUSH    HL      ;Routine
          E710 EB               EX      DE,HL   ;anspringen
          E711 C9               RET
          E712
          E712          STRING  ;String vervielfÑltigen
          E712 CDCCC8           CALL    0C8CCH
          E715 28               DB      '('     ;Klammer auf?
          E716 CD21D4           CALL    0D421H
          E719 F5               PUSH    AF
          E71A CDD6C8           CALL    0C8D6H  ;Komma?
          E71D CD3ACD           CALL    0CD3AH
          E720 CDDBC8           CALL    0C8DBH  ;Klammer zu?
          E723 F1               POP     AF
          E724 E5               PUSH    HL
          E725 F5               PUSH    AF
          E726 CD30D3           CALL    0D330H  ;LÑnge holen
          E729 23               INC     HL
          E72A 23               INC     HL
          E72B 5E               LD      E,M
          E72C 23               INC     HL
          E72D 56               LD      D,M
          E72E C1               POP     BC
          E72F C5               PUSH    BC
          E730 F5               PUSH    AF
          E731 D5               PUSH    DE
          E732 4F               LD      C,A
          E733 AF               XOR     A
          E734 B9               CP      C
          E735 280C             JR      Z,STR2
          E737 B8               CP      B
          E738 2809             JR      Z,STR2
          E73A 79               LD      A,C
          E73B 05               DEC     B
          E73C 2805             JR      Z,STR2
          E73E 81       STR1    ADD     C
          E73F 382B             JR      C,STR5
          E741 10FB             DJNZ    STR1
          E743 47       STR2    LD      B,A
          E744 0E00             LD      C,0
          E746 C5               PUSH    BC
          E747 CDE1D1           CALL    0D1E1H  ;Str.-Arithm.
          E74A C1               POP     BC
          E74B C1               POP     BC
          E74C C5               PUSH    BC
          E74D CD7ED1           CALL    0D17EH
          E750 E1               POP     HL
          E751 E3               EX      (SP),HL
          E752 7C               LD      A,H
          E753 E1               POP     HL
          E754 E3               EX      (SP),HL
          E755 6F               LD      L,A
          E756 24               INC     H
          E757 25       STR3    DEC     H
          E758 E5               PUSH    HL
          E759 C5               PUSH    BC
          E75A 2807             JR      Z,STR4
          E75C CDF2D2           CALL    0D2F2H
          E75F C1               POP     BC
          E760 E1               POP     HL
          E761 18F4             JR      STR3
          E763 C1       STR4    POP     BC
          E764 E1               POP     HL
          E765 D1               POP     DE
          E766 CD02D3           CALL    0D302H
          E769 C3A9D1           JP      0D1A9H
          E76C 1E1C     STR5    LD      E,1CH   ;ST-
          E76E C356C3           JP      0C356H  ;ERROR
          E771
          E771          RENUM   ;neu nummerieren
          E771 E5               PUSH    HL
          E772 210A00           LD      HL,10
          E775 225403           LD      (354H),HL       ;DISTAN
          E778 2A5F03           LD      HL,(35FH)       ;Start
          E77B F5               PUSH    AF
          E77C E5               PUSH    HL
          E77D 23               INC     HL
          E77E 23               INC     HL
          E77F 7E               LD      A,M
          E780 23               INC     HL
          E781 66               LD      H,M
          E782 6F               LD      L,A
          E783 224E03           LD      (34EH),HL       ;ZL-Nr
          E786 225203           LD      (352H),HL       ;NANF
          E789 ED5BD703         LD      DE,(3D7H)       ;Ende
          E78D 1B               DEC     DE
          E78E 1B               DEC     DE
          E78F E1       REN1    POP     HL
          E790 E5               PUSH    HL
          E791 7E               LD      A,M
          E792 23               INC     HL
          E793 66               LD      H,M
          E794 6F               LD      L,A
          E795 CD89C6           CALL    0C689H
          E798 E3               EX      (SP),HL
          E799 20F4             JR      NZ,REN1
          E79B D1               POP     DE
          E79C 23               INC     HL
          E79D 23               INC     HL
          E79E 7E               LD      A,M
          E79F 23               INC     HL
          E7A0 66               LD      H,M
          E7A1 6F               LD      L,A
          E7A2 225003           LD      (350H),HL ;ZL-Abst.
          E7A5 0604             LD      B,4
          E7A7 F1               POP     AF
          E7A8 214E03           LD      HL,34EH
          E7AB E3               EX      (SP),HL
          E7AC 2820     REN2    JR      Z,REN5
          E7AE CD86C9           CALL    0C986H
          E7B1 F5               PUSH    AF
          E7B2 7A               LD      A,D
          E7B3 B3               OR      E
          E7B4 CA67C9   REN3    JP      Z,0C967H  ;FC-ERROR
          E7B7 F1               POP     AF
          E7B8 E3               EX      (SP),HL
          E7B9 73               LD      M,E
          E7BA 23               INC     HL
          E7BB 72               LD      M,D
          E7BC 23               INC     HL
          E7BD 280F             JR      Z,REN5
          E7BF F5               PUSH    AF
          E7C0 05               DEC     B
          E7C1 2807             JR      Z,REN4
          E7C3 F1               POP     AF
          E7C4 E3               EX      (SP),HL
          E7C5 CDD6C8           CALL    0C8D6H  ;Komma?
          E7C8 18E2             JR      REN2
          E7CA F1       REN4    POP     AF
          E7CB C273EA           JP      NZ,SNERR2
          E7CE 2A5003   REN5    LD      HL,(350H)
          E7D1 ED5B4E03         LD      DE,(34EH)
          E7D5 CD89C6           CALL    0C689H
          E7D8 DA67C9   REN6    JP      C,0C967H
          E7DB 2A5F03           LD      HL,(35FH)
          E7DE CDBEC4   REN7    CALL    0C4BEH
          E7E1 3804             JR      C,REN8
          E7E3 28CF             JR      Z,REN3
          E7E5 18F7             JR      REN7
          E7E7 E1       REN8    POP     HL
          E7E8 C5               PUSH    BC
          E7E9 ED5B5003         LD      DE,(350H)
          E7ED 210000           LD      HL,0
          E7F0 225003           LD      (350H),HL
          E7F3 60       REN9    LD      H,B
          E7F4 69               LD      L,C
          E7F5 4E               LD      C,M
          E7F6 23               INC     HL
          E7F7 46               LD      B,M
          E7F8 78               LD      A,B
          E7F9 B1               OR      C
          E7FA 28B8             JR      Z,REN3
          E7FC 23               INC     HL
          E7FD 7E               LD      A,M
          E7FE 23               INC     HL
          E7FF 66               LD      H,M
          E800 6F               LD      L,A
          E801 CD89C6           CALL    0C689H
          E804 2A5003           LD      HL,(350H)
          E807 23               INC     HL
          E808 225003           LD      (350H),HL
          E80B 20E6             JR      NZ,REN9
          E80D 23               INC     HL
          E80E 23               INC     HL
          E80F 29               ADD     HL,HL
          E810 23               INC     HL
          E811 ED5BD703         LD      DE,(3D7H)
          E815 19               ADD     HL,DE
          E816 38C0             JR      C,REN6
          E818 CD27C3           CALL    0C327H  ;genug RAM?
          E81B 22D703           LD      (3D7H),HL
          E81E AF               XOR     A
          E81F 2B               DEC     HL
          E820 77               LD      M,A
          E821 2B               DEC     HL
          E822 77               LD      M,A
          E823 1B               DEC     DE
          E824 1B               DEC     DE
          E825 EB               EX      DE,HL
          E826 73               LD      M,E
          E827 23               INC     HL
          E828 72               LD      M,D
          E829 23               INC     HL
          E82A 3D               DEC     A
          E82B 77               LD      M,A
          E82C 23               INC     HL
          E82D 77               LD      M,A
          E82E 23               INC     HL
          E82F EB               EX      DE,HL
          E830 2A5203           LD      HL,(352H)
          E833 224E03           LD      (34EH),HL
          E836 E1       REN10   POP     HL
          E837 4E               LD      C,M
          E838 23               INC     HL
          E839 46               LD      B,M
          E83A 23               INC     HL
          E83B C5               PUSH    BC
          E83C 014E03           LD      BC,34EH
          E83F 7E               LD      A,M
          E840 12               LD      (DE),A
          E841 0A               LD      A,(BC)
          E842 77               LD      M,A
          E843 23               INC     HL
          E844 13               INC     DE
          E845 03               INC     BC
          E846 7E               LD      A,M
          E847 12               LD      (DE),A
          E848 0A               LD      A,(BC)
          E849 77               LD      M,A
          E84A 13               INC     DE
          E84B 2A4E03           LD      HL,(34EH)
          E84E ED4B5403         LD      BC,(354H)
          E852 09               ADD     HL,BC
          E853 224E03           LD      (34EH),HL
          E856 2A5003           LD      HL,(350H)
          E859 2B               DEC     HL
          E85A 7C               LD      A,H
          E85B B5               OR      L
          E85C 225003           LD      (350H),HL
          E85F 20D5             JR      NZ,REN10
          E861 12               LD      (DE),A
          E862 E1               POP     HL
          E863 2A5F03           LD      HL,(35FH)
          E866 E5               PUSH    HL
          E867 E1       REN11   POP     HL
          E868 4E               LD      C,M
          E869 23               INC     HL
          E86A 46               LD      B,M
          E86B 23               INC     HL
          E86C C5               PUSH    BC
          E86D 7E               LD      A,M
          E86E 23               INC     HL
          E86F A6               AND     M
          E870 3C               INC     A
          E871 2826             JR      Z,REN15
          E873 23       REN12   INC     HL
          E874 7E       REN13   LD      A,M
          E875 B7               OR      A
          E876 28EF             JR      Z,REN11
          E878 FE88             CP      88H     ;GOTO
          E87A 282A             JR      Z,REN16
          E87C FE8C             CP      8CH     ;GOSUB
          E87E 2826             JR      Z,REN16
          E880 FE8B             CP      8BH     ;RESTORE
          E882 2808             JR      Z,REN14
          E884 FED4             CP      0D4H    ;ELSE
          E886 2804             JR      Z,REN14
          E888 FEA9             CP      0A9H    ;THEN
          E88A 20E7             JR      NZ,REN12
          E88C CD87C9   REN14   CALL    0C987H
          E88F 7B               LD      A,E
          E890 B2               OR      D
          E891 C4BAE8           CALL    NZ,RENUP1 ;Vergl.m. Tab.
          E894 C4ECE8           CALL    NZ,RENUP2 ;Zahl Ñndern
          E897 18DB             JR      REN13
          E899 2B       REN15   DEC     HL
          E89A 22D703           LD      (3D7H),HL
          E89D 2B               DEC     HL
          E89E 77               LD      M,A
          E89F 2B               DEC     HL
          E8A0 77               LD      M,A
          E8A1 E1               POP     HL
          E8A2 E1               POP     HL
          E8A3 C38AC4           JP      0C48AH
          E8A6 CD87C9   REN16   CALL    0C987H
          E8A9 7B               LD      A,E
          E8AA B2               OR      D
          E8AB 28C7             JR      Z,REN13
          E8AD CDBAE8           CALL    RENUP1
          E8B0 C4ECE8           CALL    NZ,RENUP2
          E8B3 7E               LD      A,M
          E8B4 FE2C             CP      2CH
          E8B6 20BC             JR      NZ,REN13
          E8B8 18EC             JR      REN16
          E8BA
          E8BA E5       RENUP1  PUSH    HL
          E8BB D5               PUSH    DE
          E8BC 11FFFF           LD      DE,-1
          E8BF CDBBC4           CALL    0C4BBH  ;nÑchste Zeile
          E8C2 D1               POP     DE
          E8C3 03               INC     BC
          E8C4 03               INC     BC
          E8C5 03               INC     BC
          E8C6 03               INC     BC
          E8C7 60               LD      H,B
          E8C8 69               LD      L,C
          E8C9 ED4B5203         LD      BC,(352H)
          E8CD 7E       RUP11   LD      A,M
          E8CE 23               INC     HL
          E8CF E5               PUSH    HL
          E8D0 B6               OR      M
          E8D1 2816             JR      Z,RUP13
          E8D3 7E               LD      A,M
          E8D4 2B               DEC     HL
          E8D5 6E               LD      L,M
          E8D6 67               LD      H,A
          E8D7 CD89C6           CALL    0C689H
          E8DA 280A             JR      Z,RUP12
          E8DC 2A5403           LD      HL,(354H)
          E8DF 09               ADD     HL,BC
          E8E0 44               LD      B,H
          E8E1 4D               LD      C,L
          E8E2 E1               POP     HL
          E8E3 23               INC     HL
          E8E4 18E7             JR      RUP11
          E8E6 3EFF     RUP12   LD      A,0FFH
          E8E8 B7               OR      A
          E8E9 E1       RUP13   POP     HL
          E8EA E1               POP     HL
          E8EB C9               RET
          E8EC
          E8EC C5       RENUP2  PUSH    BC
          E8ED EB               EX      DE,HL
          E8EE 2AD703           LD      HL,(3D7H)
          E8F1 ED52             SBC     HL,DE
          E8F3 E5               PUSH    HL
          E8F4 C1       RUP21   POP     BC
          E8F5 62               LD      H,D
          E8F6 6B               LD      L,E
          E8F7 1B               DEC     DE
          E8F8 1A               LD      A,(DE)
          E8F9 FE2C             CP      ','
          E8FB 280B             JR      Z,RUP22
          E8FD FE3A             CP      ':'
          E8FF 3007             JR      NC,RUP22
          E901 C5               PUSH    BC
          E902 D5               PUSH    DE
          E903 EDB0             LDIR
          E905 D1               POP     DE
          E906 18EC             JR      RUP21
          E908 EB       RUP22   EX      DE,HL
          E909 D1               POP     DE
          E90A E5               PUSH    HL
          E90B C5               PUSH    BC
          E90C AF               XOR     A
          E90D 0698             LD      B,98H
          E90F CDAED6           CALL    0D6AEH
          E912 CD34D8           CALL    0D834H
          E915 C1               POP     BC
          E916 D1               POP     DE
          E917 23               INC     HL
          E918 13               INC     DE
          E919 7E       RUP23   LD      A,M
          E91A B7               OR      A
          E91B 280F             JR      Z,RUP24
          E91D C5               PUSH    BC
          E91E E5               PUSH    HL
          E91F EB               EX      DE,HL
          E920 09               ADD     HL,BC
          E921 54               LD      D,H
          E922 5D               LD      E,L
          E923 2B               DEC     HL
          E924 EDB8             LDDR
          E926 E1               POP     HL
          E927 EDA0             LDI
          E929 C1               POP     BC
          E92A 18ED             JR      RUP23
          E92C D5       RUP24   PUSH    DE
          E92D ED5B5F03         LD      DE,(35FH)
          E931 CD93C4           CALL    0C493H
          E934 23       RUP25   INC     HL
          E935 7E               LD      A,M
          E936 23               INC     HL
          E937 B6               OR      M
          E938 20FA             JR      NZ,RUP25
          E93A EB               EX      DE,HL
          E93B 73               LD      M,E
          E93C 23               INC     HL
          E93D 72               LD      M,D
          E93E 13               INC     DE
          E93F 13               INC     DE
          E940 ED53D703         LD      (3D7H),DE
          E944 E1               POP     HL
          E945 54               LD      D,H
          E946 5D               LD      E,L
          E947 7E       RUP26   LD      A,M
          E948 B7               OR      A
          E949 23               INC     HL
          E94A 20FB             JR      NZ,RUP26
          E94C C1               POP     BC
          E94D E3               EX      (SP),HL
          E94E C5               PUSH    BC
          E94F EB               EX      DE,HL
          E950 C9               RET
          E951
          E951          DELETE  ;Zeile(n) lîschen
          E951 C8               RET     Z
          E952 CD86C9           CALL    0C986H
          E955 CA42C4           JP      Z,0C442H
          E958 CDD6C8           CALL    0C8D6H
          E95B D5               PUSH    DE
          E95C CD86C9           CALL    0C986H
          E95F E1               POP     HL
          E960 C0               RET     NZ
          E961 EB               EX      DE,HL
          E962 E5               PUSH    HL
          E963 CDBBC4           CALL    0C4BBH  ;nÑchste Zeile
          E966 D24DC4           JP      NC,0C44DH ;UL-ERROR
          E969 D1               POP     DE
          E96A F5               PUSH    AF
          E96B C5               PUSH    BC
          E96C CDBEC4           CALL    0C4BEH
          E96F D24DC4           JP      NC,0C44DH ;UL-ERROR
          E972 C1               POP     BC
          E973 C350C4           JP      0C450H  ;einsortieren
          E976
          E976          PAUSE   ;Programm unterbrechen
          E976 CDBEC8           CALL    0C8BEH
          E979 200F             JR      NZ,PAUS2
          E97B CD98E4   PAUS1   CALL    KBDS
          E97E 30FB             JR      NC,PAUS1
          E980 FE03             CP      3       ;BRK?
          E982 C8               RET     Z
          E983 FE0A             CP      LF      ;CUU?
          E985 20F4             JR      NZ,PAUS1
          E987 C3E4DD           JP      0DDE4H  ;Eingabe ASCII
          E98A CD21D4   PAUS2   CALL    0D421H
          E98D 4F               LD      C,A
          E98E 3E10     PAUS3   LD      A,10H   ;96 sek.
          E990 1E14             LD      E,14H   ;WAIT
          E992 CD15F0           CALL    0F015H  ;PV5
          E995          ;       PUSH    BC
          E995 CD98E4           CALL    KBDS
          E998          ;       POP     BC
          E998 300A             JR      NC,PAUS4
          E99A FE03             CP      3       ;BRK?
          E99C C8               RET     Z
          E99D FE0A             CP      LF      ;CUU?
          E99F 2003             JR      NZ,PAUS4
          E9A1 C3E4DD           JP      0DDE4H  ;Eingabe ASCII
          E9A4 0D       PAUS4   DEC     C
          E9A5 20E7             JR      NZ,PAUS3
          E9A7 C9               RET
          E9A8
          E9A8          BBEEP   ;Signalton
          E9A8 0601             LD      B,1     ;ohne Angabe 1x
          E9AA CDBEC8           CALL    0C8BEH
          E9AD 2804             JR      Z,BBP1
          E9AF CD21D4           CALL    0D421H
          E9B2 47               LD      B,A     ;Anzahl
          E9B3 3E07     BBP1    LD      A,7     ;Beep
          E9B5 1E00             LD      E,0     ;CRT
          E9B7 CD15F0           CALL    0F015H  ;PV5
          E9BA 10F7             DJNZ    BBP1
          E9BC C9               RET
          E9BD
          E9BD          WINDOW  ;Fenster einstellen
          E9BD CDBEC8           CALL    0C8BEH
          E9C0 2865             JR      Z,WINDOW1
          E9C2 E5               PUSH    HL
          E9C3 CD21D4           CALL    0D421H
          E9C6 E3               EX      (SP),HL     ;in
          E9C7 21F6B9           LD      HL,WNDFN+90 ;Fenster 9
          E9CA CD9AEC           CALL    IRMWR       ;erstellen
          E9CD 23               INC     HL
          E9CE E3               EX      (SP),HL
          E9CF CDD6C8           CALL    0C8D6H
          E9D2 CD21D4           CALL    0D421H
          E9D5 E3               EX      (SP),HL
          E9D6 CD9AEC           CALL    IRMWR
          E9D9 23               INC     HL
          E9DA E3               EX      (SP),HL
          E9DB CDD6C8           CALL    0C8D6H
          E9DE CD21D4           CALL    0D421H
          E9E1 E3               EX      (SP),HL
          E9E2 CD9AEC           CALL    IRMWR
          E9E5 E3               EX      (SP),HL
          E9E6 CDD6C8           CALL    0C8D6H
          E9E9 CD21D4           CALL    0D421H
          E9EC E3               EX      (SP),HL
          E9ED 57               LD      D,A
          E9EE CD18F0           CALL    0F018H  ;IRMON
          E9F1 FE28             CP      28H
          E9F3 304D             JR      NC,WINERR
          E9F5 3AF8B9           LD      A,(WNDFN+92)
          E9F8 5F               LD      E,A
          E9F9 FE28             CP      28H
          E9FB 3045             JR      NC,WINERR
          E9FD 7A               LD      A,D
          E9FE 93               SUB     E
          E9FF 3841             JR      C,WINERR
          EA01 3C               INC     A
          EA02 329EB7           LD      (WINLG),A
          EA05 7B               LD      A,E
          EA06 329CB7           LD      (WINON),A
          EA09 3AF7B9           LD      A,(WNDFN+91)
          EA0C FE20             CP      20H
          EA0E 3032             JR      NC,WINERR
          EA10 57               LD      D,A
          EA11 3AF6B9           LD      A,(WNDFN+90)
          EA14 FE20             CP      20H
          EA16 302A             JR      NC,WINERR
          EA18 5F               LD      E,A
          EA19 7A               LD      A,D
          EA1A 93               SUB     E
          EA1B 3825             JR      C,WINERR
          EA1D 3C               INC     A
          EA1E 329FB7           LD      (WINLG+1),A
          EA21 7B               LD      A,E
          EA22 329DB7           LD      (WINON+1),A
          EA25 1810             JR      WINDOW2
          EA27 E5       WINDOW1 PUSH    HL
          EA28 CD18F0           CALL    0F018H  ;IRMON
          EA2B 210001           LD      HL,100H
          EA2E 229CB7           LD      (WINON),HL
          EA31 21281E           LD      HL,1E28H
          EA34 229EB7           LD      (WINLG),HL
          EA37 210000   WINDOW2 LD      HL,0
          EA3A 22A0B7           LD      (CURSO),HL
          EA3D CD1BF0           CALL    0F01BH  ;IRMOF
          EA40 E1               POP     HL
          EA41 C9               RET
          EA42 CD1BF0   WINERR  CALL    0F01BH  ;IRMOF
          EA45 182C             JR      SNERR2
          EA47
          EA47          BLOAD   ;MC-Programm laden
          EA47 E5               PUSH    HL
          EA48 2181B7           LD      HL,ARGN
          EA4B AF               XOR     A
          EA4C CD9AEC           CALL    IRMWR   ;ARGN=0
          EA4F E1               POP     HL
          EA50 1E10             LD      E,10H   ;LOAD
          EA52 C315F0           JP      0F015H  ;PV5
          EA55
          EA55 CDE1CD   VPEEK   CALL    0CDE1H
          EA58 E3               EX      (SP),HL
          EA59 11F3CD           LD      DE,0CDF3H ;RET-Adr.
          EA5C D5               PUSH    DE
          EA5D CD6FC9           CALL    0C96FH
          EA60 E5               PUSH    HL
          EA61 210080           LD      HL,8000H;IRM-Offset
          EA64 19               ADD     HL,DE
          EA65 3803             JR      C,VPK   ;Error
          EA67 3EBF             LD      A,0BFH
          EA69 BC               CP      H
          EA6A 3807     VPK     JR      C,SNERR2
          EA6C CD9EEC           CALL    IRMRD
          EA6F E1               POP     HL
          EA70 C3E9D3           JP      0D3E9H
          EA73
          EA73 C348C3   SNERR2  JP      0C348H  ;SN-ERROR
          EA76
          EA76          VPOKE   ;in IRM schreiben
          EA76 CD6CC9           CALL    0C96CH
          EA79 D5               PUSH    DE
          EA7A CDD6C8           CALL    0C8D6H
          EA7D CD21D4           CALL    0D421H
          EA80 E3               EX      (SP),HL
          EA81 110080           LD      DE,8000H;IRM-Offset
          EA84 19               ADD     HL,DE
          EA85 38E3             JR      C,VPK   ;Error
          EA87 57               LD      D,A
          EA88 3EBF             LD      A,0BFH
          EA8A BC               CP      H
          EA8B 38DD             JR      C,VPK   ;nur bis BFFFH
          EA8D 7A               LD      A,D
          EA8E CD9AEC           CALL    IRMWR   ;schreiben
          EA91 E1               POP     HL
          EA92 C9               RET
          EA93
          EA93          BORDER  ;schaltet RAM-8!
          EA93 CD21D4           CALL    0D421H
          EA96 0F               RRCA
          EA97 0F               RRCA
          EA98 0F               RRCA
          EA99 E660             AND     60H     ;Auswahl
          EA9B 4F               LD      C,A
          EA9C 069F             LD      B,9FH   ;Maske
          EA9E C3DEF8           JP      TONB
          EAA1
          EAA1          PRAT    ;PRINT AT
          EAA1 3AFD03           LD      A,(3FDH)
          EAA4 CB4F             BIT     1,A
          EAA6 CBCF             SET     1,A
          EAA8 32FD03           LD      (3FDH),A
          EAAB 20C6             JR      NZ,SNERR2
          EAAD D5               PUSH    DE
          EAAE E5               PUSH    HL
          EAAF CD18F0           CALL    0F018H  ;IRMON
          EAB2 219CB7           LD      HL,WINON
          EAB5 22F6B9           LD      (WNDFN+90),HL
          EAB8 11ECB9           LD      DE,WNDFN+80
          EABB 010600           LD      BC,6    ;Fenster
          EABE EDB0             LDIR            ;retten
          EAC0 210000           LD      HL,0    ;Fenster gro·
          EAC3 229CB7           LD      (WINON),HL
          EAC6 212820           LD      HL,2028H
          EAC9 229EB7           LD      (WINLG),HL
          EACC CD1BF0           CALL    0F01BH  ;IRMOF
          EACF E1               POP     HL
          EAD0 CD4BEB           CALL    LOCAT
          EAD3 CDDBC8           CALL    0C8DBH
          EAD6 CDCCC8           CALL    0C8CCH
          EAD9 3B               DB      ';'
          EADA 7E               LD      A,M
          EADB FEDF             CP      0DFH
          EADD 381D             JR      C,PRAT2 ;<DFH
          EADF FEE3             CP      0E3H
          EAE1 3019             JR      NC,PRAT2;>E2H
          EAE3 CDDFE6           CALL    PREX4   ;INK,PAPER,COLOR
          EAE6 E5       PRAT1   PUSH    HL
          EAE7 CD18F0           CALL    0F018H  ;IRMON
          EAEA 21ECB9           LD      HL,WNDFN+80
          EAED 119CB7           LD      DE,WINON
          EAF0 010600           LD      BC,6    ;Fenster
          EAF3 EDB0             LDIR            ;regenerieren
          EAF5 CD1BF0           CALL    0F01BH  ;IRMOF
          EAF8 E1               POP     HL
          EAF9 D1               POP     DE
          EAFA C1               POP     BC
          EAFB C9               RET
          EAFC CD03CB   PRAT2   CALL    0CB03H
          EAFF 18E5             JR      PRAT1
          EB01
          EB01 C348C3   SNERR3  JP      0C348H  ;SN-ERROR
          EB04
          EB04 CD21D4   INK     CALL    0D421H
          EB07 FE20             CP      32
          EB09 30F6             JR      NC,SNERR3
          EB0B CB27             SLA     A
          EB0D CB27             SLA     A
          EB0F CB27             SLA     A
          EB11 57               LD      D,A
          EB12 E5               PUSH    HL
          EB13 21A3B7           LD      HL,COLOR
          EB16 CD9EEC           CALL    IRMRD
          EB19 E1               POP     HL
          EB1A E607             AND     7
          EB1C 1812             JR      COL2
          EB1E
          EB1E CD21D4   PAPER   CALL    0D421H
          EB21 FE08     COL1    CP      8
          EB23 30DC             JR      NC,SNERR3
          EB25 57               LD      D,A
          EB26 E5               PUSH    HL
          EB27 21A3B7           LD      HL,COLOR
          EB2A CD9EEC           CALL    IRMRD
          EB2D E1               POP     HL
          EB2E E6F8             AND     0F8H
          EB30 B2       COL2    OR      D
          EB31 E5               PUSH    HL
          EB32 21A3B7           LD      HL,COLOR
          EB35 CD9AEC           CALL    IRMWR   ;neuer Farbwert
          EB38 E1               POP     HL
          EB39 C9               RET
          EB3A
          EB3A CDBEC8   BCOLOR  CALL    0C8BEH
          EB3D 28C2             JR      Z,SNERR3
          EB3F CD04EB           CALL    INK     ;Vordergrund
          EB42 CDBEC8           CALL    0C8BEH
          EB45 C8               RET     Z
          EB46 CDD6C8           CALL    0C8D6H
          EB49 18D3             JR      PAPER   ;Hintergrund
          EB4B
          EB4B          LOCAT   ;Cursor positionieren
          EB4B CDBDC8           CALL    0C8BDH
          EB4E CDCCC8           CALL    0C8CCH
          EB51 28               DB      '('
          EB52 CD21D4   LOCATE  CALL    0D421H
          EB55 57               LD      D,A
          EB56 E5               PUSH    HL
          EB57 219FB7           LD      HL,WINLG+1
          EB5A CD9EEC           CALL    IRMRD
          EB5D E1               POP     HL
          EB5E 3D               DEC     A
          EB5F BA               CP      D
          EB60 389F             JR      C,SNERR3
          EB62 CDD6C8           CALL    0C8D6H
          EB65 D5               PUSH    DE
          EB66 CD21D4           CALL    0D421H
          EB69 D1               POP     DE
          EB6A 4F               LD      C,A
          EB6B E5               PUSH    HL
          EB6C 219EB7           LD      HL,WINLG
          EB6F CD9EEC           CALL    IRMRD
          EB72 E1               POP     HL
          EB73 3D               DEC     A
          EB74 B9               CP      C
          EB75 388A             JR      C,SNERR3
          EB77 79               LD      A,C
          EB78 E5               PUSH    HL
          EB79 21A0B7           LD      HL,CURSO
          EB7C CD9AEC           CALL    IRMWR
          EB7F 7A               LD      A,D
          EB80 23               INC     HL
          EB81 CD9AEC   LOC1    CALL    IRMWR
          EB84 E1               POP     HL
          EB85 C9               RET
          EB86
          EB86          INKEY   ;Eingabe ein Zeichen
          EB86 E5               PUSH    HL
          EB87 CD98E4           CALL    KBDS
          EB8A 300F             JR      NC,INKEY3
          EB8C 3E01             LD      A,1
          EB8E CD7BD1           CALL    0D17BH
          EB91 CDE4DD           CALL    0DDE4H  ;Eingabe ASCII
          EB94 2AC203   INKEY1  LD      HL,(3C2H)
          EB97 77               LD      M,A
          EB98 C3A9D1   INKEY2  JP      0D1A9H
          EB9B AF       INKEY3  XOR     A
          EB9C CD7BD1           CALL    0D17BH
          EB9F 18F7             JR      INKEY2
          EBA1
          EBA1          SOUND   ;Tonausgabe
          EBA1 CD21D4           CALL    0D421H
          EBA4 E5               PUSH    HL
          EBA5 2182B7           LD      HL,ARG1
          EBA8 0604             LD      B,4     ;4 Argumente
          EBAA CD9AEC   SOUND1  CALL    IRMWR
          EBAD 23               INC     HL
          EBAE E3               EX      (SP),HL
          EBAF 05               DEC     B
          EBB0 280B             JR      Z,SOUND2
          EBB2 C5               PUSH    BC
          EBB3 CDD6C8           CALL    0C8D6H
          EBB6 CD21D4           CALL    0D421H
          EBB9 C1               POP     BC
          EBBA E3               EX      (SP),HL
          EBBB 18ED             JR      SOUND1
          EBBD CDBEC8   SOUND2  CALL    0C8BEH
          EBC0 281C             JR      Z,SOUND3
          EBC2 CDD6C8           CALL    0C8D6H
          EBC5 CD21D4           CALL    0D421H
          EBC8 E3               EX      (SP),HL
          EBC9 CD9AEC           CALL    IRMWR
          EBCC 23               INC     HL
          EBCD E3               EX      (SP),HL
          EBCE CDBEC8           CALL    0C8BEH
          EBD1 280B             JR      Z,SOUND3
          EBD3 CDD6C8           CALL    0C8D6H
          EBD6 CD21D4           CALL    0D421H
          EBD9 E3               EX      (SP),HL
          EBDA CD9AEC           CALL    IRMWR
          EBDD E3               EX      (SP),HL
          EBDE 1E35     SOUND3  LD      E,35H   ;TON
          EBE0 C1               POP     BC
          EBE1 C315F0           JP      0F015H  ;PV5
          EBE4
          EBE4          PSET    ;Punkt setzen
          EBE4 0601             LD      B,1     ;setzen
          EBE6 C5       POINT   PUSH    BC
          EBE7 CD6CC9           CALL    0C96CH
          EBEA E5               PUSH    HL
          EBEB 7B               LD      A,E
          EBEC 21D3B7           LD      HL,HOR
          EBEF CD9AEC           CALL    IRMWR
          EBF2 7A               LD      A,D
          EBF3 23               INC     HL
          EBF4 CD9AEC           CALL    IRMWR
          EBF7 E3               EX      (SP),HL
          EBF8 CDD6C8           CALL    0C8D6H
          EBFB CD21D4           CALL    0D421H
          EBFE E3               EX      (SP),HL
          EBFF 23               INC     HL
          EC00 CD9AEC           CALL    IRMWR
          EC03 E1               POP     HL
          EC04 CD19EC           CALL    GFARB
          EC07 1E30             LD      E,30H   ;PUSE
          EC09 C1               POP     BC
          EC0A 05               DEC     B
          EC0B 2801             JR      Z,POINT2
          EC0D 1D               DEC     E       ;PUDE
          EC0E CD15F0   POINT2  CALL    0F015H  ;PV1
          EC11 DA73EA           JP      C,SNERR2
          EC14 C9               RET
          EC15
          EC15          PRESET  ;Punkt lîschen
          EC15 0600             LD      B,0     ;lîschen
          EC17 18CD             JR      POINT
          EC19
          EC19 CDBEC8   GFARB   CALL    0C8BEH
          EC1C C8               RET     Z
          EC1D CDD6C8           CALL    0C8D6H
          EC20 CD21D4           CALL    0D421H
          EC23 E5               PUSH    HL
          EC24 21D6B7           LD      HL,FARB ;Grafik-Farbe
          EC27 17               RLA
          EC28 17               RLA
          EC29 17               RLA
          EC2A C381EB           JP      LOC1    ;in IRM schreib.
          EC2D
          EC2D          INSTR   ;String1 in String2 suchen
          EC2D CD36CD           CALL    0CD36H  ;Klammer auf?
          EC30 CDD6C8           CALL    0C8D6H
          EC33 E5               PUSH    HL
          EC34 CD30D3           CALL    0D330H
          EC37 2838             JR      Z,INSTR4
          EC39 47               LD      B,A
          EC3A 23               INC     HL
          EC3B 23               INC     HL
          EC3C 5E               LD      E,M
          EC3D 23               INC     HL
          EC3E 56               LD      D,M
          EC3F E1               POP     HL
          EC40 D5               PUSH    DE
          EC41 C5               PUSH    BC
          EC42 CD3ACD           CALL    0CD3AH
          EC45 CDDBC8           CALL    0C8DBH  ;Klammer zu?
          EC48 C1               POP     BC
          EC49 D1               POP     DE
          EC4A E5               PUSH    HL
          EC4B D5               PUSH    DE
          EC4C C5               PUSH    BC
          EC4D CD30D3           CALL    0D330H
          EC50 281F             JR      Z,INSTR4
          EC52 23               INC     HL
          EC53 23               INC     HL
          EC54 4E               LD      C,M
          EC55 23               INC     HL
          EC56 66               LD      H,M
          EC57 69               LD      L,C
          EC58 C1               POP     BC
          EC59 4F               LD      C,A
          EC5A D1               POP     DE
          EC5B E5               PUSH    HL
          EC5C C5       INSTR0  PUSH    BC
          EC5D D5               PUSH    DE
          EC5E 1A               LD      A,(DE)
          EC5F BE       INSTR1  CP      M
          EC60 2812             JR      Z,INSTR5
          EC62 23               INC     HL
          EC63 0D               DEC     C
          EC64 20F9             JR      NZ,INSTR1
          EC66 AF       INSTR2  XOR     A
          EC67 E1               POP     HL
          EC68 E1               POP     HL
          EC69 E1               POP     HL
          EC6A 11F3CD   INSTR3  LD      DE,0CDF3H ;RET-Adr.
          EC6D D5               PUSH    DE
          EC6E C3C0D0           JP      0D0C0H
          EC71 C367C9   INSTR4  JP      0C967H  ;FC-ERROR
          EC74 23       INSTR5  INC     HL
          EC75 E5               PUSH    HL
          EC76 2B               DEC     HL
          EC77 23       INSTR6  INC     HL
          EC78 0D               DEC     C
          EC79 280E             JR      Z,INSTR7
          EC7B 13               INC     DE
          EC7C 05               DEC     B
          EC7D 2811             JR      Z,INSTR8
          EC7F 1A               LD      A,(DE)
          EC80 BE               CP      M
          EC81 28F4             JR      Z,INSTR6
          EC83 E1               POP     HL
          EC84 D1               POP     DE
          EC85 C1               POP     BC
          EC86 0D               DEC     C
          EC87 18D3             JR      INSTR0
          EC89 13       INSTR7  INC     DE
          EC8A 05               DEC     B
          EC8B E1               POP     HL
          EC8C 20D8             JR      NZ,INSTR2
          EC8E 1801             JR      INSTR9
          EC90 E1       INSTR8  POP     HL
          EC91 D1       INSTR9  POP     DE
          EC92 D1               POP     DE
          EC93 D1               POP     DE
          EC94 A7               AND     A
          EC95 ED52             SBC     HL,DE
          EC97 7D               LD      A,L
          EC98 18D0             JR      INSTR3
          EC9A
          EC9A 1E28     IRMWR   LD      E,28H   ;LDMA
          EC9C 180D             JR      JPV5
          EC9E
          EC9E 1E29     IRMRD   LD      E,29H   ;LDAM
          ECA0 1809             JR      JPV5
          ECA2
          ECA2          BKEY    ;F-Taste belegen
          ECA2 CD21D4           CALL    0D421H
          ECA5 FE10             CP      16      ;F0 ... F15
          ECA7 3052             JR      NC,SNERR4
          ECA9 1E39             LD      E,39H   ;KEY
          ECAB C315F0   JPV5    JP      0F015H  ;PV5
          ECAE
          ECAE          KEYLIST ;F-Tasten auflisten
          ECAE 1E3A             LD      E,3AH   ;KEYLI
          ECB0 18F9             JR      JPV5
          ECB2
          ECB2          SWITCH  ;Module schalten
          ECB2 CD21D4           CALL    0D421H
          ECB5 F5               PUSH    AF
          ECB6 CDD6C8           CALL    0C8D6H
          ECB9 CD21D4           CALL    0D421H
          ECBC 57               LD      D,A     ;Steuerbyte
          ECBD F1               POP     AF
          ECBE E5               PUSH    HL
          ECBF 6F               LD      L,A     ;Steckplatz
          ECC0 3E02             LD      A,2     ;schalten
          ECC2 1E26             LD      E,26H   ;MODU
          ECC4 CD15F0           CALL    0F015H  ;PV5
          ECC7 E1               POP     HL
          ECC8 C9               RET
          ECC9
          ECC9 CDE1CD   PTEST   CALL    0CDE1H
          ECCC E3               EX      (SP),HL
          ECCD 11F3CD           LD      DE,0CDF3H ;RET-Adr.
          ECD0 D5               PUSH    DE
          ECD1 CD6FC9           CALL    0C96FH
          ECD4 E5               PUSH    HL
          ECD5 7B               LD      A,E     ;nur
          ECD6 21D3B7           LD      HL,HOR  ;X-Koordinate
          ECD9 CD9AEC           CALL    IRMWR   ;eintragen
          ECDC 7A               LD      A,D
          ECDD 23               INC     HL      ;Y-Koordinate
          ECDE CD9AEC           CALL    IRMWR
          ECE1 1E2F             LD      E,2FH   ;PUDE
          ECE3 CD15F0           CALL    0F015H  ;PV5
          ECE6 0600             LD      B,0
          ECE8 280C             JR      Z,PTST1 ;war gelîscht
          ECEA 23               INC     HL
          ECEB 23               INC     HL
          ECEC CD9AEC           CALL    IRMWR   ;Grafikfarbe
          ECEF 1E30             LD      E,30H   ;PUSE
          ECF1 CD15F0           CALL    0F015H  ;PV5
          ECF4 0601             LD      B,1
          ECF6 78       PTST1   LD      A,B     ;RÅckgabewert
          ECF7 E1               POP     HL
          ECF8 C3E9D3           JP      0D3E9H
          ECFB
          ECFB C348C3   SNERR4  JP      0C348H  ;SN-ERROR
          ECFE
          ECFE          CLOSE   ;Kanal schlie·en
          ECFE 0E00             LD      C,0
          ED00 7E               LD      A,M
          ED01 FE49             CP      'I'     ;Eingabe?
          ED03 2805             JR      Z,CLOS1
          ED05 0C               INC     C
          ED06 FE4F             CP      'O'     ;Ausgabe?
          ED08 20F1             JR      NZ,SNERR4
          ED0A C5       CLOS1   PUSH    BC
          ED0B 23               INC     HL
          ED0C 7E               LD      A,M
          ED0D FE23             CP      '#'
          ED0F 20EA     CLOS2   JR      NZ,SNERR4
          ED11 23               INC     HL
          ED12 CD21D4           CALL    0D421H
          ED15 E603             AND     3       ;4 GerÑte
          ED17 C1               POP     BC
          ED18 C8               RET     Z       ;Console
          ED19 E5               PUSH    HL
          ED1A 17               RLA             ;*2
          ED1B 81               ADD     C       ;Ein-/Ausgabe
          ED1C F5               PUSH    AF
          ED1D 3D               DEC     A
          ED1E 47               LD      B,A
          ED1F 3EFF             LD      A,-1
          ED21 17       CLOS3   RLA             ;Bit platzieren
          ED22 10FD             DJNZ    CLOS3
          ED24 210703           LD      HL,307H ;E/A-Flag
          ED27 A6               AND     M       ;Bit lîschen
          ED28 77               LD      M,A
          ED29 F1               POP     AF
          ED2A E1               POP     HL
          ED2B CBF7             SET     6,A     ;close
          ED2D D5               PUSH    DE
          ED2E 5F               LD      E,A
          ED2F 1603             LD      D,3
          ED31 CD0EE0           CALL    BASIO
          ED34 D1               POP     DE
          ED35 C9               RET
          ED36
          ED36          RANDOM  ;Zufallsgenerator
          ED36 ED5F             LD      A,R
          ED38 321D03           LD      (31DH),A
          ED3B C9               RET
          ED3C
          ED3C          OPEN    ;Kanal îffnen
          ED3C 7E               LD      A,M
          ED3D 23               INC     HL
          ED3E FE49             CP      'I'     ;Eingabe?
          ED40 2819             JR      Z,OPEN1
          ED42 FE4F             CP      'O'     ;Ausgabe?
          ED44 20C9             JR      NZ,CLOS2;SNERR
          ED46 CD25DE           CALL    0DE25H
          ED49 CDC8DD           CALL    0DDC8H
          ED4C C8               RET     Z
          ED4D 3ED5             LD      A,0D5H
          ED4F CDB2DC           CALL    0DCB2H
          ED52 21EA03           LD      HL,3EAH ;Druckpuffer
          ED55 AF               XOR     A
          ED56 CDD5DD           CALL    0DDD5H
          ED59 E1               POP     HL
          ED5A C9               RET
          ED5B CD5FDE   OPEN1   CALL    0DE5FH  ;Eingabe
          ED5E 3A0903           LD      A,(309H);IN-Index
          ED61 E603             AND     3
          ED63 C8               RET     Z
          ED64 3ED5             LD      A,0D5H
          ED66 CDB2DC           CALL    0DCB2H
          ED69 21EA03           LD      HL,3EAH ;Druckuffer
          ED6C CDE4DD           CALL    0DDE4H  ;Eingabe ASCII
          ED6F E1               POP     HL
          ED70 C9               RET
          ED71
          ED71          BLINE   ;Linie zeichnen
          ED71 013E04           LD      BC,43EH ;4 Par.,LINE
          ED74 1803             JR      GRAPH
          ED76
          ED76          CIRCLE  ;Kreis zeichnen
          ED76 013F03           LD      BC,33FH ;3 Par.,CIRCLE
          ED79 C5       GRAPH   PUSH    BC
          ED7A CD6CC9           CALL    0C96CH
          ED7D C1               POP     BC
          ED7E C5               PUSH    BC
          ED7F E5               PUSH    HL
          ED80 2182B7           LD      HL,ARG1
          ED83 7B       GRAPH1  LD      A,E
          ED84 CD9AEC           CALL    IRMWR
          ED87 23               INC     HL
          ED88 7A               LD      A,D
          ED89 CD9AEC           CALL    IRMWR
          ED8C 23               INC     HL
          ED8D 05               DEC     B
          ED8E 280C             JR      Z,GRAPH2
          ED90 E3               EX      (SP),HL
          ED91 C5               PUSH    BC
          ED92 CDD6C8           CALL    0C8D6H
          ED95 CD6CC9           CALL    0C96CH
          ED98 C1               POP     BC
          ED99 E3               EX      (SP),HL
          ED9A 18E7             JR      GRAPH1
          ED9C E1       GRAPH2  POP     HL
          ED9D CD19EC           CALL    GFARB
          EDA0 D1               POP     DE
          EDA1 C315F0           JP      0F015H  ;PV5
          EDA4
          EDA4          CSRLN   ;akt. Zeile holen
          EDA4 CDE1CD           CALL    0CDE1H
          EDA7 E3               EX      (SP),HL
          EDA8 11F3CD           LD      DE,0CDF3H ;RET-Adr.
          EDAB D5               PUSH    DE
          EDAC CD24D4           CALL    0D424H
          EDAF E5               PUSH    HL
          EDB0 A7               AND     A
          EDB1 3E00             LD      A,0
          EDB3 2006             JR      NZ,CSRLN1
          EDB5 219DB7           LD      HL,WINON+1
          EDB8 CD9EEC           CALL    IRMRD
          EDBB 47       CSRLN1  LD      B,A
          EDBC 21A1B7           LD      HL,CURSO+1
          EDBF CD9EEC           CALL    IRMRD
          EDC2 80               ADD     B       ;akt. Zeile
          EDC3 E1               POP     HL
          EDC4 C3E9D3           JP      0D3E9H
          EDC7
          EDC7          VGET    ;Zeichen von Bildschirm lesen
          EDC7 E3               EX      (SP),HL
          EDC8 3E01             LD      A,1
          EDCA CD7BD1           CALL    0D17BH
          EDCD CD18F0           CALL    0F018H  ;IRMON
          EDD0 ED5BA0B7         LD      DE,(CURSO)
          EDD4 CD7CE0           CALL    DABR
          EDD7 7E               LD      A,M
          EDD8 CD1BF0           CALL    0F01BH  ;IRMOF
          EDDB C394EB           JP      INKEY1  ;als Zeichen
          EDDE                                  ;zurÅckgeben
          EDDE
          EDDE          ESCTAB  ;ESC-Tabelle
          EDDE 2DE2             DW      ESC0    ;Tabulator
          EDE0 F9F8             DW      ESC1    ;Anz0   Zugr0
          EDE2 FEF8             DW      ESC2    ;1      1
          EDE4 03F9             DW      ESC3    ;0      1
          EDE6 08F9             DW      ESC4    ;1      0
          EDE8 E6F0             DW      ESC5    ;MODUL
          EDEA 16F8             DW      ESC6    ;SYSTEM
          EDEC 20F9             DW      ESC7    ;PixInvers o/o
          EDEE CCE3             DW      ESC8    ;ColSwap o/o
          EDF0 29F9             DW      ESC9    ;Farbebene o/o
          EDF2 31F9             DW      ESCA    ;HiRes o/o
          EDF4 4CF9             DW      ESCB    ;HRG o/o
          EDF6 53F9             DW      ESCC    ;IBM/CAOS
          EDF8
          EDF8          FREIE   EQU     $
          EDF8 FFFFFFFF         DS      0EDFFH-$,0FFH   ;frei
          EDFF
          EDFF 44       VERSION DB      44H     ;CAOS-Version
          EE00
          EE00                  END

        Errors: 0000
        End+1 : EE00

          0200
          0200          ;**     CAOS 4.4 ROM F          **
          0200          ;       (09.02.2003)
          0200
          0200                  ORG     0F000H
          F000
          F000 C33EF1           JP      PWRON
          F003 C357F0           JP      PV1     ;DEFB nr
          F006 C373F0           JP      PV2     ;(ARGC)=nr
          F009 C387F0           JP      PV3     ;E=nr
          F00C C33FF0           JP      PV4     ;E=nr, IRM e/a
          F00F C3C0F0           JP      RCALL   ;DEFW offset
          F012 C345F1           JP      BYE     ;JUMP-Einsprung
          F015 C333F0           JP      PV5     ;E=nr, IRM/Stack
          F018 C38AF0           JP      IRMON
          F01B C3A9F0           JP      IRMOF
          F01E C32AF0           JP      PV6     ;(ARGC)=nr
          F021 CD6AFB   JDISK   CALL    CON
          F024 CD00D0           CALL    JDISC   ;DISK-Verteiler
          F027 C371FB           JP      COFF
          F02A
          F02A C5       PV6     PUSH    BC
          F02B CD8AF0           CALL    IRMON
          F02E CD73F0           CALL    PV2
          F031 1807             JR      PV51
          F033
          F033 C5       PV5     PUSH    BC
          F034 CD8AF0           CALL    IRMON
          F037 CD87F0           CALL    PV3
          F03A CDA9F0   PV51    CALL    IRMOF
          F03D C1               POP     BC
          F03E C9               RET
          F03F
          F03F CD4EF0   PV4     CALL    SCRON
          F042 CD87F0           CALL    PV3
          F045 F5       SCROFF  PUSH    AF
          F046 DB88             IN      A,88H
          F048 CB97             RES     2,A
          F04A D388             OUT     88H     ;IRM aus
          F04C F1               POP     AF
          F04D C9               RET
          F04E
          F04E F5       SCRON   PUSH    AF
          F04F DB88             IN      A,88H
          F051 CBD7             SET     2,A     ;IRM ein
          F053 D388             OUT     88H
          F055 F1               POP     AF
          F056 C9               RET
          F057
          F057 F3       PV1     DI
          F058 E5               PUSH    HL
          F059 E1               POP     HL
          F05A E1               POP     HL
          F05B 23               INC     HL      ;nr Åbergehen
          F05C E5               PUSH    HL
          F05D 2B               DEC     HL      ;(HL)=nr
          F05E 3B               DEC     SP
          F05F 3B               DEC     SP
          F060 FB               EI
          F061 F5               PUSH    AF
          F062 D5               PUSH    DE
          F063 5E               LD      E,M
          F064 1600     PV22    LD      D,0
          F066 2AB0B7           LD      HL,(SUTAB)
          F069 19               ADD     HL,DE
          F06A 19               ADD     HL,DE   ;HL=Pos. in Tab
          F06B 5E               LD      E,M
          F06C 23               INC     HL
          F06D 56               LD      D,M
          F06E EB               EX      DE,HL
          F06F D1               POP     DE
          F070 F1               POP     AF
          F071 E3       EXRT    EX      (SP),HL
          F072 C9               RET             ;UP anspringen
          F073
          F073 A7       PV2     AND     A       ;VR: F
          F074 E5       PV21    PUSH    HL
          F075 D5               PUSH    DE
          F076 C5               PUSH    BC
          F077 E5               PUSH    HL
          F078 2197F3           LD      HL,POP3 ;Returnadresse
          F07B E3               EX      (SP),HL ;kellern
          F07C E5               PUSH    HL
          F07D F5               PUSH    AF
          F07E D5               PUSH    DE
          F07F 38E3             JR      C,PV22  ;falls PV3
          F081 3A80B7           LD      A,(ARGC);sonst E
          F084 5F               LD      E,A     ;beschaffen
          F085 18DD             JR      PV22
          F087
          F087 37       PV3     SCF             ;VR: F
          F088 18EA             JR      PV21
          F08A
          F08A C1       IRMON   POP     BC      ;RÅckkehradr.
          F08B FDE5             PUSH    IY
          F08D FD210000         LD      IY,0    ;SP in IY merken
          F091 FD39             ADD     IY,SP   ;(Kein UP ver-
          F093 F3               DI              ;Ñndert IY!)
          F094 DD770B           LD      (IX+11),A
          F097 DB88             IN      A,88H
          F099 CBD7             SET     2,A     ;IRM ein
          F09B CBEF             SET     5,A     ;LED ein
          F09D D388             OUT     88H
          F09F ED7BAEB7         LD      SP,(SYSP)
          F0A3 FB               EI
          F0A4 DD7E0B           LD      A,(IX+11)
          F0A7 C5               PUSH    BC
          F0A8 C9               RET             ;wie JP (BC)
          F0A9
          F0A9 C1       IRMOF   POP     BC      ;analog IRMON
          F0AA DD770B           LD      (IX+11),A
          F0AD DB88             IN      A,88H
          F0AF CB97             RES     2,A
          F0B1 CBAF             RES     5,A
          F0B3 F3               DI
          F0B4 D388             OUT     88H
          F0B6 FDF9             LD      SP,IY
          F0B8 FB               EI
          F0B9 DD7E0B           LD      A,(IX+11)
          F0BC FDE1             POP     IY
          F0BE C5               PUSH    BC
          F0BF C9               RET
          F0C0
          F0C0          RCALL   ;Relativer UP-Aufruf
          F0C0                  ;ohne Registerzerstîrung
          F0C0 E3               EX      (SP),HL
          F0C1 D5               PUSH    DE
          F0C2 5E               LD      E,M
          F0C3 23               INC     HL
          F0C4 56               LD      D,M     ;DE=Offset
          F0C5 23               INC     HL
          F0C6 EB               EX      DE,HL
          F0C7 19               ADD     HL,DE   ;addieren
          F0C8 E3               EX      (SP),HL ;Zieladresse
          F0C9 EB               EX      DE,HL   ;DE von Stack
          F0CA F3               DI
          F0CB 33               INC     SP
          F0CC 33               INC     SP
          F0CD E3               EX      (SP),HL ;HL von Stack
          F0CE 3B               DEC     SP
          F0CF 3B               DEC     SP
          F0D0 FB               EI
          F0D1 C9               RET             ;Ziel anspringen
          F0D2
          F0D2          ;Module listen, lesen, schalten:
          F0D2
          F0D2 7F7F     SWI7F   DW      7F7FH
          F0D4 53574954         DB      'SWITCH'
          F0DA 01               DB      1
          F0DB A7               AND     A       ;Argumente?
          F0DC 2808             JR      Z,ESC5
          F0DE CD6AFB           CALL    CON
          F0E1 CD62C3           CALL    SWIC    ;lesen/schalten
          F0E4 180E             JR      MCOFF
          F0E6                  ;
          F0E6 CD6AFB   ESC5    CALL    CON
          F0E9 CD17C2           CALL    MODULC  ;Module listen
          F0EC 1806             JR      MCOFF
          F0EE                  ;
          F0EE          MODU    ;Lesen und Schalten      **26**
          F0EE CD6AFB           CALL    CON
          F0F1 CD85C3           CALL    MODUC
          F0F4 C371FB   MCOFF   JP      COFF
          F0F7
          F0F7          ;Betriebssystem wechseln:
          F0F7
          F0F7 7F7F     JUMP7F  DW      7F7FH
          F0F9 4A554D50         DB      'JUMP'
          F0FD 03               DB      3
          F0FE 7D               LD      A,L
          F0FF 47       JUMP    LD      B,A             ;**27**
          F100 0E80             LD      C,80H
          F102 ED78             IN      A,(C)
          F104 3C               INC     A       ;Kennbyte FF?
          F105 2013             JR      NZ,JUM0
          F107 CD51F3           CALL    OSTR
          F10A 4B65696E         DB      'Kein Modul!'
          F115 070D0A00         DB      7,CR,LF,0
          F119 C9               RET
          F11A C5       JUM0    PUSH    BC
          F11B 26B8             LD      H,0B8H
          F11D 0607             LD      B,7     ;ab Platz 8!
          F11F 04       JUM1    INC     B
          F120 280D             JR      Z,JUM2  ;bis FF
          F122 ED78             IN      A,(C)
          F124 2F               CPL
          F125 E670             AND     70H     ;Speichermodul?
          F127 20F6             JR      NZ,JUM1
          F129 ED79             OUT     (C),A   ;aus
          F12B 68               LD      L,B
          F12C 77               LD      M,A
          F12D 18F0             JR      JUM1
          F12F C1       JUM2    POP     BC
          F130 3EFF             LD      A,0FFH  ;Ausgabe FF
          F132 68               LD      L,B
          F133 77               LD      M,A     ;Eintrag
          F134 F3               DI
          F135 ED79             OUT     (C),A   ;einschalten
          F137 DB88             IN      A,88H
          F139 E67E             AND     7EH
          F13B C3B4B7           JP      BJUMP   ;in IRM
          F13E
          F13E          PWRON   ;Einschalt-Init
          F13E 3EE3             LD      A,0E3H
          F140 D386             OUT     86H     ;RAM4+CAOS-C on
          F142 C34FC0           JP      PWRONC
          F145          BYE     ;Tasten-RESET
          F145 31C401           LD      SP,1C4H
          F148 CD6AFB           CALL    CON
          F14B CD86C0           CALL    SYSI    ;IRM-Init usw.
          F14E                  ;
          F14E CDE0CD   PWR4    CALL    V24INI  ;M003 suchen
          F151 3809             JR      C,PWR5  ;kein M003!
          F153 3281B7           LD      (ARGN),A
          F156 CDDEC8           CALL    V24OC   ;Druckerinit
          F159 CDD4CD           CALL    UMINIT  ;SIO B fÅr
          F15C CD71FB   PWR5    CALL    COFF    ;Interrupt
          F15F 018008           LD      BC,880H ;ROM-Modul mit
          F162 ED78             IN      A,(C)   ;Strukturbyte
          F164 3D               DEC     A       ;01?
          F165 2014             JR      NZ,PWR6 ;nein
          F167 3E43             LD      A,43H
          F169 ED79             OUT     (C),A   ;ein ab 4000H
          F16B 3208B8           LD      (0B808H),A
          F16E DD7E04           LD      A,(IX+4)
          F171 E6FC             AND     0FCH    ;RAM4 aus
          F173 DD7704           LD      (IX+4),A
          F176 D386             OUT     86H
          F178 C30040           JP      4000H   ;anspringen
          F17B                  ;
          F17B 06FC     PWR6    LD      B,0FCH
          F17D ED78             IN      A,(C)
          F17F FEA7             CP      0A7H    ;Floppy?
          F181 203A             JR      NZ,MEN0 ;nein
          F183 ED79             OUT     (C),A   ;einschalten
          F185 01F3B3           LD      BC,0B3F3H
          F188 ED78             IN      A,(C)   ;Betriebsart
          F18A 3D               DEC     A
          F18B 2830             JR      Z,MEN0  ;PC-BA
          F18D FE04             CP      4
          F18F 282C             JR      Z,MEN0  ;KC-BA
          F191 CD51F3           CALL    OSTR
          F194 0C0A             DB      0CH,LF
          F196 4175746F         DB      'Autostart Floppy'
          F1A6 0D0A00           DB      CR,LF,0
          F1A9 3E01             LD      A,1
          F1AB 3281B7           LD      (ARGN),A
          F1AE 3EFC             LD      A,0FCH
          F1B0 CDFFF0           CALL    JUMP    ;Startversuch
          F1B3 1808             JR      MEN0
          F1B5          ;
          F1B5 7F7F     MENU7F  DW      7F7FH
          F1B7 4D454E55         DB      'MENU'
          F1BB 1F               DB      1FH
          F1BC E1               POP     HL      ;Stack clear
          F1BD CD51F3   MEN0    CALL    OSTR
          F1C0 0C0A             DB      0CH,LF
          F1C2 2A204B43         DB      '* KC-CAOS 4.4 *',0
          F1D2 2100C0   MENU    LD      HL,0C000H       ;**46**
          F1D5 4D               LD      C,L
          F1D6 45               LD      B,L     ;BC=0
          F1D7 CD80F4   MEN1    CALL    CRLF
          F1DA 3E02     MEN2    LD      A,2     ;CLLN
          F1DC CDF7E3           CALL    CRT
          F1DF 3AECB7           LD      A,(PROMPT)
          F1E2 FE20             CP      20H
          F1E4 3002             JR      NC,MEN3
          F1E6 3E25             LD      A,'%'   ;Standard
          F1E8 CD80F3   MEN3    CALL    OCHR
          F1EB CDACE4           CALL    BRKT
          F1EE 3832             JR      C,LOOP2 ;Break
          F1F0 DD7E09           LD      A,(IX+9)
          F1F3 EDB1     MEN4    CPIR
          F1F5 E222F2           JP      PO,LOOP2;ausgesucht
          F1F8 EDA1             CPI
          F1FA 20F7             JR      NZ,MEN4 ;2mal!
          F1FC 7E       MEN5    LD      A,M
          F1FD FE20             CP      20H     ;Epilog?
          F1FF 38D6             JR      C,MEN1
          F201 FE30             CP      30H
          F203 38D5             JR      C,MEN2
          F205 FE60             CP      60H
          F207 30D1             JR      NC,MEN2
          F209 CD80F3           CALL    OCHR
          F20C 23               INC     HL
          F20D 0B               DEC     BC
          F20E 18EC             JR      MEN5
          F210
          F210          LOOP    ;Eingabeschleife
          F210 CD4EF0           CALL    SCRON           ;**12**
          F213 CD71FB           CALL    COFF
          F216 3AECB7           LD      A,(PROMPT)
          F219 FE20             CP      20H
          F21B 3002             JR      NC,LOOP1
          F21D 3E25             LD      A,'%'   ;Standard
          F21F CD80F3   LOOP1   CALL    OCHR    ;Prompt
          F222 CD27F2   LOOP2   CALL    INPUT
          F225 18E9             JR      LOOP
          F227
          F227          INPUT   ;MenÅkommandoroutine
          F227 CD3CF4           CALL    INLIN
          F22A 300B             JR      NC,INP1
          F22C 3E0B             LD      A,0BH   ;bei BRK
          F22E CDF7E3           CALL    CRT     ;Cursor hoch
          F231 3E02             LD      A,2     ;und
          F233 CDF7E3           CALL    CRT     ;Zeile lîschen
          F236 C9               RET
          F237 13       INP1    INC     DE      ;Zeichen danach
          F238 1A               LD      A,(DE)
          F239 E6DF             AND     0DFH    ;leer?
          F23B C8               RET     Z
          F23C CD04F3           CALL    MSUCH   ;Suche ab C000H
          F23F 3846             JR      C,INP5  ;gefunden
          F241 3A05B8           LD      A,(0B805H)
          F244 E601             AND     1
          F246 200A             JR      NZ,INP2 ;CAOS-C war an
          F248 CD6AFB           CALL    CON
          F24B 0620             LD      B,20H
          F24D CD06F3           CALL    MS1
          F250 3835             JR      C,INP5  ;gefunden
          F252 D5       INP2    PUSH    DE
          F253 3A02B8           LD      A,(0B802H)
          F256 5F               LD      E,A     ;ROM-C merken
          F257 16D1             LD      D,0D1H  ;BASIC nicht mit
          F259 3E02     INP3    LD      A,2
          F25B 6F               LD      L,A
          F25C CDEEF0           CALL    MODU    ;ROMC-Ebene ein
          F25F DDCB04BF         RES     7,(IX+4),A
          F263 D386             OUT     86H     ;CAOSC aus!
          F265 EB               EX      DE,HL
          F266 E3               EX      (SP),HL ;DE=Suchkette
          F267 EB               EX      DE,HL
          F268 0620             LD      B,20H
          F26A CD06F3           CALL    MS1     ;MenÅwort?
          F26D 3813             JR      C,INP4  ;gefunden
          F26F EB               EX      DE,HL
          F270 E3               EX      (SP),HL ;DE=Schaltzust.
          F271 EB               EX      DE,HL
          F272 3E10             LD      A,10H
          F274 82               ADD     D
          F275 57               LD      D,A
          F276 30E1             JR      NC,INP3 ;nÑchste Ebene
          F278 53               LD      D,E
          F279 3E02             LD      A,2
          F27B 6F               LD      L,A
          F27C CDEEF0           CALL    MODU    ;ROMC wie zuvor
          F27F D1               POP     DE
          F280 182C             JR      ERR1    ;invalid command
          F282                  ;
          F282 F1       INP4    POP     AF      ;Schaltzustand
          F283 AF               XOR     A       ;ROMC vergessen
          F284 3205B8           LD      (0B805H),A
          F287 7E       INP5    LD      A,M     ;Epilog
          F288 23               INC     HL
          F289 E5               PUSH    HL
          F28A FE1F             CP      1FH
          F28C C8               RET     Z       ;ohne arg!
          F28D F5               PUSH    AF
          F28E CDDCF4           CALL    GARG    ;Arg's erfassen
          F291 C1               POP     BC
          F292 384E             JR      C,ERR4  ;bad args
          F294 3A81B7           LD      A,(ARGN)
          F297 48               LD      C,B
          F298 CBA0             RES     4,B
          F29A CB28             SRA     B
          F29C B8               CP      B
          F29D 3835             JR      C,ERR3  ;zu wenig arg
          F29F 2804             JR      Z,INP6
          F2A1 CB61             BIT     4,C
          F2A3 2021             JR      NZ,ERR2 ;zu viele arg
          F2A5 CB41     INP6    BIT     0,C
          F2A7 CD9EF5           CALL    LARG    ;Arg's laden
          F2AA C0               RET     NZ      ;mit IRM on
          F2AB C345F0           JP      SCROFF  ;mit IRM off
          F2AE
          F2AE CD51F3   ERR1    CALL    OSTR
          F2B1 66616C73         DB      'falsches Kommando',7,0
          F2C4 183B             JR      ERRCR
          F2C6 CD51F3   ERR2    CALL    OSTR
          F2C9 7A752076         DB      'zu viele',0
          F2D2 181D             JR      ERRA
          F2D4 CD51F3   ERR3    CALL    OSTR
          F2D7 7A752077         DB      'zu wenig',0
          F2E0 180F             JR      ERRA
          F2E2 CD51F3   ERR4    CALL    OSTR
          F2E5 6665686C         DB      'fehlerhafte',0
          F2F1 E1       ERRA    POP     HL      ;Stack clear
          F2F2 CD51F3           CALL    OSTR
          F2F5 20417267         DB      ' Argumente',7,0
          F301 C380F4   ERRCR   JP      CRLF
          F304
          F304 0600     MSUCH   LD      B,0
          F306 2100C0   MS1     LD      HL,0C000H
          F309 4D               LD      C,L
          F30A DD7E09           LD      A,(IX+9)
          F30D EDB1     ZSUCH   CPIR                    ;**1D**
          F30F 37               SCF
          F310 3F               CCF
          F311 E0               RET     PO      ;nicht gef.
          F312 EDA1             CPI
          F314 20F7             JR      NZ,ZSUCH
          F316 F5               PUSH    AF
          F317 D5               PUSH    DE
          F318 1A       ZS1     LD      A,(DE)
          F319 13               INC     DE
          F31A FE21             CP      21H
          F31C 380D             JR      C,ZS3   ;Kettenende
          F31E CB6E             BIT     5,M     ;gro·?
          F320 CCF9F4           CALL    Z,UPCASE
          F323 EDA1             CPI
          F325 28F1             JR      Z,ZS1
          F327 D1       ZS2     POP     DE
          F328 F1               POP     AF
          F329 18E2             JR      ZSUCH
          F32B                  ;
          F32B 7E       ZS3     LD      A,M
          F32C FE20             CP      20H     ;Epilog?
          F32E 3809             JR      C,ZS4   ;ja
          F330 28F5             JR      Z,ZS2   ;SPC!
          F332 FE80             CP      80H
          F334 30F1             JR      NC,ZS2  ;>80H
          F336 23               INC     HL
          F337 18F2             JR      ZS3
          F339                  ;
          F339 F1       ZS4     POP     AF
          F33A F1               POP     AF
          F33B 37               SCF             ;gefunden
          F33C C9               RET
          F33D
          F33D 47       WAIT    LD      B,A             ;**14**
          F33E AF               XOR     A
          F33F CD45F3   WAIT1   CALL    WTUP
          F342 10FB             DJNZ    WAIT1
          F344 C9               RET
          F345                  ;
          F345 3D       WTUP    DEC     A       ;UP fÅr WAIT
          F346 C8               RET     Z
          F347 F5               PUSH    AF
          F348 F1               POP     AF
          F349 18FA             JR      WTUP
          F34B
          F34B DD7E02   BNROST  LD      A,(IX+2);Blocknummer u.
          F34E CD8BF4   AHOSTR  CALL    AHEX    ;RG A und folg.
          F351 E3       OSTR    EX      (SP),HL ;ZK      **23**
          F352 7E       OSTR1   LD      A,M     ;ausgeben
          F353 23               INC     HL
          F354 A7               AND     A       ;bis 00-Byte
          F355 CA71F0           JP      Z,EXRT
          F358 CD80F3           CALL    OCHR
          F35B 18F5             JR      OSTR1
          F35D
          F35D CD6DF3   NORM    CALL    NIN             ;**13**
          F360 21A6FB   NOUT    LD      HL,ZEI0         ;**20**
          F363 E5       SOUT    PUSH    HL              ;**1E**
          F364 2AB9B7           LD      HL,(OUTAB)
          F367 E3               EX      (SP),HL
          F368 22B9B7           LD      (OUTAB),HL
          F36B E1               POP     HL
          F36C C9               RET
          F36D
          F36D 21AAFB   NIN     LD      HL,ZEI4         ;**21**
          F370 E5       SIN     PUSH    HL              ;**1F**
          F371 2ABBB7           LD      HL,(INTAB)
          F374 E3               EX      (SP),HL
          F375 22BBB7           LD      (INTAB),HL
          F378 E1               POP     HL
          F379 C9               RET
          F37A
          F37A E5       INTB    PUSH    HL              ;**16**
          F37B 2ABBB7           LD      HL,(INTAB)
          F37E 1804             JR      INTA1
          F380 E5       OCHR    PUSH    HL              ;**24**
          F381 2AB9B7           LD      HL,(OUTAB)
          F384 D5       INTA1   PUSH    DE      ;s.a. PV1
          F385 C5               PUSH    BC      ;(sehr Ñhnlich)
          F386 5E               LD      E,M
          F387 1600             LD      D,0
          F389 2AB0B7           LD      HL,(SUTAB)
          F38C F5               PUSH    AF
          F38D 19               ADD     HL,DE
          F38E 19               ADD     HL,DE
          F38F F1               POP     AF
          F390 5E               LD      E,M
          F391 23               INC     HL
          F392 56               LD      D,M
          F393 EB               EX      DE,HL
          F394 CD2CE2           CALL    JPHL
          F397 C1       POP3    POP     BC      ;auch fÅr PV2
          F398 D1               POP     DE      ;bis PV6!
          F399 E1               POP     HL
          F39A C9               RET
          F39B
          F39B E5       KBD     PUSH    HL              ;**04**
          F39C D5               PUSH    DE
          F39D C5               PUSH    BC
          F39E DDCB0876 KBD1    BIT     6,(IX+8);F-Taste aktiv?
          F3A2 205C             JR      NZ,KBD9;ja
          F3A4 1E00     KBD2    LD      E,0
          F3A6 CDA5F7   KBD3    CALL    CUCP    ;blinken
          F3A9 1C               INC     E       ;e/a-Merker
          F3AA 060F             LD      B,0FH   ;F00h mal
          F3AC CDA3E4   KBD4    CALL    KBDZ    ;abfragen
          F3AF 3807             JR      C,KBD5
          F3B1 0B               DEC     BC
          F3B2 78               LD      A,B
          F3B3 B1               OR      C
          F3B4 20F6             JR      NZ,KBD4 ;dann Cursor
          F3B6 18EE             JR      KBD3    ;wieder weg usw.
          F3B8                  ;
          F3B8 CB43     KBD5    BIT     0,E     ;gerade ein?
          F3BA C4A5F7           CALL    NZ,CUCP ;ja - wegnehmen
          F3BD 57               LD      D,A
          F3BE DDCB086E         BIT     5,(IX+8);Click ein?
          F3C2 C4BFE3           CALL    NZ,CLIK
          F3C5 7A               LD      A,D
          F3C6 21A2B7           LD      HL,STBT
          F3C9 CB66             BIT     4,M     ;ESC aktiv?
          F3CB 280D             JR      Z,KBD6
          F3CD ED5BA0B7         LD      DE,(CURSO)
          F3D1 CDF6E1           CALL    CRT1    ;ESC ausfÅhren
          F3D4 ED53A0B7         LD      (CURSO),DE
          F3D8 18CA             JR      KBD2
          F3DA                  ;
          F3DA FE1B     KBD6    CP      ESC
          F3DC 2004             JR      NZ,KBD7
          F3DE CBE6             SET     4,M     ;ESC merken
          F3E0 18C2             JR      KBD2
          F3E2                  ;
          F3E2 FEF1     KBD7    CP      0F1H    ;F-Taste?
          F3E4 38B1             JR      C,POP3
          F3E6 E60F             AND     0FH
          F3E8 47               LD      B,A
          F3E9 2100B9           LD      HL,0B900H
          F3EC 7E       KBD8    LD      A,M
          F3ED 2C               INC     L
          F3EE 28B4             JR      Z,KBD2  ;Speicherende
          F3F0 A7               AND     A
          F3F1 20F9             JR      NZ,KBD8;Pos. in Puffer
          F3F3 10F7             DJNZ    KBD8    ;auszÑhlen
          F3F5 7D               LD      A,L
          F3F6 FE9C             CP      9CH
          F3F8 30AA             JR      NC,KBD2 ;Speicherende
          F3FA DDCB08F6         SET     6,(IX+8);F-Taste aktiv
          F3FE 1808             JR      KBD10
          F400                  ;
          F400 CDACE4   KBD9    CALL    BRKT    ;Abbruch?
          F403 381A             JR      C,KBD12
          F405 2AD1B7           LD      HL,(FTAST);Zeiger auf
          F408 7E       KBD10   LD      A,M     ;nÑchstes CHR
          F409 FE1B             CP      ESC
          F40B 200B             JR      NZ,KBD11
          F40D 23               INC     HL
          F40E 22D1B7           LD      (FTAST),HL
          F411 21A2B7           LD      HL,STBT
          F414 CBE6             SET     4,M     ;ESC merken
          F416 1886             JR      KBD1
          F418                  ;
          F418 23       KBD11   INC     HL
          F419 22D1B7           LD      (FTAST),HL;Zeiger rett.
          F41C A7               AND     A       ;Null-Ende?
          F41D 2007             JR      NZ,KBD13
          F41F DDCB08B6 KBD12   RES     6,(IX+8);ja - inaktiv
          F423 C3A4F3           JP      KBD2
          F426                  ;
          F426 21A2B7   KBD13   LD      HL,STBT
          F429 CB66             BIT     4,M
          F42B CA97F3           JP      Z,POP3
          F42E ED5BA0B7         LD      DE,(CURSO)
          F432 CDF6E1           CALL    CRT1    ;ESC ausfÅhren
          F435 ED53A0B7         LD      (CURSO),DE
          F439 C39EF3           JP      KBD1
          F43C
          F43C CD7AF3   INLIN   CALL    INTB            ;**17**
          F43F CD80F3           CALL    OCHR
          F442 FE03             CP      3       ;BRK?
          F444 37               SCF
          F445 2804             JR      Z,INLI1
          F447 FE0D             CP      CR      ;ENTER?
          F449 20F1             JR      NZ,INLIN
          F44B F5       INLI1   PUSH    AF
          F44C CD80F4           CALL    CRLF    ;PA: A=0
          F44F ED5BA0B7         LD      DE,(CURSO)
          F453 BA               CP      D       ;Zeile 1 durch
          F454                                  ;PAGE-Mode?
          F454 2004             JR      NZ,INLI2
          F456 3A9FB7           LD      A,(WINLG+1)
          F459 57               LD      D,A     ;D korrigieren
          F45A 15       INLI2   DEC     D       ;Zeile drÅber
          F45B E5               PUSH    HL
          F45C CD7CE0           CALL    DABR
          F45F EB               EX      DE,HL
          F460 E1               POP     HL      ;PA: DE
          F461 F1               POP     AF      ;PA: CY=BRK
          F462 C9       NOOP    RET
          F463
          F463 7F7F     GO7F    DW      7F7FH
          F465 676F             DB      'go'
          F467 03               DB      3
          F468 E9               JP      (HL)
          F469
          F469 7C       HLHX    LD      A,H             ;**1A**
          F46A CD8BF4           CALL    AHEX
          F46D 7D               LD      A,L
          F46E CD8BF4   AHSPC   CALL    AHEX
          F471 3E20     SPACE   LD      A,20H           ;**2B**
          F473 C380F3   SPAC0   JP      OCHR
          F476
          F476 CD51F3   ERRM    CALL    OSTR            ;**17**
          F479 4552524F         DB      'ERROR',7,0
          F480                  ;
          F480 CD51F3   CRLF    CALL    OSTR            ;**2C**
          F483 0D0A00           DB      CR,LF,0
          F486 C9               RET
          F487
          F487 3E10     HOME    LD      A,10H           ;**2D**
          F489 18E8             JR      SPAC0
          F48B
          F48B F5       AHEX    PUSH    AF              ;**1C**
          F48C 1F               RRA             ;Tetradentausch
          F48D 1F               RRA
          F48E 1F               RRA
          F48F 1F               RRA
          F490 CD94F4           CALL    AHEX0   ;erst aufrufen,
          F493 F1               POP     AF      ;dann reinlaufen
          F494 E60F     AHEX0   AND     0FH     ;Maske
          F496 C690             ADD     90H     ;Åbliche
          F498 27               DAA             ;Routine
          F499 CE40             ADC     40H     ;fÅr die
          F49B 27               DAA             ;Hexausgabe
          F49C 18D5             JR      SPAC0
          F49E
          F49E CDA1F4   HLDE    CALL    HLDE1           ;**1B**
          F4A1 CD69F4   HLDE1   CALL    HLHX
          F4A4 EB               EX      DE,HL
          F4A5 C9               RET
          F4A6
          F4A6 13       RHEX0   INC     DE
          F4A7 1A       RHEX    LD      A,(DE)          ;**18**
          F4A8 FE20             CP      ' '     ;Trennzeichen
          F4AA 28FA             JR      Z,RHEX0 ;Åbergehen
          F4AC AF               XOR     A
          F4AD 2198B7           LD      HL,NUMVX+1
          F4B0 77               LD      M,A
          F4B1 2B               DEC     HL      ;HL=NUMVX
          F4B2 77               LD      M,A
          F4B3 2B               DEC     HL      ;HL=NUMNX
          F4B4 77               LD      M,A     ;alles nullsetz
          F4B5 1A       RH1     LD      A,(DE)
          F4B6 B7               OR      A       ;Ende-Dummy?
          F4B7 C8               RET     Z
          F4B8 FE20             CP      ' '     ;Ende-Space?
          F4BA C8               RET     Z
          F4BB D630             SUB     '0'
          F4BD D8               RET     C
          F4BE FE0A             CP      10
          F4C0 380B             JR      C,RH2
          F4C2 D607             SUB     7
          F4C4 E6DF             AND     0DFH    ;Klein>Gro·
          F4C6 FE0A             CP      10
          F4C8 D8               RET     C
          F4C9 FE10             CP      10H
          F4CB 3F               CCF
          F4CC D8               RET     C
          F4CD 13       RH2     INC     DE
          F4CE 34               INC     M       ;NUMNX erhîhen
          F4CF 23               INC     HL
          F4D0 ED6F             RLD             ;Tetrade
          F4D2 23               INC     HL      ;durchschieben
          F4D3 ED6F             RLD
          F4D5 2B               DEC     HL
          F4D6 2B               DEC     HL      ;RLD setzt auch
          F4D7 28DC             JR      Z,RH1   ;Z-Flag!
          F4D9 1B               DEC     DE      ;Fehler: Zahl
          F4DA 37               SCF             ;zu gro·
          F4DB C9               RET
          F4DC
          F4DC          GARG    ;bis 10 Argumente erfassen
          F4DC 0181B7           LD      BC,ARGN         ;**22**
          F4DF AF               XOR     A
          F4E0 02               LD      (BC),A  ;(ARGN)=0
          F4E1 CDA7F4   GARG1   CALL    RHEX
          F4E4 D8               RET     C       ;Fehler
          F4E5 7E               LD      A,M
          F4E6 B7               OR      A       ;Ende-Dummy?
          F4E7 C8               RET     Z
          F4E8 23               INC     HL
          F4E9 03               INC     BC
          F4EA 7E               LD      A,M     ;L(NUMVX)
          F4EB 02               LD      (BC),A  ;L(Argument)
          F4EC 23               INC     HL
          F4ED 03               INC     BC
          F4EE 7E               LD      A,M     ;H(NUMVX)
          F4EF 02               LD      (BC),A  ;H(Argument)
          F4F0 2E81             LD      L,81H   ;HL=ARGN
          F4F2 34               INC     M
          F4F3 7E               LD      A,M
          F4F4 C6F5             ADD     0F5H    ;10 Argumente?
          F4F6 30E9             JR      NC,GARG1
          F4F8 C9               RET             ;Fehler: zu viel
          F4F9
          F4F9          UPCASE  ;A upcasen, wenn Kleinbuchstabe
          F4F9 FE61             CP      'a'
          F4FB D8               RET     C
          F4FC FE7B             CP      'z'+1
          F4FE D0               RET     NC
          F4FF E6DF             AND     0DFH
          F501 C9               RET
          F502
          F502 CD6AFB   SIXD    CALL    CON             ;**31**
          F505 CDBEC0           CALL    SIXC
          F508 C371FB           JP      COFF
          F50B                  ;
          F50B DD360500 KPUFF   LD      (IX+5H),0
          F50F DD3606B7         LD      (IX+6H),CASS/256
          F513 C9               RET
          F514
          F514 C5       INIEA   PUSH    BC              ;**43**
          F515 4E               LD      C,M     ;1.Byte=Adr.
          F516 23               INC     HL
          F517 46               LD      B,M     ;2.Byte=Anz.
          F518 23               INC     HL
          F519 EDB3             OTIR
          F51B C1               POP     BC
          F51C C9               RET
          F51D
          F51D 56       INIMEX  LD      D,M     ;Anzahl
          F51E 23               INC     HL
          F51F F3       INIME   DI                      ;**44**
          F520 CD14F5   INIME1  CALL    INIEA
          F523 15               DEC     D       ;D KanÑle
          F524 20FA             JR      NZ,INIME1
          F526 FB               EI
          F527 C9               RET
          F528          ;
          F528 7F7F     SAVE7F  DW      7F7FH
          F52A 53415645         DB      'SAVE'
          F52E 05               DB      5
          F52F CD51F3           CALL    OSTR
          F532 4E616D65         DB      'Name :',0
          F539 CD3CF4           CALL    INLIN
          F53C D8               RET     C       ;BRK
          F53D 210600           LD      HL,6
          F540 19               ADD     HL,DE   ;Beginn Name
          F541                  ;
          F541 1100B7   SAVE    LD      DE,CASS         ;**36**
          F544 010B00           LD      BC,11   ;Name nach
          F547 EDB0             LDIR            ;Puffer
          F549 AF               XOR     A
          F54A 12               LD      (DE),A
          F54B 2181B7           LD      HL,ARGN ;alle Arg.
          F54E 1E10             LD      E,10H   ;mit ARGN
          F550 0E15             LD      C,15H
          F552 EDB0             LDIR            ;nach Puffer
          F554 CD0BF5           CALL    KPUFF   ;Standard setzen
          F557 CD28E5           CALL    ISRO
          F55A 2A82B7   SAV1    LD      HL,(ARG1);Ladeadr.
          F55D 1100B7           LD      DE,CASS
          F560 018000           LD      BC,80H
          F563 3A01B8           LD      A,(0B801H)
          F566 E601             AND     1
          F568 200F             JR      NZ,SAV3 ;IRM ein
          F56A 41               LD      B,C
          F56B CD45F0   SAV2    CALL    SCROFF
          F56E 7E               LD      A,M     ;aus RAM
          F56F CD4EF0           CALL    SCRON
          F572 12               LD      (DE),A  ;in Puffer
          F573 23               INC     HL
          F574 13               INC     DE
          F575 10F4             DJNZ    SAV2
          F577 1802             JR      SAV4
          F579 EDB0     SAV3    LDIR            ;kopieren
          F57B 2282B7   SAV4    LD      (ARG1),HL
          F57E CD51F3           CALL    OSTR
          F581 0200             DB      2,0     ;CLLN
          F583 CD4BF3           CALL    BNROST  ;Blocknummer
          F586 00               NOP
          F587 01A000           LD      BC,0A0H
          F58A CDACE4           CALL    BRKT
          F58D DAE2E4           JP      C,CSROI ;BRK
          F590 ED5B84B7         LD      DE,(ARG2)
          F594 ED52             SBC     HL,DE   ;Ende erreicht?
          F596 D2DBE4           JP      NC,CSRO
          F599 CD37E5           CALL    MBO     ;Block ausgeben
          F59C 18BC             JR      SAV1
          F59E
          F59E ED4B86B7 LARG    LD      BC,(ARG3)       ;**15**
          F5A2 ED5B84B7         LD      DE,(ARG2)
          F5A6 2A82B7           LD      HL,(ARG1)
          F5A9 3A81B7           LD      A,(ARGN)
          F5AC C9               RET
          F5AD
          F5AD          LUP     ;LOAD-Unterprogramm
          F5AD                  ;PA: CY=1 BRK gedrÅckt
          F5AD DD3403           INC     (IX+3)  ;erwarteter Blk
          F5B0 CD9DE5   LUP1    CALL    MBI
          F5B3 3020             JR      NC,LUP3
          F5B5 CD51F3           CALL    OSTR
          F5B8 09090920         DB      9,9,9,' ',0
          F5BD CD4BF3           CALL    BNROST
          F5C0 203F             DB      ' ?'    ;fehlerhaft
          F5C2 1E00             DB      1EH,0
          F5C4 DD7E03           LD      A,(IX+3)
          F5C7 3D               DEC     A       ;Block 01 erw.?
          F5C8 28E6             JR      Z,LUP1
          F5CA CD9BF3           CALL    KBD     ;nein
          F5CD FE03             CP      3       ;BRK?
          F5CF 37               SCF
          F5D0 C8               RET     Z
          F5D1 FE0A             CP      LF      ;CUD?
          F5D3 20DB             JR      NZ,LUP1
          F5D5 DD7E02   LUP3    LD      A,(IX+2)
          F5D8 DD4603           LD      B,(IX+3)
          F5DB 05               DEC     B       ;Block 01 erw.?
          F5DC 2817             JR      Z,LUP6
          F5DE 04               INC     B       ;richtige
          F5DF B8               CP      B       ;Blocknummer?
          F5E0 280B             JR      Z,LUP5
          F5E2 3C               INC     A       ;Block FF?
          F5E3 2808             JR      Z,LUP5
          F5E5 CD4BF3   LUP4    CALL    BNROST
          F5E8 2A               DB      '*'     ;falsche Nr.
          F5E9 1900             DB      19H,0
          F5EB 18C3             JR      LUP1
          F5ED
          F5ED CD4BF3   LUP5    CALL    BNROST
          F5F0 3E20             DB      '> '    ;korrekter Blk.
          F5F2 1900             DB      19H,0
          F5F4 C9               RET
          F5F5
          F5F5 3D       LUP6    DEC     A       ;Block 01?
          F5F6 20ED             JR      NZ,LUP4
          F5F8 CD80F4           CALL    CRLF    ;keine Nr,
          F5FB 2100B7           LD      HL,CASS
          F5FE 060B             LD      B,11    ;sondern Name
          F600 7E       LUP7    LD      A,M     ;ausgeben
          F601 23               INC     HL
          F602 CDF7E3           CALL    CRT
          F605 10F9             DJNZ    LUP7
          F607 C371F4           JP      SPACE
          F60A
          F60A CD51F3   NOMC    CALL    OSTR
          F60D 6B65696E         DB      'keine MC-Datei!',0
          F61D C3E2E4   CLJP    JP      CSROI
          F620          ;
          F620 7F7F     VERI7F  DW      7F7FH
          F622 56455249         DB      'VERIFY'
          F628 01               DB      1
          F629 DD360700 VERIF   LD      (IX+7),0        ;**11**
          F62D 1816             JR      LOAD1
          F62F          ;
          F62F 7F7F     LOAD7F  DW      7F7FH
          F631 4C4F4144         DB      'LOAD'
          F635 01               DB      1
          F636 DD360701 LOAD    LD      (IX+7),1;LOAD   ;**10**
          F63A 3A81B7           LD      A,(ARGN)
          F63D FE02             CP      2
          F63F 3804             JR      C,LOAD1 ;Autostart?
          F641 DDCB07CE         SET     1,(IX+7);unterdrÅcken
          F645 CDB6E4   LOAD1   CALL    ISRI1
          F648 CD0BF5           CALL    KPUFF   ;Standard setzen
          F64B DD360300         LD      (IX+3),0
          F64F CDADF5           CALL    LUP
          F652 38C9     LOAD2   JR      C,CLJP  ;BRK
          F654 DDCB0746         BIT     0,(IX+7)
          F658 2855             JR      Z,LOAD5 ;Verify
          F65A 2E10             LD      L,10H
          F65C DD7E07           LD      A,(IX+7)
          F65F E6E3             AND     0E3H    ;Bits 2..4 Null
          F661 DD7707           LD      (IX+7),A
          F664 7E               LD      A,M     ;Anzahl Arg.
          F665 CB27             SLA     A
          F667 CB27             SLA     A       ;2* schieben
          F669 E61C             AND     1CH     ;Maske
          F66B DDB607           OR      (IX+7)
          F66E DD7707           LD      (IX+7),A
          F671 7E               LD      A,M     ;Anzahl Arg.
          F672 D602             SUB     2
          F674 FE09             CP      9       ;MC?
          F676 3092             JR      NC,NOMC
          F678 ED4B15B7         LD      BC,(CASS+15H)
          F67C C5               PUSH    BC
          F67D ED5B13B7         LD      DE,(CASS+13H)
          F681 2A11B7           LD      HL,(CASS+11H)
          F684 3A81B7           LD      A,(ARGN)
          F687 A7               AND     A       ;Ladeoffset?
          F688 2811             JR      Z,LOAD3 ;nein
          F68A ED4B82B7         LD      BC,(ARG1)
          F68E 09               ADD     HL,BC   ;AAdr,Eadr
          F68F EB               EX      DE,HL   ;umrechnen
          F690 09               ADD     HL,BC
          F691 EB               EX      DE,HL
          F692 DDCB0766         BIT     4,(IX+7);4..7 Args?
          F696 2003             JR      NZ,LOAD3
          F698 E3               EX      (SP),HL
          F699 09               ADD     HL,BC   ;SAdr umrechnen
          F69A E3               EX      (SP),HL
          F69B CD9EF4   LOAD3   CALL    HLDE    ;AAdr,EAdr ausg.
          F69E 3A10B7           LD      A,(CASS+10H)
          F6A1 FE03             CP      3
          F6A3 3805             JR      C,LOAD4 ;keine SAdr
          F6A5 E3               EX      (SP),HL
          F6A6 CD69F4           CALL    HLHX    ;SAdr ausg.
          F6A9 E3               EX      (SP),HL
          F6AA C1       LOAD4   POP     BC      ;SAdr merken
          F6AB ED4386B7         LD      (ARG3),BC
          F6AF CD80F4   LOAD5   CALL    CRLF
          F6B2 EB               EX      DE,HL   ;DE=Ladeadr.
          F6B3                  ;Load-Hauptschleife
          F6B3 CDADF5   LOAD6   CALL    LUP
          F6B6 389A             JR      C,LOAD2 ;BRK
          F6B8 DDCB0746         BIT     0,(IX+7)
          F6BC 2828             JR      Z,LOAD11;Verify
          F6BE E5               PUSH    HL
          F6BF ED52             SBC     HL,DE
          F6C1 018000           LD      BC,80H
          F6C4 ED42             SBC     HL,BC
          F6C6 09               ADD     HL,BC
          F6C7 3001             JR      NC,LOAD7
          F6C9 4D               LD      C,L     ;restl. Anzahl
          F6CA 2100B7   LOAD7   LD      HL,CASS
          F6CD 3A01B8           LD      A,(0B801H)
          F6D0 E601             AND     1
          F6D2 200F             JR      NZ,LOAD9;IRM ein
          F6D4 41               LD      B,C
          F6D5 7E       LOAD8   LD      A,M     ;aus Puffer
          F6D6 CD45F0           CALL    SCROFF
          F6D9 12               LD      (DE),A  ;in RAM
          F6DA 23               INC     HL
          F6DB 13               INC     DE
          F6DC CD4EF0           CALL    SCRON
          F6DF 10F4             DJNZ    LOAD8
          F6E1 1802             JR      LOAD10
          F6E3 EDB0     LOAD9   LDIR            ;kopieren
          F6E5 E1       LOAD10  POP     HL
          F6E6 DD3402   LOAD11  INC     (IX+2)  ;Blocknr. FF?
          F6E9 20C8             JR      NZ,LOAD6
          F6EB                  ;
          F6EB CDE2E4   CSRI    CALL    CSROI           ;**0B**
          F6EE DD7E07           LD      A,(IX+7)
          F6F1 E603             AND     3
          F6F3 3D               DEC     A
          F6F4 C0               RET     NZ      ;kein Start
          F6F5 DD7E07           LD      A,(IX+7)
          F6F8 E61C             AND     1CH
          F6FA FE0C             CP      0CH
          F6FC                                  ;Befehl fehlte
          F6FC DD360700         LD      (IX+7),0;in CAOS 4.3 !
          F700
          F700 D8               RET     C       ;keine Sadr
          F701 2A86B7           LD      HL,(ARG3);Sadr
          F704 E9               JP      (HL)    ;Ansprung
          F705          ;
          F705 7F7F     COL7F   DW      7F7FH
          F707 434F4C4F         DB      'COLOR'
          F70C 01               DB      1
          F70D CD6AFB   COLR    CALL    CON             ;**0F**
          F710 CD84C5           CALL    COLRC
          F713 181D             JR      JCOFF
          F715
          F715 E5       CSTBT   PUSH    HL              ;**42**
          F716 21A2B7           LD      HL,STBT
          F719 CBDE             SET     3,M
          F71B CD80F3           CALL    OCHR    ;Steuerzeichen
          F71E CB9E             RES     3,M     ;darstellen
          F720 E1               POP     HL
          F721 C9               RET
          F722          ;
          F722 7F7F     DISP7F  DW      7F7FH
          F724 44495350         DB      'DISPLAY'
          F72B 03               DB      3
          F72C CD6AFB   DISP    CALL    CON             ;**3B**
          F72F CD0DC8           CALL    DISPC
          F732 C371FB   JCOFF   JP      COFF
          F735
          F735          LDAME   ;fÅr DISPC, MODIC, FSAVE, view
          F735 CD71FB           CALL    COFF
          F738 3A01B8           LD      A,(0B801H)
          F73B E601             AND     1       ;IRM off?
          F73D CC45F0           CALL    Z,SCROFF
          F740 7E               LD      A,M     ;Byte holen
          F741 CD4EF0   JCON    CALL    SCRON
          F744 C36AFB           JP      CON
          F747          ;
          F747 7F7F     MODI7F  DW      7F7FH
          F749 4D4F4449         DB      'MODIFY'
          F74F 03               DB      3
          F750 CD6AFB   MODI    CALL    CON             ;**2E**
          F753 CD3EC8           CALL    MODIC
          F756 18DA             JR      JCOFF
          F758
          F758          LDMAE   ;fÅr MODIC, FLOAD
          F758 CD71FB           CALL    COFF
          F75B F5               PUSH    AF
          F75C 3A01B8           LD      A,(0B801H)
          F75F E601             AND     1       ;IRM off?
          F761 CC45F0           CALL    Z,SCROFF
          F764 F1               POP     AF
          F765 77               LD      M,A     ;Byte eintragen
          F766 18D9             JR      JCON
          F768          ;
          F768 7F7F     WIND7F  DW      7F7FH
          F76A 57494E44         DB      'WINDOW'
          F770 01               DB      1
          F771 CD6AFB           CALL    CON
          F774 CDB5C5           CALL    WINDC
          F777 1829             JR      KCOFF
          F779
          F779 CD6AFB   WININ   CALL    CON             ;**3C**
          F77C CD08C6           CALL    WININC
          F77F 1821             JR      KCOFF
          F781
          F781 CD6AFB   WINAK   CALL    CON             ;**3D**
          F784 CDD8C5           CALL    WINAKC
          F787 1819             JR      KCOFF
          F789          ;
          F789 7F7F     KEY7F   DW      7F7FH
          F78B 4B4559           DB      'KEY'
          F78E 01               DB      1
          F78F FE01             CP      1
          F791 3008             JR      NC,KEYL
          F793 CD6AFB   KEYLI   CALL    CON             ;**3A**
          F796 CD1AC5           CALL    KEYLIC  ;Keylist
          F799 1807             JR      KCOFF
          F79B
          F79B 7D       KEYL    LD      A,L     ;Nummer
          F79C CD6AFB   KEY     CALL    CON             ;**39**
          F79F CD6EC4           CALL    KEYC
          F7A2 C371FB   KCOFF   JP      COFF
          F7A5
          F7A5          CUCP    ;Cursor compeln
          F7A5 D5               PUSH    DE              ;**25**
          F7A6 F5               PUSH    AF
          F7A7 E5               PUSH    HL
          F7A8 CD52E0           CALL    PADR0
          F7AB 3822             JR      C,CUCP3 ;au·erhalb
          F7AD E5               PUSH    HL
          F7AE CD7CE0           CALL    DABR
          F7B1 7E               LD      A,M
          F7B2 E1               POP     HL
          F7B3 A7               AND     A       ;Dummy?
          F7B4 200A             JR      NZ,CUCP1
          F7B6 CBCD             SET     1,L     ;vorletzte
          F7B8 CBD5             SET     2,L     ;Cursorzeile
          F7BA 7E               LD      A,M
          F7BB EE7F             XOR     7FH     ;Strichcursor
          F7BD 77               LD      M,A
          F7BE 180F             JR      CUCP3
          F7C0 C5       CUCP1   PUSH    BC
          F7C1 ED5BEEB7         LD      DE,(CUMUST);Muster
          F7C5 0608             LD      B,8     ;Zeichenhîhe
          F7C7 1A       CUCP2   LD      A,(DE)
          F7C8 AE               XOR     M       ;verknÅpfen
          F7C9 77               LD      M,A
          F7CA 13               INC     DE
          F7CB 2C               INC     L
          F7CC 10F9             DJNZ    CUCP2   ;8*
          F7CE C1               POP     BC
          F7CF E1       CUCP3   POP     HL
          F7D0 F1               POP     AF
          F7D1 D1               POP     DE
          F7D2 C9               RET
          F7D3
          F7D3 CD6AFB   PUSE    CALL    CON             ;**30**
          F7D6 CDBBC6           CALL    PUSEC   ;Punkt setzen
          F7D9 1841             JR      COF
          F7DB
          F7DB CD6AFB   PUDE    CALL    CON             ;**2F**
          F7DE CD98C7           CALL    PUDEC   ;Punkt lîschen
          F7E1 1839             JR      COF
          F7E3
          F7E3 CD6AFB   CIRCL   CALL    CON             ;**3F**
          F7E6 CDC8C6           CALL    CIRCLC  ;Kreis
          F7E9 1831             JR      COF
          F7EB
          F7EB CD6AFB   LINE    CALL    CON             ;**3E**
          F7EE CD3EC6           CALL    LINEC   ;Linie
          F7F1 1829             JR      COF
          F7F3
          F7F3 CD6AFB   MBOUT   CALL    CON             ;**38**
          F7F6 CD1CCE           CALL    MBOC    ;Byte ausgeben
          F7F9 1821             JR      COF
          F7FB
          F7FB CD6AFB   MBIN    CALL    CON             ;**37**
          F7FE CD96CE           CALL    MBIC    ;Byte einlesen
          F801 1819             JR      COF
          F803
          F803 CD71FB   JIOERR  CALL    COFF    ;Sprung zu
          F806 2AC9B7           LD      HL,(IOERR);?IO ERROR
          F809 CDA9F0           CALL    IRMOF
          F80C E9               JP      (HL)
          F80D          ;
          F80D 7F7F     SYS7F   DW      7F7FH
          F80F 53595354         DB      'SYSTEM'
          F815 11               DB      11H
          F816 CD6AFB   ESC6    CALL    CON
          F819 CD24C1           CALL    SYSTC
          F81C C371FB   COF     JP      COFF
          F81F
          F81F          BASPV   ;BASIC-I/O-Verteiler
          F81F E5               PUSH    HL
          F820 C5               PUSH    BC
          F821 CD8AF0           CALL    IRMON
          F824 CB6B             BIT     5,E
          F826 D5               PUSH    DE
          F827 2053             JR      NZ,BASBYE       ;BYE
          F829 23               INC     HL
          F82A 23               INC     HL
          F82B CB7B             BIT     7,E
          F82D 2042             JR      NZ,BSA2
          F82F E5               PUSH    HL
          F830 7B               LD      A,E
          F831 E607             AND     7
          F833 2169F8           LD      HL,BUPTAB
          F836 85               ADD     L
          F837 6F               LD      L,A
          F838 7A               LD      A,D     ;Parameter
          F839 53               LD      D,E     ;Steuerbyte
          F83A 5E               LD      E,M     ;UP-Nummer
          F83B E1               POP     HL      ;Dateiname
          F83C CD87F0           CALL    PV3     ;Aufruf
          F83F D1               POP     DE
          F840 57               LD      D,A     ;Ausg.-Param.
          F841 7B               LD      A,E
          F842 E64F             AND     4FH
          F844 EE43             XOR     43H
          F846 2018             JR      NZ,BSA1
          F848 CD51F3           CALL    OSTR
          F84B 56455249         DB      'VERIFY ?(Y):',0
          F858 CD9BF3           CALL    KBD
          F85B FE59             CP      'Y'
          F85D CC29F6           CALL    Z,VERIF
          F860 7A       BSA1    LD      A,D
          F861 CB9B             RES     3,E
          F863 CDA9F0           CALL    IRMOF
          F866 C1               POP     BC
          F867 E1               POP     HL
          F868 C9               RET
          F869
          F869          BUPTAB  ;H-Teil konstant!
          F869 16               DB      16H     ;INTB   #0
          F86A 24               DB      24H     ;OCHR
          F86B 37               DB      37H     ;MBIN   #1
          F86C 38               DB      38H     ;MBOUT
          F86D 06               DB      06H     ;USIN1  #2
          F86E 02               DB      02H     ;UOT1
          F86F 07               DB      07H     ;USIN2  #3
          F870 03               DB      03H     ;UOT2
          F871
          F871 CD98E4   BSA2    CALL    KBDS
          F874 D1               POP     DE
          F875 57               LD      D,A
          F876 30E8             JR      NC,BSA1
          F878 CBBB             RES     7,E
          F87A 18E4             JR      BSA1
          F87C
          F87C 3A5E03   BASBYE  LD      A,(35EH);geschÅtzt?
          F87F A7               AND     A
          F880 2809             JR      Z,BASB1
          F882 CDA9F0           CALL    IRMOF
          F885 CD41C6           CALL    0C641H  ;NEW
          F888 CD8AF0           CALL    IRMON
          F88B 1600     BASB1   LD      D,0
          F88D 3E02             LD      A,2     ;BASIC-ROM
          F88F 6F               LD      L,A     ;abschalten
          F890 CDEEF0           CALL    MODU
          F893 2AB0B7           LD      HL,(SUTAB)
          F896 116A02           LD      DE,SUBAS
          F899 A7               AND     A
          F89A ED52             SBC     HL,DE   ;BASEX aktiv?
          F89C 2006             JR      NZ,BASB2
          F89E 2A0102           LD      HL,(SUSP)
          F8A1 22B0B7           LD      (SUTAB),HL
          F8A4 C310F2   BASB2   JP      LOOP
          F8A7
          F8A7 7E       ZKOUT   LD      A,M             ;**45**
          F8A8 23               INC     HL
          F8A9 A7               AND     A
          F8AA C8               RET     Z
          F8AB CD80F3           CALL    OCHR
          F8AE 18F7             JR      ZKOUT
          F8B0
          F8B0 CD9EF5   TON     CALL    LARG            ;**35**
          F8B3 DDCB084E TON1    BIT     1,(IX+8);noch alter Ton
          F8B7 20FA             JR      NZ,TON1
          F8B9 C5       TON2    PUSH    BC
          F8BA 0E8C             LD      C,8CH   ;CTC0
          F8BC CDE5F8           CALL    TON4    ;starten
          F8BF 0C               INC     C       ;CTC1
          F8C0 EB               EX      DE,HL
          F8C1 CDE5F8           CALL    TON4    ;starten
          F8C4 C1               POP     BC
          F8C5 79               LD      A,C     ;LautstÑrke
          F8C6 EE1F             XOR     1FH     ;da nullaktiv
          F8C8 F681             OR      81H     ;maskieren
          F8CA 4F               LD      C,A
          F8CB 78               LD      A,B
          F8CC A7               AND     A       ;Dauerton?
          F8CD 280D             JR      Z,TON3
          F8CF CBB9             RES     7,C     ;nein, Blinkaus
          F8D1 DDCB08CE         SET     1,(IX+8);neuer Ton
          F8D5 3EC7             LD      A,0C7H  ;EI,ZÑhler 50Hz
          F8D7 D38E             OUT     8EH     ;CTC2
          F8D9 78               LD      A,B     ;Dauer
          F8DA D38E             OUT     8EH
          F8DC 0660     TON3    LD      B,60H
          F8DE DB89     TONB    IN      A,89H
          F8E0 A0               AND     B       ;RAM8 maskieren
          F8E1 B1               OR      C
          F8E2 D389             OUT     89H     ;Ltst. ausgeben
          F8E4 C9               RET
          F8E5
          F8E5          TON4    ;CTC (C) programmieren mit HL
          F8E5 7D               LD      A,L
          F8E6 A7               AND     A       ;Ton?
          F8E7 2E03             LD      L,3
          F8E9 280B             JR      Z,TON6  ;kein Ton
          F8EB 6F               LD      L,A
          F8EC 3E07             LD      A,7     ;Zeitgeber
          F8EE CB44             BIT     0,H     ;Vorteiler?
          F8F0 2802             JR      Z,TON5
          F8F2 F620             OR      20H     ;ja
          F8F4 ED79     TON5    OUT     (C),A
          F8F6 ED69     TON6    OUT     (C),L
          F8F8 C9               RET
          F8F9
          F8F9          ;ESC-Funktionen:
          F8F9 0100B2   ESC1    LD      BC,0B200H
          F8FC 180D             JR      ESCVR
          F8FE
          F8FE 0105AD   ESC2    LD      BC,0AD05H
          F901 1808             JR      ESCVR
          F903
          F903 0104AD   ESC3    LD      BC,0AD04H
          F906 1803             JR      ESCVR
          F908
          F908 0101B2   ESC4    LD      BC,0B201H
          F90B 60       ESCVR   LD      H,B
          F90C 2E00             LD      L,0
          F90E 22CBB7           LD      (VRAM),HL
          F911 06FA             LD      B,0FAH
          F913          AXO84   ;AND/XOR/OUT84
          F913 78               LD      A,B
          F914 F3                DI
          F915 DDA601            AND    (IX+1)
          F918 A9                XOR    C
          F919 DD7701   OUT84    LD     (IX+1),A
          F91C D384              OUT    (84H),A
          F91E FB               EI
          F91F C9               RET
          F920
          F920 0E04     ESC7    LD      C,4     ;Invers-Bit
          F922 21A2B7   XORSTB  LD      HL,STBT
          F925 7E               LD      A,M
          F926 A9               XOR     C
          F927 77               LD      M,A
          F928 C9               RET
          F929
          F929 DD7E01   ESC9    LD      A,(IX+1)
          F92C EE02             XOR     2
          F92E F3               DI
          F92F 18E8             JR      OUT84
          F931
          F931 21A2B7   ESCA    LD      HL,STBT
          F934 CBB6             RES     6,M     ;HRG aus
          F936 0108FF   ESCAB   LD      BC,0FF08H
          F939 CD13F9           CALL    AXO84
          F93C 01007F           LD      BC,7F00H;Blinken aus
          F93F CB5F             BIT     3,A
          F941 2802             JR      Z,AXO89
          F943 0E80             LD      C,80H   ;ein
          F945 DB89     AXO89   IN      A,89H
          F947 A0               AND     B
          F948 A9               XOR     C
          F949 D389             OUT     89H
          F94B C9               RET
          F94C
          F94C 21A2B7   ESCB    LD      HL,STBT
          F94F CBF6             SET     6,M     ;HRG ein
          F951 18E3             JR      ESCAB
          F953
          F953 0E20     ESCC    LD      C,20H   ;IBM <-> CAOS
          F955 18CB             JR      XORSTB
          F957          ;
          F957 7F7F     V24O7F  DW      7F7FH
          F959 5632344F         DB      'V24OUT'
          F95F 01               DB      1
          F960          V24OUT  ;Druckerroutine          **47**
          F960 CD6AFB           CALL    CON
          F963 CDDEC8           CALL    V24OC
          F966 3E0D     V24CRLF LD      A,CR
          F968 CDB4F9           CALL    PRINT
          F96B 3E0A             LD      A,LF    ;CR+LF drucken
          F96D CDB4F9           CALL    PRINT
          F970 C371FB   COF1    JP      COFF
          F973
          F973          HCPGM   ;Reaktion auf ShCLR
          F973 F5               PUSH    AF
          F974 DD7E04           LD      A,(IX+4);CAOSC merken
          F977 F5               PUSH    AF
          F978 CBFF             SET     7,A     ;CAOSC on
          F97A DD7704           LD      (IX+4),A
          F97D D386             OUT     86H
          F97F CD6ACA           CALL    HCPGMC
          F982 F1               POP     AF
          F983 DD7704           LD      (IX+4),A;wie vorher
          F986 D386             OUT     86H
          F988 F1               POP     AF
          F989 C9               RET
          F98A
          F98A          ;
          F98A 7F7F     V24D7F  DW      7F7FH
          F98C 56323444         DB      'V24DUP'
          F992 01               DB      1
          F993          V24DUP  ;Duplexroutine           **48**
          F993 CD6AFB           CALL    CON
          F996 CD5ECD           CALL    V24DC
          F999 18D5             JR      COF1
          F99B
          F99B CD6AFB   INIDUP  CALL    CON
          F99E CDD4CD           CALL    UMINIT  ;INT init.
          F9A1 18CD             JR      COF1
          F9A3
          F9A3          ;Centronics initialisieren
          F9A3 7F7F     CEN7F   DW      7F7FH
          F9A5 43454E           DB      'CEN'
          F9A8 01               DB      1
          F9A9 CD6AFB           CALL    CON
          F9AC CDB4C8           CALL    CENC
          F9AF 18B5             JR      V24CRLF
          F9B1
          F9B1          ECHO    ;Druckroutine mit Protokoll
          F9B1 CDF7E3           CALL    CRT
          F9B4 DDCB047E PRINT   BIT     7,(IX+4)
          F9B8 2008             JR      NZ,PR1  ;CAOSC on!
          F9BA E5               PUSH    HL
          F9BB 2171FB           LD      HL,COFF ;nach PRINTC
          F9BE E3               EX      (SP),HL ;wieder aus
          F9BF CD6AFB           CALL    CON
          F9C2 CD0CCA   PR1     CALL    PRINTC  ;drucken
          F9C5 C9               RET
          F9C6
          F9C6          M001PR  ;Druckroutine fÅr M001
          F9C6 F5               PUSH    AF
          F9C7 DB05     BUSY1   IN      A,(5)
          F9C9 CB57             BIT     2,A     ;BUSY?
          F9CB 20FA             JR      NZ,BUSY1
          F9CD F1               POP     AF
          F9CE F5               PUSH    AF
          F9CF D304             OUT     (4),A   ;Daten
          F9D1 AF               XOR     A
          F9D2 D305             OUT     (5),A
          F9D4 3C               INC     A       ;Strobe-Imp.
          F9D5 D305             OUT     (5),A
          F9D7 F1               POP     AF
          F9D8 C9               RET
          F9D9
          F9D9          M021PR  ;Druckroutine fÅr M021
          F9D9 F5               PUSH    AF
          F9DA DB90     BUSY2   IN      A,(90H)
          F9DC CB77             BIT     6,A     ;BUSY?
          F9DE 20FA             JR      NZ,BUSY2
          F9E0 F1               POP     AF
          F9E1 F5               PUSH    AF
          F9E2 D391             OUT     (91H),A ;Daten
          F9E4 AF               XOR     A
          F9E5 D390             OUT     (90H),A
          F9E7 3E80             LD      A,80H   ;Strobe-Imp.
          F9E9 D390             OUT     (90H),A
          F9EB F1               POP     AF
          F9EC C9               RET
          F9ED
          F9ED          V24PR   ;Druckroutine fÅr V24
          F9ED F5               PUSH    AF
          F9EE C5       V24PR1  PUSH    BC
          F9EF CD6EFA           CALL    LCSO
          F9F2 3E0A             LD      A,0AH
          F9F4 81               ADD     C
          F9F5 4F               LD      C,A
          F9F6 ED78             IN      A,(C)
          F9F8 CB57             BIT     2,A     ;bereit?
          F9FA 2008             JR      NZ,V24PR2
          F9FC 3E01             LD      A,1     ;nein-warten
          F9FE CD3DF3           CALL    WAIT
          FA01 C1               POP     BC
          FA02 18EA             JR      V24PR1
          FA04 C1       V24PR2  POP     BC
          FA05 F1               POP     AF
          FA06 C5               PUSH    BC
          FA07 F5               PUSH    AF
          FA08 CD6EFA           CALL    LCSO
          FA0B 3E08     V24PUT  LD      A,8
          FA0D 81               ADD     C
          FA0E 4F               LD      C,A
          FA0F F1               POP     AF
          FA10 ED79             OUT     (C),A   ;Ausgabe
          FA12 C1               POP     BC
          FA13 C9               RET
          FA14
          FA14          V24OT   ;Ausgabe V.24-duplex
          FA14 F5               PUSH    AF
          FA15 C5       V24OT1  PUSH    BC
          FA16 CD7BFA           CALL    LCSOD   ;Adresse holen
          FA19 3E0A             LD      A,0AH
          FA1B 81               ADD     C
          FA1C 4F               LD      C,A
          FA1D ED78             IN      A,(C)
          FA1F CB57             BIT     2,A     ;Puffer leer?
          FA21 2008             JR      NZ,V24OT2
          FA23 3E01             LD      A,1
          FA25 CD3DF3           CALL    WAIT    ;kurz warten
          FA28 C1               POP     BC
          FA29 18EA             JR      V24OT1
          FA2B C1       V24OT2  POP     BC
          FA2C F1               POP     AF
          FA2D C5               PUSH    BC
          FA2E F5               PUSH    AF
          FA2F CD7BFA           CALL    LCSOD
          FA32 18D7             JR      V24PUT  ;Zeichen ausgeb.
          FA34
          FA34          V24IN   ;Eingabe V.24-duplex
          FA34 C5               PUSH    BC
          FA35 E5               PUSH    HL
          FA36 D5               PUSH    DE
          FA37 CD7BFA           CALL    LCSOD
          FA3A C5               PUSH    BC
          FA3B 3E0A             LD      A,0AH   ;SIO-Steuerport
          FA3D 81               ADD     C
          FA3E 4F               LD      C,A
          FA3F ED78             IN      A,(C)
          FA41 CB47             BIT     0,A     ;bereit?
          FA43 2016             JR      NZ,V24IN2
          FA45 3E05             LD      A,5     ;WR5
          FA47 ED79             OUT     (C),A
          FA49 3EEA             LD      A,0EAH  ;DTR on
          FA4B ED79             OUT     (C),A   ;Senderfreigabe
          FA4D ED78     V24IN1  IN      A,(C)
          FA4F CB47             BIT     0,A     ;jetzt bereit?
          FA51 2008             JR      NZ,V24IN2
          FA53 CDACE4           CALL    BRKT
          FA56 30F5             JR      NC,V24IN1
          FA58 C1               POP     BC
          FA59 180F             JR      V24IN3
          FA5B                  ;
          FA5B 3E05     V24IN2  LD      A,5     ;WR5
          FA5D ED79             OUT     (C),A
          FA5F 3E6A             LD      A,6AH   ;DTR off
          FA61 ED79             OUT     (C),A
          FA63 C1               POP     BC
          FA64 3E08             LD      A,8     ;SIO-Datenport
          FA66 81               ADD     C
          FA67 4F               LD      C,A
          FA68 ED78             IN      A,(C)   ;Einlesen
          FA6A D1       V24IN3  POP     DE
          FA6B E1               POP     HL
          FA6C C1               POP     BC
          FA6D C9               RET
          FA6E
          FA6E          LCSO    ;SIO-Offset fÅr V24OUT
          FA6E F5               PUSH    AF
          FA6F 3AE1B7           LD      A,(HCPZ)
          FA72 CB57     LCSO1   BIT     2,A     ;Kanal A oder B?
          FA74 0E01             LD      C,1
          FA76 2001             JR      NZ,LCSOE
          FA78 0D               DEC     C
          FA79 F1       LCSOE   POP     AF
          FA7A C9               RET
          FA7B
          FA7B          LCSOD   ;SIO-Offset fÅr V24DUP
          FA7B F5               PUSH    AF
          FA7C 3AE8B7           LD      A,(HCPZ2)
          FA7F 18F1             JR      LCSO1
          FA81
          FA81          ISRT    ;ISR fÅr Fremdtastatur
          FA81 E5               PUSH    HL
          FA82 D5               PUSH    DE
          FA83 C5               PUSH    BC
          FA84 F5               PUSH    AF
          FA85 DB88             IN      A,88H
          FA87 4F               LD      C,A
          FA88 CBD7             SET     2,A     ;IRM on!
          FA8A D388             OUT     88H
          FA8C DD4604           LD      B,(IX+4);CAOS-C
          FA8F C5               PUSH    BC      ;merken
          FA90 3A00A8           LD      A,(V24PL)
          FA93 47               LD      B,A     ;Steckplatz M003
          FA94 0E80             LD      C,80H
          FA96 3E01             LD      A,1
          FA98 ED79             OUT     (C),A   ;Modul on!
          FA9A C5               PUSH    BC
          FA9B DB09             IN      A,9     ;empf. Code
          FA9D CD23E6           CALL    IRET
          FAA0 A7               AND     A
          FAA1 2814             JR      Z,IST2  ;Code 0
          FAA3 DDBE0D           CP      (IX+13)
          FAA6 2806             JR      Z,IST1  ;Repeat!
          FAA8 DD360A00         LD      (IX+10),0
          FAAC 1809             JR      IST2
          FAAE 57       IST1    LD      D,A     ;Code merken
          FAAF 3AE0B7           LD      A,(COUNT)
          FAB2 3C               INC     A
          FAB3 DD770A           LD      (IX+10),A ;repeat jetzt
          FAB6 7A               LD      A,D
          FAB7 DD770D   IST2    LD      (IX+13),A ;Code
          FABA A7               AND     A
          FABB 2855             JR      Z,ISB3
          FABD DDCB08C6         SET     0,(IX+8);aktivieren
          FAC1 184F             JR      ISB3    ;Originalzust.
          FAC3
          FAC3          ISRSB   ;ISR SIO B (Empfang)
          FAC3                  ;MC-Load oder Fremdtastatur
          FAC3 E5               PUSH    HL
          FAC4 D5               PUSH    DE
          FAC5 C5               PUSH    BC
          FAC6 F5               PUSH    AF
          FAC7 DB88             IN      A,88H
          FAC9 4F               LD      C,A
          FACA CBD7             SET     2,A     ;IRM on!
          FACC D388             OUT     88H
          FACE DD4604           LD      B,(IX+4);CAOS-C
          FAD1 C5               PUSH    BC      ;merken
          FAD2 3A00A8           LD      A,(V24PL)
          FAD5 47               LD      B,A     ;Steckplatz M003
          FAD6 0E80             LD      C,80H
          FAD8 3E01             LD      A,1
          FADA ED79             OUT     (C),A   ;Modul on!
          FADC C5               PUSH    BC
          FADD DB09             IN      A,9     ;empf. Zeichen
          FADF 2165FB           LD      HL,DTROFF
          FAE2 CD14F5           CALL    INIEA   ;DTR off
          FAE5 CD23E6           CALL    IRET
          FAE8 CD6AFB           CALL    CON     ;CAOS-C on
          FAEB FE0D             CP      CR      ;Fremdtastatur?
          FAED 2815             JR      Z,ISB2
          FAEF FE1B             CP      ESC     ;MC-Programm?
          FAF1 2019             JR      NZ,ISB1
          FAF3 3E06             LD      A,6     ;UOUT2, Kanal B
          FAF5 CD89CD           CALL    V24DCF  ;Duplex init.
          FAF8 CD34FA           CALL    V24IN   ;Folgezeichen
          FAFB D654             SUB     'T'     ;ESC-T ?
          FAFD 2829             JR      Z,ISB4  ;-> MC laden
          FAFF 3D               DEC     A       ;ESC-U ?
          FB00 2843             JR      Z,ISB6  ;-> MC starten
          FB02 1808             JR      ISB1    ;sonst nichts!
          FB04                  ;
          FB04 2181FA   ISB2    LD      HL,ISRT ;neue Tast.-ISR
          FB07 F3               DI
          FB08 22E201           LD      (1E2H),HL
          FB0B FB               EI
          FB0C 210FCE   ISB1    LD      HL,DTRON
          FB0F CD14F5           CALL    INIEA   ;DTR on
          FB12 C1       ISB3    POP     BC
          FB13 16B8             LD      D,0B8H  ;MSTW-Speicher
          FB15 58               LD      E,B
          FB16 1A               LD      A,(DE)  ;Schaltzustand
          FB17 ED79             OUT     (C),A   ;wie zuvor
          FB19 C1       ISB7    POP     BC
          FB1A 78               LD      A,B
          FB1B DD7704           LD      (IX+4),A;IX+4 und OUT86
          FB1E D386             OUT     86H     ;wie vor INT!
          FB20 79               LD      A,C
          FB21 D388             OUT     88H     ;IRM wie zuvor
          FB23 F1               POP     AF
          FB24 C1               POP     BC
          FB25 D1               POP     DE
          FB26 E1               POP     HL
          FB27 C9               RET
          FB28
          FB28                  ; MC laden:
          FB28 DDCB04BF ISB4    RES     7,(IX+4),A
          FB2C D386             OUT     86H     ;CAOS-C off
          FB2E CD5CFB           CALL    V24HL   ;Adresse
          FB31 EB               EX      DE,HL
          FB32 CD5CFB           CALL    V24HL   ;Anzahl
          FB35 EB               EX      DE,HL
          FB36 CD34FA   ISB5    CALL    V24IN
          FB39 77               LD      M,A     ;Daten in
          FB3A 23               INC     HL      ;Speicher poken
          FB3B 1B               DEC     DE
          FB3C 7B               LD      A,E
          FB3D B2               OR      D       ;bis Anzahl=0
          FB3E 20F6             JR      NZ,ISB5
          FB40 CD6AFB   ISBC    CALL    CON     ;CAOS-C on
          FB43 18C7             JR      ISB1
          FB45
          FB45                  ; MC starten:
          FB45 CD5CFB   ISB6    CALL    V24HL   ;Startadresse
          FB48 EB               EX      DE,HL
          FB49 210FCE           LD      HL,DTRON
          FB4C CD14F5           CALL    INIEA   ;DTR on
          FB4F EB               EX      DE,HL
          FB50 C1               POP     BC
          FB51 16B8             LD      D,0B8H  ;MSTW-Speicher
          FB53 58               LD      E,B
          FB54 1A               LD      A,(DE)  ;Schaltzustand
          FB55 ED79             OUT     (C),A   ;wie zuvor
          FB57 CD2CE2           CALL    JPHL    ;Prog. starten
          FB5A 18BD             JR      ISB7
          FB5C
          FB5C CD34FA   V24HL   CALL    V24IN
          FB5F 6F               LD      L,A
          FB60 CD34FA           CALL    V24IN
          FB63 67               LD      H,A
          FB64 C9               RET
          FB65
          FB65 0B       DTROFF  DB      0BH     ;SIO-B
          FB66 03                DB     3       ;3 Byte
          FB67 18                 DB    18H     ;rÅcksetzen
          FB68 05                 DB    5       ;WR5
          FB69 6A                 DB    6AH     ;DTR off
          FB6A
          FB6A          CON     ;CAOS-ROM C on
          FB6A F5               PUSH    AF
          FB6B DDCB04FF         SET     7,(IX+4),A
          FB6F 180C             JR      CSW
          FB71
          FB71          COFF    ;CAOS-ROM C off
          FB71 F5               PUSH    AF
          FB72 3A05B8           LD      A,(0B805H)
          FB75 E601             AND     1
          FB77 2006             JR      NZ,CNSW ;bleibt on!
          FB79 DDCB04BF         RES     7,(IX+4),A
          FB7D D386     CSW     OUT     86H
          FB7F F1       CNSW    POP     AF
          FB80 C9               RET
          FB81
          FB81          MULT    ;BA=D*C                  **41**
          FB81 CD6AFB           CALL    CON
          FB84 CD73C5           CALL    MULC
          FB87 18E8             JR      COFF
          FB89
          FB89 CD6AFB   SQR     CALL    CON             ;**40**
          FB8C CD64C5           CALL    SQRC
          FB8F 18E0             JR      COFF
          FB91
          FB91          ISRC2   ;CTC2: Tonlg
          FB91 CD23E6           CALL    IRET    ;EI/RETI
          FB94 F5               PUSH    AF
          FB95 D5               PUSH    DE
          FB96 DB88             IN      A,88H
          FB98 5F               LD      E,A
          FB99 CBD7             SET     2,A     ;IRM on
          FB9B D388             OUT     88H
          FB9D CDCFE4           CALL    TOFF
          FBA0 7B               LD      A,E
          FBA1 D388             OUT     88H
          FBA3 D1               POP     DE
          FBA4 F1               POP     AF
          FBA5 C9               RET
          FBA6
          FBA6 00       ZEI0    DB      0       ;CRT
          FBA7 38               DB      38H     ;MBOUT
          FBA8 02       ZEI2    DB      2       ;UOUT1
          FBA9 03       ZEI3    DB      3       ;UOUT2
          FBAA 04       ZEI4    DB      4       ;KBD
          FBAB 37               DB      37H     ;MBIN
          FBAC 06               DB      6       ;UIN1
          FBAD 07               DB      7       ;UIN2
          FBAE
          FBAE F7E3     SUTB    DW      CRT     ;00
          FBB0 37E5             DW      MBO     ;01
          FBB2 BDB7             DW      UOUT1   ;02
          FBB4 C3B7             DW      UOUT2   ;03
          FBB6 9BF3             DW      KBD     ;04
          FBB8 9DE5             DW      MBI     ;05
          FBBA C0B7             DW      UIN1    ;06
          FBBC C6B7             DW      UIN2    ;07
          FBBE 28E5             DW      ISRO    ;08
          FBC0 DBE4             DW      CSRO    ;09
          FBC2 9AE5             DW      ISRI    ;0A
          FBC4 EBF6             DW      CSRI    ;0B
          FBC6 98E4             DW      KBDS    ;0C
          FBC8 45F1             DW      BYE     ;0D
          FBCA A3E4             DW      KBDZ    ;0E
          FBCC 0DF7             DW      COLR    ;0F
          FBCE 36F6             DW      LOAD    ;10
          FBD0 29F6             DW      VERIF   ;11
          FBD2 10F2             DW      LOOP    ;12
          FBD4 5DF3             DW      NORM    ;13
          FBD6 3DF3             DW      WAIT    ;14
          FBD8 9EF5             DW      LARG    ;15
          FBDA 7AF3             DW      INTB    ;16
          FBDC 3CF4             DW      INLIN   ;17
          FBDE A7F4             DW      RHEX    ;18
          FBE0 76F4             DW      ERRM    ;19
          FBE2 69F4             DW      HLHX    ;1A
          FBE4 9EF4             DW      HLDE    ;1B
          FBE6 8BF4             DW      AHEX    ;1C
          FBE8 0DF3             DW      ZSUCH   ;1D
          FBEA 63F3             DW      SOUT    ;1E
          FBEC 70F3             DW      SIN     ;1F
          FBEE 60F3             DW      NOUT    ;20
          FBF0 6DF3             DW      NIN     ;21
          FBF2 DCF4             DW      GARG    ;22
          FBF4 51F3             DW      OSTR    ;23
          FBF6 80F3             DW      OCHR    ;24
          FBF8 A5F7             DW      CUCP    ;25
          FBFA EEF0             DW      MODU    ;26
          FBFC FFF0             DW      JUMP    ;27
          FBFE E4E3             DW      LDMA    ;28
          FC00 E6E3             DW      LDAM    ;29
          FC02 ACE4             DW      BRKT    ;2A
          FC04 71F4             DW      SPACE   ;2B
          FC06 80F4             DW      CRLF    ;2C
          FC08 87F4             DW      HOME    ;2D
          FC0A 50F7             DW      MODI    ;2E
          FC0C DBF7             DW      PUDE    ;2F
          FC0E D3F7             DW      PUSE    ;30
          FC10 02F5             DW      SIXD    ;31
          FC12 7CE0             DW      DABR    ;32
          FC14 70E0             DW      TCIF    ;33
          FC16 60E0             DW      PADR    ;34
          FC18 B0F8             DW      TON     ;35
          FC1A 41F5             DW      SAVE    ;36
          FC1C FBF7             DW      MBIN    ;37
          FC1E F3F7             DW      MBOUT   ;38
          FC20 9CF7             DW      KEY     ;39
          FC22 93F7             DW      KEYLI   ;3A
          FC24 2CF7             DW      DISP    ;3B
          FC26 79F7             DW      WININ   ;3C
          FC28 81F7             DW      WINAK   ;3D
          FC2A EBF7             DW      LINE    ;3E
          FC2C E3F7             DW      CIRCL   ;3F
          FC2E 89FB             DW      SQR     ;40
          FC30 81FB             DW      MULT    ;41
          FC32 15F7             DW      CSTBT   ;42
          FC34 14F5             DW      INIEA   ;43
          FC36 1FF5             DW      INIME   ;44
          FC38 A7F8             DW      ZKOUT   ;45
          FC3A D2F1             DW      MENU    ;46
          FC3C 60F9             DW      V24OUT  ;47
          FC3E 93F9             DW      V24DUP  ;48
          FC40
          FC40
          FC40 5777     KTAB    DB      'Ww'
          FC42 4161             DB      'Aa'
          FC44 3222             DB      '2"'
          FC46 0819             DB      8,19H           ;CUL
          FC48 100C             DB      10H,0CH         ;HOME
          FC4A 2D3D             DB      '-='
          FC4C F2F8             DB      0F2H,0F8H       ;F2
          FC4E 5979             DB      'Yy'
          FC50 4565             DB      'Ee'
          FC52 5373             DB      'Ss'
          FC54 3323             DB      '3#'
          FC56 5E5D             DB      '^ö'
          FC58 010F             DB      1,0FH           ;CLR
          FC5A 3A2A             DB      ':*'
          FC5C F3F9             DB      0F3H,0F9H       ;F3
          FC5E 5878             DB      'Xx'
          FC60 5474             DB      'Tt'
          FC62 4666             DB      'Ff'
          FC64 3525             DB      '5%'
          FC66 5070             DB      'Pp'
          FC68 1F02             DB      1FH,2           ;DEL
          FC6A 3040             DB      '0',40H
          FC6C F5FB             DB      0F5H,0FBH       ;F5
          FC6E 5676             DB      'Vv'
          FC70 5575             DB      'Uu'
          FC72 4868             DB      'Hh'
          FC74 3727             DB      '7',27H
          FC76 4F6F             DB      'Oo'
          FC78 1A14             DB      1AH,14H         ;INS
          FC7A 3929             DB      '9)'
          FC7C 0304             DB      3,4             ;BRK
          FC7E 4E6E             DB      'Nn'
          FC80 4969             DB      'Ii'
          FC82 4A6A             DB      'Jj'
          FC84 3828             DB      '8('
          FC86 205B             DB      ' é'            ;SPC
          FC88 4B6B             DB      'Kk'
          FC8A 2C3C             DB      ',<'
          FC8C 131B             DB      13H,ESC         ;STOP
          FC8E 4D6D             DB      'Mm'
          FC90 5A7A             DB      'Zz'
          FC92 4767             DB      'Gg'
          FC94 3626             DB      '6&'
          FC96 1C1D             DB      1CH,1DH     ;LIST/RUN
          FC98 4C6C             DB      'Ll'
          FC9A 2E3E             DB      '.>'
          FC9C F6FC             DB      0F6H,0FCH       ;F6
          FC9E 4262             DB      'Bb'
          FCA0 5272             DB      'Rr'
          FCA2 4464             DB      'Dd'
          FCA4 3424             DB      '4$'
          FCA6 5F5C             DB      '_ô'
          FCA8 2B3B             DB      '+;'
          FCAA 2F3F             DB      '/?'
          FCAC F4FA             DB      0F4H,0FAH       ;F4
          FCAE 4363             DB      'Cc'
          FCB0 5171             DB      'Qq'
          FCB2 1605             DB      16H,5           ;CAPS
          FCB4 3121             DB      '1!'
          FCB6 0A12             DB      LF,12H          ;CUD
          FCB8 0B11             DB      0BH,11H         ;CUU
          FCBA 0918             DB      09H,18H         ;CUR
          FCBC F1F7             DB      0F1H,0F7H       ;F1
          FCBE 0D0E             DB      CR,0EH          ;ENTER
          FCC0
          FCC0                                  ;PIO-A(Joystick)
          FCC0 C3FA     ISRTAB  DW      ISRSB   ;SIO B:Empfang
          FCC2 14E6             DW      ISRPA   ;PIO A:Kassette
          FCC4 13E4             DW      ISRPB   ;PIO B:Tastatur
          FCC6 23E6             DW      IRET    ;CTC 0:frei
          FCC8 04E6             DW      ISRC1   ;CTC 1:Kassette
          FCCA 91FB             DW      ISRC2   ;CTC 2:Tondauer
          FCCC 07E4             DW      ISRC3   ;CTC 3:Tastatur
          FCCE
          FCCE
          FCCE F0E3     CRTTAB  DW      NOT     ;00
          FCD0 74E2             DW      CLR     ;01
          FCD2 3CE3             DW      CLLN    ;02
          FCD4 F0E3             DW      NOT     ;03=BRK
          FCD6 F0E3             DW      NOT     ;04=Sh-BRK
          FCD8 2DE2             DW      ESC0    ;05=TAB
          FCDA F0E3             DW      NOT     ;06
          FCDC A5E3             DW      BEEP    ;07
          FCDE 53E2             DW      CUL     ;08
          FCE0 3CE2             DW      CUR     ;09
          FCE2 45E2             DW      CUD     ;0A
          FCE4 63E2             DW      CUU     ;0B
          FCE6 C9E2             DW      CLS     ;0C
          FCE8 D9E2             DW      CBL     ;0D=Enter
          FCEA F0E3             DW      NOT     ;0E=Sh-Enter
          FCEC 4FE2             DW      HCOPY   ;0F
          FCEE D7E2             DW      HOMEPG  ;10
          FCF0 68E2             DW      PAGE    ;11
          FCF2 6FE2             DW      SCROL   ;12
          FCF4 F0E3             DW      NOT     ;13=STOP
          FCF6 E8E3             DW      CLICK   ;14
          FCF8 F0E3             DW      NOT     ;15
          FCFA F0E3             DW      NOT     ;16=CAPS
          FCFC F0E3             DW      NOT     ;17
          FCFE 5DE2             DW      CEL     ;18
          FD00 D9E2             DW      CBL     ;19
          FD02 AAE2             DW      INS     ;1A
          FD04 F1E3             DW      ESCPRG  ;1B
          FD06 F0E3             DW      NOT     ;1C=LIST
          FD08 F0E3             DW      NOT     ;1D=RUN
          FD0A 43E2             DW      NL      ;1E=CONT
          FD0C 77E2             DW      DEL     ;1F
          FD0E
          FD0E
          FD0E          TOKTAB  ;BASIC-Token
          FD0E                  ;(Bit 7 im 1. Byte gesetzt!)
          FD0E C94E4B45         DB      '+NKEY$'
          FD14 CA4F5953         DB      '-OYST'
          FD19 D3545249         DB      '”TRING$'
          FD20 C94E5354         DB      '+NSTR'
          FD25 D2454E55         DB      '“ENUMBER'
          FD2D C4454C45         DB      '-ELETE'
          FD33 D0415553         DB      '–AUSE'
          FD38 C2454550         DB      '-EEP'
          FD3C D7494E44         DB      '◊INDOW'
          FD42 C24F5244         DB      '-ORDER'
          FD48 C94E4B           DB      '+NK'
          FD4B D0415045         DB      '–APER'
          FD50 C154             DB      '-T'
          FD52 C34F4C4F         DB      '+OLOR'
          FD57 D34F554E         DB      '”OUND'
          FD5C D0534554         DB      '–SET'
          FD60 D0524553         DB      '–RESET'
          FD66 C24C4F41         DB      '-LOAD'
          FD6B D6504545         DB      '÷PEEK'
          FD70 D6504F4B         DB      '÷POKE'
          FD75 CC4F4341         DB      '›OCATE'
          FD7B CB45594C         DB      '-EYLIST'
          FD82 CB4559           DB      '-EY'
          FD85 D3574954         DB      '”WITCH'
          FD8B D0544553         DB      '–TEST'
          FD90 C34C4F53         DB      '+LOSE'
          FD95 CF50454E         DB      'œPEN'
          FD99 D2414E44         DB      '“ANDOMIZE'
          FDA2 D6474554         DB      '÷GET$'
          FDA7 CC494E45         DB      '›INE'
          FDAB C3495243         DB      '+IRCLE'
          FDB1 C353524C         DB      '+SRLIN'
          FDB7 80               DB      80H
          FDB8
          FDB8          TOKJP   ;Sprungtabelle fÅr BASIC-Token
          FDB8 86EB             DW      INKEY
          FDBA FD02             DW      02FDH   ;JOYST
          FDBC 12E7             DW      STRING
          FDBE 2DEC             DW      INSTR
          FDC0 71E7             DW      RENUM
          FDC2 51E9             DW      DELETE
          FDC4 76E9             DW      PAUSE
          FDC6 A8E9             DW      BBEEP
          FDC8 BDE9             DW      WINDOW
          FDCA 93EA             DW      BORDER
          FDCC 04EB             DW      INK
          FDCE 1EEB             DW      PAPER
          FDD0 48C3             DW      0C348H  ;AT
          FDD2 3AEB             DW      BCOLOR
          FDD4 A1EB             DW      SOUND
          FDD6 E4EB             DW      PSET
          FDD8 15EC             DW      PRESET
          FDDA 47EA             DW      BLOAD
          FDDC 48C3             DW      0C348H  ;VPEEK
          FDDE 76EA             DW      VPOKE
          FDE0 52EB             DW      LOCATE
          FDE2 AEEC             DW      KEYLIST
          FDE4 A2EC             DW      BKEY
          FDE6 B2EC             DW      SWITCH
          FDE8 48C3             DW      0C348H  ;PTEST
          FDEA FEEC             DW      CLOSE
          FDEC 3CED             DW      OPEN
          FDEE 36ED             DW      RANDOM
          FDF0 48C3             DW      0C348H  ;VGET
          FDF2 71ED             DW      BLINE
          FDF4 76ED             DW      CIRCLE
          FDF6
          FDF6          FREIF   EQU     $
          FDF6 FFFF             DS      0FDF8H-$,0FFH   ;frei
          FDF8
          FDF8 80402010 BITTAB  DB      80H,40H,20H,10H
          FDFC 08040201         DB      8,4,2,1
          FE00
          FE00                  END

        Errors: 0000
        End+1 : FE00
        
