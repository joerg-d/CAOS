SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   1
CAOS45  Z80

    1                   ;*************************************************
    2                   ;**						**
    3                   ;**	CAOS 4.5   (c) KC-Club 2010		**
    4                   ;**						**
    5                   ;*************************************************
    6                   ;**						**
    7                   ;**	Entwickler:				**
    8                   ;**		Mario Leubner			**
    9                   ;**		Daniel Elstner			**
   10                   ;**		...				**
   11                   ;**						**
   12                   ;**	Versionen:				**
   13                   ;**	13.04.1994 - CAOS 4.2 Reassemblierung	**
   14                   ;**	17.02.1995 - CAOS 4.3			**
   15                   ;**	09.02.2003 - CAOS 4.4			**
   16                   ;**	26.05.2010 - CAOS 4.5 beta		**
   17                   ;**	29.05.2010 - CAOS 4.5 beta2		**
   18                   ;**	30.05.2010 - CAOS 4.5 beta3		**
   19                   ;**	08.06.2010 - CAOS 4.5 beta4		**
   20                   ;**	13.06.2010 - CAOS 4.5 beta5		**
   21                   ;**	19.06.2010 - CAOS 4.5 beta6		**
   22                   ;**	30.07.2010 - CAOS 4.5 beta7		**
   23                   ;**	28.08.2010 - CAOS 4.5 beta8		**
   24                   ;**	06.09.2010 - finale Version		**
   25                   ;**						**
   26                   ;*************************************************
   27                   
   28         0000      beta	equ	0		; 0 fuer Vollversion, 1 fuer beta-Version
   29                   DATUM	MACRO
   30                   	DB	'06.09.2010'	; Versionsdatum nur hier aendern!
   31                   	ENDM
   32                   
   33                   ; Uebersetzen ohne Erzeugen eines Listings:
   34                   ;	SLRZ80 CAOS45.@@Z/F
   35                   ; oder:	Z80ASM CAOS45.@@Z/F
   36                   ;	REN CAOS45.COM CAOS45.KCC
   37                   
   38                   ; Uebersetzen mit Erzeugen eines Listings:
   39                   ;	SLRZ80 CAOS45/F
   40                   ; oder:	Z80ASM CAOS45/F
   41                   ;	REN CAOS45.COM CAOS45.KCC
   42                   
   43                   ; Hardware:	(KC85/5)
   44                   ;
   45                   ;256 KByte interner RAM (RAM0,RAM4,RAM8)
   46                   ; 64 KByte IRM (2 unabhaengige Bilder)
   47                   ; 16 KByte CAOS-ROM C000-FFFF
   48                   ; 32 KByte USER-ROM C000-DFFF (4 Ebenen)
   49                   
   50                   ;---------------------------------------------------------------------
   51                   
   52                   ;**	Speicheruebersicht, Belegung der CAOS-ROMs	**
   53                   
   54                   ;ROM-C:
   55                   ;C000	IRM-Defaulttabelle
   56                   ;	System-Initialisierung, Portinittabellen
   57                   ;	SYSTEM-Check, Modulcheck
   58                   ;	Modulschaltung (SWITCH)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   2
CAOS45  Z80

   59                   ;	F-Tastenbelegung (KEY, KEYLIST)
   60                   ;	Farben setztn (COLOR)
   61                   ;	Fensterfunktionen (WINDOW, WINAK, WININ)
   62                   ;	Grafikfunktionen (LINE, PUSE, CIRCLE, PUDE)
   63                   ;	Speicherfunktionen (DISPLAY, MODIFY)
   64                   ;	Initialisierung Druckerausgabe, Duplexbetrieb
   65                   ;	allgemeine Druckroutine mit Protokoll, Screen- oder Hardcopy
   66                   ;	V.24-Initialisierungstabellen
   67                   ;	Byteweise Kassettenroutinen (MBOUT, MBIN)
   68                   ;	Speichercheck VIEW
   69                   ;	Druck-Kommando PRINT
   70                   ;	Tabelle der Modulnamen
   71                   
   72                   ;ROM-D:
   73                   ;D000	DISK-Sprungverteiler und Floppy-Routinen
   74                   ;	BASEX-Erweiterung fuer BASIC
   75                   ;	Pixelausgabe fuer IBM-Zeichensatz
   76                   ;	Fensterscrolling, Zeile loeschen
   77                   ;	FLOAD, FSAVE, DIR, STAT, REN, ERA, SETRO, SETWR
   78                   ;	DRIVE, TYPE, DUMP, INIT
   79                   ;	Datum und Uhrzeit anzeigen (TIME)
   80                   ;	Wurzelberechnung, Multiplikation (SQR, MULT)
   81                   ;	CAOS-Versionsanzeige (help)
   82                   ;	M001-Initialisierungstabelle fuer Centronics
   83                   ;	Defaulttabelle fuer Joystick-Belegung
   84                   ;	IBM-Codierungen fuer Druckerausgabe
   85                   ;DAB8	IBM-Zeichensatz
   86                   
   87                   ;ROM-E:
   88                   ;E000	RESET, BASIC-Verteiler
   89                   ;	CRT-Treiber (PADR, DABR, WPIX)
   90                   ;	Tastaturtreiber mit ISR CTC Kanal 3, PIO-B, SIO-B
   91                   ;	Joysticktreiber fuer M008/M021
   92                   ;	Kassetten-Routinen Eingabe/Ausgabe
   93                   ;	BASIC-Erweiterungen
   94                   ;	Initialisierungstabelle fuer M021
   95                   ;	Tabelle der ESC-Funktionen
   96                   ;EDFF	CAOS-Versionsnummer
   97                   ;EE00	Zeichenbildtabelle Grossbuchstaben
   98                   
   99                   ;ROM-F:
  100                   ;F000	Power-ON, Programmverteiler, IRMON, IRMOF, RCALL
  101                   ;	Kommandos SWITCH und JUMP
  102                   ;	Kommandointerpreter, MENU
  103                   ;	WAIT
  104                   ;	Zeichenaus-/eingabe (HLHX, AHEX, OCHR, INTB ...)
  105                   ;	Tastatureingabe KBD, INLIN
  106                   ;	Kommando go
  107                   ;	Hex-Zahlen/Argumente erfassen (RHEX, GARG)
  108                   ;	Ports initialisieren (INIEA, INIMEX)
  109                   ;	Kassettenkommandos (SAVE, VERIFY, LOAD)
  110                   ;	Kommandos COLOR, DISPLAY, MODIFY
  111                   ;	Kommandos WINDOW, KEY (mit Keylist)
  112                   ;	Cursordarstellung, Grafikroutinen
  113                   ;	Kommando SYSTEM
  114                   ;	BASIC-I/O-Verteiler
  115                   ;	Zeichenkette anzeigen (ZKOUT)
  116                   ;	Tonausgabe (TON)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   3
CAOS45  Z80

  117                   ;	ESC-Programme
  118                   ;	Drucker-, und Duplexroutinen (M001, M021, V.24-Modul)
  119                   ;	SIO-Empfangsinterrupt (Tastatur, ESC...)
  120                   ;	Umschaltroutine fuer CAOS-ROM-C
  121                   ;	I/O-UP-Nummer-Tabelle
  122                   ;	Unterprogrammtabelle fuer SUTAB
  123                   ;	Tastencodetabelle KTAB
  124                   ;	ISRTAB	Interrupttabelle
  125                   ;	CRTTAB	Steuerfunktionstabelle
  126                   ;	TOKTAB	BASIC-Token mit Sprungtabelle
  127                   ;FDF0	BASIC-Unterprogrammtabelle
  128                   ;FDF8	Bittabelle fuer Punktroutinen
  129                   ;FE00	Zeichenbildtabelle Kleinbuchstaben
  130                   
  131                   ;---------------------------------------------------------------------
  132                   
  133                   ; CAOS-Vorblock:
  134                   
  135 0100  43 41 4F 53 	DB	'CAOS45  KCC'
  136 010B  00 00 00 00 	DS	5,0
  137 0110  02          	DB	2		; 2 Adressen
  138 0111  4000        	DW	4000H		; AADR
  139 0113  8000        	DW	8000H		; EADR+1
  140 0115  00 00 00 00 	DS	107,0
  141                   
  142                   	INCLUDE	EQU45.INC	; Vereinbarungen, Uebersicht
    1                   ;*****************************************
    2                   ;**	CAOS 4.5			**
    3                   ;**					**
    4                   ;**	Macros und Vereinbarungen	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 10.11.2013	**
    7                   ;*****************************************
    8                   
    9                   MESSAGE	MACRO	MSG1,N,MSG2
   10                   	 .PRINTX MSG1 N MSG2
   11                   	ENDM
   12                   
   13                   ; Mit FF auffuellen, bis die absolute Adresse LOC erreicht ist:
   14                   ABSFILL	MACRO	LOC,WHAT
   15                   	 IF $ GT LOC
   16                   	  MESSAGE <Fehler! LOC:>,% $ - LOC,<Byte zu viel vor WHAT>
   17                   	 ELSE
   18                   	  IF2
   19                   	   MESSAGE <LOC:>,% LOC - $,<Byte frei vor WHAT>
   20                   	  ENDIF
   21                   	  DS	LOC - $,0FFh
   22                   	 ENDIF
   23                   	ENDM
   24                   
   25                   ; Undokumentierter Opcode:
   26                   ;	IN	F,(C)
   27                   INFC	MACRO
   28                   	 DB	0EDh,70h
   29                   	ENDM
   30                   
   31                   ; Undokumentierter Opcode:
   32                   ;	OUT	(C),0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   4
EQU45   INC

   33                   OUTC0	MACRO
   34                   	 DB	0EDh,71h
   35                   	ENDM
   36                   
   37                   ; Undokumentierter Opcode:
   38                   ;	RES	BI,(IX+DISP),A
   39                   RESIXA	MACRO	BI,DISP
   40                   	 DB	0DDh,0CBh,DISP
   41                   	 DB	BI SHL 3 OR 10000111b
   42                   	ENDM
   43                   
   44                   ; Undokumentierter Opcode:
   45                   ;	SET	BI,(IX+DISP),A
   46                   SETIXA	MACRO	BI,DISP
   47                   	 DB	0DDh,0CBh,DISP
   48                   	 DB	BI SHL 3 OR 11000111b
   49                   	ENDM
   50                   
   51                   ; Setze Bit 7 des ersten Zeichens fuer BASIC-Token:
   52                   TOKEN	MACRO	STRING
   53                   Y	 DEFL	80h
   54                   	 IRPC	X,STRING
   55                   	  DB	'&X' + Y
   56                   Y	  DEFL	0
   57                   	 ENDM
   58                   	ENDM
   59                   
   60                   ;---------------------------------------
   61                   
   62                   ; Portadressen im Grundgeraet:
   63                   
   64         0088      PIOAD	EQU	88H	; PIO-A, Datenbyte
   65         0089      PIOBD	EQU	89H	; PIO-B, Datenbyte
   66         008A      PIOAS	EQU	8AH	; PIO-A, Steuerbyte
   67         008B      PIOBS	EQU	8BH	; PIO-B, Steuerbyte
   68         008C      CTC0	EQU	8CH	; CTC Kanal 0
   69         008D      CTC1	EQU	8DH	; CTC Kanal 1
   70         008E      CTC2	EQU	8EH	; CTC Kanal 2
   71         008F      CTC3	EQU	8FH	; CTC Kanal 3
   72                   
   73                   ; von den BASIC-Erweiterungen genutzte Arbeitszellen im RAM:
   74                   
   75         0307      IOCHNL	EQU	0307H	; Ein-/Ausgabekanal
   76         0309      ININD	EQU	0309H	; IN-Index
   77         031B      RNDVR3	EQU	031BH	; Zufallszahl
   78         034E      ANF	EQU	034EH	; erste Zeilennummer
   79         0350      ENDE	EQU	0350H	; letzte Zeilennummer
   80         0352      NANF	EQU	0352H	; neue erste Zeilennummer
   81         0354      DISTAN	EQU	0354H	; Zeilennummernabstand
   82         035E      DATFLG	EQU	035EH	; List-, Editierschutz wenn <> 0
   83         035F      PSTBEG	EQU	035FH	; Programmstartadresse (Standardwert = 0401H)
   84         037E      COLRET	EQU	037EH	; Ablage Farbbyte
   85         03C0      STRDAT	EQU	03C0H	; 4 Byte: Laenge und Adresse des aktuellen Strings
   86         03D7      SVARPT	EQU	03D7H	; Adresse der Liste der einfachen und Stringvariablen
   87         03EA      INTPRB	EQU	03EAH	; Druckpuffer=Dateiname
   88         03FD      PRTFLG	EQU	03FDH	; PRINT-Erweiterung
   89                   
   90                   ; von den BASIC-Erweiterungen genutzte Routinen aus dem BASIC-ROM:

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   5
EQU45   INC

   91                   
   92         C00D      PRIST	EQU	0C00DH	; BASIC-Interpreter Kaltstart
   93         C08C      SECST	EQU	0C08CH	; BASIC-Interpreter Warmstart
   94         C327      TMEMO	EQU	0C327H	; Test, ob RAM fuer naechste Operationen reicht
   95         C348      SNER	EQU	0C348H	; Sprung zu SN-ERROR
   96         C356      ERROO	EQU	0C356H	; Ausgebe Fehlercode
   97         C442      LIN13	EQU	0C442H	; Zeiger auf Zeile mit naechstgroesserer Nummer stellen
   98         C44D      ULER	EQU	0C44DH	; Sprung zu UL-ERROR
   99         C450      LIN6	EQU	0C450H	; Zeile in Programm einsortieren	
  100         C48A      LIN10	EQU	0C48AH
  101         C493      LIN11	EQU	0C493H
  102         C4BB      ZPOIT	EQU	0C4BBH	; Zeiger auf Anfang naechste Zeile stellen
  103         C4BE      ZPOIT1	EQU	0C4BEH
  104         C689      CPREG	EQU	0C689H
  105         C8B7      DLI22	EQU	0C8B7H	; Ansprung Tokenverarbeitung
  106         C8BD      TCHAR	EQU	0C8BDH	; naechstes Zeichen holen
  107         C8BE      TCHAR1	EQU	0C8BEH
  108         C8CC      CPSTX	EQU	0C8CCH	; erwartetes Zeichen folgt als DB ..
  109         C8D6      CPCOMM	EQU	0C8D6H	; Komma?
  110         C8DB      CPBRGT	EQU	0C8DBH	; Klammer zu?
  111         C967      FCER	EQU	0C967H	; Sprung zu FC-ERROR
  112         C96F      EPRVL3	EQU	0C96FH	; Wert bestimmen
  113         C96C      EPRVL4	EQU	0C96CH
  114         C986      DCHEX	EQU	0C986H	; Zeilennummer pruefen und in Hexzahl wandeln
  115         C987      DCHEX1	EQU	0C987H
  116         CB03      PRINT2	EQU	0CB03H
  117         CD36      SNALY6	EQU	0CD36H
  118         CD3A      SNALY	EQU	0CD3AH
  119         CDE1      SNLY14	EQU	0CDE1H	; Syntax-Check '('
  120         CDF3      SNLY16	EQU	0CDF3H	; Syntax-Check ')'
  121         D0C0      POS1	EQU	0D0C0H
  122         D17B      STADTB	EQU	0D17BH
  123         D17E      SADTB1	EQU	0D17EH
  124         D1A9      SLEN3	EQU	0D1A9H
  125         D1E1      STROP	EQU	0D1E1H	; String-Arithmetik
  126         D2F2      STRMV1	EQU	0D2F2H
  127         D302      STRZS3	EQU	0D302H
  128         D330      LEN1	EQU	0D330H	; Laenge holen
  129         D421      ARGVL1	EQU	0D421H	; Wert abholen
  130         D424      ARGVL2	EQU	0D424H
  131         D6AE      SGN1	EQU	0D6AEH
  132         D834      NUMKON	EQU	0D834H
  133         DCB2      CASS1	EQU	0DCB2H	; Dateiname aufbereiten
  134         DDC8      TESTCO	EQU	0DDC8H
  135         DDD5      CO	EQU	0DDD5H	; Ausgabe eines Zeichens (ASCII)
  136         DDE4      CI	EQU	0DDE4H	; Eingabe eines Zeichens (ASCII)
  137         DE25      OUTCHL	EQU	0DE25H	; Ausgabe zu Kanal
  138         DE5F      INCHNL	EQU	0DE5FH	; Eingabe von Kanal
  139                   
  140                   ; Steuerzeichen:
  141                   
  142         000A      LF	EQU	0AH
  143         000D      CR	EQU	0DH
  144         001B      ESC	EQU	1BH
  145                   
  146                   ; IRM-Belegung:
  147                   
  148         A800      V24PL	EQU	0A800H	; Steckplatz V.24-Modul

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   6
EQU45   INC

  149                   ;INTV1		0A801H	; Initialisierungsdaten V.24-Druckausgabe
  150                   ;INTV2		0A809H	; Initialisierungsdaten V.24-duplex
  151                   
  152         A894      JOYIRM	EQU	0A894H	; Joystick-Tabelle (noch nicht endgueltig)
  153                   	; bis	0A89Fh
  154                   ;		0A8A0H	; Ablage IRM-Inhalt unter Mauspfeil (96 Byte)
  155                   	; bis	0A8FFH
  156                   
  157         B700      CASS	EQU	0B700H	; 128 Byte Kassettenpuffer
  158                   	; bis	0B77FH
  159         B780      ARGC	EQU	0B780H	; Argument-Nr.
  160         B781      ARGN	EQU	0B781H	; Anzahl Argumente
  161         B782      ARG1	EQU	0B782H	; Argument 1
  162         B784      ARG2	EQU	0B784H	;    "	   2
  163         B786      ARG3	EQU	0B786H	;    "	   3
  164         B788      ARG4	EQU	0B788H	;    "	   4
  165         B78A      ARG5	EQU	0B78AH	;    "	   5
  166         B78C      ARG6	EQU	0B78CH	;    "	   6
  167         B78E      ARG7	EQU	0B78EH	;    "	   7
  168         B790      ARG8	EQU	0B790H	;    "	   8
  169         B792      ARG9	EQU	0B792H	;    "	   9
  170         B794      ARG10	EQU	0B794H	;    "	  10
  171         B796      NUMNX	EQU	0B796H	; Anzahl Zeichen
  172         B797      NUMVX	EQU	0B797H	; Wert HEX-Zahl
  173         B799      HCADR	EQU	0B799H	; Hardcopy-Aufruf
  174         B79B      WINNR	EQU	0B79BH	; Fenster-Nr.
  175         B79C      WINON	EQU	0B79CH	; Fenster-Anfang
  176         B79E      WINLG	EQU	0B79EH	; Fenster-Groesse
  177         B7A0      CURSO	EQU	0B7A0H	; Cursor-Position
  178         B7A2      STBT	EQU	0B7A2H	; BS-Steuerbyte
  179         B7A3      COLOR	EQU	0B7A3H	; Farbe
  180         B7A4      WEND	EQU	0B7A4H	; Adresse fuer Scrolling-Routine
  181         B7A6      CCTL0	EQU	0B7A6H	; Zeichentabelle 0
  182         B7A8      CCTL1	EQU	0B7A8H	;	"	 1
  183         B7AA      CCTL2	EQU	0B7AAH	;	"	 2
  184         B7AC      CCTL3	EQU	0B7ACH	;	"	 3
  185         B7AE      SYSP	EQU	0B7AEH	; System Stackpointer
  186         B7B0      SUTAB	EQU	0B7B0H	; UP-Tabelle
  187         B7B2      CTAB	EQU	0B7B2H	; CRT-Steuerprogramm
  188         B7B4      BJUMP	EQU	0B7B4H	; BASIC-Sprung
  189         B7B9      OUTAB	EQU	0B7B9H	; Zeiger Ausgabe
  190         B7BB      INTAB	EQU	0B7BBH	; Zeiger Eingabe
  191         B7BD      UOUT1	EQU	0B7BDH	; Sprung OUT#2
  192         B7C0      UIN1	EQU	0B7C0H	; Sprung IN#2
  193         B7C3      UOUT2	EQU	0B7C3H	; Sprung OUT#3
  194         B7C6      UIN2	EQU	0B7C6H	; Sprung IN#3
  195         B7C9      IOERR	EQU	0B7C9H	; BASIC-Error
  196         B7CB      VRAM	EQU	0B7CBH	; Adresse Video-RAM
  197         B7CD      ZOTAB	EQU	0B7CDH
  198         B7CF      ZWEND	EQU	0B7CFH	; WEND-Merker
  199         B7D1      FTAST	EQU	0B7D1H	; F-Tastenpointer
  200         B7D3      HOR	EQU	0B7D3H	; Grafik Horizontalposition
  201         B7D5      VERT	EQU	0B7D5H	; Grafik Vertikalposition
  202         B7D6      FARB	EQU	0B7D6H	; Grafik Farbe
  203         B7D7      MIXIT	EQU	0B7D7H	; IX-Merker
  204         B7D8      VORTN	EQU	0B7D8H	; Vortonlaenge
  205         B7DA      DTPTR	EQU	0B7DAH	; CASS-Pointer
  206         B7DB      CTCMD	EQU	0B7DBH	; CTC2-Modus

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   7
EQU45   INC

  207         B7DC      BLINK	EQU	0B7DCH	; Blinkfrequenz
  208         B7DD      L3TAB	EQU	0B7DDH	; ESC-Tabelle
  209         B7DF      L3SIZ	EQU	0B7DFH	; Anzahl ESC-Routinen
  210         B7E0      COUNT	EQU	0B7E0H	; Tastatur-Repeat
  211         B7E1      HCPZ	EQU	0B7E1H	; Druckersteuerbyte
  212                   		; Bit 0=0	Protokollfunktion
  213                   		; Bit 0=1	Hardcopyfunktion
  214                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  215                   		; Bit 2=0/1	SIO-Kanal A oder B
  216                   		; Bit 3		-
  217                   		; Bit 4..7	Druckertyp (0 bis F)
  218                   		; Bit 7=0	Matrixdrucker
  219                   		; Bit 7=1	Schreibmaschine
  220         B7E2      INTV1	EQU	0B7E2H	; Druckerinitialisierung
  221         B7E4      INTV1L	EQU	0B7E4H	;	"  -Laenge
  222         B7E5      INTV2	EQU	0B7E5H	; Duplexinitialisierung
  223         B7E7      INTV2L	EQU	0B7E7H	;	"  -Laenge
  224         B7E8      HCPZ2	EQU	0B7E8H	; Duplexsteuerbyte
  225                   		; Bit 0		-
  226                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  227                   		; Bit 2=0/1	SIO-Kanal A oder B
  228                   		; Bit 3		WR5 Bit 3: Senden ein/aus
  229                   		; Bit 4		-
  230                   		; Bit 5,6	WR5 Bit 5,6: 5-8 Bit pro Zeichen (Senden)
  231                   		; Bit 7		WR3 Bit 7: 7/8 Bit pro Zeichen (Empfang)
  232         B7E9      OFILT	EQU	0B7E9H	; Druckroutine (ungefiltert)
  233         B7EC      PROMPT	EQU	0B7ECH	; Systemprompt
  234         B7ED      LINTYP	EQU	0B7EDH	; Linientyp
  235         B7EE      CUMUST	EQU	0B7EEH	; ^Cursormuster
  236         B7F0      JOYTAB	EQU	0B7F0H	; Joystick-Tastencodes
  237                   ;		0B7F2H
  238                   ;		bis	; reservicert fuer Arbeitszellen von REAS und TEMO
  239                   ;		0B7FFH
  240         B800      MODST	EQU	0B800H	; Modulsteuerwortspeicher
  241                   	; bis	0B8FFH
  242                   
  243         B99C      WNDFN	EQU	0B99CH	; Fenstersvektorpeicher
  244                   	; bis	0B9FFH
  245                   
  246                   ; Portadressen des Koppel-RAM (D004):
  247                   
  248         00F1      ERRTX	EQU	000F1H	; Fehlertext			(ab DEP 2.0)
  249         80F1      STBYT2	EQU	080F1H	; 2. Steuerbyte:		(ab DEP 2.0)
  250                   			;	Bit 0 - Anforderung
  251                   			;	Bit 1 - Laufwerkswechsel
  252                   			;	Bit 2 - Userwechsel
  253                   			;	Bit 3..6 reserviert
  254                   			;	Bit 7 - Fehlerrueckmeldung
  255         81F1      LWANF	EQU	081F1H	; Laufwerk ('A', 'B', ... 'P')
  256         82F1      UANF	EQU	082F1H	; User-Bereich (00H ... 0FH)
  257         83F1      DEPVER	EQU	083F1H	; DEP-Version BCD
  258         84F1      DATE	EQU	084F1H	; Datum BCD			(ab DEP 3.0)
  259                   			;	Jahr (00..99)
  260                   			;	Monat (1..12)
  261                   			;	Tag (1..31)
  262         87F1      TIME	EQU	087F1H	; Uhrzeit BCD			(ab DEP 3.0)
  263                   			;	Stunde (0..23)
  264                   			;	Minute (0..59)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   8
EQU45   INC

  265                   			;	Sekunde (0..59)
  266                   
  267         80F2      FDATA	EQU	080F2H	; Daten- bzw. Sektorpuffer 128 Byte lang
  268         80F3      STBYT1	EQU	080F3H	; 1. Steuerbyte:
  269                   			;	Bit 0 - Anforderung
  270                   			;	Bit 1 - 1=schreiben/0=lesen
  271                   			;	Bit 3 - oeffnen
  272                   			;	Bit 6 - schliessen
  273                   			;	Bit 7 - Fehlerrueckmeldung
  274                   			;	Bit	5 4 2	Funktionsauswahl:
  275                   			;		0 0 0	Sektor lesen/schreiben
  276                   			;		0 0 1	DIR-Anforderung
  277                   			;		0 1 0	ERA
  278                   			;		0 1 1	STAT
  279                   			;		1 0 0	REN
  280                   			;		1 0 1	SETRO
  281                   			;		1 1 0	SETWR
  282                   			;		1 1 1	BASIC-Byte lesen/schreiben
  283         81F3      FCODE	EQU	081F3H	; Fehlercode
  284         82F3      DIRBUF	EQU	082F3H	; Puffer fuer Dateiname oder Directory
  285         8EF3      BASBYT	EQU	08EF3H	; Datenbyte fuer BASIC-Byte-Schnittstelle
  286         B3F3      UROK	EQU	0B3F3H	; Betriebsart
  287                   
  288                   ; Belegung der IX - Zellen:
  289                   
  290                   ; IX+0	Zeitkonstante fuer Kassettenroutinen
  291                   ; IX+1	Merkzelle fuer Ausgabeport 84H
  292                   ; IX+2	gelesene Blocknummer (Kassette)
  293                   ; IX+3	Sollblocknummer (Kassette)
  294                   ; IX+4	Merkzelle fuer Ausgabeport 86H
  295                   ; IX+5	Ein- Ausgabepufferadresse (low)
  296                   ; IX+6	Ein- Ausgabepufferadresse (high)
  297                   ; IX+7	Kennbyte fuer LOAD/VERIFY
  298                   ;	 BIT 0: =1 ->LOAD  =0 ->VERIFY
  299                   ;	 BIT 1: =1 kein Selbstart bei LOAD (in BASIC Kennung fuer 1. Block)
  300                   ;	 BIT 2-4 : Anzahl Argumente (bei SAVE)/ARGN>3 (Startoffset)
  301                   ;	 BIT 5-7 : BASIC: fuer CLOAD/CSAVE 
  302                   ; IX+8	Kennbyte Tastatur
  303                   ;	 BIT 0: gueltiges Byte (ASCII) in IX+13
  304                   ;	 BIT 1: Tonausgabe laeuft
  305                   ;	 BIT 2-4: aktuelles Speichergeraet
  306                   ;		  0=Kassette, 1=Diskette, 2=USB (M052), 3=Netzwerk (M052)
  307                   ;		  4=Headersave, 5..7 frei
  308                   ;	 BIT 5: Tastenclick ein/aus
  309                   ;	 BIT 6: Code kommt von F-Taste
  310                   ;	 BIT 7: 0=Shiftlock
  311                   ; IX+9	Prologbyte (normal 7FH)
  312                   ; IX+10	Autorepeatzaehler (Tastatur)
  313                   ; IX+11	Merkzelle fuer Akku (bei BWS on/off mit Stackverlagerung)
  314                   ; IX+12	Scancode von Tastatur
  315                   ; IX+13	ASCII-Code von Tastatur
  316                   ; IX+14	Tastaturcodetabelle low
  317                   ; IX+15	Tastaturcodetabelle high
  143                   
  144                   	.PHASE	0C000H
  145                   
  146                   	INCLUDE	CC45.INC	; ROM-C (C000-CFFF)
    1                   ;*****************************************

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   9
CC45    INC

    2                   ;**	CAOS 4.5	ROM C		**
    3                   ;**					**
    4                   ;**	Adresse:  C000h bis CFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 06.09.2010	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0C000H
   10                   
   11                   ;
   12                   ; IRM-Defaulttabelle:
   13                   ;
   14 C000  F4BB        KCTAB1:	DW	NOOP		; Hardcopy-Adresse
   15 C002  00          WIN0:	DB	0		; WINNR
   16 C003  0000        	DW	0		; WINON
   17 C005  2028        	DW	2028H		; WINLG
   18 C007  0000        	DW	0		; CURSO
   19 C009  00          	DB	0		; STBT
   20 C00A  39          	DB	39H		; COLOR
   21 C00B  E27D        	DW	SCRLPG		; WEND
   22 C00D  EE00        WIN1:	DW	0EE00H		; CCTL0
   23 C00F  FE00        	DW	0FE00H		; CCTL1
   24 C011  EE00        	DW	0EE00H		; CCTL2
   25 C013  FE00        	DW	0FE00H		; CCTL3
   26 C015  01C4        	DW	1C4H		; SYSP
   27 C017  FB93        	DW	SUTB		; SUTAB
   28 C019  FCB5        	DW	CRTTAB		; CTAB
   29 C01B  D3 88       	OUT	(PIOAD),A	; BJUMP
   30 C01D  C3 F012     	JP	0F012H
   31 C020  FB8B        	DW	ZEI0		; OUTAB
   32 C022  FB8F        	DW	ZEI4		; INTAB
   33 C024  C3 F4BB     	JP	NOOP		; UOUT1
   34 C027  C3 F4BB     	JP	NOOP		; UIN1
   35 C02A  C3 F4BB     	JP	NOOP		; UOUT2
   36 C02D  C3 F4BB     	JP	NOOP		; UIN2
   37 C030  DC82        	DW	0DC82H		; IOERR (BASIC)
   38 C032  B200        	DW	0B200H		; VRAM
   39                   
   40 C034  47 0C       KCTAB2:	DB	47H,0CH		; CTC2 (blinken)
   41 C036  EDE5        	DW	ESCTAB		; L3TAB
   42 C038  0D          	DB	13		; L3SIZ (0-C)
   43 C039  05          	DB	5		; COUNT
   44 C03A  00          	DB	0		; HCPZ
   45 C03B  A801        	DW	0A801H		; INTV1
   46 C03D  08          	DB	8		; INTV1L
   47 C03E  A809        	DW	0A809H		; INTV2
   48 C040  09          	DB	9		; INTV2L
   49 C041  EE          	DB	11101110b	; HCPZ2 (8 Bit, Senden ein)
   50 C042  C3 F4BB     	JP	NOOP		; OFILT
   51 C045  25          	DB	'%'		; PROMPT
   52 C046  FF          	DB	0FFH		; LINTYP
   53 C047  EFD8        	DW	0EFD8H		; CUMUST
   54 C049  A894        	DW	JOYIRM		; JOYTAB
   55                   
   56                   ; Modulschaltzustaende (interne Module):
   57                   
   58 C04B  03          KCTAB3:	DB	3	; RAM0
   59 C04C  01          	DB	1	; IRM

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  10
CC45    INC

   60 C04D  00          	DB	0	; USER-ROMC
   61 C04E  03          	DB	3	; RAM8
   62 C04F  03          	DB	3	; RAM4
   63 C050  00          	DB	0	; CAOSC
   64 C051              KCTAB4:
   65                   ;
   66                   ; Grundinitialisierung ohne Speicher loeschen, ausser:
   67                   ; VRAM0/1, Kassettenpuffer, Monitor-RAM, Modulsteuerwortspeicher
   68                   ; Joystick wird hier neu initialisiert (bei RESET nicht)
   69                   ;
   70 C051  7F7F        	DW	7F7Fh
   71 C053  4E 45 57 20 	DB	'NEW ',1	; Menuewort versteckt, IRM ein
   72 C058  F3          	DI
   73 C059  31 B900     	LD	SP,MODST+100H	; Loeschbereich AD00h..B8FFh
   74 C05C  01 0600     	LD	BC,600h		; Anzahl = 6 * 256 Wort = 0C00h
   75 C05F  18 07       	JR	PWRC0
   76                   ;
   77                   ; Power-ON Initialisierung:
   78                   ;
   79 C061  F3          PWRONC:	DI
   80 C062  31 C000     	LD	SP,0C000H	; Loeschbereich 0..BFFFh
   81 C065  01 6000     	LD	BC,6000H	; Anzahl = 60h * 256 Wort = C000h
   82 C068  61          PWRC0:	LD	H,C
   83 C069  69          	LD	L,C		; HL=0
   84 C06A  E5          PWRC1:	PUSH	HL		; schnelles Speicher loeschen
   85 C06B  0D          	DEC	C
   86 C06C  20 FC       	JR	NZ,PWRC1
   87 C06E  10 FA       	DJNZ	PWRC1
   88 C070  31 01C4     	LD	SP,01C4H	; System-Stackpointer
   89 C073  0E 80       	LD	C,80h		; alle Module abschalten (B war 0)
   90 C075              PWRC2:	OUTC0			; OUT (C),0
    1 C075  ED 71       	 DB	0EDh,71h
   91 C077  10 FC       	DJNZ	PWRC2
   92 C079  CD C0A1     	CALL	SYSI		; Systeminitialisierung (Rueckkehr mit EI)
   93 C07C  21 D81C     	LD	HL,JOYTBD	; vorbereitete Joystick-Tabelle
   94 C07F  11 A894     	LD	DE,JOYIRM	; JOYTAB-Standardadresse im IRM
   95 C082  01 000C     	LD	BC,12
   96 C085  ED B0       	LDIR			; Tabelle in den IRM kopieren
   97 C087  AF          	XOR	A		; Fenster Nr. 0
   98 C088  32 B79B     PWRC3:	LD	(WINNR),A	; Nr. eintragen
   99 C08B  CD C555     	CALL	WCOPY		; Fenstervektorspeicher initialisieren
  100 C08E  3C          	INC	A
  101 C08F  FE 0A       	CP	10		; fuer 10 Fenster (0-9)
  102 C091  38 F5       	JR	C,PWRC3
  103 C093  CD F91D     	CALL	ESC3		; Anzeige Bild 0, Zugriff Bild 1
  104 C096  3E 0C       	LD	A,0CH
  105 C098  CD E0A0     	CALL	CRT		; Bild 1: CLS
  106 C09B  CD F913     	CALL	ESC1		; Anzeige+Zugriff Bild 0
  107 C09E  C3 F15E     	JP	PWR4		; weiter im ROM-F ...
  108                   ;
  109                   ; System-Initialisierung:
  110                   ;
  111 C0A1  F3          SYSI:	DI
  112 C0A2  ED 5E       	IM	2
  113 C0A4  21 C120     	LD	HL,IOTAB1	; PIO A,B und 84H/86H
  114 C0A7  CD F549     	CALL	INIMEX		; Ports initialisieren
  115 C0AA  DD 21 01F0  	LD	IX,1F0H
  116 C0AE  DD 36 01 28 	LD	(IX+1),28H	; OUT84-Merker

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  11
CC45    INC

  117 C0B2  DD 36 04 E3 	LD	(IX+4),0E3H	; OUT86-Merker
  118 C0B6  11 B799     	LD	DE,HCADR
  119 C0B9  21 C000     	LD	HL,KCTAB1	; Defaulttabelle
  120 C0BC  01 0034     	LD	BC,KCTAB2-KCTAB1; fuer IRM-Arbeitszellen
  121 C0BF  ED B0       	LDIR			; 1. Teil in IRM kopieren
  122 C0C1  1E DB       	LD	E,LOW(CTCMD)	; (D war 0B7h)
  123 C0C3  0E 17       	LD	C,KCTAB3-KCTAB2	; (B war 0)
  124 C0C5  ED B0       	LDIR			; 2. Teil in IRM kopieren
  125 C0C7  11 B800     	LD	DE,MODST	; Modulsteuerwortspeicher
  126 C0CA  3A B804     	LD	A,(MODST+4)	; RAM4 aktueller Schaltzustand
  127 C0CD  E6 04       	AND	4		; RAM4-Ebene herausloesen
  128 C0CF  0E 06       	LD	C,KCTAB4-KCTAB3	; (B war 0)
  129 C0D1  ED B0       	LDIR			; 3. Teil in IRM kopieren
  130 C0D3  21 B804     	LD	HL,MODST+4
  131 C0D6  B6          	OR	(HL)		; bisherige Ebene wieder einbauen
  132 C0D7  77          	LD	(HL),A
  133 C0D8  3E 01       	LD	A,1		; Standardwert fuer IXH- und I-Register
  134 C0DA  21 FCA5     SIXC:	LD	HL,ISRTAB
  135 C0DD  F3          	DI
  136 C0DE  32 B7D7     	LD	(MIXIT),A
  137 C0E1  1E E0       	LD	E,0E0H
  138 C0E3  57          	LD	D,A
  139 C0E4  01 0010     	LD	BC,10H		; Interrupttabelle
  140 C0E7  ED B0       	LDIR			; kopieren nach xxE0h bis xxF0h
  141 C0E9  DD 66 01    	LD	H,(IX+1)	; alte Merker
  142 C0EC  DD 6E 04    	LD	L,(IX+4)	; mitnehmen
  143 C0EF  D5          	PUSH	DE
  144 C0F0  DD E1       	POP	IX
  145 C0F2  DD 36 08 80 	LD	(IX+8),80H	; Defaultbelegung (Kassetten kein CAPS-Lock)
  146 C0F6  DD 74 01    	LD	(IX+1),H	; Merker neu eintragen
  147 C0F9  DD 75 04    	LD	(IX+4),L
  148 C0FC  DD 36 0E 25 	LD	(IX+14),LOW(KTAB)
  149 C100  DD 36 0F FC 	LD	(IX+15),HIGH(KTAB)
  150 C104  DD 36 09 7F 	LD	(IX+9),7FH	; Standard-Prologbyte
  151 C108  ED 5E       	IM	2
  152 C10A  3A B7D7     	LD	A,(MIXIT)
  153 C10D  ED 47       	LD	I,A
  154 C10F  21 C13A     	LD	HL,IOTAB2	; PIO A,B und CTC
  155 C112  CD F549     	CALL	INIMEX		; Ports neu initialisieren
  156 C115  21 EDD6     	LD	HL,CENINI
  157 C118  CD F549     	CALL	INIMEX		; M021 initialisieren
  158 C11B  CD F537     	CALL	KPUFF		; Kassettenpuffer definieren
  159 C11E  FB          	EI
  160 C11F  C9          	RET
  161                   ;
  162                   ; Portinitialisierungstabellen:
  163                   ;
  164 C120  07          IOTAB1:	DB	7		; 7 Ports fuer Erstinitialisierung
  165                   
  166 C121  8A 01       	 DB	PIOAS,1		; PIO-A Steuerwort
  167 C123  E4          	  DB	0E4h		; Interruptvektor
  168                   
  169 C124  88 02       	 DB	PIOAD,2		; PIO-A Daten
  170 C126  1F          	  DB	00011111b	; D005-Reset
  171 C127  0F          	  DB	00001111b	; IRM, RAM0, CAOS-E
  172                   
  173 C128  8A 02       	 DB	PIOAS,2		; PIO-A Steuerwort
  174 C12A  0F          	  DB	00001111b	; Byte-Ausgabemodus

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  12
CC45    INC

  175 C12B  03          	  DB	00000011b	; DI
  176                   
  177 C12C  8B 03       	 DB	PIOBS,3		; PIO-B Steuerwort
  178 C12E  E6          	  DB	0E6h		; Interruptvektor
  179 C12F  0F          	  DB	00001111b	; Byte-Ausgabemodus
  180 C130  83          	  DB	10000011b	; EI
  181                   
  182 C131  89 01       	 DB	PIOBD,1		; PIO-B Daten
  183 C133  FF          	  DB	0FFh		; Daten
  184                   
  185 C134  84 01       	 DB	84h,1		; Ausgabeport 84h
  186 C136  28          	  DB	00101000b	; RAM8 0, LoRes
  187                   
  188 C137  86 01       	 DB	86h,1		; Ausgabeport 86h
  189 C139  E3          	  DB	11100011b	; RAM4 ein, USER-C 3, CAOS-C ein
  190                   
  191 C13A  04          IOTAB2:	DB	4		; 4 Ports initialisieren
  192                   
  193 C13B  8A 01       	 DB	PIOAS,1		; PIO-A Steuerwort
  194 C13D  E4          	  DB	0E4h		; Interruptvektor
  195                   
  196 C13E  8B 01       	 DB	PIOBS,1		; PIO-B Steuerwort
  197 C140  E6          	  DB	0E6h		; Interruptvektor
  198                   
  199 C141  8C 01       	 DB	CTC0,1		; CTC Kanal 0
  200 C143  E8          	  DB	0E8h		; Interruptvektor
  201                   
  202 C144  8E 02       	 DB	CTC2,2		; CTC Kanal 2: blinken
  203 C146  47          	  DB	01000111b	; DI, Zaehler, RESET
  204 C147  0C          	  DB	12		; Zeitkonstante
  205                   
  206                   ; Schreibe 'RAMn'
  207                   
  208 C148  CD F0D6     WRAM:	CALL	OSTR
  209 C14B  52 41 4D 00 	DB	'RAM',0
  210 C14F  7A          	LD	A,D
  211 C150  CD F3D5     	CALL	OCHR
  212 C153  A7          	AND	A		; CY=0
  213 C154  C9          	RET
  214                   
  215                   ; Systemcheck:
  216                   
  217 C155  D5          SYSTC:	PUSH	DE
  218 C156  CD F0D6     	CALL	OSTR
  219 C159  0D 43 41 4F 	DB	CR,'CAOSE',0
  220 C160  DB 88       	IN	A,(PIOAD)
  221 C162  E6 01       	AND	1
  222 C164  CD C269     	CALL	WONOF		; Bit 0
  223 C167  CD F0D6     	CALL	OSTR
  224 C16A  43 41 4F 53 	DB	'CAOSC',0
  225 C170  3A B805     	LD	A,(MODST+5)
  226 C173  E6 01       	AND	1
  227 C175  CD C269     	CALL	WONOF
  228 C178  CD F0D6     	CALL	OSTR
  229 C17B  52 4F 4D 43 	DB	'ROMC ',0
  230 C181  DD 7E 04    	LD	A,(IX+4)
  231 C184  07          	RLCA			; Bits 5,6
  232 C185  07          	RLCA

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  13
CC45    INC

  233 C186  07          	RLCA			; nach Bits 0,1
  234 C187  E6 03       	AND	3
  235 C189  EE 33       	XOR	'3'
  236 C18B  CD F3D5     	CALL	OCHR		; Ebene ausgeben
  237 C18E  DB 88       	IN	A,(PIOAD)
  238 C190  5F          	LD	E,A
  239 C191  E6 80       	AND	10000000b	; CY=0, Z=NOT(Bit 7)
  240 C193  CD C269     	CALL	WONOF
  241 C196  16 30       	LD	D,'0'
  242 C198  CD C148     	CALL	WRAM		; RAM0
  243 C19B  7B          	LD	A,E
  244 C19C  E6 0F       	AND	00001111b
  245 C19E  FE 08       	CP	00001000b	; CY=NOT(Bit 3)
  246 C1A0  CB 4F       	BIT	1,A		; Schaltzustand
  247 C1A2  CD C269     	CALL	WONOF
  248 C1A5  16 34       	LD	D,'4'
  249 C1A7  CD C148     	CALL	WRAM		; RAM4
  250 C1AA  CD F3BC     	CALL	SPACE
  251 C1AD  3A B804     	LD	A,(MODST+4)
  252 C1B0  0F          	RRCA
  253 C1B1  0F          	RRCA			; Bit 2
  254 C1B2  E6 01       	AND	1
  255 C1B4  C6 30       	ADD	A,'0'
  256 C1B6  CD F3D5     	CALL	OCHR		; Ebene 0/1
  257 C1B9  DD 7E 04    	LD	A,(IX+4)
  258 C1BC  CB 47       	BIT	0,A		; Schaltzustand
  259 C1BE  0F          	RRCA			; Schreibschutz (Bit 1)
  260 C1BF  0F          	RRCA			; ins Carry-Flag rotieren
  261 C1C0  3F          	CCF			; und invertieren
  262 C1C1  CD C269     	CALL	WONOF
  263 C1C4  16 38       	LD	D,'8'
  264 C1C6  CD C148     	CALL	WRAM		; RAM8
  265 C1C9  3E 20       	LD	A,' '
  266 C1CB  CD F3D5     	CALL	OCHR
  267 C1CE  DD 7E 01    	LD	A,(IX+1)
  268 C1D1  0F          	RRCA			; Bits 4,5,6,7
  269 C1D2  0F          	RRCA
  270 C1D3  0F          	RRCA
  271 C1D4  0F          	RRCA			; nach 0,1,2,3
  272                   ;	AND	0FH		; redundant: bereits in AHEX0
  273 C1D5  D6 02       	SUB	2
  274 C1D7  CD F3CD     	CALL	AHEX0		; Ebene ausgeben
  275 C1DA  DB 89       	IN	A,(PIOBD)
  276 C1DC  CB 6F       	BIT	5,A		; Schaltzustand
  277 C1DE  07          	RLCA			; Schreibschutz (Bit 6)
  278 C1DF  07          	RLCA			; ins Carry-Flag rotieren
  279 C1E0  3F          	CCF			; und invertieren
  280 C1E1  CD C269     	CALL	WONOF
  281 C1E4  CD F0D6     	CALL	OSTR
  282 C1E7  42 49 4C 44 	DB	'BILD ',0
  283 C1ED  DD 7E 01    	LD	A,(IX+1)
  284 C1F0  E6 04       	AND	00000100b	; Zugriffs-Bit
  285 C1F2  0F          	RRCA		
  286 C1F3  0F          	RRCA
  287 C1F4  C6 30       	ADD	A,'0'
  288 C1F6  CD F3D5     	CALL	OCHR		; Bildnummer
  289 C1F9  3A B801     	LD	A,(MODST+1)
  290 C1FC  E6 01       	AND	1		; IRM on?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  14
CC45    INC

  291 C1FE  CD C269     	CALL	WONOF
  292 C201  18 63       	JR	SPCRLF		; POP DE; JP CRLF
  293                   
  294                   ; Modulkontrollanzeige:
  295                   
  296 C203  D5          MODULC:	PUSH	DE
  297 C204  AF          	XOR	A
  298 C205  D3 91       	OUT	(91h),A		; M008 PIO-B Daten
  299 C207  DB 91       	IN	A,(91h)
  300 C209  A7          	AND	A
  301 C20A  20 16       	JR	NZ,MODC0
  302 C20C  CD F0D6     	CALL	OSTR
  303 C20F  2D 2D 20 2D 	DB	'-- -- -- JOY/CEN'
  304 C21F  0D 0A 00    	DB	0Dh,0Ah,0
  305 C222  2E 07       MODC0:	LD	L,7		; ab Platz 7
  306 C224  E5          MODC1:	PUSH	HL
  307 C225  3E 01       	LD	A,1		; lesen
  308 C227  CD C307     	CALL	MODUC
  309 C22A  7C          	LD	A,H
  310 C22B  3C          	INC	A		; Kennbyte=FFh?
  311 C22C  28 34       	JR	Z,MODC2		; kein Modul
  312 C22E  7D          	LD	A,L
  313 C22F  CD F3B9     	CALL	AHSPC		; Steckplatz
  314 C232  7C          	LD	A,H
  315 C233  CD F3B9     	CALL	AHSPC		; Kennbyte
  316 C236  7A          	LD	A,D
  317 C237  CD F3B9     	CALL	AHSPC		; Steuerbyte
  318 C23A  4C          	LD	C,H
  319 C23B  7C          	ld	a,h
  320 C23C  FE FB       	cp	0fbh		; Software-Modul?
  321 C23E  28 4B       	jr	z,slot		; Inhalt analysieren!
  322 C240  21 CFE3     	ld	hl,muser
  323 C243  FE C0       	cp	0c0h
  324 C245  38 04       	jr	c,modcd		; kleiner als C0
  325 C247  FE D8       	cp	0d8h
  326 C249  38 11       	jr	c,modca		; USER-Modul von C0-D7
  327 C24B  06 1D       modcd:	LD	B,29		; Anzahl definierter Module in MTAB
  328 C24D  21 CEB4     	LD	HL,MTAB
  329 C250  7E          MODCC:	LD	A,(HL)
  330 C251  23          	INC	HL
  331 C252  B9          	CP	C
  332 C253  28 07       	JR	Z,MODCA		; Text gefunden
  333 C255  7E          MODCB:	LD	A,(HL)
  334 C256  23          	INC	HL
  335 C257  A7          	AND	A		; Stringende?
  336 C258  20 FB       	JR	NZ,MODCB
  337 C25A  10 F4       	DJNZ	MODCC
  338 C25C  CD F8BB     MODCA:	CALL	ZKOUT		; Modulname
  339 C25F  CD F4CC     slot7:	CALL	CRLF
  340 C262  E1          MODC2:	POP	HL
  341 C263  2C          	INC	L		; Steckplatz+1
  342 C264  20 BE       	JR	NZ,MODC1	; bis FFh
  343 C266  D1          SPCRLF:	POP	DE
  344 C267  18 14       	JR	SJCRLF
  345                   
  346                   ; Schreibe ON, ON* oder OFF
  347                   
  348 C269  28 15       WONOF:	JR	Z,WOF

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  15
CC45    INC

  349 C26B  F5          	PUSH	AF
  350 C26C  CD F0D6     	CALL	OSTR
  351 C26F  20 4F 4E 00 	DB	' ON',0
  352 C273  F1          	POP	AF
  353 C274  3E 20       	LD	A,' '
  354 C276  30 02       	JR	NC,WRR
  355 C278  3E 2A       	LD	A,'*'		; Schreibschutz
  356 C27A  CD F3D5     WRR:	CALL	OCHR
  357 C27D  C3 F4CC     SJCRLF:	JP	CRLF
  358                   	;
  359 C280  CD F0D6     WOF:	CALL	OSTR
  360 C283  20 4F 46 46 	DB	' OFF',CR,LF,0
  361 C28A  C9          	RET
  362                   
  363                   ; Suche nach Inhalt der Softwaremodule M012, M026, M027 usw.
  364                   ; Es wird das erste Menwort gesucht, und dieses als Name angezeigt!
  365                   ; PE:	L=Steckplatz	H=Kennbyte = 0FBH
  366                   
  367 C28B  7D          slot:	ld	a,l		; Steckplatz, der zu untersuchen ist
  368 C28C  01 0880     	ld	bc,0880h	; alle Module von 8 bis L abschalten
  369 C28F              slot1:	OUTC0			; OUT (C),0
    1 C28F  ED 71       	 DB	0EDh,71h
  370 C291  04          	inc	b		; naechster Steckplatz
  371 C292  B8          	cp	b
  372 C293  20 FA       	jr	nz,slot1
  373 C295  3E 41       	ld	a,41h		; Modul auf 4000h einschalten
  374 C297  ED 79       	out	(c),a
  375                   	RESIXA	0,4		; RES 0,(IX+4),A
    1 C299  DD CB 04    	 DB	0DDh,0CBh,4
    2 C29C  87          	 DB	0 SHL 3 OR 10000111b
  376 C29D  D3 86       	OUT	(86H),A		; RAM4 aus!
  377 C29F  11 CFE2     	ld	de,MTAB2	; Vergleichskette 0-String
  378 C2A2  21 4000     	ld	hl,4000h	; Suchbereich Beginn
  379 C2A5  01 2000     	ld	bc,2000h	; 8K durchsuchen
  380 C2A8  CD F349     	call	zs0		; erstes Menuewort suchen
  381 C2AB  38 05       	jr	c,slot2		; Menuewort gefunden
  382 C2AD  21 CFDA     	ld	hl,mtab1	; ansonsten als "Software" anzeigen
  383 C2B0  18 07       	jr	slot4
  384                   	;
  385 C2B2  2B          slot2:	dec	hl
  386 C2B3  7E          	ld	a,(hl)
  387 C2B4  FE 7F       	cp	7fh		; zurueck bis zu Prologbyte
  388 C2B6  20 FA       	jr	nz,slot2
  389 C2B8  23          slot3:	inc	hl
  390 C2B9  7E          slot4:	ld	a,(hl)
  391 C2BA  FE 20       	cp	20h		; Epilog?
  392 C2BC  38 05       	jr	c,slot5		; ja
  393 C2BE  CD F3D5     	call	ochr		; Menuewort anzeigen
  394 C2C1  18 F5       	jr	slot3
  395                   	;
  396 C2C3  21 B804     slot5:	ld	hl,modst+4	; beginnend ab RAM4
  397 C2C6  56          slot6:	ld	d,(hl)		; gespeicherter Schaltzustand
  398 C2C7  E5          	push	hl
  399 C2C8  3E 02       	ld	a,2		; schalten
  400 C2CA  CD C307     	call	moduc		; Schaltzustaende nach Tabelle regenerieren
  401 C2CD  E1          	pop	hl
  402 C2CE  2C          	inc	l		; naechster Steckplatz
  403 C2CF  20 F5       	jr	nz,slot6

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  16
CC45    INC

  404 C2D1  18 8C       	jr	slot7
  405                   
  406                   ; Module lesen und schalten (Menuewort):
  407                   
  408 C2D3  53          SWIC:	LD	D,E		; Steuerbyte
  409 C2D4  2D          	DEC	L
  410 C2D5  20 0C       	JR	NZ,SWI2		; nicht IRM
  411 C2D7  FE 01       	CP	1
  412 C2D9  28 08       	JR	Z,SWI2		; nur lesen
  413 C2DB  2C          	INC	L
  414 C2DC  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
  415 C2DE  72          	LD	(HL),D		; IRM eintragen!
  416 C2DF  26 FF       	LD	H,0FFH
  417 C2E1  18 04       	JR	SWI3
  418 C2E3  2C          SWI2:	INC	L
  419 C2E4  CD C307     	CALL	MODUC		; lesen/schalten
  420 C2E7  7D          SWI3:	LD	A,L
  421 C2E8  CD F3B9     	CALL	AHSPC		; Platz anzeigen
  422 C2EB  7C          	LD	A,H
  423 C2EC  CD F3B9     	CALL	AHSPC		; Kennbyte
  424 C2EF  7A          	LD	A,D
  425 C2F0  CD F3C4     	CALL	AHEX		; Steuerbyte
  426 C2F3  18 88       	JR	SJCRLF
  427                   
  428                   ; V.24-Modul suchen und einschalten:
  429                   ;
  430                   ; PE:	B	Steckplatz ab dem gesucht wird
  431                   ; PA:	B	Steckplatz des Moduls
  432                   ;	CY = 1	kein M003 vorhanden
  433                   ; VR:	AF, BC, D, HL
  434                   ;
  435 C2F5  0E 80       V24SU:	LD	C,80h
  436 C2F7  ED 78       V24S1:	IN	A,(C)
  437 C2F9  FE EE       	CP	0EEH		; M003?
  438 C2FB  28 05       	JR	Z,V24S2		; ja
  439 C2FD  04          	INC	B
  440 C2FE  20 F7       	JR	NZ,V24S1
  441 C300  37          	SCF			; nicht gefunden
  442 C301  C9          	RET
  443 C302  68          V24S2:	LD	L,B
  444 C303  3E 02       	LD	A,2
  445 C305  16 01       	LD	D,1
  446                   
  447                   ; Module schalten:
  448                   
  449 C307  26 B8       MODUC:	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
  450 C309  0E 80       	LD	C,80H		; I/O-Adresse
  451 C30B  45          	LD	B,L
  452 C30C  FE 02       	CP	2		; Parameter?
  453 C30E  30 04       	JR	NC,MODU1
  454 C310  56          	LD	D,(HL)		; nur lesen
  455 C311  ED 60       RSTRB:	IN	H,(C)
  456 C313  C9          	RET
  457                   
  458 C314  7E          MODU1:	LD	A,(HL)		; alter Zustand
  459 C315  72          	LD	(HL),D		; eintragen
  460 C316  67          	LD	H,A		; fuer 2. RAM4
  461 C317  7D          	LD	A,L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  17
CC45    INC

  462 C318  FE 06       	CP	6		; interne Module?
  463 C31A  38 04       	JR	C,MODU2
  464 C31C  ED 51       	OUT	(C),D		; Senden Steuerbyte
  465 C31E  18 F1       	JR	RSTRB
  466                   
  467 C320  45          MODU2:	LD	B,L
  468 C321  04          	INC	B
  469 C322  DB 88       	IN	A,(PIOAD)
  470 C324  10 0D       	DJNZ	MODU3		; 0: RAM0?
  471 C326  E6 F5       	AND	11110101b
  472 C328  67          	LD	H,A
  473 C329  7A          	LD	A,D
  474 C32A  0F          	RRCA			; Bits 0,1 auf 7,0 rotieren
  475 C32B  E6 81       	AND	10000001b	; CY = 0
  476 C32D  17          	RLA			; 0 einfuegen, CY = Bit 7
  477 C32E  17          	RLA			; Bit 0 = CY
  478 C32F  07          	RLCA			; auf Bits 1,3 rotieren
  479 C330  B4          	OR	H
  480 C331  18 27       	JR	OUT88
  481                   
  482 C333  10 0A       MODU3:	DJNZ	MODU4		; 1: IRM?
  483 C335  E6 FB       	AND	11111011b
  484 C337  CB 42       	BIT	0,D
  485 C339  28 1F       	JR	Z,OUT88
  486 C33B  F6 04       	OR	00000100b
  487 C33D  18 1B       	JR	OUT88
  488                   
  489 C33F  10 1D       MODU4:	DJNZ	MODU5		; 2: ROMC?
  490 C341  7A          	LD	A,D
  491 C342  2F          	CPL			; negieren
  492 C343  07          	RLCA			; Bits 4..5 auf 5..6 rotieren
  493 C344  E6 60       	AND	01100000b	; ausfiltern
  494 C346  67          	LD	H,A
  495 C347  F3          	DI
  496 C348  DD 7E 04    	LD	A,(IX+4)
  497 C34B  E6 9F       	AND	10011111b
  498 C34D  B4          	OR	H		; einbauen
  499 C34E  DD 77 04    	LD	(IX+4),A
  500 C351  D3 86       	OUT	(86H),A
  501 C353  FB          	EI
  502 C354  7A          	LD	A,D
  503 C355  0F          	RRCA			; CY = Bit 0
  504 C356  DB 88       	IN	A,(PIOAD)
  505 C358  17          	RLA			; als Bit 0 einschieben
  506 C359  0F          	RRCA			; und auf Bit 7 rotieren
  507 C35A  D3 88       OUT88:	OUT	(PIOAD),A
  508 C35C  18 27       	JR	STBFF
  509                   
  510 C35E  10 28       MODU5:	DJNZ	MODU6		; 3: RAM8?
  511 C360  3E 03       	LD	A,00000011b
  512 C362  A2          	AND	D
  513 C363  0F          	RRCA			; Bits 0..1 auf 5..6 rotieren
  514 C364  0F          	RRCA
  515 C365  0F          	RRCA
  516 C366  67          	LD	H,A
  517 C367  F3          	DI
  518 C368  DB 89       	IN	A,(PIOBD)
  519 C36A  E6 9F       	AND	10011111b

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  18
CC45    INC

  520 C36C  B4          	OR	H
  521 C36D  D3 89       	OUT	(PIOBD),A
  522 C36F  FB          	EI
  523 C370  7A          	LD	A,D
  524 C371  07          	RLCA			; Bits 2..5 auf 4..7 rotieren
  525 C372  07          	RLCA
  526 C373  C6 20       	ADD	A,20h		; Segment-Verschiebung
  527 C375  E6 F0       	AND	0F0h
  528 C377  67          	LD	H,A
  529 C378  F3          	DI
  530 C379  DD 7E 01    	LD	A,(IX+1)
  531 C37C  E6 0F       	AND	0Fh
  532 C37E  B4          	OR	H		; RAM8-Segment
  533 C37F  D3 84       	OUT	(84h),A
  534 C381  DD 77 01    	LD	(IX+1),A
  535 C384  FB          STBFFI:	EI
  536 C385  26 FF       STBFF:	LD	H,0FFh
  537 C387  C9          	RET
  538                   
  539 C388  10 FB       MODU6:	DJNZ	STBFF		; 5=CAOSC
  540 C38A  7A          	LD	A,D		; 4=RAM4
  541 C38B  AC          	XOR	H
  542 C38C  E6 04       	AND	4		; Aenderung?
  543 C38E  F3          	DI
  544 C38F  28 3F       	JR	Z,RAM41
  545 C391  DD 7E 04    	LD	A,(IX+4)
  546 C394  F6 03       	OR	3
  547 C396  D3 86       	OUT	(86H),A		; RAM4 on
  548 C398  D5          	PUSH	DE
  549 C399  E5          	PUSH	HL
  550 C39A  DB 88       	IN	A,(PIOAD)
  551 C39C  F5          	PUSH	AF
  552 C39D  CB 87       	RES	0,A
  553 C39F  D3 88       	OUT	(PIOAD),A	; CAOSE off
  554 C3A1  DD 7E 01    	LD	A,(IX+1)
  555 C3A4  F5          	PUSH	AF
  556 C3A5  E6 F9       	AND	11111001b
  557 C3A7  2E 03       	LD	L,3		; 3 IRM-Ebenen
  558 C3A9  01 1000     	LD	BC,1000H	; 800H frei!
  559 C3AC  11 4000     	LD	DE,4000H
  560 C3AF  C6 02       R4IS:	ADD	A,2
  561 C3B1  D3 84       	OUT	(84H),A		; IRM-Ebene
  562 C3B3  67          	LD	H,A
  563 C3B4  E5          	PUSH	HL
  564 C3B5  21 A800     	LD	HL,0A800H
  565 C3B8  1A          R4MV:	LD	A,(DE)
  566 C3B9  ED A0       	LDI
  567 C3BB  2B          	DEC	HL
  568 C3BC  77          	LD	(HL),A
  569 C3BD  23          	INC	HL
  570 C3BE  EA C3B8     	JP	PE,R4MV
  571 C3C1  E1          	POP	HL
  572 C3C2  7C          	LD	A,H
  573 C3C3  06 18       	LD	B,18H		; jetzt 1800H!
  574 C3C5  2D          	DEC	L
  575 C3C6  20 E7       	JR	NZ,R4IS
  576 C3C8  F1          	POP	AF
  577 C3C9  D3 84       	OUT	(84H),A		; IRM wie zuvor

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  19
CC45    INC

  578 C3CB  F1          	POP	AF
  579 C3CC  D3 88       	OUT	(PIOAD),A	; CAOSE on
  580 C3CE  E1          	POP	HL
  581 C3CF  D1          	POP	DE
  582 C3D0  DD 7E 04    RAM41:	LD	A,(IX+4)
  583 C3D3  AA          	XOR	D
  584 C3D4  E6 FC       	AND	11111100b	; Bits 0..1: a = (0 XOR d) = d
  585 C3D6  AA          	XOR	D		; Bits 2..7: a = (a XOR d) XOR d
  586 C3D7  DD 77 04    	LD	(IX+4),A
  587 C3DA  D3 86       	OUT	(86h),A
  588 C3DC  18 A6       	JR	STBFFI
  589                   
  590                   ; F-Taste belegen:
  591                   
  592 C3DE  21 B900     KEYC:	LD	HL,0B900H
  593 C3E1  A7          	AND	A
  594 C3E2  20 07       	JR	NZ,KEY0
  595 C3E4  06 9C       	LD	B,9CH
  596 C3E6  77          KEYCL:	LD	(HL),A		; loeschen
  597 C3E7  2C          	INC	L
  598 C3E8  10 FC       	DJNZ	KEYCL
  599 C3EA  C9          	RET
  600 C3EB  FE 10       KEY0:	CP	16
  601 C3ED  D0          	RET	NC		; nur F1 bis FF
  602 C3EE  47          	LD	B,A
  603 C3EF  F6 F0       	OR	0F0H
  604 C3F1  4F          	LD	C,A
  605 C3F2  7E          KEY1:	LD	A,(HL)		; B Dummys auszaehlen
  606 C3F3  2C          	INC	L
  607 C3F4  C8          	RET	Z
  608 C3F5  A7          	AND	A
  609 C3F6  20 FA       	JR	NZ,KEY1
  610 C3F8  10 F8       	DJNZ	KEY1
  611 C3FA  7D          	LD	A,L
  612 C3FB  FE 9C       	CP	9CH
  613 C3FD  D0          	RET	NC
  614 C3FE  ED 5B B7A0  	LD	DE,(CURSO)
  615 C402  CD C4BB     	CALL	KEYDI		; praesentieren
  616 C405  CD F3F0     KEY2:	CALL	INTB
  617 C408  FE 13       	CP	13H
  618 C40A  20 03       	JR	NZ,KEY3
  619 C40C  04          	INC	B		; Umschaltung
  620 C40D  18 F6       	JR	KEY2
  621 C40F  CB 40       KEY3:	BIT	0,B
  622 C411  28 0D       	JR	Z,KEY4		; interpretieren
  623 C413  FE 03       	CP	3
  624 C415  28 70       	JR	Z,KEY12		; BRK=Abbruch
  625 C417  FE 0D       	CP	CR
  626 C419  28 0A       	JR	Z,KEY5		; Enter=belegen
  627 C41B  CD F3D5     	CALL	OCHR
  628 C41E  18 E5       	JR	KEY2
  629 C420  CD F751     KEY4:	CALL	CSTBT
  630 C423  18 E0       	JR	KEY2
  631                   	;
  632 C425  E5          KEY5:	PUSH	HL		; Pos. in Puffer
  633 C426  CD E07C     	CALL	DABR
  634 C429  EB          	EX	DE,HL
  635 C42A  CD F4DC     	CALL	RHEX		; Fn lesen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  20
CC45    INC

  636 C42D  E1          	POP	HL
  637 C42E  38 06       	JR	C,KERR		; Formatfehler
  638 C430  3A B797     	LD	A,(NUMVX)
  639 C433  B9          	CP	C		; geaendert!
  640 C434  28 06       	JR	Z,KEY6
  641 C436  CD F4CC     KERR:	CALL	CRLF
  642 C439  C3 F4C2     	JP	ERRM
  643 C43C  13          KEY6:	INC	DE
  644 C43D  13          	INC	DE
  645 C43E  06 9B       	LD	B,9BH
  646 C440  2F          	CPL
  647 C441  A7          	AND	A
  648 C442  28 21       	JR	Z,KEY8		; KEY F
  649 C444  3C          	INC	A
  650 C445  47          	LD	B,A
  651 C446  4D          	LD	C,L
  652 C447  7E          KEY7:	LD	A,(HL)
  653 C448  2C          	INC	L
  654 C449  28 EB       	JR	Z,KERR		; Puffer voll!
  655 C44B  A7          	AND	A
  656 C44C  20 F9       	JR	NZ,KEY7
  657 C44E  10 F7       	DJNZ	KEY7		; Ende suchen
  658 C450  2D          	DEC	L
  659 C451  7D          	LD	A,L
  660 C452  FE 9C       	CP	9CH
  661 C454  30 E0       	JR	NC,KERR		; Puffer voll!
  662 C456  44          	LD	B,H
  663 C457  C5          	PUSH	BC
  664 C458  91          	SUB	C
  665 C459  4F          	LD	C,A
  666 C45A  06 00       	LD	B,0
  667 C45C  D5          	PUSH	DE
  668 C45D  11 B99B     	LD	DE,0B99BH
  669 C460  ED B8       	LDDR			; Rest hinter
  670 C462  43          	LD	B,E
  671 C463  D1          	POP	DE
  672 C464  E1          	POP	HL
  673 C465  4F          KEY8:	LD	C,A
  674 C466  2D          KEY9:	DEC	L
  675 C467  7E          	LD	A,(HL)
  676 C468  A7          	AND	A
  677 C469  20 FB       	JR	NZ,KEY9		; zurueck bis 0
  678 C46B  2C          KEY10:	INC	L
  679 C46C  1A          	LD	A,(DE)
  680 C46D  13          	INC	DE
  681 C46E  77          	LD	(HL),A		; belegen
  682 C46F  B7          	OR	A
  683 C470  28 08       	JR	Z,KEY11
  684 C472  78          	LD	A,B
  685 C473  95          	SUB	L
  686 C474  20 F5       	JR	NZ,KEY10
  687 C476  36 00       	LD	(HL),0
  688 C478  18 BC       	JR	KERR
  689 C47A  79          KEY11:	LD	A,C
  690 C47B  A7          	AND	A
  691 C47C  28 09       	JR	Z,KEY12		; KEY F
  692 C47E  04          	INC	B
  693 C47F  2C          	INC	L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  21
CC45    INC

  694 C480  5D          	LD	E,L
  695 C481  54          	LD	D,H
  696 C482  68          	LD	L,B
  697 C483  06 00       	LD	B,0
  698 C485  ED B0       	LDIR			; Rest nach vorn
  699 C487  C3 F4CC     KEY12:	JP	CRLF
  700                   
  701                   ; Anzeige belegter F-Tasten:
  702                   
  703 C48A  21 B901     KEYLIC:	LD	HL,0B901H
  704 C48D  01 00F1     	LD	BC,0F1H
  705 C490  7E          KEYLC1:	LD	A,(HL)
  706 C491  A7          	AND	A
  707 C492  28 07       	JR	Z,KEYLC2
  708 C494  CD C4BB     	CALL	KEYDI		; Belegung
  709 C497  CD F4CC     	CALL	CRLF
  710 C49A  04          	INC	B		; Zaehler
  711 C49B  2C          KEYLC2:	INC	L
  712 C49C  7D          	LD	A,L
  713 C49D  FE 9C       	CP	9CH
  714 C49F  30 03       	JR	NC,KEYLC3
  715 C4A1  0C          	INC	C
  716 C4A2  20 EC       	JR	NZ,KEYLC1	; F1 bis FF
  717 C4A4  04          KEYLC3:	INC	B
  718 C4A5  05          	DEC	B
  719 C4A6  C0          	RET	NZ
  720 C4A7  CD F0D6     	CALL	OSTR
  721 C4AA  46 2D 54 61 	DB	'F-Tasten leer'
  722 C4B7  0D 0A 00    	DB	CR,LF,0
  723 C4BA  C9          	RET
  724                   
  725 C4BB  3E 02       KEYDI:	LD	A,2
  726 C4BD  CD F3D5     	CALL	OCHR		; Zeile loeschen
  727 C4C0  79          	LD	A,C
  728 C4C1  CD F0D3     	CALL	AHOSTR		; Fn
  729 C4C4  20 3A 00    	DB	' :',0
  730 C4C7  7E          KEYD1:	LD	A,(HL)
  731 C4C8  B7          	OR	A
  732 C4C9  C8          	RET	Z
  733 C4CA  CD F751     	CALL	CSTBT
  734 C4CD  23          	INC	HL
  735 C4CE  7D          	LD	A,L
  736 C4CF  FE 9C       	CP	9CH
  737 C4D1  D0          	RET	NC
  738 C4D2  18 F3       	JR	KEYD1
  739                   
  740                   ; COLOR-Menuewort:
  741                   
  742 C4D4  A7          COLRC:	AND	A		; Anzahl Parameter
  743 C4D5  20 17       	JR	NZ,SETCO	; 1 oder 2 -> Farben einstellen
  744 C4D7  3A B7A3     	LD	A,(COLOR)	; 0 = aktuelle Farben anzeigen
  745 C4DA  6F          	LD	L,A
  746 C4DB  0F          	RRCA
  747 C4DC  0F          	RRCA
  748 C4DD  0F          	RRCA
  749 C4DE  E6 1F       	AND	1FH
  750 C4E0  CD F3B9     	CALL	AHSPC		; Anzeige Vordergrundfarbe
  751 C4E3  7D          	LD	A,L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  22
CC45    INC

  752 C4E4  E6 07       	AND	7
  753 C4E6  CD F3C4     	CALL	AHEX		; Anzeige Hintergrundfarbe
  754 C4E9  CD F4CC     	CALL	CRLF
  755 C4EC  18 18       	JR	COLRC2
  756                   
  757                   ; COLOR-Unterprogramm = Farbe setzen (aus L und E)
  758                   
  759 C4EE  3E 1F       SETCO:	LD	A,1FH		; 1 oder 2 
  760 C4F0  A5          	AND	L
  761 C4F1  17          	RLA
  762 C4F2  17          	RLA
  763 C4F3  17          	RLA
  764 C4F4  6F          	LD	L,A
  765 C4F5  3A B781     	LD	A,(ARGN)
  766 C4F8  FE 02       	CP	2
  767 C4FA  7B          	LD	A,E
  768 C4FB  30 03       	JR	NC,COLRC1
  769 C4FD  3A B7A3     	LD	A,(COLOR)	; Hintergrund
  770 C500  E6 07       COLRC1:	AND	7
  771 C502  B5          	OR	L
  772 C503  32 B7A3     	LD	(COLOR),A
  773 C506  C3 FB57     COLRC2:	JP	COFF
  774                   
  775                   ; WINDOW-Menuewort
  776                   
  777 C509  A7          WINDC:	AND	A		; Kein Argument?
  778 C50A  28 20       	JR	Z,WINC0		; Standardfenster initialisieren
  779 C50C  3D          	DEC	A		; 1 Arg?
  780 C50D  7D          	LD	A,L		; nr
  781 C50E  28 28       	JR	Z,WINAKC	; Aufruf No.L
  782 C510  65          	LD	H,L		; za
  783 C511  69          	LD	L,C		; sa
  784 C512  53          	LD	D,E		; zn
  785 C513  3A B788     	LD	A,(ARG4)
  786 C516  5F          	LD	E,A		; sn
  787 C517  3A B781     	LD	A,(ARGN)
  788 C51A  FE 04       	CP	4
  789 C51C  38 0B       	JR	C,WINCJE	; 2..3 Arg
  790 C51E  3E 00       	LD	A,0
  791 C520  28 03       	JR	Z,WINC1		; 4 Arg
  792 C522  3A B78A     	LD	A,(ARG5)	; nr
  793 C525  CD C568     WINC1:	CALL	WININC
  794 C528  D0          	RET	NC
  795 C529  C3 F4C2     WINCJE:	JP	ERRM
  796                   
  797 C52C  11 B79B     WINC0:	LD	DE,WINNR	; von Fensternummer
  798 C52F  21 C002     	LD	HL,WIN0		; bis WEND-Adresse
  799 C532  01 000B     	LD	BC,WIN1-WIN0	; mit Standardwerten aus ROM
  800 C535  ED B0       	LDIR			; Fenster 0 neu initialisieren
  801 C537  C9          	RET
  802                   
  803                   ; definiertes Fenster aufrufen:
  804                   
  805 C538  CD C555     WINAKC:	CALL	WCOPY
  806 C53B  32 B79B     	LD	(WINNR),A
  807 C53E  CD C548     	CALL	PART		; Fenster A
  808 C541  D8          	RET	C		; holen
  809 C542  EB          	EX	DE,HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  23
CC45    INC

  810 C543  11 B79C     	LD	DE,WINON
  811 C546  18 1A       	JR	WCOP1
  812                   
  813                   ; Testet A und berechnet Position in Fenstervektorspeicher =DE
  814                   
  815 C548  C6 F6       PART:	ADD	A,0F6H
  816 C54A  D8          	RET	C		; zu gross
  817 C54B  87          	ADD	A,A
  818 C54C  5F          	LD	E,A
  819 C54D  87          	ADD	A,A
  820 C54E  87          	ADD	A,A
  821 C54F  83          	ADD	A,E
  822 C550  5F          	LD	E,A
  823 C551  16 B9       	LD	D,0B9H
  824 C553  A7          	AND	A		; CY=0
  825 C554  C9          	RET
  826                   
  827                   ; Fenster (WINNR) retten
  828                   
  829 C555  F5          WCOPY:	PUSH	AF
  830 C556  3A B79B     	LD	A,(WINNR)
  831 C559  CD C548     	CALL	PART
  832 C55C  38 3D       	JR	C,WINIE		; Fehler
  833 C55E  F1          	POP	AF
  834 C55F  21 B79C     	LD	HL,WINON
  835 C562  01 000A     WCOP1:	LD	BC,10
  836 C565  ED B0       	LDIR
  837 C567  C9          	RET
  838                   
  839                   ; Initialisierung eines Fensters
  840                   
  841 C568  F5          WININC:	PUSH	AF
  842 C569  FE 0A       	CP	10		; No.
  843 C56B  30 2E       	JR	NC,WINIE
  844 C56D  7A          	LD	A,D		; Zeilen
  845 C56E  A7          	AND	A
  846 C56F  28 2A       	JR	Z,WINIE
  847 C571  84          	ADD	A,H
  848 C572  38 27       	JR	C,WINIE
  849 C574  FE 21       	CP	21H
  850 C576  30 23       	JR	NC,WINIE
  851 C578  7B          	LD	A,E		; Spalten
  852 C579  A7          	AND	A
  853 C57A  28 1F       	JR	Z,WINIE
  854 C57C  85          	ADD	A,L
  855 C57D  38 1C       	JR	C,WINIE
  856 C57F  FE 29       	CP	29H
  857 C581  30 18       	JR	NC,WINIE
  858 C583  F1          	POP	AF
  859 C584  D5          	PUSH	DE
  860 C585  E5          	PUSH	HL
  861 C586  CD C555     	CALL	WCOPY
  862 C589  E1          	POP	HL
  863 C58A  D1          	POP	DE
  864 C58B  22 B79C     	LD	(WINON),HL
  865 C58E  ED 53 B79E  	LD	(WINLG),DE
  866 C592  ED 43 B7A0  	LD	(CURSO),BC	; BC=0
  867 C596  32 B79B     	LD	(WINNR),A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  24
CC45    INC

  868 C599  A7          	AND	A
  869 C59A  C9          	RET
  870                   	;
  871 C59B  F1          WINIE:	POP	AF		; Fehlerende
  872 C59C  37          	SCF
  873 C59D  C9          	RET
  874                   
  875                   ; Linie zeichnen von	(ARG1)/(ARG2) nach (ARG3)/(ARG4)
  876                   
  877 C59E  ED 5B B784  LINEC:	 LD	DE,(ARG2)	; YANF
  878 C5A2  2A B788     	 LD	HL,(ARG4)	; YEND
  879 C5A5  D9          	 EXX
  880 C5A6  ED 5B B782  	LD	DE,(ARG1)	; XANF
  881 C5AA  D5          	PUSH	DE
  882 C5AB  2A B786     	LD	HL,(ARG3)	; XEND
  883 C5AE  3E 08       	LD	A,8		; X=Master
  884 C5B0  B7          	OR	A
  885 C5B1  ED 52       	SBC	HL,DE		; HL=XSTEPS
  886 C5B3  30 06       	JR	NC,LINC1	; vorwaerts
  887 C5B5  19          	ADD	HL,DE
  888 C5B6  EB          	EX	DE,HL
  889 C5B7  F6 01       	OR	1		; rueckwaerts
  890 C5B9  ED 52       	SBC	HL,DE
  891 C5BB  D9          LINC1:	 EXX
  892 C5BC  D5          	 PUSH	DE		; YANF
  893 C5BD  ED 52       	 SBC	HL,DE		; HL'=YSTEPS
  894 C5BF  30 06       	 JR	NC,LINC2	; steigend
  895 C5C1  19          	 ADD	HL,DE
  896 C5C2  EB          	 EX	DE,HL
  897 C5C3  F6 02       	 OR	2		; fallend
  898 C5C5  ED 52       	 SBC	HL,DE
  899 C5C7  E5          LINC2:	 PUSH	HL		; YSTEPS
  900 C5C8  D9          	 EXX			; HL=XSTEPS
  901 C5C9  C1          	POP	BC		; BC=YSTEPS
  902 C5CA  E5          	PUSH	HL
  903 C5CB  ED 42       	SBC	HL,BC		; flach/steil?
  904 C5CD  E1          	POP	HL
  905 C5CE  C5          	PUSH	BC
  906 C5CF  30 05       	JR	NC,LINC3	; flach
  907 C5D1  E3          	EX	(SP),HL
  908 C5D2  CB 9F       	RES	3,A		; X=Slave
  909 C5D4  CB D7       	SET	2,A		; Y=Master
  910 C5D6  E5          LINC3:	PUSH	HL		; HL=MAX(STEPS)
  911 C5D7  44          	LD	B,H
  912 C5D8  4D          	LD	C,L		; Pixelzaehler
  913 C5D9  D9          	 EXX
  914 C5DA  C1          	 POP	BC		; BC'=MAX(...)
  915 C5DB  D1          	 POP	DE		; DE'=MIN(...)
  916 C5DC  60          	 LD	H,B
  917 C5DD  69          	 LD	L,C
  918 C5DE  CB 3C       	 SRL	H		; Slave mit 1/2
  919 C5E0  CB 1D       	 RR 	L		; HL=1/2*MAX(...)
  920 C5E2  D9          	 EXX
  921 C5E3  D1          	POP	DE		; DE=YANF
  922 C5E4  E1          	POP	HL		; HL=XANF
  923                   
  924                   ; Hauptschleife
  925                   ; AF Bitregister

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  25
CC45    INC

  926                   ; HL lfd. X-Koordinate	HL' Slave
  927                   ; DE lfd. Y-Koordinate	DE' -Master
  928                   ; BC Punktezaehler	BC' +Master
  929                   
  930 C5E5  F5          LINCS:	PUSH	AF
  931 C5E6  08          	EX	AF,AF'		; Bitreg merken
  932 C5E7  F1          	POP	AF
  933 C5E8  E5          	PUSH	HL
  934 C5E9  21 B7ED     	LD	HL,LINTYP
  935 C5EC  CB 06       	RLC	(HL)
  936 C5EE  E1          	POP	HL
  937 C5EF  DC C69E     	CALL	C,SHLDE		; Punkt setzen
  938 C5F2  D9          	 EXX
  939 C5F3  A7          	 AND	A
  940 C5F4  ED 52       	 SBC	HL,DE		; -Master subtrahieren
  941 C5F6  30 01       	 JR	NC,LINC4	; kein Uebertrag - kein Sprung!
  942 C5F8  09          	 ADD	HL,BC		; +Master addieren (CY bleibt =1)
  943 C5F9  D9          LINC4:	 EXX
  944 C5FA  30 02       	JR	NC,LINC5
  945 C5FC  F6 0C       	OR	0CH		; X und Y!
  946 C5FE  CB 5F       LINC5:	BIT	3,A		; X?
  947 C600  28 07       	JR	Z,LINC6
  948 C602  23          	INC	HL
  949 C603  CB 47       	BIT	0,A
  950 C605  28 02       	JR	Z,LINC6
  951 C607  2B          	DEC	HL
  952 C608  2B          	DEC	HL
  953 C609  CB 57       LINC6:	BIT	2,A		; Y?
  954 C60B  28 07       	JR	Z,LINC7
  955 C60D  13          	INC	DE
  956 C60E  CB 4F       	BIT	1,A
  957 C610  28 02       	JR	Z,LINC7
  958 C612  1B          	DEC	DE
  959 C613  1B          	DEC	DE
  960 C614  78          LINC7:	LD	A,B
  961 C615  B1          	OR	C		; letzter Punkt?
  962 C616  C8          	RET	Z
  963 C617  0B          	DEC	BC
  964 C618  08          	EX	AF,AF'		; Bitreg
  965 C619  18 CA       	JR	LINCS
  966                   
  967                   ; Punkt setzen:
  968                   
  969 C61B  E5          PUSEC:	PUSH	HL
  970 C61C  D5          	PUSH	DE
  971 C61D  C5          	PUSH	BC
  972 C61E  CD C716     	CALL	CALHV		; berechnen
  973 C621  D4 C6AB     	CALL	NC,PUSET	; & setzen
  974 C624  C3 F3EC     	JP	POP3		; POP	BC,DE,HL   RET
  975                   
  976                   ; Kreis zeichnen:
  977                   
  978 C627  3A B786     CIRCLC:	LD	A,(ARG3)
  979 C62A  4F          	LD	C,A
  980 C62B  69          	LD	L,C
  981 C62C  AF          	XOR	A
  982 C62D  06 08       	LD	B,8
  983 C62F  CB 1D       	RR 	L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  26
CC45    INC

  984 C631  30 01       CIR1:	JR	NC,CIR2
  985 C633  81          	ADD	A,C
  986 C634  1F          CIR2:	RRA
  987 C635  CB 1D       	RR 	L
  988 C637  10 F8       	DJNZ	CIR1
  989 C639  67          	LD	H,A		; Achtelkreis berechnen
  990 C63A  54          	LD	D,H
  991 C63B  5D          	LD	E,L
  992 C63C  79          	LD	A,C
  993 C63D  CB 21       	SLA	C
  994 C63F  CB 10       	RL 	B
  995 C641  0B          	DEC	BC
  996 C642  C5          	PUSH	BC
  997 C643  01 0001     	LD	BC,1
  998 C646  D9          	EXX
  999 C647  4F          	LD	C,A
 1000 C648  06 00       	LD	B,0H
 1001 C64A  E5          CIR3:	PUSH	HL
 1002 C64B  21 B7ED     	LD	HL,LINTYP
 1003 C64E  CB 06       	RLC	(HL)
 1004 C650  E1          	POP	HL
 1005 C651  30 06       	JR	NC,CIRN
 1006 C653  CD C678     	CALL	CIRUP		; und jeweils 8
 1007 C656  CD C678     	CALL	CIRUP		; Punkte setzen
 1008 C659  D9          CIRN:	EXX
 1009 C65A  A7          	AND	A
 1010 C65B  ED 42       	SBC	HL,BC
 1011 C65D  03          	INC	BC
 1012 C65E  03          	INC	BC
 1013 C65F  ED 52       	SBC	HL,DE
 1014 C661  19          	ADD	HL,DE
 1015 C662  D9          	EXX
 1016 C663  30 0C       	JR	NC,CIR4
 1017 C665  D9          	EXX
 1018 C666  E3          	EX	(SP),HL
 1019 C667  EB          	EX	DE,HL
 1020 C668  A7          	AND	A
 1021 C669  ED 52       	SBC	HL,DE
 1022 C66B  1B          	DEC	DE
 1023 C66C  1B          	DEC	DE
 1024 C66D  EB          	EX	DE,HL
 1025 C66E  E3          	EX	(SP),HL
 1026 C66F  D9          	EXX
 1027 C670  0D          	DEC	C
 1028 C671  04          CIR4:	INC	B
 1029 C672  79          	LD	A,C
 1030 C673  B8          	CP	B
 1031 C674  30 D4       	JR	NC,CIR3
 1032 C676  F1          	POP	AF
 1033 C677  C9          	RET
 1034                   
 1035                   ; setzt 4 Punkte um Mittelpunkt
 1036                   
 1037 C678  78          CIRUP:	LD	A,B
 1038 C679  41          	LD	B,C
 1039 C67A  4F          	LD	C,A
 1040 C67B  AF          	XOR	A
 1041 C67C  57          	LD	D,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  27
CC45    INC

 1042 C67D  2A B784     	LD	HL,(ARG2)
 1043 C680  E5          	PUSH	HL
 1044 C681  59          	LD	E,C
 1045 C682  19          	ADD	HL,DE
 1046 C683  CD C68C     	CALL	CIRUP1
 1047 C686  AF          	XOR	A
 1048 C687  57          	LD	D,A
 1049 C688  E1          	POP	HL
 1050 C689  59          	LD	E,C
 1051 C68A  ED 52       	SBC	HL,DE
 1052 C68C  E5          CIRUP1:	PUSH	HL
 1053 C68D  2A B782     	LD	HL,(ARG1)
 1054 C690  58          	LD	E,B
 1055 C691  A7          	AND	A
 1056 C692  ED 52       	SBC	HL,DE
 1057 C694  D1          	POP	DE
 1058 C695  CD C69E     	CALL	SHLDE
 1059 C698  D5          	PUSH	DE
 1060 C699  57          	LD	D,A
 1061 C69A  58          	LD	E,B
 1062 C69B  19          	ADD	HL,DE
 1063 C69C  19          	ADD	HL,DE
 1064 C69D  D1          	POP	DE
 1065                   	;
 1066 C69E              SHLDE:	;setzt Punkt auf Pos. HL/DE (wenn moeglich)
 1067 C69E  E5          	PUSH	HL
 1068 C69F  D5          	PUSH	DE
 1069 C6A0  C5          	PUSH	BC
 1070 C6A1  F5          	PUSH	AF
 1071 C6A2  CD C71F     	CALL	CALXY		; berechnen
 1072 C6A5  D4 C6AB     	CALL	NC,PUSET	; & setzen
 1073 C6A8  C3 E0AB     	JP	POP4		; POP	AF,BC,DE,HL   RET
 1074                   	;
 1075 C6AB  DD CB 01 5E PUSET:	BIT	3,(IX+1)
 1076 C6AF  28 26       	JR	Z,HIRES		; HiRes
 1077 C6B1  CB 4A       	BIT	1,D
 1078 C6B3  20 1E       	JR	NZ,PUERA
 1079 C6B5  CB 42       	BIT	0,D
 1080 C6B7  20 03       	JR	NZ,PUXOR
 1081 C6B9  B6          	OR	(HL)		; setzen
 1082 C6BA  18 03       	JR	PUCOL
 1083 C6BC  AE          PUXOR:	XOR	(HL)		; alternierend
 1084 C6BD  CB 82       	RES	0,D
 1085 C6BF  77          PUCOL:	LD	(HL),A
 1086 C6C0  DD 7E 01    	LD	A,(IX+1)
 1087 C6C3  5F          	LD	E,A
 1088 C6C4  EE 02       	XOR	2		; Farbebene
 1089 C6C6  F3          	DI
 1090 C6C7  D3 84       	OUT	(84H),A
 1091 C6C9  7E          	LD	A,(HL)
 1092 C6CA  E6 07       	AND	7
 1093 C6CC  B2          	OR	D
 1094 C6CD  77          	LD	(HL),A		; neue vFarbe
 1095 C6CE  7B          	LD	A,E
 1096 C6CF  D3 84       	OUT	(84H),A
 1097 C6D1  FB          	EI
 1098 C6D2  C9          	RET
 1099 C6D3  2F          PUERA:	CPL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  28
CC45    INC

 1100 C6D4  A6          	AND	(HL)		; loeschen
 1101 C6D5  77          	LD	(HL),A
 1102 C6D6  C9          	RET
 1103                   	;
 1104 C6D7  47          HIRES:	LD	B,A
 1105 C6D8  B6          	OR	(HL)		; Bit setzen in
 1106 C6D9  CB 5A       	BIT	3,D		; Pixelebene?
 1107 C6DB  20 01       	JR	NZ,HIR1
 1108 C6DD  A8          	XOR	B		; wieder loeschen
 1109 C6DE  77          HIR1:	LD	(HL),A
 1110 C6DF  DD 7E 01    	LD	A,(IX+1)
 1111 C6E2  4F          	LD	C,A
 1112 C6E3  EE 02       	XOR	2
 1113 C6E5  F3          	DI
 1114 C6E6  D3 84       	OUT	(84H),A
 1115 C6E8  78          	LD	A,B
 1116 C6E9  B6          	OR	(HL)		; Bit setzen in
 1117 C6EA  CB 62       	BIT	4,D		; Farbebene?
 1118 C6EC  20 01       	JR	NZ,HIR2
 1119 C6EE  A8          	XOR	B		; wieder loeschen
 1120 C6EF  77          HIR2:	LD	(HL),A
 1121 C6F0  79          	LD	A,C
 1122 C6F1  D3 84       	OUT	(84H),A
 1123 C6F3  FB          	EI
 1124 C6F4  C9          	RET
 1125                   
 1126                   ; Punkt loeschen, PA: A=Farbbyte
 1127                   
 1128 C6F5  E5          PUDEC:	PUSH	HL
 1129 C6F6  D5          	PUSH	DE
 1130 C6F7  C5          	PUSH	BC
 1131 C6F8  CD C716     	CALL	CALHV
 1132 C6FB  38 16       	JR	C,PUDEE		; ausserhalb
 1133 C6FD  47          	LD	B,A		; Bit
 1134 C6FE  4E          	LD	C,(HL)
 1135 C6FF  2F          	CPL
 1136 C700  A1          	AND	C
 1137 C701  77          	LD	(HL),A		; loeschen
 1138 C702  DD 7E 01    	LD	A,(IX+1)
 1139 C705  5F          	LD	E,A
 1140 C706  EE 02       	XOR	2
 1141 C708  F3          	DI
 1142 C709  D3 84       	OUT	(84H),A
 1143 C70B  56          	LD	D,(HL)		; Farbbyte
 1144 C70C  7B          	LD	A,E
 1145 C70D  D3 84       	OUT	(84H),A
 1146 C70F  FB          	EI
 1147 C710  78          	LD	A,B		; Z=1: Punkt
 1148 C711  A1          	AND	C		; war geloescht
 1149 C712  7A          	LD	A,D		; Farbbyte
 1150 C713  C3 F3EC     PUDEE:	JP	POP3		; POP	BC,DE,HL   RET
 1151                   
 1152                   ; Grafikposition berechnen
 1153                   ; HL=X-Koor., DE=Y-Koor.
 1154                   ; PA:	CY=1	ausserhalb
 1155                   ; HL=IRM-Adr, A=Bitmaske, D=Farb
 1156                   
 1157 C716  2A B7D3     CALHV:	LD	HL,(HOR)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  29
CC45    INC

 1158 C719  ED 5B B7D5  	LD	DE,(VERT)
 1159 C71D  16 00       	LD	D,0
 1160 C71F  C5          CALXY:	PUSH	BC
 1161 C720  01 FDF8     	LD	BC,BITTAB
 1162 C723  7D          	LD	A,L
 1163 C724  E6 07       	AND	7
 1164 C726  81          	ADD	A,C
 1165 C727  4F          	LD	C,A		; Bit
 1166 C728  7D          	LD	A,L
 1167 C729  CB 3C       	SRL	H
 1168 C72B  1F          	RRA
 1169 C72C  CB 3C       	SRL	H
 1170 C72E  1F          	RRA
 1171 C72F  CB 3C       	SRL	H
 1172 C731  1F          	RRA			; Spalte
 1173 C732  FE 28       	CP	28H
 1174 C734  30 11       	JR	NC,CALEN
 1175 C736  F6 80       	OR	80H		; IRM
 1176 C738  67          	LD	H,A
 1177 C739  3E FF       	LD	A,0FFH
 1178 C73B  82          	ADD	A,D
 1179 C73C  38 09       	JR	C,CALEN
 1180 C73E  AB          	XOR	E		; CY=0!
 1181 C73F  6F          	LD	L,A		; Zeile
 1182 C740  3A B7D6     	LD	A,(FARB)
 1183 C743  57          	LD	D,A
 1184 C744  0A          	LD	A,(BC)		; MASKE fuer X
 1185 C745  C1          	POP	BC
 1186 C746  C9          	RET
 1187 C747  C1          CALEN:	POP	BC		; ausserhalb
 1188 C748  37          	SCF
 1189 C749  C9          	RET
 1190                   
 1191                   ; Ausgabe einer Displayzeile
 1192                   ; HL=Adresse, C=Anzahl Bytes
 1193                   
 1194 C74A  CD F3B4     DPMEMO:	CALL	HLHX		; Adresse
 1195 C74D  E5          	PUSH	HL
 1196 C74E  41          	LD	B,C
 1197 C74F  CD FB3B     DPME1:	CALL	LDAME		; Byte holen
 1198 C752  23          	INC	HL
 1199 C753  CD F3B9     	CALL	AHSPC		; anzeigen
 1200 C756  10 F7       	DJNZ	DPME1		; C*
 1201 C758  E1          	POP	HL
 1202 C759  41          	LD	B,C
 1203 C75A  3E 09       	LD	A,9
 1204 C75C  CD F3D5     	CALL	OCHR		; CUR
 1205 C75F  CD FB3B     DPME2:	CALL	LDAME		; Byte holen
 1206 C762  23          	INC	HL
 1207 C763  CD F751     	CALL	CSTBT		; als ASCII
 1208 C766  10 F7       	DJNZ	DPME2		; C*
 1209 C768  C9          	RET
 1210                   
 1211                   ; Anzeige Speicherbereich:
 1212                   ; HL=Adresse, E=Listblocklaenge
 1213                   ; C=Anzahl Bytes pro Zeile
 1214                   ; A=Anzahl Argumente
 1215                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  30
CC45    INC

 1216 C769  FE 03       DISPC:	CP	3
 1217 C76B  30 08       	JR	NC,DISP1
 1218 C76D  0E 08       	LD	C,8		; default = 8 Bytes/Zeile
 1219 C76F  FE 02       	CP	2
 1220 C771  30 02       	JR	NC,DISP1
 1221 C773  1E 04       	LD	E,4		; default = 4 Zeilen
 1222 C775  D5          DISP1:	PUSH	DE
 1223 C776  CD C74A     DISP2:	CALL	DPMEMO		; 1 Zeile
 1224 C779  CD F4CC     	CALL	CRLF
 1225 C77C  CD E388     	CALL	BRKT
 1226 C77F  38 06       	JR	C,DISP4
 1227 C781  1D          	DEC	E
 1228 C782  20 F2       	JR	NZ,DISP2	; E*
 1229 C784  CD F3F0     DISP3:	CALL	INTB		; Warten auf Tastenbetaetigung
 1230 C787  D1          DISP4:	POP	DE
 1231 C788  FE 03       	CP	3		; BRK?
 1232 C78A  C8          	RET	Z
 1233 C78B  FE 0F       	CP	0FH
 1234 C78D  20 05       	JR	NZ,DISP5
 1235 C78F  CD F3D5     	CALL	OCHR		; Hardcopy
 1236 C792  18 F0       	JR	DISP3
 1237 C794  FE 13       DISP5:	CP	13H		; STOP?
 1238 C796  20 DD       	JR	NZ,DISP1
 1239 C798  18 07       	JR	MODI1
 1240                   
 1241                   ; Anzeige/Veraendern Speicherbereich
 1242                   ; HL=Adresse, E=Anzahl Bytes pro Zeile
 1243                   ; A=Anzahl Argumente
 1244                   
 1245 C79A  4B          MODIC:	LD	C,E		; Breite
 1246 C79B  FE 02       	CP	2
 1247 C79D  30 02       	JR	NC,MODI1
 1248 C79F  0E 01       	LD	C,1		; default
 1249 C7A1  CD C74A     MODI1:	CALL	DPMEMO
 1250 C7A4  3E 05       	LD	A,5
 1251 C7A6  32 B7A0     	LD	(CURSO),A
 1252 C7A9  CD F495     	CALL	INLIN
 1253 C7AC  D8          	RET	C		; BRK
 1254 C7AD  E5          	PUSH	HL
 1255 C7AE  CD F4DC     	CALL	RHEX		; Adresse
 1256 C7B1  7E          	LD	A,(HL)
 1257 C7B2  E1          	POP	HL
 1258 C7B3  38 56       	JR	C,MODI9		; Fehler
 1259 C7B5  A7          	AND	A
 1260 C7B6  28 E9       	JR	Z,MODI1
 1261 C7B8  2A B797     	LD	HL,(NUMVX)
 1262 C7BB  E5          MODI2:	PUSH	HL
 1263 C7BC  CD F4DC     	CALL	RHEX		; Datenbyte
 1264 C7BF  7E          	LD	A,(HL)
 1265 C7C0  A7          	AND	A		; kein Zeichen
 1266 C7C1  23          	INC	HL		; einlesbar?
 1267 C7C2  7E          	LD	A,(HL)
 1268 C7C3  E1          	POP	HL
 1269 C7C4  28 04       	JR	Z,MODI4
 1270 C7C6  CD FB2B     MODI3:	CALL	LDMAE		; eintragen
 1271 C7C9  23          	INC	HL
 1272 C7CA  1A          MODI4:	LD	A,(DE)
 1273 C7CB  FE 2E       	CP	'.'		; Abschluss?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  31
CC45    INC

 1274 C7CD  C8          	RET	Z
 1275 C7CE  FE 2C       	CP	','		; 1 Zeichen?
 1276 C7D0  20 05       	JR	NZ,MODI5
 1277 C7D2  13          	INC	DE
 1278 C7D3  1A          	LD	A,(DE)		; vom Video-RAM
 1279 C7D4  13          	INC	DE
 1280 C7D5  18 EF       	JR	MODI3		; eintragen
 1281                   
 1282 C7D7  FE 3A       MODI5:	CP	':'		; Rueckschritt?
 1283 C7D9  20 06       	JR	NZ,MODI6
 1284 C7DB  06 00       	LD	B,0
 1285 C7DD  ED 42       	SBC	HL,BC		; C Bytes zurueck
 1286 C7DF  18 C0       	JR	MODI1
 1287                   
 1288 C7E1  FE 2F       MODI6:	CP	'/'		; neue Adresse?
 1289 C7E3  20 0B       	JR	NZ,MODI0
 1290 C7E5  13          	INC	DE
 1291 C7E6  CD F4DC     	CALL	RHEX
 1292 C7E9  38 20       	JR	C,MODI9
 1293 C7EB  2A B797     	LD	HL,(NUMVX)
 1294 C7EE  18 B1       	JR	MODI1
 1295                   
 1296 C7F0  FE 27       MODI0:	CP	27H		; Zeichenkette?
 1297 C7F2  20 10       	JR	NZ,MODI8
 1298 C7F4  13          	INC	DE
 1299 C7F5  1A          MODI7:	LD	A,(DE)		; Zeichen holen
 1300 C7F6  13          	INC	DE
 1301 C7F7  A7          	AND	A		; Dummy-Ende?
 1302 C7F8  28 A7       	JR	Z,MODI1
 1303 C7FA  FE 27       	CP	27H		; Ende Kette?
 1304 C7FC  28 CC       	JR	Z,MODI4
 1305 C7FE  CD FB2B     	CALL	LDMAE		; eintragen
 1306 C801  23          	INC	HL
 1307 C802  18 F1       	JR	MODI7
 1308                   
 1309 C804  A7          MODI8:	AND	A		; Ende Zeile?
 1310 C805  28 9A       	JR	Z,MODI1
 1311 C807  FE 20       	CP	' '		; Leerzeichen?
 1312 C809  28 B0       	JR	Z,MODI2
 1313 C80B  CD F4C2     MODI9:	CALL	ERRM		; sonst ERROR
 1314 C80E  18 91       	JR	MODI1
 1315                   
 1316                   ; Initialisierung der Druckerausgabe:
 1317                   ;
 1318                   ; PE:	(ARGN)	0..5 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1319                   ;	(ARG1)	Steckplatz	(0 = M021)
 1320                   ;	(ARG2)	SIO-Kanal	(0..1 = A, 2 = B)
 1321                   ;	(ARG3)	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1322                   ;	(ARG4)	ShCLR-Reaktion	(0 = keine, 1 = Protokoll, 2 = Hardcopy)
 1323                   ;	(ARG5)	Druckertyp	(0..12)
 1324                   ; PA:	-
 1325                   ; VR:	AF, BC, DE, HL
 1326                   ;
 1327 C810  CD F5DD     LSTC:	CALL	LARG		; Arg's laden
 1328 C813  CD C85B     	CALL	LSTCA		; Druckerinitialisierung (intern)
 1329 C816  DA F4C2     	JP	C,ERRM
 1330 C819  3E 0D       	LD	A,CR		; CR+LF drucken
 1331 C81B  CD B7E9     	CALL	OFILT

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  32
CC45    INC

 1332 C81E  3E 0A       	LD	A,LF
 1333 C820  C3 B7E9     	JP	OFILT
 1334                   
 1335 C823  3A B7E1     LSTC1:	LD	A,(HCPZ)	; bisheriges Steuerbyte
 1336 C826  E6 F0       	AND	0F0h		; Druckertyp uebernehmen
 1337 C828  0F          	RRCA			; und auf Bits 1..4 rotieren
 1338 C829  0F          	RRCA
 1339 C82A  0F          	RRCA
 1340 C82B  18 3D       	JR	LSTC6
 1341                   
 1342 C82D  CD C8C8     LSTC2:	CALL	USRARG		; Steuerwort aus Argumenten bilden (CY war 0)
 1343 C830  AF          	XOR	A
 1344 C831  D3 91       	OUT	(91h),A		; M021 PIO-B Daten
 1345 C833  DB 91       	IN	A,(91h)
 1346 C835  C6 FF       	ADD	A,-1		; 0 zurueckgelesen?
 1347 C837  D8          	RET	C		; sonst kein M021 vorhanden
 1348 C838  C5          	PUSH	BC
 1349 C839  21 F9CC     	LD	HL,M021PR
 1350 C83C  18 57       	JR	LSTC7
 1351                   
 1352 C83E  2E 07       LSTC3:	LD	L,7		; ab Steckplatz 7
 1353 C840  CD C8BE     LSTC4:	CALL	SIOARG		; Steuerwort aus Argumenten bilden
 1354 C843  C5          	PUSH	BC		; Adresse ShCLR-Reaktionsprogramm
 1355 C844  45          	LD	B,L
 1356 C845  CD C2F5     	CALL	V24SU		; M003 suchen
 1357 C848  50          	LD	D,B		; Steckplatz in D zurueckgeben
 1358 C849  38 70       	JR	C,IOEPOP	; nicht gefunden
 1359 C84B  3A B7E4     	LD	A,(INTV1L)
 1360 C84E  47          	LD	B,A
 1361 C84F  2A B7E2     	LD	HL,(INTV1)
 1362 C852  7B          	LD	A,E		; Steuerbyte
 1363 C853  CD C946     	CALL	INISIO
 1364 C856  21 F9E1     	LD	HL,V24PR
 1365 C859  18 3A       	JR	LSTC7
 1366                   
 1367                   ; Initialisierung der Druckerausgabe (intern):
 1368                   ;
 1369                   ; PE:	A	0..5 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1370                   ;	L	Steckplatz	(0 = M021)
 1371                   ;	E	SIO-Kanal	(0..1 = A, 2 = B)
 1372                   ;	C	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1373                   ;	(ARG4)	ShCLR-Reaktion	(0 = keine, 1 = Protokoll, 2 = Hardcopy)
 1374                   ;	(ARG5)	Druckertyp	(0..12)
 1375                   ; PA:	D	Steckplatz M003	(nur gueltig fuer A = 0)
 1376                   ;	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1377                   ; VR:	AF, BC, DE, HL
 1378                   ;
 1379 C85B  67          LSTCA:	LD	H,A
 1380 C85C  3E 05       	LD	A,5
 1381 C85E  BC          	CP	H		; (ARGN) <= 5?
 1382 C85F  D8          	RET	C
 1383 C860  20 C1       	JR	NZ,LSTC1
 1384 C862  3A B78A     LSTC5:	LD	A,(ARG5)	; neuer Druckertyp
 1385 C865  FE 0D       	CP	13		; (ARG5) < 13?
 1386 C867  30 53       	JR	NC,IOERET
 1387 C869  87          	ADD	A,A		; 0 fuer Bit 3 einschieben
 1388 C86A  57          LSTC6:	LD	D,A
 1389 C86B  7C          	LD	A,H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  33
CC45    INC

 1390 C86C  A7          	AND	A		; Steckplatz angegeben?
 1391 C86D  28 CF       	JR	Z,LSTC3
 1392 C86F  7D          	LD	A,L
 1393 C870  A7          	AND	A		; Steckplatz = 0?
 1394 C871  28 BA       	JR	Z,LSTC2		; M021
 1395 C873  C5          	PUSH	BC
 1396 C874  45          	LD	B,L
 1397 C875  0E 80       	LD	C,80h
 1398 C877  ED 78       	IN	A,(C)
 1399 C879  C1          	POP	BC
 1400 C87A  D6 EE       	SUB	0EEh		; M003?
 1401 C87C  28 C2       	JR	Z,LSTC4
 1402 C87E  3D          	DEC	A		; M001?
 1403 C87F  20 3B       	JR	NZ,IOERET
 1404                   
 1405 C881  CD C8C8     	CALL	USRARG		; Steuerwort aus Argumenten bilden (CY war 0)
 1406 C884  C5          	PUSH	BC		; Adresse ShCLR-Reaktionsprogramm
 1407 C885  3E 02       	LD	A,2
 1408 C887  16 01       	LD	D,1
 1409 C889  CD C307     	CALL	MODUC		; M001 einschalten
 1410 C88C  21 D810     	LD	HL,DIOINI
 1411 C88F  CD C979     	CALL	IMEXDI		; PIO konfigurieren
 1412 C892  21 F9BC     	LD	HL,M001PR
 1413 C895  22 B7EA     LSTC7:	LD	(OFILT + 1),HL
 1414 C898  E1          	POP	HL
 1415 C899  22 B799     	LD	(HCADR),HL	; ShCLR-Reaktionsprogramm setzen
 1416 C89C  7B          	LD	A,E
 1417 C89D  32 B7E1     	LD	(HCPZ),A	; Steuerbyte eintragen
 1418 C8A0  21 F9AB     	LD	HL,PRINT
 1419 C8A3  01 F4BB     	LD	BC,NOOP
 1420 C8A6  A7          	AND	A		; CY = 0
 1421                   ;
 1422                   ; Eintragen der Sprungadressen eines I/O-Kanals:
 1423                   ;
 1424                   ; PE:	E = Steuerwort
 1425                   ;	BC = Sprungadresse fuer Eingabe
 1426                   ;	HL = Sprungadresse fuer Ausgabe
 1427                   ; PA:	-
 1428                   ; VR:	F
 1429                   ;
 1430 C8A7  CB 4B       SETUIO:	BIT	1,E		; Ausgabekanal #2 oder #3?
 1431 C8A9  20 08       	JR	NZ,SETU2
 1432 C8AB  22 B7BE     	LD	(UOUT1 + 1),HL
 1433 C8AE  ED 43 B7C1  	LD	(UIN1  + 1),BC
 1434 C8B2  C9          	RET
 1435 C8B3  22 B7C4     SETU2:	LD	(UOUT2 + 1),HL
 1436 C8B6  ED 43 B7C7  	LD	(UIN2  + 1),BC
 1437 C8BA  C9          	RET
 1438                   
 1439 C8BB  E1          IOEPOP:	POP	HL
 1440 C8BC  37          IOERET:	SCF
 1441 C8BD  C9          	RET
 1442                   
 1443                   ; Auswertung der Argumente 2..4 fuer I/O-Initialisierung:
 1444                   ;
 1445                   ; PE:	H	Argumentzahl
 1446                   ;	E	SIO-Kanal	(0..1 = A, 2 = B)
 1447                   ;	C	User-Kanal	(2 = UOUT1, 3 = UOUT2)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  34
CC45    INC

 1448                   ;	(ARG4)	ShCLR-Reaktion
 1449                   ;	D	Steuerwort
 1450                   ; PA:	E	Steuerwort	(3 neue Bits von rechts einrotiert)
 1451                   ;	BC	Adresse ShCLR-Reaktionsprogramm
 1452                   ;	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1453                   ; VR:	AF, BC, DE, SP
 1454                   ;
 1455                   ; Stack-Unwinding: Im Fehlerfall wird die eigentliche Ruecksprungadresse vom
 1456                   ; Stack genommen, und dann ein RET ausgefuehrt.  Die aufrufende Routine darf
 1457                   ; keine Daten auf dem Stack zu liegen haben!
 1458                   ;
 1459 C8BE  3E 01       SIOARG:	LD	A,1
 1460 C8C0  BC          	CP	H
 1461 C8C1  30 05       	JR	NC,USRARG
 1462 C8C3  1D          	DEC	E		; (ARG2): SIO-Kanal
 1463 C8C4  93          	SUB	E		; 1 <= (ARG2) <= 2?
 1464 C8C5  38 F4       	JR	C,IOEPOP
 1465 C8C7  BB          	CP	E		; CY = 1 wenn K2
 1466 C8C8  5A          USRARG:	LD	E,D
 1467 C8C9  CB 13       	RL	E		; Bit 2 einschieben
 1468 C8CB  3E 02       	LD	A,2
 1469 C8CD  57          	LD	D,A
 1470 C8CE  BC          	CP	H
 1471 C8CF  30 06       	JR	NC,NOARG3
 1472 C8D1  79          	LD	A,C		; (ARG3): User-I/O-Kanal
 1473 C8D2  92          	SUB	D
 1474 C8D3  BA          	CP	D		; 2 <= (ARG3) <= 3?
 1475 C8D4  30 E5       	JR	NC,IOEPOP
 1476 C8D6  0F          	RRCA			; CY = 1 wenn User-Kanal #3
 1477 C8D7  CB 13       NOARG3:	RL	E		; Bit 1 einschieben
 1478 C8D9  01 F4BB     	LD	BC,NOOP
 1479 C8DC  14          	INC	D		; D = 3
 1480 C8DD  7A          	LD	A,D
 1481 C8DE  BC          	CP	H
 1482 C8DF  30 0D       	JR	NC,NOARG4
 1483 C8E1  3A B788     	LD	A,(ARG4)	; Reaktion auf ShCLR
 1484 C8E4  A7          	AND	A		; (ARG4) = 0?
 1485 C8E5  28 07       	JR	Z,NOARG4
 1486 C8E7  92          	SUB	D		; 0 <= (ARG4) <= 2?
 1487 C8E8  30 D1       	JR	NC,IOEPOP
 1488 C8EA  01 F97E     	LD	BC,HCPGM
 1489 C8ED  0F          	RRCA			; CY = 1 wenn Hardcopy
 1490 C8EE  CB 13       NOARG4:	RL	E		; Bit 0 einschieben
 1491 C8F0  C9          	RET
 1492                   
 1493                   ; Initialisierung V.24-Duplexbetrieb:
 1494                   ;
 1495                   ; PE:	(ARGN)	0..3 Argumente	(0 = M003 ab Steckplatz 7 suchen)
 1496                   ;	(ARG1)	Steckplatz
 1497                   ;	(ARG2)	SIO-Kanal	(0..1 = A, 2 = B)
 1498                   ;	(ARG3)	User-Kanal	(2 = UOUT1, 3 = UOUT2)
 1499                   ; PA:	CY	Fehlerstatus	(0 = OK, 1 = Fehler)
 1500                   ; VR:	AF, BC, DE, HL
 1501                   ;
 1502 C8F1  CD F5DD     V24DC:	CALL	LARG		; Arg's laden
 1503 C8F4  67          	LD	H,A
 1504 C8F5  3E 03       	LD	A,3
 1505 C8F7  BC          	CP	H		; (ARGN) <= 3?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  35
CC45    INC

 1506 C8F8  D8          	RET	C		; mehr als 3 Argumente
 1507 C8F9  16 00       	LD	D,0		; Steuerwort zunaechst leer
 1508 C8FB  CD C8BE     	CALL	SIOARG		; Steuerwort aus Argumenten 2-4 bilden
 1509 C8FE  E5          	PUSH	HL
 1510 C8FF  3A B7E7     	LD	A,(INTV2L)	; Laenge Duplexinitialisierung
 1511 C902  47          	LD	B,A
 1512 C903  2A B7E5     	LD	HL,(INTV2)	; Duplexinitialisierung
 1513 C906  23          	INC	HL
 1514 C907  18 17       	JR	V24DC5
 1515                   
 1516 C909  3E 80       V24DC1:	LD	A,10000000b	; Empfangseinstellungen (7/8 Bit)
 1517 C90B  18 10       	JR	V24DC3
 1518                   
 1519 C90D  7E          V24DC2:	LD	A,(HL)		; Initialisierungsdaten lesen
 1520 C90E  E6 07       	AND	00000111b	; Registerauswahl?
 1521 C910  28 11       	JR	Z,V24DC6
 1522 C912  23          	INC	HL
 1523 C913  FE 03       	CP	3		; WR3?
 1524 C915  28 F2       	JR	Z,V24DC1
 1525 C917  FE 05       	CP	5		; WR5?
 1526 C919  20 05       	JR	NZ,V24DC5
 1527 C91B  3E 68       	LD	A,01101000b	; Sendeeinstellungen (5-8 Bit, ein/aus)
 1528 C91D  A6          V24DC3:	AND	(HL)		; benoetigte Bits abtrennen
 1529 C91E  B3          	OR	E		; und in Steuerbyte einbauen
 1530 C91F  5F          V24DC4:	LD	E,A
 1531 C920  05          V24DC5:	DEC	B
 1532 C921  28 98       	JR	Z,IOEPOP	; fehlendes Initialisierungsbyte
 1533 C923  23          V24DC6:	INC	HL
 1534 C924  10 E7       	DJNZ	V24DC2
 1535                   
 1536 C926  E1          	POP	HL
 1537 C927  7C          	LD	A,H
 1538 C928  06 07       	LD	B,7		; Suche ab Steckplatz 7
 1539 C92A  A7          	AND	A		; Steckplatz angegeben?
 1540 C92B  28 01       	JR	Z,V24DC7
 1541 C92D  45          	LD	B,L		; angegebener Steckplatz
 1542 C92E  CD C2F5     V24DC7:	CALL	V24SU
 1543 C931  D8          	RET	C		; Modul nicht gefunden
 1544 C932  21 F9FC     	LD	HL,V24OT
 1545 C935  01 FA07     	LD	BC,V24IN
 1546 C938  CD C8A7     	CALL	SETUIO		; I/O-Sprungadressen eintragen
 1547 C93B  3A B7E7     V24DC8:	LD	A,(INTV2L)
 1548 C93E  47          	LD	B,A
 1549 C93F  2A B7E5     	LD	HL,(INTV2)
 1550 C942  7B          	LD	A,E		; Duplex-Steuerbyte
 1551 C943  32 B7E8     	LD	(HCPZ2),A	; eintragen
 1552                   
 1553                   ; SIO-Initialisierung:
 1554                   ;
 1555                   ; PE:	HL	Initialisierungstabelle
 1556                   ;	B	Laenge der Tabelle (>= 3)
 1557                   ;	A	Steuerbyte
 1558                   ; PA:	CY = 0
 1559                   ; VR:	AF, BC, HL
 1560                   ;
 1561 C946  E6 04       INISIO:	AND	00000100b
 1562 C948  0F          	RRCA
 1563 C949  0F          	RRCA

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  36
CC45    INC

 1564 C94A  C6 0C       	ADD	A,0Ch		; CTC-Port
 1565 C94C  4F          	LD	C,A
 1566 C94D  78          	LD	A,B
 1567 C94E  06 02       	LD	B,2		; 2 Byte fuer CTC-Initialisierung
 1568 C950  90          	SUB	B
 1569 C951  F3          	DI
 1570 C952  ED B3       	OTIR			; CTC initialisieren
 1571 C954  47          	LD	B,A
 1572 C955  0D          	DEC	C		; SIO-Steuerport
 1573 C956  0D          	DEC	C
 1574 C957  ED B3       	OTIR			; SIO initialisieren
 1575 C959  FB          	EI
 1576 C95A  A7          	AND	A		; CY = 0
 1577 C95B  C9          	RET
 1578                   
 1579                   ; V.24-Modul initialisieren:
 1580                   ;	-Tabellen in IRM kopieren
 1581                   ;	-M003 suchen und einschalten
 1582                   ;	-M003-Steckplatz merken
 1583                   
 1584 C95C  21 CCAD     V24INI:	LD	HL,V24TAB	; vorbereitete V24-Tabelle
 1585 C95F  11 A800     	LD	DE,V24PL	; Steckplatz (A800H)
 1586 C962  01 0012     	LD	BC,V24UMT - V24TAB
 1587 C965  ED B0       	LDIR			; in IRM kopieren
 1588 C967  AF          	XOR	A
 1589 C968  CD C85B     	CALL	LSTCA		; SIO-A: Druckerinitialisierung
 1590 C96B  D8          	RET	C		; kein M003 gefunden
 1591 C96C  7A          	LD	A,D
 1592 C96D  32 A800     	LD	(V24PL),A	; Steckplatz eintragen
 1593 C970  21 F9FC     	LD	HL,V24OT	; Duplex-Ausgaberoutine
 1594 C973  22 B7C4     	LD	(UOUT2 + 1),HL	; fuer User-Kanal #3 eintragen
 1595 C976  21 CCBF     	LD	HL,V24UMT	; SIO-B: Empfangs-Interrupt
 1596                   
 1597                   ; Initialisierung mehrerer Ports mit Sperren von Interrupts:
 1598                   ;
 1599                   ; PE:	HL	Initialisierungstabelle
 1600                   ;	(HL)	Anzahl der Kanaele
 1601                   ; PA:	-
 1602                   ; VR:	F, D, HL
 1603                   ;
 1604 C979  56          IMEXDI:	LD	D,(HL)		; Anzahl Kanaele
 1605 C97A  23          	INC	HL
 1606 C97B  C3 F552     	JP	INIME		; Ports initialisieren
 1607                   
 1608                   ; allgemeine Druckroutine
 1609                   
 1610 C97E  F5          PRINTC:	PUSH	AF
 1611 C97F  3A B7E1     	LD	A,(HCPZ)
 1612 C982  CB 7F       	BIT	7,A
 1613 C984  28 29       	JR	Z,PRINT3	; Drucker
 1614                   	;Schreibmaschine
 1615 C986  E6 F0       	AND	0F0H
 1616 C988  FE 90       	CP	90H
 1617 C98A  28 17       	JR	Z,S6005
 1618 C98C  FE A0       	CP	0A0H
 1619 C98E  20 1F       	JR	NZ,PRINT3
 1620 C990  F1          S6010:	POP	AF
 1621 C991  E5          	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  37
CC45    INC

 1622 C992  C5          	PUSH	BC
 1623 C993  21 D828     	LD	HL,ZIBM
 1624 C996  01 0007     	LD	BC,7
 1625 C999  ED B1       	CPIR
 1626 C99B  20 0F       	JR	NZ,PRINT1
 1627 C99D  0E 06       	LD	C,6
 1628 C99F  09          	ADD	HL,BC
 1629 C9A0  7E          	LD	A,(HL)
 1630 C9A1  18 09       	JR	PRINT1
 1631                   
 1632 C9A3  F1          S6005:	POP	AF
 1633 C9A4  FE 7E       	CP	7EH
 1634 C9A6  20 08       	JR	NZ,PRINT4
 1635 C9A8  3E 83       	LD	A,83H
 1636 C9AA  18 04       	JR	PRINT4
 1637 C9AC  C1          PRINT1:	POP	BC
 1638 C9AD  E1          	POP	HL
 1639 C9AE  F5          	PUSH	AF
 1640 C9AF  F1          PRINT3:	POP	AF
 1641 C9B0  FE 09       PRINT4:	CP	9		; CUR
 1642 C9B2  28 0D       	JR	Z,PRINT5
 1643 C9B4  F5          	PUSH	AF
 1644 C9B5  3A B7A2     	LD	A,(STBT)
 1645 C9B8  CB 5F       	BIT	3,A		; Steuerzeichen
 1646 C9BA  28 0E       	JR	Z,PRINT7	; ausfuehren
 1647 C9BC  F1          	POP	AF
 1648 C9BD  FE 7F       	CP	7FH		; und 7Fh
 1649 C9BF  20 02       	JR	NZ,PRINT6
 1650 C9C1  3E 20       PRINT5:	LD	A,20H		; nach SPC
 1651 C9C3  FE 20       PRINT6:	CP	20H		; und Steuerzeichen
 1652 C9C5  30 04       	JR	NC,PRINT8
 1653 C9C7  3E 5F       	LD	A,'_'		; nach '_' wandeln
 1654 C9C9  F5          	PUSH	AF
 1655 C9CA  F1          PRINT7:	POP	AF
 1656 C9CB  C3 B7E9     PRINT8:	JP	OFILT		; in IRM
 1657                   
 1658                   ; ShCLR-Reaktionsprogramm
 1659                   
 1660 C9CE  E5          HCPGMC:	PUSH	HL
 1661 C9CF  D5          	PUSH	DE
 1662 C9D0  3A B7E1     	LD	A,(HCPZ)
 1663 C9D3  CB 47       	BIT	0,A		; Hardcopy?
 1664 C9D5  20 2C       	JR	NZ,COPIES
 1665                   
 1666                   ; Protokollfunktion
 1667                   
 1668 C9D7  2A B7B9     	LD	HL,(OUTAB)
 1669 C9DA  5F          	LD	E,A		; E = (HCPZ)
 1670 C9DB  7E          	LD	A,(HL)
 1671 C9DC  A7          	AND	A		; CRT?
 1672 C9DD  20 10       	JR	NZ,PROTO2
 1673 C9DF  CB 4B       	BIT	1,E		; USER1/2?
 1674 C9E1  21 F9A8     	LD	HL,ECHO		; CRT+PRINT
 1675 C9E4  11 FB8E     	LD	DE,ZEI3		; UOUT2
 1676 C9E7  20 10       	JR	NZ,PROTO3
 1677 C9E9  1B          	DEC	DE		; UOUT1
 1678 C9EA  22 B7BE     PROTO4:	LD	(UOUT1 + 1),HL
 1679 C9ED  18 0D       	JR	PROTO5

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  38
CC45    INC

 1680                   	;
 1681 C9EF  21 F9AB     PROTO2:	LD	HL,PRINT	; Protokoll deaktivieren
 1682 C9F2  11 FB8B     	LD	DE,ZEI0		; CRT
 1683 C9F5  FE 02       	CP	2
 1684 C9F7  28 F1       	JR	Z,PROTO4
 1685 C9F9  22 B7C4     PROTO3:	LD	(UOUT2 + 1),HL
 1686 C9FC  ED 53 B7B9  PROTO5:	LD	(OUTAB),DE	; Zeiger
 1687 CA00  D1          	POP	DE
 1688 CA01  E1          	POP	HL
 1689 CA02  C9          	RET
 1690                   
 1691                   ; Hard- oder Screencopy
 1692                   
 1693 CA03  C5          COPIES:	PUSH	BC
 1694 CA04  F5          	PUSH	AF
 1695 CA05  E6 F0       	AND	0F0H
 1696 CA07  F2 CA2E     	JP	P,HCOPYC	; Hardcopy
 1697                   
 1698                   ; Screencopy
 1699                   
 1700 CA0A  2A B7CB     	LD	HL,(VRAM)
 1701 CA0D  06 20       	LD	B,32
 1702 CA0F  0E 28       SCOPY1:	LD	C,40
 1703 CA11  7E          SCOPY2:	LD	A,(HL)
 1704 CA12  23          	INC	HL
 1705 CA13  FE 20       	CP	20H
 1706 CA15  30 02       	JR	NC,SCOPY4
 1707 CA17  3E 20       	LD	A,' '		; statt Steuerzeichen
 1708 CA19  CD F9AB     SCOPY4:	CALL	PRINT
 1709 CA1C  0D          	DEC	C		; 40 Spalten
 1710 CA1D  20 F2       	JR	NZ,SCOPY2
 1711 CA1F  3E 0D       	LD	A,CR
 1712 CA21  CD C9B0     	CALL	PRINT4
 1713 CA24  3E 0A       	LD	A,LF
 1714 CA26  CD C9B0     	CALL	PRINT4
 1715 CA29  10 E4       	DJNZ	SCOPY1		; 32 Zeilen
 1716 CA2B  C3 E0AB     HCEND:	JP	POP4		; POP	AF,BC,DE,HL   RET
 1717                   
 1718 CA2E              HCOPYC:	;..nach Typ verzweigen
 1719 CA2E  E6 F0       	AND	0F0H
 1720 CA30  FE 10       	CP	10H
 1721 CA32  CA CAFC     	JP	Z,K6314		; ESC/P breit
 1722 CA35  FE 20       	CP	20H
 1723 CA37  CA CB3A     	JP	Z,K6311		; mit ANSI
 1724 CA3A  FE 30       	CP	30H
 1725 CA3C  CA CB68     	JP	Z,K6312		; ANSI breit
 1726 CA3F  FE 50       	CP	50H
 1727 CA41  28 3B       	JR	Z,HCMIN		; ESC/P2 (Mini)
 1728 CA43  FE 70       	CP	70H
 1729 CA45  28 67       	JR	Z,ESCP2		; ESC/P2 24 Nadel
 1730                   
 1731                   ; K6313, K6304, ESC/P2 mit 8 Nadeln
 1732                   
 1733 CA47  26 00       K6313:	LD	H,0		; Zeile 0
 1734 CA49  CD CC28     K6313a:	CALL	PRZK		; Grafik init
 1735 CA4C  2E 00       	LD	L,0		; Spalte 0
 1736 CA4E  0E 08       K6313b:	LD	C,8
 1737 CA50  CD CB94     	CALL	CBYTES

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  39
CC45    INC

 1738 CA53  E5          	PUSH	HL
 1739 CA54  06 08       K6313c:	LD	B,8
 1740 CA56  21 B700     	LD	HL,CASS
 1741 CA59  CB 16       K6313d:	RL 	(HL)
 1742 CA5B  17          	RLA
 1743 CA5C  23          	INC	HL
 1744 CA5D  10 FA       	DJNZ	K6313d
 1745 CA5F  CD B7E9     	CALL	OFILT
 1746 CA62  0D          	DEC	C
 1747 CA63  20 EF       	JR	NZ,K6313c	; naechster Cursor
 1748 CA65  E1          	POP	HL
 1749 CA66  2C          	INC	L
 1750 CA67  3E 28       	LD	A,40
 1751 CA69  BD          	CP	L
 1752 CA6A  20 E2       	JR	NZ,K6313b
 1753 CA6C  7C          	LD	A,H
 1754 CA6D  C6 08       	ADD	A,8		; naechste Zeile
 1755 CA6F  67          	LD	H,A
 1756 CA70  30 D7       	JR	NC,K6313a
 1757 CA72  3E 0D       HCCRLF:	LD	A,CR
 1758 CA74  CD B7E9     	CALL	OFILT
 1759 CA77  3E 0A       	LD	A,LF
 1760 CA79  CD B7E9     	CALL	OFILT
 1761 CA7C  18 AD       	JR	HCEND
 1762                   
 1763                   ; ESC/P2 Miniformat
 1764                   
 1765 CA7E  21 0000     HCMIN:	LD	HL,0		; Zeile=0, Spalte=0
 1766 CA81  CD CC28     MINIa:	CALL	PRZK
 1767 CA84  0E 18       MINIb:	LD	C,24		; 24 Pixel
 1768 CA86  CD CB94     	CALL	CBYTES
 1769 CA89  CD CC09     	CALL	S3PRS
 1770 CA8C  20 F6       	JR	NZ,MINIb
 1771 CA8E  7C          	LD	A,H
 1772 CA8F  C6 18       	ADD	A,24
 1773 CA91  67          	LD	H,A
 1774 CA92  2E 00       	LD	L,0		; Spalte=0
 1775 CA94  FE F0       	CP	240
 1776 CA96  20 E9       	JR	NZ,MINIa
 1777 CA98  CD CC28     	CALL	PRZK
 1778 CA9B  0E 10       MINIc:	LD	C,16
 1779 CA9D  CD CB94     	CALL	CBYTES
 1780 CAA0  06 08       	LD	B,8
 1781 CAA2  AF          	XOR	A
 1782 CAA3  12          MINId:	LD	(DE),A		; 8 Nadeln frei
 1783 CAA4  13          	INC	DE
 1784 CAA5  10 FC       	DJNZ	MINId
 1785 CAA7  CD CC09     	CALL	S3PRS
 1786 CAAA  20 EF       	JR	NZ,MINIc
 1787 CAAC  18 C4       	JR	HCCRLF
 1788                   
 1789                   ; ESC/P2 mit 24 Nadeln
 1790                   
 1791 CAAE  26 00       ESCP2:	LD	H,0		; Zeile 0
 1792 CAB0  CD CC28     ESCP2a:	CALL	PRZK
 1793 CAB3  2E 00       	LD	L,0		; Spalte 0
 1794 CAB5  06 08       ESCP2b:	LD	B,8		; 8 Pixel
 1795 CAB7  E5          	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  40
CC45    INC

 1796 CAB8  CD E060     	CALL	PADR
 1797 CABB  11 B700     	LD	DE,CASS
 1798 CABE  7E          ESCP2c:	LD	A,(HL)
 1799 CABF  12          	LD	(DE),A
 1800 CAC0  13          	INC	DE
 1801 CAC1  12          	LD	(DE),A		; 3 mal ablegen
 1802 CAC2  13          	INC	DE
 1803 CAC3  12          	LD	(DE),A
 1804 CAC4  13          	INC	DE
 1805 CAC5  2C          	INC	L
 1806 CAC6  10 F6       	DJNZ	ESCP2c
 1807 CAC8  0E 08       	LD	C,8
 1808 CACA  06 18       ESCP2d:	LD	B,24		; 3*8 Bytes
 1809 CACC  21 B700     	LD	HL,CASS
 1810 CACF  CB 16       ESCP2e:	RL	(HL)
 1811 CAD1  CB 13       	RL	E
 1812 CAD3  CB 12       	RL	D
 1813 CAD5  17          	RLA
 1814 CAD6  23          	INC	HL
 1815 CAD7  10 F6       	DJNZ	ESCP2e		; Wandlung
 1816 CAD9  77          	LD	(HL),A
 1817 CADA  06 03       	LD	B,3		; 3 mal drucken
 1818 CADC  7E          ESCP2f:	LD	A,(HL)
 1819 CADD  CD B7E9     	CALL	OFILT		; 1.
 1820 CAE0  7A          	LD	A,D
 1821 CAE1  CD B7E9     	CALL	OFILT		; 2.
 1822 CAE4  7B          	LD	A,E
 1823 CAE5  CD B7E9     	CALL	OFILT		; 3. Byte
 1824 CAE8  10 F2       	DJNZ	ESCP2f
 1825 CAEA  0D          	DEC	C
 1826 CAEB  20 DD       	JR	NZ,ESCP2d
 1827 CAED  E1          	POP	HL
 1828 CAEE  2C          	INC	L
 1829 CAEF  3E 28       	LD	A,40		; Zeilenende?
 1830 CAF1  BD          	CP	L
 1831 CAF2  20 C1       	JR	NZ,ESCP2b
 1832 CAF4  7C          	LD	A,H
 1833 CAF5  C6 08       	ADD	A,8
 1834 CAF7  67          	LD	H,A
 1835 CAF8  30 B6       	JR	NC,ESCP2a
 1836 CAFA  18 3B       	JR	JHCRLF
 1837                   
 1838                   ; ESC/P 9-Nadeln (breit)
 1839                   
 1840 CAFC  26 00       K6314:	LD	H,0
 1841 CAFE  CD CC28     K6314a:	CALL	PRZK
 1842 CB01  2E 00       	LD	L,0
 1843 CB03  06 04       K6314b:	LD	B,4
 1844 CB05  E5          	PUSH	HL
 1845 CB06  CD E060     	CALL	PADR
 1846 CB09  11 B700     	LD	DE,CASS
 1847 CB0C  7E          K6314c:	LD	A,(HL)
 1848 CB0D  12          	LD	(DE),A
 1849 CB0E  13          	INC	DE
 1850 CB0F  12          	LD	(DE),A
 1851 CB10  13          	INC	DE
 1852 CB11  2C          	INC	L
 1853 CB12  10 F8       	DJNZ	K6314c		; 4*

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  41
CC45    INC

 1854 CB14  0E 08       	LD	C,8
 1855 CB16  06 08       K6314d:	LD	B,8
 1856 CB18  21 B700     	LD	HL,CASS
 1857 CB1B  CB 16       K6314e:	RL 	(HL)
 1858 CB1D  17          	RLA
 1859 CB1E  23          	INC	HL
 1860 CB1F  10 FA       	DJNZ	K6314e
 1861 CB21  CD B7E9     	CALL	OFILT
 1862 CB24  CD B7E9     	CALL	OFILT
 1863 CB27  0D          	DEC	C
 1864 CB28  20 EC       	JR	NZ,K6314d
 1865 CB2A  E1          	POP	HL
 1866 CB2B  2C          	INC	L
 1867 CB2C  3E 28       	LD	A,40
 1868 CB2E  BD          	CP	L
 1869 CB2F  20 D2       	JR	NZ,K6314b
 1870 CB31  7C          	LD	A,H
 1871 CB32  C6 04       	ADD	A,4
 1872 CB34  67          	LD	H,A
 1873 CB35  30 C7       	JR	NC,K6314a
 1874 CB37  C3 CA72     JHCRLF:	JP	HCCRLF
 1875                   
 1876                   ; ANSI-Drucker
 1877                   
 1878 CB3A  CD CC28     K6311:	CALL	PRZK
 1879 CB3D  06 2A       	LD	B,256/6
 1880 CB3F  21 0000     	LD	HL,0
 1881 CB42  0E 06       K6311a:	LD	C,6
 1882 CB44  CD CB94     	CALL	CBYTES
 1883 CB47  CD CBB5     	CALL	SPRS		; 6*8-Feld ausg.
 1884 CB4A  20 F6       	JR	NZ,K6311a
 1885 CB4C  3E 06       	LD	A,6		; 6 Pixel tiefer
 1886 CB4E  84          	ADD	A,H
 1887 CB4F  67          	LD	H,A
 1888 CB50  2E 00       	LD	L,0
 1889 CB52  CD CC28     	CALL	PRZK
 1890 CB55  05          	DEC	B
 1891 CB56  20 EA       	JR	NZ,K6311a
 1892 CB58  0E 04       K6311b:	LD	C,256 MOD 6	; den Rest
 1893 CB5A  CD CB94     	CALL	CBYTES
 1894 CB5D  AF          	XOR	A
 1895 CB5E  12          	LD	(DE),A		; letzte beiden
 1896 CB5F  13          	INC	DE		; Zeilen leeren
 1897 CB60  12          	LD	(DE),A
 1898 CB61  CD CBB5     	CALL	SPRS
 1899 CB64  20 F2       	JR	NZ,K6311b
 1900 CB66  18 CF       	JR	JHCRLF
 1901                   
 1902                   ; ANSI breit
 1903                   
 1904 CB68  CD CC28     K6312:	CALL	PRZK
 1905 CB6B  06 55       	LD	B,256/3
 1906 CB6D  21 0000     	LD	HL,0
 1907 CB70  0E 03       K6312a:	LD	C,3
 1908 CB72  CD CBA3     	CALL	CBYTS2
 1909 CB75  CD CBDE     	CALL	S2PRS
 1910 CB78  20 F6       	JR	NZ,K6312a
 1911 CB7A  24          	INC	H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  42
CC45    INC

 1912 CB7B  24          	INC	H
 1913 CB7C  24          	INC	H
 1914 CB7D  2E 00       	LD	L,0
 1915 CB7F  CD CC28     	CALL	PRZK
 1916 CB82  10 EC       	DJNZ	K6312a
 1917 CB84  0E 04       K6312b:	LD	C,256 MOD 6	; den Rest
 1918 CB86  CD CBA3     	CALL	CBYTS2
 1919 CB89  AF          	XOR	A
 1920 CB8A  12          	LD	(DE),A
 1921 CB8B  13          	INC	DE
 1922 CB8C  12          	LD	(DE),A
 1923 CB8D  CD CBDE     	CALL	S2PRS
 1924 CB90  20 F2       	JR	NZ,K6312b
 1925 CB92  18 A3       	JR	JHCRLF
 1926                   
 1927                   ; C Bytes zum Puffer
 1928                   
 1929 CB94  E5          CBYTES:	PUSH	HL
 1930 CB95  C5          	PUSH	BC
 1931 CB96  CD E060     	CALL	PADR
 1932 CB99  11 B700     	LD	DE,CASS
 1933 CB9C  06 00       	LD	B,0
 1934 CB9E  ED B0       	LDIR
 1935 CBA0  C1          	POP	BC
 1936 CBA1  E1          	POP	HL
 1937 CBA2  C9          	RET
 1938                   
 1939                   ; C Bytes zum Puffer & doppeln
 1940                   
 1941 CBA3  E5          CBYTS2:	PUSH	HL
 1942 CBA4  CD E060     	CALL	PADR
 1943 CBA7  11 B700     	LD	DE,CASS
 1944 CBAA  7E          C2BYTL:	LD	A,(HL)
 1945 CBAB  12          	LD	(DE),A
 1946 CBAC  13          	INC	DE
 1947 CBAD  12          	LD	(DE),A
 1948 CBAE  13          	INC	DE
 1949 CBAF  2C          	INC	L
 1950 CBB0  0D          	DEC	C
 1951 CBB1  20 F7       	JR	NZ,C2BYTL
 1952 CBB3  E1          	POP	HL
 1953 CBB4  C9          	RET
 1954                   
 1955                   ; 8* 6-Nadel-Sprosse ausgeben
 1956                   
 1957 CBB5  E5          SPRS:	PUSH	HL
 1958 CBB6  C5          	PUSH	BC
 1959 CBB7  2E 80       	LD	L,80H
 1960 CBB9  06 00       SPRS1:	LD	B,0
 1961 CBBB  11 B700     	LD	DE,CASS
 1962 CBBE  1A          SPRS2:	LD	A,(DE)
 1963 CBBF  A5          	AND	L		; CY=0
 1964 CBC0  28 01       	JR	Z,SPRS3
 1965 CBC2  37          	SCF			; CY=1
 1966 CBC3  CB 10       SPRS3:	RL 	B
 1967 CBC5  13          	INC	DE
 1968 CBC6  3E 06       	LD	A,6		; fuer 6 Bit
 1969 CBC8  BB          	CP	E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  43
CC45    INC

 1970 CBC9  20 F3       	JR	NZ,SPRS2	; ob. Nadel war 0
 1971 CBCB  A7          	AND	A		; unt. Nadel = 0
 1972 CBCC  CB 10       	RL 	B
 1973 CBCE  78          	LD	A,B
 1974 CBCF  CD B7E9     	CALL	OFILT
 1975 CBD2  CB 0D       	RRC	L
 1976 CBD4  F2 CBB9     	JP	P,SPRS1
 1977 CBD7  C1          	POP	BC
 1978 CBD8  E1          	POP	HL
 1979 CBD9  2C          	INC	L
 1980 CBDA  3E 28       	LD	A,40
 1981 CBDC  BD          	CP	L
 1982 CBDD  C9          	RET
 1983                   
 1984                   ; 8* 6-Nadel-Sprosse doppelt out
 1985                   
 1986 CBDE  E5          S2PRS:	PUSH	HL
 1987 CBDF  C5          	PUSH	BC
 1988 CBE0  2E 80       	LD	L,80H
 1989 CBE2  06 00       S2PR1:	LD	B,0
 1990 CBE4  11 B700     	LD	DE,CASS		; Kassetten-Puffer
 1991 CBE7  1A          S2PR2:	LD	A,(DE)
 1992 CBE8  A5          	AND	L
 1993 CBE9  28 01       	JR	Z,S2PR3
 1994 CBEB  37          	SCF
 1995 CBEC  CB 10       S2PR3:	RL 	B
 1996 CBEE  13          	INC	DE
 1997 CBEF  3E 06       	LD	A,6
 1998 CBF1  BB          	CP	E
 1999 CBF2  20 F3       	JR	NZ,S2PR2
 2000 CBF4  78          	LD	A,B
 2001 CBF5  17          	RLA			; untere beiden
 2002 CBF6  17          	RLA			; Nadeln tot
 2003 CBF7  CD B7E9     	CALL	OFILT
 2004 CBFA  CD B7E9     	CALL	OFILT
 2005 CBFD  CB 0D       	RRC	L
 2006 CBFF  F2 CBE2     	JP	P,S2PR1
 2007 CC02  C1          	POP	BC
 2008 CC03  E1          	POP	HL
 2009 CC04  2C          	INC	L
 2010 CC05  3E 28       	LD	A,40
 2011 CC07  BD          	CP	L
 2012 CC08  C9          	RET
 2013                   
 2014                   ; 8* 24-Nadel-Sprosse ausgeben
 2015                   
 2016 CC09  E5          S3PRS:	PUSH	HL
 2017 CC0A  1E 08       	LD	E,8
 2018 CC0C  0E 03       S3PR1:	LD	C,3		; 24 Nadeln = 3 Byte
 2019 CC0E  21 B700     	LD	HL,CASS
 2020 CC11  06 08       S3PR2:	LD	B,8
 2021 CC13  CB 16       S3PR3:	RL	(HL)
 2022 CC15  17          	RLA
 2023 CC16  23          	INC	HL
 2024 CC17  10 FA       	DJNZ	S3PR3		; Wandlung
 2025 CC19  CD B7E9     	CALL	OFILT
 2026 CC1C  0D          	DEC	C
 2027 CC1D  20 F2       	JR	NZ,S3PR2

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  44
CC45    INC

 2028 CC1F  1D          	DEC	E
 2029 CC20  20 EA       	JR	NZ,S3PR1
 2030 CC22  E1           	POP	HL
 2031 CC23  2C          	INC	L
 2032 CC24  3E 28       	LD	A,40
 2033 CC26  BD          	CP	L
 2034 CC27  C9          	RET
 2035                   
 2036                   ; Druckerinitialisierung entsprechend HCPZ
 2037                   
 2038 CC28  E5          PRZK:	PUSH	HL
 2039 CC29  C5          	PUSH	BC
 2040 CC2A  AF          	XOR	A
 2041 CC2B  21 B7E1     	LD	HL,HCPZ
 2042 CC2E  ED 6F       	RLD
 2043 CC30  4F          	LD	C,A		; Druckertyp
 2044 CC31  ED 67       	RRD
 2045 CC33  0C          	INC	C
 2046 CC34  21 CC4E     	LD	HL,C6313
 2047 CC37  46          PRZK1:	LD	B,(HL)		; Laenge
 2048 CC38  0D          	DEC	C
 2049 CC39  28 09       	JR	Z,PRZK2
 2050 CC3B  04          	INC	B
 2051 CC3C  7D          	LD	A,L
 2052 CC3D  80          	ADD	A,B
 2053 CC3E  6F          	LD	L,A
 2054 CC3F  30 F6       	JR	NC,PRZK1
 2055 CC41  24          	INC	H
 2056 CC42  18 F3       	JR	PRZK1
 2057 CC44  23          PRZK2:	INC	HL
 2058 CC45  7E          	LD	A,(HL)
 2059 CC46  CD B7E9     	CALL	OFILT
 2060 CC49  10 F9       	DJNZ	PRZK2
 2061 CC4B  C1          	POP	BC
 2062 CC4C  E1          	POP	HL
 2063 CC4D  C9          	RET
 2064                   
 2065                   ; Grafiksteuersequenzen fuer die Drucker
 2066                   
 2067 CC4E  0A          C6313:	DB	10		; Laenge
 2068 CC4F  0D 09       	DB	CR,9
 2069 CC51  1B 4A 18    	DB	ESC,'J',24
 2070 CC54  1B 2A 05    	DB	ESC,'*',5
 2071 CC57  0140        	DW	320
 2072                   
 2073 CC59  0A          C6314:	DB	10		; Laenge
 2074 CC5A  0D 09       	DB	CR,9
 2075 CC5C  1B 4A 18    	DB	ESC,'J',24
 2076 CC5F  1B 2A 05    	DB	ESC,'*',5
 2077 CC62  0280        	DW	640
 2078                   
 2079 CC64  0E          C6311:	DB	14		; Laenge
 2080 CC65  1B 5B 30 31 	DB	ESC,'[01e'
 2081 CC6A  1B 5B 31 32 	DB	ESC,'[12`'
 2082 CC6F  1B 4B       	DB	ESC,'K'
 2083 CC71  0140        	DW	320
 2084                   
 2085 CC73  0E          C6312:	DB	14		; Laenge

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  45
CC45    INC

 2086 CC74  1B 5B 30 31 	DB	ESC,'[01e'
 2087 CC79  1B 5B 31 32 	DB	ESC,'[12`'
 2088 CC7E  1B 4B       	DB	ESC,'K'
 2089 CC80  0280        	DW	640
 2090                   
 2091 CC82  09          C6304:	DB	9		; Laenge
 2092 CC83  0D 09       	DB	CR,9
 2093 CC85  1B 4A 18    	DB	ESC,'J',24
 2094 CC88  1B 4B       	DB	ESC,'K'
 2095 CC8A  0140        	DW	320
 2096                   
 2097 CC8C  0A          CMINI:	DB	10		; Laenge
 2098 CC8D  0D 09       	DB	CR,9
 2099 CC8F  1B 4A 18    	DB	ESC,'J',24
 2100 CC92  1B 2A 27    	DB	ESC,'*',39
 2101 CC95  0140        	DW	320
 2102                   
 2103 CC97  0A          C24N1:	DB	10		; Laenge
 2104 CC98  0D 09       	DB	CR,9
 2105 CC9A  1B 4A 18    	DB	ESC,'J',24
 2106 CC9D  1B 2A 00    	DB	ESC,'*',0
 2107 CCA0  0140        	DW	320
 2108                   
 2109 CCA2  0A          C24N2:	DB	10		; Laenge
 2110 CCA3  0D 09       	DB	CR,9
 2111 CCA5  1B 4A 18    	DB	ESC,'J',24
 2112 CCA8  1B 2A 27    	DB	ESC,'*',39
 2113 CCAB  03C0        	DW	960
 2114                   
 2115                   ; V.24-Tabellen, zum Kopieren in den IRM ab A800H:
 2116                   
 2117 CCAD  00          V24TAB:	DB	0		; Steckplatz M003 (Aktualisierung durch Suche)
 2118                   
 2119                   ; Kanal 1 - Druckerausgabe (9600 Baud)
 2120 CCAE  47          	DB	01000111b	; CTC: DI, Zaehler, neg. Flanke, RESET
 2121 CCAF  5B          	DB	91		; Zeitkonstante
 2122 CCB0  04 04       	DB	4,00000100b	; WR4: Vorteiler=1, 1 Stop-Bit, ohne Paritaet
 2123 CCB2  03 20       	DB	3,00100000b	; WR3: Empfaenger aus, CTS+DCD-Steuerung
 2124 CCB4  05 6A       	DB	5,01101010b	; WR5: Sender ein, 8Bit, /DTR=1, RTS=1
 2125                   
 2126                   ; Kanal 2 - Duplex (1200 Baud)
 2127 CCB6  47          	DB	01000111b	; CTC: DI, Zaehler, neg. Flanke, RESET
 2128 CCB7  2E          	DB	46		; Zeitkonstante
 2129 CCB8  18          	DB	00011000b	; Port-RESET
 2130 CCB9  04 44       	DB	4,01000100b	; WR4: Vorteiler=16, 1 Stop-Bit, ohne Paritaet
 2131 CCBB  03 E1       	DB	3,11100001b	; WR3: Empfaenger ein, 8Bit, CTS+DCD-Steuerung
 2132 CCBD  05 6A       	DB	5,01101010b	; WR5: Sender ein, 8Bit, /DTR=1, RTS=1
 2133                   
 2134                   ; Initialisierung SIO-B fuer Empfangs-Interrupt (1200 Baud):
 2135                   
 2136 CCBF  02          V24UMT:	DB	2		; 2 Ports
 2137 CCC0  0D 02       	 DB	0Dh,2		; CTC1
 2138 CCC2  47          	  DB	01000111b	; DI, Zaehler, neg. Flanke, ZK folgt, RESET
 2139 CCC3  2E          	  DB	46		; Zeitkonstante
 2140 CCC4  0B 0B       V24INT:	 DB	0Bh,11		; SIO-B Steuerwort
 2141 CCC6  18          	  DB	00011000b	; Port-RESET
 2142 CCC7  02 E2       	  DB	2,0E2h		; WR2: INT-Vektor
 2143 CCC9  04 44       	  DB	4,01000100b	; WR4: Vorteiler=16, 1 Stop-Bit, ohne Paritaet

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  46
CC45    INC

 2144 CCCB  03 E1       	  DB	3,11100001b	; WR3: Empfaenger ein, 8Bit, CTS/DCD-Steuerung
 2145 CCCD  05 EA       	  DB	5,11101010b	; WR5: Sender ein, 8Bit, /DTR=0 (bereit), RTS=1
 2146 CCCF  11 18       	  DB	11h,00011000b	; WR1: Interrupt bei Zeichenempfang
 2147                   
 2148                   ; Initialisierung SIO-B fuer Polling-Betrieb:
 2149                   
 2150 CCD1  0B 07       V24POL:	DB	0Bh,7		; SIO-B Steuerwort, 7 Byte
 2151 CCD3  18          	 DB	00011000b	; Port RESET
 2152 CCD4  04 44       	 DB	4,01000100b	; Vorteiler 16, 1 Stop-Bit, ohne Paritaet
 2153 CCD6  03 E1       	 DB	3,11100001b	; Empfaenger ein, 8 Bit, CTS/DCD-Steuerung
 2154 CCD8  05 6A       	 DB	5,01101010b	; Sender ein, 8 Bit, DTR aus, RTS ein
 2155                   
 2156                   ; Byteweise MB-Ausgabe
 2157                   
 2158 CCDA  5A          MBOC:	LD	E,D		; Steuerbyte
 2159 CCDB  57          	LD	D,A		; Datenbyte
 2160 CCDC  D5          	PUSH	DE
 2161 CCDD  C5          	PUSH	BC
 2162 CCDE  CB 5B       	BIT	3,E
 2163 CCE0  28 29       	JR	Z,NOINIT
 2164 CCE2  DD CB 07 CE 	SET	1,(IX+7)	; merken INIT
 2165 CCE6  3E D5       	LD	A,'U'+80H
 2166 CCE8  BE          	CP	(HL)
 2167 CCE9  D5          	PUSH	DE
 2168 CCEA  11 00A0     	LD	DE,0A0H		; Vortonlaenge
 2169 CCED  20 03       	JR	NZ,NOHIU
 2170 CCEF  11 0500     	LD	DE,500H		; bei 'U' gedehnt
 2171 CCF2  ED 53 B7D8  NOHIU:	LD	(VORTN),DE
 2172 CCF6  11 B700     	LD	DE,CASS
 2173 CCF9  01 000B     	LD	BC,11
 2174 CCFC  ED B0       	LDIR			; Name
 2175 CCFE  EB          	EX	DE,HL
 2176 CCFF  D1          	POP	DE
 2177 CD00  72          	LD	(HL),D		; 1.Byte
 2178 CD01  2C          	INC	L
 2179 CD02  7D          MBOC1:	LD	A,L
 2180 CD03  32 B7DA     	LD	(DTPTR),A
 2181 CD06  C1          MBOCE:	POP	BC
 2182 CD07  D1          	POP	DE
 2183 CD08  CB 9B       	RES	3,E
 2184 CD0A  C9          	RET
 2185                   	;
 2186 CD0B  2A B7DA     NOINIT:	LD	HL,(DTPTR)
 2187 CD0E  26 B7       	LD	H,0B7H
 2188 CD10  72          	LD	(HL),D		; Byte eintragen
 2189 CD11  CB 73       	BIT	6,E
 2190 CD13  20 1E       	JR	NZ,MCLOS	; Close
 2191 CD15  2C          	INC	L
 2192 CD16  F2 CD02     	JP	P,MBOC1
 2193 CD19  DD CB 07 4E 	BIT	1,(IX+7)
 2194 CD1D  20 08       	JR	NZ,MBOC2	; erst mal Init!
 2195 CD1F  CD CE27     	CALL	MBLO		; Block ausgeben
 2196 CD22  21 B700     MBOC6:	LD	HL,CASS
 2197 CD25  18 DB       	JR	MBOC1
 2198                   	;
 2199 CD27  DD CB 07 8E MBOC2:	RES	1,(IX+7)	; ruecksetzen
 2200 CD2B  CD E4DA     	CALL	ISRO		; Init
 2201 CD2E  CD CE2E     	CALL	MBLNR		; Blocknr.

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  47
CC45    INC

 2202 CD31  18 EF       	JR	MBOC6
 2203                   	;
 2204 CD33  DD CB 07 4E MCLOS:	BIT	1,(IX+7)	; Init?
 2205 CD37  28 05       	JR	Z,MBOC3
 2206 CD39  CD E4DA     	CALL	ISRO		; erst noch Init!
 2207 CD3C  18 03       	JR	MBOC4
 2208 CD3E  CD CE27     MBOC3:	CALL	MBLO		; Block ausgeben
 2209 CD41  ED 4B B7D8  MBOC4:	LD	BC,(VORTN)
 2210 CD45  CD E481     	CALL	CSRO
 2211 CD48  D5          MBOC5:	PUSH	DE
 2212 CD49  CD F723     	CALL	CSRI
 2213 CD4C  DD CB 07 AE 	RES	5,(IX+7)	; 'U'-Merker ruecksetzen
 2214 CD50  D1          	POP	DE
 2215 CD51  18 B3       	JR	MBOCE
 2216                   
 2217                   ; Byteweise MB-Eingabe
 2218                   
 2219 CD53  5A          MBIC:	LD	E,D		; Steuerbyte
 2220 CD54  57          	LD	D,A		; Datenbyte (PA!)
 2221 CD55  D5          	PUSH	DE
 2222 CD56  C5          	PUSH	BC
 2223 CD57  CB 73       	BIT	6,E		; Close?
 2224 CD59  20 ED       	JR	NZ,MBOC5
 2225 CD5B  CB 5B       	BIT	3,E		; Init?
 2226 CD5D  28 66       	JR	Z,MBIU
 2227 CD5F  3E 01       	LD	A,1		; erwarteter Block
 2228 CD61  DD 77 03    	LD	(IX+3),A
 2229 CD64  E5          	PUSH	HL
 2230 CD65  CD E54B     	CALL	ISRI
 2231 CD68  E1          MBIC1:	POP	HL
 2232 CD69  DA CE17     	JP	C,JBLERR	; Fehler: '*'
 2233 CD6C  DD 7E 02    	LD	A,(IX+2)	; gelesener Block
 2234 CD6F  FE 01       	CP	1
 2235 CD71  C2 CE17     	JP	NZ,JBLERR	; Fehler: '*'
 2236 CD74  DD CB 07 BE 	RES	7,(IX+7)	; Kopfblock geladen
 2237 CD78  DD 34 03    	INC	(IX+3)		; erwarteter Block
 2238 CD7B  11 B700     	LD	DE,CASS
 2239 CD7E  06 0B       	LD	B,11
 2240 CD80  1A          	LD	A,(DE)
 2241 CD81  FE D5       	CP	'U'+80H		; hohes 'U'?
 2242 CD83  20 04       	JR	NZ,MBIC2
 2243 CD85  DD CB 07 EE 	SET	5,(IX+7)	; merken zur Blocknummernausgabeunterdrueckung
 2244 CD89  C6 29       MBIC2:	ADD	A,29H
 2245 CD8B  30 12       	JR	NC,MBIC3
 2246 CD8D  1A          	LD	A,(DE)		; geschuetzte BASIC-Programme
 2247 CD8E  D6 04       	SUB	4		; als ungeschuetzt anzeigen
 2248 CD90  12          	LD	(DE),A
 2249 CD91  13          	INC	DE
 2250 CD92  12          	LD	(DE),A
 2251 CD93  13          	INC	DE
 2252 CD94  12          	LD	(DE),A
 2253 CD95  32 035E     	LD	(DATFLG),A	; <=hier LIST/EDIT/BYE-Schutz setzen
 2254 CD98  DD CB 07 F6 	SET	6,(IX+7)	; merken wofuer?
 2255 CD9C  11 B700     	LD	DE,CASS
 2256 CD9F  1A          MBIC3:	LD	A,(DE)		; Name aus Kassettenpuffer
 2257 CDA0  CD E0A0     	CALL	CRT		; anzeigen
 2258 CDA3  BE          	CP	(HL)		; stimmt Name?
 2259 CDA4  28 04       	JR	Z,MBIC4

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  48
CC45    INC

 2260 CDA6  DD CB 07 FE 	SET	7,(IX+7)	; nein-merken
 2261 CDAA  23          MBIC4:	INC	HL
 2262 CDAB  13          	INC	DE
 2263 CDAC  10 F1       	DJNZ	MBIC3
 2264 CDAE  CD F4CC     	CALL	CRLF
 2265 CDB1  DD CB 07 7E 	BIT	7,(IX+7)
 2266 CDB5  C2 F81C     	JP	NZ,JIOERR	 ; Name falsch -> ?IO ERROR
 2267 CDB8  EB          	EX	DE,HL
 2268 CDB9  56          MBIC5:	LD	D,(HL)		; Daten lesen
 2269 CDBA  2C          	INC	L
 2270 CDBB  7D          	LD	A,L
 2271 CDBC  32 B7DA     	LD	(DTPTR),A
 2272 CDBF  7A          	LD	A,D
 2273 CDC0  C1          	POP	BC
 2274 CDC1  D1          	POP	DE
 2275 CDC2  CB 9B       	RES	3,E
 2276 CDC4  C9          	RET
 2277                   
 2278 CDC5  2A B7DA     MBIU:	LD	HL,(DTPTR)
 2279 CDC8  26 B7       	LD	H,HIGH(CASS)
 2280 CDCA  CB 7D       	BIT	7,L
 2281 CDCC  28 EB       	JR	Z,MBIC5		; aus Puffer
 2282 CDCE  CD E54E     MBIU1:	CALL	MBI
 2283 CDD1  38 33       	JR	C,MERR
 2284 CDD3  3E FF       	LD	A,0FFH
 2285 CDD5  DD BE 02    	CP	(IX+2)		; Block FF?
 2286 CDD8  28 17       	JR	Z,MBIU3
 2287 CDDA  DD 7E 03    	LD	A,(IX+3)
 2288 CDDD  DD BE 02    	CP	(IX+2)		; erwarteter?
 2289 CDE0  28 0F       	JR	Z,MBIU3
 2290 CDE2  3E 2A       	LD	A,'*'
 2291 CDE4  CD E0A0     	CALL	CRT		; nicht erwartet
 2292 CDE7  CD F0D0     	CALL	BNROST
 2293 CDEA  19 00       	DB	19H,0
 2294 CDEC  CD CE34     MBIU2:	CALL	JBRKT
 2295 CDEF  18 DD       	JR	MBIU1
 2296                   
 2297 CDF1  DD 34 03    MBIU3:	INC	(IX+3)		; naechsten
 2298 CDF4  3D          	DEC	A		; erwarten
 2299 CDF5  DD CB 07 6E 	BIT	5,(IX+7)
 2300 CDF9  20 06       	JR	NZ,MBIU4
 2301 CDFB  CD F0D0     	CALL	BNROST		; Blocknummer
 2302 CDFE  3E 19 00    	DB	'>',19H,0	; unter Vorbehalt ausgeben
 2303 CE01  21 B700     MBIU4:	LD	HL,CASS
 2304 CE04  18 B3       	JR	MBIC5
 2305                   
 2306 CE06  CD F0D6     MERR:	CALL	OSTR
 2307 CE09  09 09 09 09 	DB	9,9,9,9,'?',0	; Fehler im Block
 2308 CE0F  CD F0D0     	CALL	BNROST
 2309 CE12  0D 0A 00    	DB	CR,LF,0
 2310 CE15  18 D5       	JR	MBIU2
 2311                   
 2312 CE17  CD F0D6     JBLERR:	CALL	OSTR
 2313 CE1A  2A 08 00    	DB	'*',8,0		; nicht erwarteter 1. Block
 2314 CE1D  CD CE34     	CALL	JBRKT
 2315 CE20  CD E54E     	CALL	MBI
 2316 CE23  E5          	PUSH	HL
 2317 CE24  C3 CD68     	JP	MBIC1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  49
CC45    INC

 2318                   
 2319 CE27  ED 4B B7D8  MBLO:	LD	BC,(VORTN)
 2320 CE2B  CD E4E9     	CALL	MBO
 2321 CE2E  CD F0D0     MBLNR:	CALL	BNROST
 2322 CE31  3E 19 00    	DB	'>',19H,0
 2323 CE34  CD E388     JBRKT:	CALL	BRKT		; bei BRK
 2324 CE37  D0          	RET	NC		; auch ?IO ERROR
 2325 CE38  C3 F81C     	JP	JIOERR
 2326                   
 2327                   ; Speicherschnellansicht
 2328                   
 2329 CE3B  7F7F        VIEW7F:	DW	7F7FH
 2330 CE3D  76 69 65 77 	DB	'view'
 2331 CE41  03          	DB	3
 2332 CE42  7D          	LD	A,L
 2333 CE43  FE 10       	CP	10H
 2334 CE45  30 0C       	JR	NC,VIEW1	; L>0Fh
 2335 CE47  7C          	LD	A,H
 2336 CE48  A7          	AND	A
 2337 CE49  20 08       	JR	NZ,VIEW1	; H>0
 2338 CE4B  21 B782     	LD	HL,ARG1
 2339 CE4E  ED 6F       	RLD
 2340 CE50  66          	LD	H,(HL)
 2341 CE51  2E 00       	LD	L,0
 2342 CE53  11 8800     VIEW1:	LD	DE,8800H
 2343 CE56  01 2000     	LD	BC,2000H
 2344 CE59  CD FB3B     VIEW2:	CALL	LDAME		; Byte holen
 2345 CE5C  12          	LD	(DE),A		; in IRM poken
 2346 CE5D  23          	INC	HL
 2347 CE5E  13          	INC	DE
 2348 CE5F  0D          	DEC	C
 2349 CE60  20 F7       	JR	NZ,VIEW2
 2350 CE62  10 F5       	DJNZ	VIEW2
 2351 CE64  3E 0B       VIEW3:	LD	A,0BH		; Zeile hoch
 2352 CE66  CD E0A0     	CALL	CRT
 2353 CE69  3E 08       	LD	A,8
 2354 CE6B  32 B7A0     	LD	(CURSO),A
 2355 CE6E  CD CE71     	CALL	VIEW4
 2356 CE71  3E 01       VIEW4:	LD	A,1
 2357 CE73  4F          VIEW5:	LD	C,A
 2358 CE74  CD F3C4     	CALL	AHEX		; HEX-Leiste
 2359 CE77  79          	LD	A,C
 2360 CE78  C6 22       	ADD	A,22H
 2361 CE7A  30 F7       	JR	NC,VIEW5
 2362 CE7C  C9          	RET
 2363                   
 2364                   ; Druckereinstellungen
 2365                   
 2366 CE7D  7F7F        PRI7F:	DW	7F7FH
 2367 CE7F  50 52 49 4E 	DB	'PRINT',1FH
 2368 CE85  1A          PRI:	LD	A,(DE)
 2369 CE86  A7          	AND	A
 2370 CE87  C8          	RET	Z		; fertig
 2371 CE88  FE 20       	CP	' '
 2372 CE8A  28 14       	JR	Z,PRINC
 2373 CE8C  FE 2C       	CP	','
 2374 CE8E  28 13       	JR	Z,PRK		; Zeichen
 2375 CE90  FE 27       	CP	27H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  50
CC45    INC

 2376 CE92  28 13       	JR	Z,PRSTR		; String
 2377 CE94  CD F4DC     	CALL	RHEX
 2378 CE97  DA F4C2     	JP	C,ERRM		; Fehler!
 2379 CE9A  3A B797     	LD	A,(NUMVX)
 2380 CE9D  CD B7E9     PRIC:	CALL	OFILT
 2381 CEA0  13          PRINC:	INC	DE
 2382 CEA1  18 E2       	JR	PRI
 2383 CEA3  13          PRK:	INC	DE
 2384 CEA4  1A          	LD	A,(DE)		; Zeichen
 2385 CEA5  18 F6       	JR	PRIC
 2386 CEA7  13          PRSTR:	INC	DE
 2387 CEA8  1A          	LD	A,(DE)
 2388 CEA9  A7          	AND	A
 2389 CEAA  C8          	RET	Z		; Ende-0
 2390 CEAB  FE 27       	CP	27H
 2391 CEAD  28 F1       	JR	Z,PRINC		; Stringende
 2392 CEAF  CD B7E9     	CALL	OFILT
 2393 CEB2  18 F3       	JR	PRSTR
 2394                   
 2395                   ; Tabelle der Modulnamen:
 2396                   
 2397 CEB4  01 53 54 41 MTAB:	DB	001H,'START-ROM',0	; M033 Typestar
 2398 CEBF  70 33 32 4B 	DB	070H,'32K EPROM',0	; M045
 2399 CECA  71 36 34 4B 	DB	071H,'64K EPROM',0	; M046
 2400 CED5  72 31 32 38 	DB	072H,'128K EPROM',0	; M047
 2401 CEE1  73 32 35 36 	DB	073H,'256K EPROM',0	; M048
 2402                   ;	DB	074H,'512K EPROM',0	; reserviert!
 2403                   ;	DB	075H,'1M EPROM',0	; reserviert!
 2404 CEED  77 36 34 4B 	DB	077H,'64K RAM',0	; M032 - 64k-Variante
 2405 CEF6  78 31 32 38 	DB	078H,'128K RAM',0	; M036
 2406 CF00  79 32 35 36 	DB	079H,'256K RAM',0	; M032 - 256k-Variante
 2407 CF0A  7A 35 31 32 	DB	07AH,'512K RAM',0	; M034
 2408 CF14  7B 31 4D 20 	DB	07BH,'1M RAM',0		; M035, M035x4
 2409                   ;	DB	07CH,'32K EEPROM',0	; reserviert!
 2410                   ;	DB	07DH,'64K EEPROM',0	; reserviert!
 2411                   ;	DB	07EH,'128K EEPROM',0	; reserviert!
 2412                   ;	DB	07FH,'256K EEPROM',0	; reserviert!
 2413 CF1C  A7 46 4C 4F 	DB	0A7H,'FLOPPY',0		; D004, D008
 2414 CF24  D9 45 50 52 	DB	0D9H,'EPROMER 32K',0	; M030 (fuer 2k-32k EPROMs)
 2415 CF31  DA 50 49 4F 	DB	0DAH,'PIO-3',0		; M002
 2416 CF38  DB 45 50 52 	DB	0DBH,'EPROMER 64K',0	; M030 (fuer 2k-64k EPROMs)
 2417 CF45  E3 44 41 55 	DB	0E3H,'DAU1',0		; M029
 2418 CF4B  E7 41 44 55 	DB	0E7H,'ADU1',0		; M010
 2419 CF51  EC 53 43 41 	DB	0ECH,'SCANNER',0	; M051 (KC-Club)
 2420 CF5A  EE 56 2E 32 	DB	0EEH,'V.24',0		; M003, M053
 2421 CF60  EF 44 49 47 	DB	0EFH,'DIGITAL I/O',0	; M001
 2422 CF6D  F0 38 4B 20 	DB	0F0H,'8K CMOS-RAM',0	; M120
 2423 CF7A  F1 31 36 4B 	DB	0F1H,'16K CMOS-RAM',0	; M122
 2424 CF88  F2 33 32 4B 	DB	0F2H,'32K CMOS-RAM',0	; M124
 2425                   ;	DB	0F3H,'4*8K RAM',0	; M062-RAM (E. Mueller)
 2426                   ;	DB	0F3H,'8*8K EPROM',0	; M062-ROM (E. Mueller)
 2427 CF96  F4 31 36 4B 	DB	0F4H,'16K RAM',0	; M022
 2428 CF9F  F5 33 32 4B 	DB	0F5H,'32K RAM',0	; M024
 2429 CFA8  F6 36 34 4B 	DB	0F6H,'64K RAM',0	; M011
 2430 CFB1  F7 38 4B 20 	DB	0F7H,'8K EPROM',0	; M025, M040
 2431 CFBB  F8 31 36 4B 	DB	0F8H,'16K EPROM',0	; M028, M040
 2432                   ;	DB	0FBH,'8K SOFTWARE',0	; M012, M026, M027 (Sonderbehandlung!)
 2433 CFC6  FC 42 41 53 	DB	0FCH,'BASIC',0		; M006

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  51
CC45    INC

 2434 CFCD  FD 55 53 42 	DB	0FDH,'USB+NET',0	; M052 (KC-Club, mit 32K EEPROM 4 * 8K)
 2435 CFD6  3F 3F 3F 00 	DB	'???',0
 2436 CFDA  53 4F 46 54 MTAB1:	DB	'SOFTWARE'		; Standardanzeige falls ohne Menuewort
 2437 CFE2  00          MTAB2:	DB	0
 2438 CFE3  55 53 45 52 MUSER:	DB	'USER',0		; M005 (USER-Module C0-D7)
 2439                   
 2440                   	ABSFILL	0D000h,<ROM-C-Ende>
    7 CFE8  FF FF FF FF 	  DS	0D000h - $,0FFh
  147                   
  148                   	INCLUDE	CD45.INC	; ROM-D (D000-DAB7)
    1                   ;*****************************************
    2                   ;**	CAOS 4.5	ROM D		**
    3                   ;**					**
    4                   ;**	Adresse:  D000h bis DAB7h	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 06.09.2010	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0D000H
   10                   
   11                   ; MC-Sprungverteiler (fuer die 9 Grundfunktionen)
   12                   
   13 D000  FE 09       JDISC:	CP	9		; Funktion 0-8 zugelassen
   14 D002  D0          	RET	NC
   15 D003  F5          	PUSH	AF
   16 D004  21 0000     	LD	HL,0		; Dateiname
   17 D007  CD D080     	CALL	FNAM2		; Name ausgeben
   18 D00A  21 D056     	LD	HL,DTAB		; Sprungtabelle der Floppyfunktionen
   19 D00D  F1          	POP	AF
   20 D00E  87          	ADD	A,A
   21 D00F  16 00       	LD	D,0
   22 D011  5F          	LD	E,A
   23 D012  19          	ADD	HL,DE
   24 D013  5E          	LD	E,(HL)		; Sprungtabelle lesen
   25 D014  23          	INC	HL
   26 D015  56          	LD	D,(HL)
   27 D016  D5          	PUSH	DE		; DE=Sprungadresse
   28                   
   29                   ; Test ob Floppy arbeitet
   30                   
   31 D017  01 FC80     DISK:	LD	BC,0FC80H	; Modulsteckplatz FC
   32 D01A  ED 78       	IN	A,(C)
   33 D01C  FE A7       	CP	0A7H		; Floppy vorhanden?
   34 D01E  28 13       	JR	Z,DISK1
   35 D020  CD F0D6     	CALL	OSTR
   36 D023  4B 65 69 6E 	DB	'Kein D004!'
   37 D02D  07 0D 0A 00 	DB	7,CR,LF,0
   38 D031  E1          	POP	HL
   39 D032  C9          	RET
   40 D033  01 B3F3     DISK1:	LD	BC,UROK		; 0B3F3H
   41 D036  ED 78       	IN	A,(C)
   42 D038  FE 05       	CP	5		; CAOS-Betriebsart?
   43 D03A  C8          	RET	Z
   44 D03B  CD F0D6     	CALL	OSTR
   45 D03E  43 41 4F 53 	DB	'CAOS-Disk starten!'
   46 D050  07 0D 0A 00 	DB	7,CR,LF,0
   47 D054  E1          	POP	HL
   48 D055  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  52
CD45    INC

   49                   
   50                   ; Sprungtabelle Diskroutinen
   51                   				; Nr.
   52 D056  D301        DTAB:	DW	FLOAD		; 0
   53 D058  D3BD        	DW	FSAVE		; 1
   54 D05A  D429        	DW	DIR		; 2
   55 D05C  D49D        	DW	STAT		; 3
   56 D05E  D4EC        	DW	REN		; 4
   57 D060  D53E        	DW	SETRO		; 5
   58 D062  D555        	DW	SETWR		; 6
   59 D064  D527        	DW	ERA		; 7
   60 D066  D569        	DW	DRIVE		; 8
   61                   
   62                   ; Name ein-, ausgeben:
   63                   ; PA:	DE = Zeiger auf Dateiname
   64                   
   65 D068  EB          FNAME:	EX	DE,HL
   66 D069  7E          	LD	A,(HL)		; erstes Zeichen nach Menuewort holen
   67 D06A  E6 DF       	AND	0DFH
   68 D06C  20 12       	JR	NZ,FNAM2	; Argument angegeben, als Dateiname nutzen!
   69 D06E  21 0006     FNAM0:	LD	HL,6
   70 D071  CD F0D6     FNAM1:	CALL	OSTR
   71 D074  4E 61 6D 65 	DB	'Name :',0
   72 D07B  CD F495     	CALL	INLIN
   73 D07E  D8          	RET	C		; BRK
   74 D07F  19          	ADD	HL,DE
   75 D080  E5          FNAM2:	PUSH	HL		; Zeiger auf Dateiname
   76 D081  1E 0C       	LD	E,12		; Dateiname 8.3 = 12 Zeichen
   77 D083  01 82F3     	LD	BC,DIRBUF	; 082F3H
   78 D086  7E          FNAM3:	LD	A,(HL)
   79 D087  ED 79       	OUT	(C),A
   80 D089  23          	INC	HL
   81 D08A  04          	INC	B
   82 D08B  1D          	DEC	E
   83 D08C  20 F8       	JR	NZ,FNAM3
   84 D08E  D1          	POP	DE		; Dateiname (fuer FSAVE)
   85 D08F  06 80       	LD	B,HIGH(STBYT1)	; 80F3H (BC fuer Steuerbyte 1)
   86 D091  C9          	RET
   87                   
   88                   ; Steuerbyte 2 ausgeben
   89                   
   90 D092  01 80F1     STEUB2:	LD	BC,STBYT2	; 080F1H
   91 D095  18 0E       	JR	STEU0
   92                   
   93                   ; Steuerbyte 1 ausgeben
   94                   
   95 D097  FE 09       STEUER:	CP	9		; read/open ?
   96 D099  20 07       	JR	NZ,STEU3
   97 D09B  3E 01       	LD	A,1
   98 D09D  CD FB7D     	CALL	SETDEV		; Speichergeraet ist jetzt Diskette
   99 D0A0  3E 09       	LD	A,9
  100 D0A2  01 80F3     STEU3:	LD	BC,STBYT1	; 080F3H
  101 D0A5  ED 79       STEU0:	OUT	(C),A
  102 D0A7  C5          STEU1:	PUSH	BC
  103 D0A8  3E 01       	LD	A,1		; 6ms
  104 D0AA  CD F37B     	CALL	WAIT		; warten
  105 D0AD  C1          	POP	BC
  106 D0AE  ED 78       	IN	A,(C)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  53
CD45    INC

  107 D0B0  CB 47       	BIT	0,A
  108 D0B2  20 F3       	JR	NZ,STEU1	; fertig?
  109 D0B4  CB 7F       	BIT	7,A
  110 D0B6  C8          	RET	Z		; kein Fehler
  111 D0B7  C1          	POP	BC		; RET-Adresse vergessen!
  112 D0B8  01 83F1     FLERR:	LD	BC,DEPVER	; 083F1H
  113 D0BB  ED 78       	IN	A,(C)
  114 D0BD  FE 20       	CP	20H		; DEP ab 2.0?
  115 D0BF  30 0B       	JR	NC,FLER1	; ja
  116 D0C1  01 81F3     	LD	BC,FCODE	; 081F3H
  117 D0C4  ED 78       	IN	A,(C)		; Fehlernummer
  118 D0C6  CD F3C4     	CALL	AHEX		; anzeigen
  119 D0C9  C3 F4C2     	JP	ERRM
  120                   	;
  121 D0CC  06 00       FLER1:	LD	B,HIGH(ERRTX)	; 00F1H = Fehlertext von DEP 2.0
  122 D0CE  ED 78       FLER2:	IN	A,(C)
  123 D0D0  04          	INC	B
  124 D0D1  A7          	AND	A
  125 D0D2  C8          	RET	Z		; 00=Ende
  126 D0D3  CD F3D5     	CALL	OCHR
  127 D0D6  18 F6       	JR	FLER2
  128                   
  129                   ; BASEX-Programmteil mit Fehlertexten
  130                   
  131 D0D8  21 D1A8     BASEX:	LD	HL,BAS
  132 D0DB  11 00D8     	LD	DE,0D8H
  133 D0DE  01 0030     	LD	BC,BASE-BAS
  134 D0E1  ED B0       	LDIR			; Verteiler
  135 D0E3  21 D180     	LD	HL,UMS
  136 D0E6  11 0150     	LD	DE,150H
  137 D0E9  01 0028     	LD	BC,UMSE-UMS
  138 D0EC  ED B0       	LDIR			; Umschaltung
  139 D0EE  21 D118     	LD	HL,BASEC
  140 D0F1  11 0200     	LD	DE,200H
  141 D0F4  01 0068     	LD	BC,UMS-BASEC
  142 D0F7  ED B0       	LDIR			; BASEX selbst
  143 D0F9  2A B7B0     	LD	HL,(SUTAB)
  144 D0FC  22 0201     	LD	(SUSP),HL
  145 D0FF  11 0268     	LD	DE,SUBAS
  146 D102  ED 53 B7B0  	LD	(SUTAB),DE
  147 D106  01 0092     	LD	BC,92H
  148 D109  ED B0       	LDIR			; SUTAB
  149 D10B  21 0250     	LD	HL,MBIND
  150 D10E  22 02D6     	LD	(SUBAS+6EH),HL	; MB-Eingabe modifizieren
  151 D111  21 0203     	LD	HL,MBOUTD
  152 D114  22 02D8     	LD	(SUBAS+70H),HL	; MB-Ausgabe modifizieren
  153 D117  C9          	RET
  154                   
  155         D118      BASEC:	EQU	$		; Adresse im ROMC
  156         0200      RUN:	EQU	$-BASEC+200H
  157 D118  00          	DB	0		; 1 ->RUN-Switch
  158         0201      SUSP:	EQU	$-BASEC+200H
  159 D119  0000        	DW	0		; Speicher SUTAB
  160                   
  161         0203      MBOUTD:	EQU	$-BASEC+200H
  162 D11B  01 8EF3     	LD	BC,BASBYT	; 08EF3H
  163 D11E  ED 79       	OUT	(C),A		; Datenbyte
  164 D120  7A          	LD	A,D

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  54
CD45    INC

  165 D121  E6 48       	AND	48H
  166 D123  F6 37       	OR	37H
  167 D125  CD 0165     	CALL	NAMBAS
  168 D128  CB 77       	BIT	6,A		; schliessen?
  169 D12A  28 0A       	JR	Z,O1
  170 D12C  57          	LD	D,A
  171 D12D  3A 0200     	LD	A,(RUN)
  172 D130  A7          	AND	A
  173 D131  7A          	LD	A,D
  174 D132  28 02       	JR	Z,O1
  175 D134  CB FF       	SET	7,A		; run-switch
  176 D136  ED 79       O1:	OUT	(C),A		; Steuerbyte
  177 D138  ED 78       O2:	IN	A,(C)
  178 D13A  CB 47       	BIT	0,A		; fertig?
  179 D13C  20 FA       	JR	NZ,O2
  180 D13E  07          	RLCA
  181 D13F  DD CB 08 C6 	SET	0,(IX+8)	; Taste gedrueckt
  182 D143  D0          	RET	NC
  183 D144  01 83F1     BASERR:	LD	BC,DEPVER	; 083F1H
  184 D147  ED 78       	IN	A,(C)
  185 D149  FE 20       	CP	20H		; DEP ab 2.0?
  186 D14B  30 0F       	JR	NC,BERR2	; ja
  187 D14D  01 81F3     	LD	BC,FCODE	; 081F3H
  188 D150  ED 78       	IN	A,(C)
  189 D152  CD F3C4     	CALL	AHEX		; Fehler-Nr.
  190 D155  2A B7C9     BERR1:	LD	HL,(IOERR)
  191 D158  E5          	PUSH	HL
  192 D159  C3 F0A7     	JP	IRMOF		; (vorher JP 0F01BH)
  193                   	;
  194 D15C  06 00       BERR2:	LD	B,HIGH(ERRTX)	; Fehlertext - Register C ist bereits korrekt
  195 D15E  ED 78       BERR3:	IN	A,(C)
  196 D160  28 F3       	JR	Z,BERR1		; 00-Ende
  197 D162  04          	INC	B
  198 D163  CD F3D5     	CALL	OCHR
  199 D166  18 F6       	JR	BERR3
  200                   
  201         0250      MBIND:	EQU	$-BASEC+200H
  202 D168  7A          	LD	A,D
  203 D169  E6 48       	AND	48H
  204 D16B  F6 35       	OR	35H
  205 D16D  CD 0165     	CALL	NAMBAS
  206 D170  ED 79       	OUT	(C),A		; 80F3H = Steuerbyte
  207 D172  ED 78       I1:	IN	A,(C)
  208 D174  CB 47       	BIT	0,A		; fertig?
  209 D176  20 FA       	JR	NZ,I1
  210 D178  07          	RLCA
  211 D179  38 C9       	JR	C,BASERR	; Fehler
  212 D17B  06 8E       	LD	B,HIGH(BASBYT)	; 08EF3H
  213 D17D  ED 78       	IN	A,(C)		; Datenbyte
  214 D17F  C9          	RET
  215                   
  216         0268      SUBAS:	EQU	$-BASEC+200H	; hier wird die SUTAB hin kopiert
  217                   
  218                   ; Umschaltung Tape/Disk
  219                   
  220 D180  CD F08A     UMS:	CALL	IRMON		; bisher CALL 0F018H
  221 D183  2A 0201     	LD	HL,(SUSP)
  222 D186  ED 5B B7B0  	LD	DE,(SUTAB)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  55
CD45    INC

  223 D18A  22 B7B0     	LD	(SUTAB),HL
  224 D18D  ED 53 0201  	LD	(SUSP),DE
  225 D191  CD F0A7     	CALL	IRMOF		; bisher CALL 0F01BH
  226 D194  C9          	RET
  227                   
  228                   ; Dateiname (in BASEX) ausgeben:
  229                   
  230         0165      NAMBAS:	EQU	$-UMS+150H
  231 D195  01 83F3     	LD	BC,83F3H
  232 D198  CB 5F       	BIT	3,A		; open?
  233 D19A  28 09       	JR	Z,NAMB2
  234 D19C  1E 0B       	LD	E,11		; Anzahl Zeichen
  235 D19E  ED A3       NAMB1:	OUTI
  236 D1A0  04          	INC	B
  237 D1A1  04          	INC	B
  238 D1A2  1D          	DEC	E
  239 D1A3  20 F9       	JR	NZ,NAMB1
  240 D1A5  06 80       NAMB2:	LD	B,HIGH(STBYT1)	; 80F3H (BC fuer Steuerbyte 1)
  241 D1A7  C9          	RET
  242 D1A8              UMSE:	; Ende der Umschaltroutine
  243                   
  244                   ; BASIC-Schnittstelle (vorbereitet fuer 12 Funktionen)
  245                   
  246 D1A8  3E 00       BAS:	LD	A,0		; CALL*D8	FLOAD
  247 D1AA  01          	DB	1
  248 D1AB  3E 01       	LD	A,1		; CALL*DB	FSAVE
  249 D1AD  01          	DB	1
  250 D1AE  3E 02       	LD	A,2		; CALL*DE	DIR
  251 D1B0  01          	DB	1
  252 D1B1  3E 03       	LD	A,3		; CALL*E1	STAT
  253 D1B3  01          	DB	1
  254 D1B4  3E 04       	LD	A,4		; CALL*E4	REN
  255 D1B6  01          	DB	1
  256 D1B7  3E 05       	LD	A,5		; CALL*E7	SETRO
  257 D1B9  01          	DB	1
  258 D1BA  3E 06       	LD	A,6		; CALL*EA	SETWR
  259 D1BC  01          	DB	1
  260 D1BD  3E 07       	LD	A,7		; CALL*ED	ERA
  261 D1BF  01          	DB	1
  262 D1C0  3E 08       	LD	A,8		; CALL*F0	DRIVE
  263 D1C2  01          	DB	1
  264 D1C3  3E 09       	LD	A,9		; CALL*F3	frei
  265 D1C5  01          	DB	1
  266 D1C6  3E 0A       	LD	A,10		; CALL*F6	frei
  267 D1C8  01          	DB	1
  268 D1C9  3E 0B       	LD	A,11		; CALL*F9	frei
  269 D1CB  01          	DB	1
  270 D1CC  3E 0C       	LD	A,12		; CALL*FC	frei
  271 D1CE  CD F08A     	CALL	IRMON		; bisher CALL 0F018H
  272 D1D1  CD F021     	CALL	JDISK		; Disk-Verteiler
  273 D1D4  CD F0A7     	CALL	IRMOF		; bisher CALL 0F01BH
  274 D1D7  C9          	RET
  275 D1D8              BASE:	; Ende BASIC-Verteiler
  276                   
  277                   ; CAOS-D-Teil der Pixelausgaberoutine WPIX
  278                   
  279 D1D8  79          WPIXD:	LD	A,C
  280 D1D9  01 DC00     	LD	BC,0DC00H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  56
CD45    INC

  281 D1DC  87          	ADD	A,A
  282 D1DD  38 2C       	JR	C,WPX02		; 80..FF
  283 D1DF  05          	DEC	B
  284 D1E0  FE 40       	CP	40H
  285 D1E2  38 27       	JR	C,WPX02		; 00..1F
  286 D1E4  06 ED       	LD	B,0EEH-1	; Grossbuchstaben
  287 D1E6  FE B6       	CP	2*5BH
  288 D1E8  38 21       	JR	C,WPX02		; 20..5A
  289 D1EA  FE BC       	CP	2*5EH
  290 D1EC  38 0C       	JR	C,WPX01		; 5B..5D
  291 D1EE  FE C0       	CP	2*60H
  292 D1F0  38 19       	JR	C,WPX02		; 5E..5F
  293 D1F2  28 06       	JR	Z,WPX01		; 60
  294 D1F4  06 FC       	LD	B,0FEH-2	; Kleinbuchstaben
  295 D1F6  FE F6       	CP	2*7BH
  296 D1F8  38 11       	JR	C,WPX02		; 61..7A
  297 D1FA  01 DAB8     WPX01:	LD	BC,0DAB8H	; Zusatztabelle
  298 D1FD  D6 B6       	SUB	2*5BH
  299 D1FF  FE 06       	CP	6
  300 D201  38 08       	JR	C,WPX02		; 5B..5D
  301 D203  D6 04       	SUB	4
  302 D205  FE 06       	CP	6
  303 D207  28 02       	JR	Z,WPX02		; 60
  304 D209  D6 34       	SUB	34H
  305 D20B  6F          WPX02:	LD	L,A
  306 D20C  26 00       	LD	H,0
  307 D20E  29          	ADD	HL,HL		; *4
  308 D20F  C3 E0DF     	JP	WPX07		; Zurueck zu CAOS-E
  309                   
  310                   ; Rolle Fenster fuer Scrollroutine
  311                   
  312 D212  E5          MOVELN:	PUSH	HL
  313 D213  D5          	PUSH	DE
  314 D214  C5          	PUSH	BC
  315 D215  F5          	PUSH	AF
  316 D216  08          	EX	AF,AF'
  317 D217  F5          	PUSH	AF
  318 D218  79          	LD	A,C		; BC: Pixelzeilen
  319 D219  08          	EX	AF,AF'
  320 D21A  3A B79E     	LD	A,(WINLG)	; Spalten
  321 D21D  E5          MOLN1:	PUSH	HL
  322 D21E  D5          	PUSH	DE
  323 D21F  ED A0       MOLN2:	LDI			; zeichenweise
  324 D221  ED A0       	LDI
  325 D223  ED A0       	LDI
  326 D225  ED A0       	LDI
  327 D227  ED A0       	LDI
  328 D229  ED A0       	LDI
  329 D22B  ED A0       	LDI
  330 D22D  ED A0       	LDI
  331 D22F  EA D21F     	JP	PE,MOLN2
  332 D232  D1          	POP	DE
  333 D233  E1          	POP	HL
  334 D234  24          	INC	H		; neue Spalte
  335 D235  14          	INC	D
  336 D236  08          	EX	AF,AF'
  337 D237  4F          	LD	C,A
  338 D238  08          	EX	AF,AF'

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  57
CD45    INC

  339 D239  3D          	DEC	A		; Spaltenzaehler
  340 D23A  20 E1       	JR	NZ,MOLN1
  341 D23C  08          	EX	AF,AF'
  342 D23D  F1          	POP	AF
  343 D23E  08          	EX	AF,AF'
  344 D23F  C3 E0AB     	JP	POP4		; POP	AF,BC,DE,HL   RET
  345                   
  346                   ; Loeschen einer Zeile
  347                   ; HL: Adresse, C: Laenge, A: Byte
  348                   
  349 D242  41          CLLINE:	LD	B,C
  350 D243  55          CLL1:	LD	D,L		; L retten
  351 D244  77          	LD	(HL),A		; zeichenweise
  352 D245  2C          	INC	L		; ohne Schleife
  353 D246  77          	LD	(HL),A
  354 D247  2C          	INC	L
  355 D248  77          	LD	(HL),A
  356 D249  2C          	INC	L
  357 D24A  77          	LD	(HL),A
  358 D24B  2C          	INC	L
  359 D24C  77          	LD	(HL),A
  360 D24D  2C          	INC	L
  361 D24E  77          	LD	(HL),A
  362 D24F  2C          	INC	L
  363 D250  77          	LD	(HL),A
  364 D251  2C          	INC	L
  365 D252  77          	LD	(HL),A
  366 D253  6A          	LD	L,D		; L holen
  367 D254  24          	INC	H
  368 D255  10 EC       	DJNZ	CLL1
  369 D257  C9          	RET
  370                   
  371                   ; CAOS-D-Teil der Scrollroutine SCRLPG
  372                   
  373 D258  3A B79E     SCRLD:	LD	A,(WINLG)	; Spalten
  374 D25B  4F          	LD	C,A
  375 D25C  06 00       	LD	B,0
  376 D25E  3A B79F     	LD	A,(WINLG+1)	; Zeilen
  377 D261  3D          	DEC	A		; nur 1 Zeile?
  378 D262  28 3A       	JR	Z,SCRL3		; nur CLLN
  379 D264  D5          	PUSH	DE
  380 D265  F5          	PUSH	AF
  381 D266  50          	LD	D,B		; DE=0
  382 D267  58          	LD	E,B		; Cursor links/oben
  383 D268  CD E07C     	CALL	DABR
  384 D26B  EB          	EX	DE,HL
  385 D26C  21 0028     SCRL1:	LD	HL,40		; 1 Zeile tiefer
  386 D26F  19          	ADD	HL,DE
  387 D270  E5          	PUSH	HL
  388 D271  C5          	PUSH	BC
  389 D272  ED B0       	LDIR			; im VRAM eine Zeile rollen
  390 D274  C1          	POP	BC
  391 D275  D1          	POP	DE
  392 D276  3D          	DEC	A
  393 D277  20 F3       	JR	NZ,SCRL1	; A-mal rollen
  394 D279  F1          	POP	AF
  395 D27A  87          	ADD	A,A
  396 D27B  87          	ADD	A,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  58
CD45    INC

  397 D27C  87          	ADD	A,A		; *8: Pixelzeile
  398 D27D  4F          	LD	C,A
  399 D27E  50          	LD	D,B		; B war 0
  400 D27F  58          	LD	E,B		; DE=0
  401 D280  CD E056     	CALL	PADR1
  402 D283  EB          	EX	DE,HL		; DE=Pixeladresse
  403 D284  2E 08       	LD	L,8		; H war 0
  404 D286  19          	ADD	HL,DE
  405 D287  3A B7A2     	LD	A,(STBT)
  406 D28A  1F          	RRA
  407 D28B  1F          	RRA
  408 D28C  38 0B       	JR	C,SCRL2		; Farbe AUS
  409 D28E  F5          	PUSH	AF
  410 D28F  CD F943     	CALL	ESC9
  411 D292  CD D212     	CALL	MOVELN
  412 D295  CD F943     	CALL	ESC9
  413 D298  F1          	POP	AF
  414 D299  17          SCRL2:	RLA			; Pixel AUS?
  415 D29A  D4 D212     	CALL	NC,MOVELN
  416 D29D  D1          	POP	DE
  417 D29E  15          SCRL3:	DEC	D
  418                   
  419                   ; CAOS-D-Teil der Zeilenloeschroutine CLLN (Shift-DEL)
  420                   
  421 D29F  1E 00       CLLND:	LD	E,0
  422 D2A1  CD E07C     	CALL	DABR		; ausserhalb?
  423 D2A4  D8          	RET	C		; (Selbstschutz)
  424 D2A5  3A B79E     	LD	A,(WINLG)
  425 D2A8  47          	LD	B,A		; Spalten
  426 D2A9  4F          	LD	C,A
  427 D2AA  AF          	XOR	A
  428 D2AB  77          CLLN1:	LD	(HL),A		; VRAM loeschen
  429 D2AC  23          	INC	HL
  430 D2AD  10 FC       	DJNZ	CLLN1
  431 D2AF  CD E056     	CALL	PADR1
  432 D2B2  D8          	RET	C
  433 D2B3  D5          	PUSH	DE
  434 D2B4  DD CB 01 5E 	BIT	3,(IX+1)
  435 D2B8  3A B7A2     	LD	A,(STBT)
  436 D2BB  20 04       	JR	NZ,CLLALT	; LORES
  437 D2BD  CB 77       	BIT	6,A
  438 D2BF  20 1C       	JR	NZ,CLLHR	; HRG-Modus
  439 D2C1  0F          CLLALT:	RRCA			; Pixel AUS?
  440 D2C2  5F          	LD	E,A		; nach E merken
  441 D2C3  38 06       	JR	C,CLLN2
  442 D2C5  AF          	XOR	A
  443 D2C6  E5          	PUSH	HL
  444 D2C7  CD D242     	CALL	CLLINE		; Pixel loeschen
  445 D2CA  E1          	POP	HL
  446 D2CB  CB 0B       CLLN2:	RRC	E		; Farbe AUS?
  447 D2CD  38 0C       	JR	C,CLLN3
  448 D2CF  CD F943     	CALL	ESC9
  449 D2D2  3A B7A3     	LD	A,(COLOR)
  450 D2D5  CD D242     CLLCOL:	CALL	CLLINE		; Farbe setzen
  451 D2D8  CD F943     	CALL	ESC9
  452 D2DB  D1          CLLN3:	POP	DE
  453 D2DC  C9          	RET
  454                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  59
CD45    INC

  455 D2DD  3A B7A3     CLLHR:	LD	A,(COLOR)
  456 D2E0  E6 03       	AND	00000011b	; Paper, CY=0
  457 D2E2  1F          	RRA
  458 D2E3  3D          	DEC	A		; NEG ohne Veraenderung von CY
  459 D2E4  2F          	CPL
  460 D2E5  5F          	LD	E,A		; E = FFh * Bit 1 (Farbe)
  461 D2E6  9F          	SBC	A,A		; A = FFh * Bit 0 (Pixel)
  462 D2E7  E5          	PUSH	HL
  463 D2E8  CD D242     	CALL	CLLINE
  464 D2EB  E1          	POP	HL
  465 D2EC  CD F943     	CALL	ESC9
  466 D2EF  7B          	LD	A,E		; Farbe
  467 D2F0  18 E3       	JR	CLLCOL
  468                   
  469                   ; Programm von Floppy laden
  470                   
  471 D2F2  7F7F        FLOA7F:	DW	7F7FH
  472 D2F4  46 4C 4F 41 	DB	'FLOAD'
  473 D2F9  01          	DB	1
  474 D2FA  CD D017     	CALL	DISK		; D004 bereit?
  475 D2FD  CD D06E     	CALL	FNAM0
  476 D300  D8          	RET	C		; Eingabe mit BRK abgebrochen
  477 D301  3A B781     FLOAD:	LD	A,(ARGN)
  478 D304  FE 02       	CP	2
  479 D306  3E 00       	LD	A,0
  480 D308  38 02       	JR	C,FLO0
  481 D30A  CB CF       	SET	1,A		; merken: kein Autostart
  482 D30C  DD 77 07    FLO0:	LD	(IX+7),A
  483 D30F  3E 09       	LD	A,9		; Lesen oeffnen
  484 D311  CD D097     	CALL	STEUER
  485 D314  01 90F2     	LD	BC,FDATA+1000H	; 90F2H
  486 D317  ED 78       	IN	A,(C)		; Anzahl Parameter in Vorblock
  487 D319  87          	ADD	A,A
  488 D31A  87          	ADD	A,A
  489 D31B  E6 1C       	AND	1CH
  490 D31D  DD B6 07    	OR	(IX+7)
  491 D320  DD 77 07    	LD	(IX+7),A
  492 D323  ED 78       	IN	A,(C)		; Anzahl
  493 D325  FE 02       	CP	2
  494 D327  38 04       	JR	C,FLO1		; wenn<2
  495 D329  FE 0A       	CP	10
  496 D32B  38 17       	JR	C,FLO2		; wenn>10
  497 D32D  CD F0D6     FLO1:	CALL	OSTR
  498 D330  4B 65 69 6E 	DB	'Keine MC-Datei!'
  499 D33F  07 0D 0A 00 	DB	7,CR,LF,0
  500 D343  C9          	RET
  501 D344  04          FLO2:	INC	B
  502 D345  ED 68       	IN	L,(C)
  503 D347  04          	INC	B
  504 D348  ED 60       	IN	H,(C)		; HL=Ladeadresse
  505 D34A  04          	INC	B
  506 D34B  ED 58       	IN	E,(C)
  507 D34D  04          	INC	B
  508 D34E  ED 50       	IN	D,(C)		; DE=Endadresse
  509 D350  FE 03       	CP	3
  510 D352  38 08       	JR	C,FLO3		; keine Startadresse
  511 D354  E5          	PUSH	HL
  512 D355  04          	INC	B

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  60
CD45    INC

  513 D356  ED 68       	IN	L,(C)
  514 D358  04          	INC	B
  515 D359  ED 60       	IN	H,(C)		; Startadresse
  516 D35B  E3          	EX	(SP),HL
  517 D35C  08          FLO3:	EX	AF,AF'
  518 D35D  3A B781     	LD	A,(ARGN)
  519 D360  A7          	AND	A
  520 D361  28 0F       	JR	Z,FLO5		; ohne Offset
  521 D363  ED 4B B782  	LD	BC,(ARG1)	; Offset von Eingabe
  522 D367  09          	ADD	HL,BC		; Startadresse umrechnen
  523 D368  EB          	EX	DE,HL
  524 D369  09          	ADD	HL,BC		; Endadresse umrechnen
  525 D36A  EB          	EX	DE,HL
  526 D36B  08          	EX	AF,AF'
  527 D36C  38 03       	JR	C,FLO4		; keine Startadresse
  528 D36E  E3          	EX	(SP),HL
  529 D36F  09          	ADD	HL,BC		; Startadresse umrechnen
  530 D370  E3          	EX	(SP),HL
  531 D371  08          FLO4:	EX	AF,AF'
  532 D372  CD F4D3     FLO5:	CALL	HLDE		; Aadr Eadr anzeigen
  533 D375  08          	EX	AF,AF'
  534 D376  38 08       	JR	C,FLO6		; keine Startadresse
  535 D378  E3          	EX	(SP),HL
  536 D379  22 B786     	LD	(ARG3),HL
  537 D37C  CD F3B4     	CALL	HLHX		; Sadr anzeigen
  538 D37F  E1          	POP	HL
  539 D380  CD F4CC     FLO6:	CALL	CRLF
  540 D383  3E 01       FLO7:	LD	A,1		; Lesen normal
  541 D385  CD D097     	CALL	STEUER
  542 D388  0D          	DEC	C		; STBYT1 -> FDATA
  543 D389  ED 78       FLO8:	IN	A,(C)
  544 D38B  CD FB2B     	CALL	LDMAE		; Daten in Speicher ablegen
  545 D38E  23          	INC	HL
  546 D38F  04          	INC	B
  547 D390  E5          	PUSH	HL
  548 D391  ED 52       	SBC	HL,DE		; Endadresse erreicht?
  549 D393  E1          	POP	HL
  550 D394  30 06       	JR	NC,FLO9		; ja
  551 D396  78          	LD	A,B
  552 D397  A7          	AND	A		; Sektor eingelesen?
  553 D398  20 EF       	JR	NZ,FLO8		; nein, weitere Datenbytes abholen
  554 D39A  18 E7       	JR	FLO7		; neuen Sektor lesen
  555                   	;
  556 D39C  DD 7E 07    FLO9:	LD	A,(IX+7)	; Autostart ausfuehren?
  557 D39F  CB 4F       	BIT	1,A
  558 D3A1  C0          	RET	NZ		; kein Start
  559 D3A2  E6 1C       	AND	1CH
  560 D3A4  FE 0C       	CP	0CH
  561 D3A6  D8          	RET	C		; keine Sadr vorhanden
  562 D3A7  2A B786     	LD	HL,(ARG3)	; Sadr
  563 D3AA  E5          	PUSH	HL		; auf Stack ablegen
  564 D3AB  C3 FB57     	JP	COFF		; erst noch CAOSC off!
  565                   
  566                   ; Datei auf Floppy abspeichern
  567                   
  568 D3AE  7F7F        FSAV7F:	DW	7F7FH
  569 D3B0  46 53 41 56 	DB	'FSAVE'
  570 D3B5  05          	DB	5

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  61
CD45    INC

  571 D3B6  CD D017     	CALL	DISK		; D004 bereit?
  572 D3B9  CD D06E     	CALL	FNAM0
  573 D3BC  D8          	RET	C		; Eingabe mit BRK abgebrochen
  574 D3BD  CD E4D1     FSAVE:	CALL	CLC		; Kassetten-Puffer loeschen
  575 D3C0  EB          	EX	DE,HL
  576 D3C1  01 000C     	LD	BC,12		; Dateiname+Typ 8.3
  577 D3C4  ED B0       	LDIR			; an Anfang Kassettenpuffer kopieren
  578 D3C6  1E 10       	LD	E,10H		; Argumente im Kassettenpuffer
  579 D3C8  21 B781     	LD	HL,ARGN
  580 D3CB  7E          	LD	A,(HL)		; Anzahl Argumente
  581 D3CC  87          	ADD	A,A		; *2
  582 D3CD  3C          	INC	A
  583 D3CE  4F          	LD	C,A		; Anzahl Bytes
  584 D3CF  ED B0       	LDIR			; Argumente in Kassettenpuffer kopieren
  585 D3D1  21 B700     	LD	HL,CASS
  586 D3D4  01 81F2     	LD	BC,FDATA+100H	; 81F2H
  587 D3D7  1E 80       	LD	E,128
  588 D3D9  ED A3       FSA2:	OUTI			; Vorblock ausgeben
  589 D3DB  04          	INC	B
  590 D3DC  04          	INC	B
  591 D3DD  1D          	DEC	E
  592 D3DE  20 F9       	JR	NZ,FSA2
  593 D3E0  3E 0B       	LD	A,0BH		; Schreiben oeffnen
  594 D3E2  CD D097     	CALL	STEUER
  595 D3E5  2A B784     	LD	HL,(ARG2)	; Endadresse+1
  596 D3E8  ED 5B B782  	LD	DE,(ARG1)	; Anfangsadresse
  597 D3EC  A7          	AND	A
  598 D3ED  ED 52       	SBC	HL,DE		; Anzahl Datenbytes
  599 D3EF  EB          	EX	DE,HL		; HL=Adresse, DE=Anzahl
  600 D3F0  0D          FSA3:	DEC	C		; 80F2H=FDATA
  601 D3F1  3E 80       	LD	A,128
  602 D3F3  08          FSA4:	EX	AF,AF'		; A' = Sektorzaehler
  603 D3F4  CD FB3B     	 CALL	LDAME		; Daten aus Speicher holen
  604 D3F7  23          	 INC	HL
  605 D3F8  ED 79       	 OUT	(C),A		; und in Koppel-RAM schreiben
  606 D3FA  1B          	 DEC	DE		; Anzahl-1
  607 D3FB  7A          	 LD	A,D
  608 D3FC  B3          	 OR	E
  609 D3FD  28 05       	 JR	Z,FSA5		; Anzahl=0 -> alle Daten geschrieben
  610 D3FF  08          	EX	AF,AF'
  611 D400  04          	INC	B
  612 D401  3D          	DEC	A
  613 D402  20 EF       	JR	NZ,FSA4		; bis Koppel-RAM voll ist
  614 D404  3E 03       FSA5:	LD	A,3		; Schreiben normal
  615 D406  CD D097     	CALL	STEUER
  616 D409  7A          	LD	A,D		; Anzahl=0?
  617 D40A  B3          	OR	E
  618 D40B  20 E3       	JR	NZ,FSA3		; weitere Daten vorhanden!
  619 D40D  3E 43       	LD	A,43H		; Schreiben schliessen
  620 D40F  CD D097     	CALL	STEUER
  621 D412  C3 E4D1     	JP	CLC		; Puffer loeschen
  622                   
  623                   ; Directory mit Maske
  624                   
  625 D415  7F7F        DIR7F:	DW	7F7FH
  626 D417  44 49 52    	DB	'DIR'
  627 D41A  1F          	DB	1FH
  628 D41B  CD D017     	CALL	DISK		; D004 bereit?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  62
CD45    INC

  629 D41E  EB          	EX	DE,HL		; Maske aus Kommandozeile
  630 D41F  11 B700     	LD	DE,CASS
  631 D422  01 000B     	LD	BC,11		; max. Laenge
  632 D425  ED B0       	LDIR			; In Kassettenpuffer ablegen
  633 D427  18 03       	JR	DIR0
  634 D429  11 B700     DIR:	LD	DE,CASS
  635 D42C  AF          DIR0:	XOR	A		; Abschluss Maske
  636 D42D  12          	LD	(DE),A
  637 D42E  3E 0D       	LD	A,0DH		; Directory oeffnen
  638 D430  CD D097     DIR1:	CALL	STEUER
  639 D433  CB 57       	BIT	2,A
  640 D435  20 41       	JR	NZ,DIR6		; Ende
  641 D437  06 82       	LD	B,HIGH(DIRBUF)	; 82F3H
  642 D439  21 B70C     	LD	HL,CASS+12
  643 D43C  A7          	AND	A		; CY=0
  644 D43D  16 03       	LD	D,3		; 3 Eintraege
  645 D43F  1E 0B       DIR2:	LD	E,11		; 11 Zeichen lang
  646 D441  ED 78       DIR3:	IN	A,(C)		; einlesen
  647 D443  F5          	PUSH	AF
  648 D444  E6 7F       	AND	7FH
  649 D446  04          	INC	B
  650 D447  77          	LD	(HL),A
  651 D448  23          	INC	HL
  652 D449  7B          	LD	A,E
  653 D44A  FE 03       	CP	3		; RO-Byte?
  654 D44C  28 01       	JR	Z,DIR4
  655 D44E  F1          	POP	AF
  656 D44F  1D          DIR4:	DEC	E
  657 D450  20 EF       	JR	NZ,DIR3
  658 D452  36 00       	LD	(HL),0		; Ende-Kennung
  659 D454  23          	INC	HL
  660 D455  04          	INC	B
  661 D456  F1          	POP	AF
  662 D457  77          	LD	(HL),A		; RO-Byte
  663 D458  23          	INC	HL
  664 D459  15          	DEC	D
  665 D45A  20 E3       	JR	NZ,DIR2
  666 D45C  21 B70C     	LD	HL,CASS+12
  667 D45F  06 03       	LD	B,3
  668 D461  E5          DIR5:	PUSH	HL
  669 D462  11 B700     	LD	DE,CASS
  670 D465  1A          	LD	A,(DE)
  671 D466  A7          	AND	A
  672 D467  C4 D4B6     	CALL	NZ,GLOB		; Vergleich mit Maske
  673 D46A  E1          	POP	HL
  674 D46B  D4 D481     	CALL	NC,DIR7		; Anzeige
  675 D46E  11 000D     	LD	DE,13
  676 D471  19          	ADD	HL,DE
  677 D472  10 ED       	DJNZ	DIR5		; 3 Eintraege
  678 D474  3E 05       	LD	A,5		; DIR weiter
  679 D476  18 B8       	JR	DIR1
  680                   	;
  681 D478  3A B7A0     DIR6:	LD	A,(CURSO)
  682 D47B  A7          	AND	A
  683 D47C  C4 F4CC     	CALL	NZ,CRLF
  684 D47F  18 1C       	JR	STAT
  685                   	;
  686 D481  E5          DIR7:	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  63
CD45    INC

  687 D482  3A B7A0     	LD	A,(CURSO)
  688 D485  FE 27       	CP	3*13
  689 D487  CC F4CC     	CALL	Z,CRLF
  690 D48A  CD F8BB     	CALL	ZKOUT
  691 D48D  3E 20       	LD	A,' '		; WR
  692 D48F  CB 7E       	BIT	7,(HL)
  693 D491  28 02       	JR	Z,DIR8
  694 D493  3E 2A       	LD	A,'*'		; RO
  695 D495  CD F3D5     DIR8:	CALL	OCHR
  696 D498  CD F3BC     	CALL	SPACE
  697 D49B  E1          	POP	HL
  698 D49C  C9          	RET
  699                   
  700 D49D  3E 15       STAT:	LD	A,15H		; Status
  701 D49F  CD D097     	CALL	STEUER
  702 D4A2  1E 14       	LD	E,20
  703 D4A4  06 82       	LD	B,HIGH(DIRBUF)	; 82F3H
  704 D4A6  ED 78       STAT1:	IN	A,(C)
  705 D4A8  E6 7F       	AND	7FH		; Bit 7 abtrennen
  706 D4AA  04          	INC	B
  707 D4AB  F5          	PUSH	AF
  708 D4AC  CD F3D5     	CALL	OCHR
  709 D4AF  F1          	POP	AF
  710 D4B0  1D          	DEC	E
  711 D4B1  20 F3       	JR	NZ,STAT1
  712 D4B3  C9          	RET
  713                   
  714                   ; Vergleich mit DIR-Maske:
  715                   
  716 D4B4  23          MAT0:	INC	HL
  717 D4B5  13          MAT0E:	INC	DE
  718 D4B6              GLOB:	; Eintritt, HL=Name, DE=Maske
  719                   	; PA: CY=1: nicht gefunden
  720 D4B6  1A          	LD	A,(DE)
  721 D4B7  B6          	OR	(HL)		; Beide Ende?
  722 D4B8  C8          	RET	Z		; -> OK
  723 D4B9  1A          	LD	A,(DE)
  724 D4BA  FE 2A       	CP	'*'
  725 D4BC  28 16       	JR	Z,MAT0S
  726 D4BE  FE 01       	CP	1
  727 D4C0  D8          	RET	C		; M Ende
  728 D4C1  7E          	LD	A,(HL)
  729 D4C2  FE 01       	CP	1
  730 D4C4  D8          	RET	C		; N Ende
  731 D4C5  1A          	LD	A,(DE)
  732 D4C6  FE 3F       	CP	'?'
  733 D4C8  28 EA       	JR	Z,MAT0		; Joker
  734 D4CA  CB 6E       	BIT	5,(HL)
  735 D4CC  CC F52E     	CALL	Z,UPCASE
  736 D4CF  BE          	CP	(HL)
  737 D4D0  28 E2       	JR	Z,MAT0
  738 D4D2  37          	SCF
  739 D4D3  C9          	RET
  740                   	;
  741 D4D4  E5          MAT0S:	PUSH	HL
  742 D4D5  D5          	PUSH	DE
  743 D4D6  CD D4B5     	CALL	MAT0E		; Rekursion!
  744 D4D9  D1          	POP	DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  64
CD45    INC

  745 D4DA  E1          	POP	HL
  746 D4DB  D0          	RET	NC		; -> OK
  747 D4DC  7E          	LD	A,(HL)
  748 D4DD  23          	INC	HL
  749 D4DE  B7          	OR	A
  750 D4DF  20 F3       	JR	NZ,MAT0S
  751 D4E1  37          	SCF
  752 D4E2  C9          	RET
  753                   
  754 D4E3  7F7F        REN7F:	DW	7F7FH
  755 D4E5  52 45 4E    	DB	'REN'
  756 D4E8  1F          	DB	1FH
  757 D4E9  CD D017     	CALL	DISK		; D004 bereit?
  758 D4EC  CD F0D6     REN:	CALL	OSTR
  759 D4EF  41 6C 74 65 	DB	'Alter ',0
  760 D4F6  21 000C     	LD	HL,12
  761 D4F9  CD D071     	CALL	FNAM1
  762 D4FC  D8          	RET	C		; BRK
  763 D4FD  3E 29       	LD	A,29H		; REN alter Dateiname
  764 D4FF  CD D097     	CALL	STEUER
  765 D502  CD F0D6     	CALL	OSTR
  766 D505  4E 65 75 65 	DB	'Neuer ',0
  767 D50C  21 000C     	LD	HL,12
  768 D50F  CD D071     	CALL	FNAM1
  769 D512  3E 21       	LD	A,21H		; Ren neuer Dateiname
  770 D514  D8          DOUT:	RET	C		; BRK
  771 D515  CD D097     	CALL	STEUER		; Stack-Unwinding:
  772 D518  C9          	RET			; nicht in JP umwandeln!
  773                   
  774 D519  7F7F        ERA7F:	DW	7F7FH
  775 D51B  45 52 41    	DB	'ERA'
  776 D51E  1F          	DB	1FH
  777 D51F  CD D017     	CALL	DISK		; D004 bereit?
  778 D522  CD D068     	CALL	FNAME
  779 D525  18 03       	JR	ERA1
  780 D527  CD D06E     ERA:	CALL	FNAM0
  781 D52A  3E 11       ERA1:	LD	A,11H		; Era
  782 D52C  18 E6       	JR	DOUT
  783                   
  784 D52E  7F7F        SRO7F:	DW	7F7FH
  785 D530  53 45 54 52 	DB	'SETRO'
  786 D535  1F          	DB	1FH
  787 D536  CD D017     	CALL	DISK		; D004 bereit?
  788 D539  CD D068     	CALL	FNAME
  789 D53C  18 03       	JR	SETR1
  790 D53E  CD D06E     SETRO:	CALL	FNAM0
  791 D541  3E 25       SETR1:	LD	A,25H		; Setro
  792 D543  18 CF       	JR	DOUT
  793                   
  794 D545  7F7F        SWR7F:	DW	7F7FH
  795 D547  53 45 54 57 	DB	'SETWR'
  796 D54C  1F          	DB	1FH
  797 D54D  CD D017     	CALL	DISK		; D004 bereit?
  798 D550  CD D068     	CALL	FNAME
  799 D553  18 03       	JR	SETW1
  800 D555  CD D06E     SETWR:	CALL	FNAM0
  801 D558  3E 31       SETW1:	LD	A,31H		; Setwr
  802 D55A  18 B8       	JR	DOUT

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  65
CD45    INC

  803                   
  804 D55C  7F7F        DRIV7F:	DW	7F7FH
  805 D55E  44 52 49 56 	DB	'DRIVE'
  806 D563  1F          	DB	1FH
  807 D564  CD D017     	CALL	DISK		; D004 bereit?
  808 D567  18 03       	JR	DRIV0
  809 D569  11 D585     DRIVE:	LD	DE,DRIV1
  810 D56C  01 83F1     DRIV0:	LD	BC,DEPVER	; 083F1H
  811 D56F  ED 78       	IN	A,(C)
  812 D571  FE 20       	CP	20H		; DEP ab 2.0?
  813 D573  30 12       	JR	NC,DRIV2	; nein
  814 D575  CD F0D6     	CALL	OSTR
  815 D578  4B 65 69 6E 	DB	'Kein DEP2!'
  816 D582  07 0D 0A    	DB	7,CR,LF
  817 D585  00          DRIV1:	DB	0
  818 D586  C9          	RET
  819 D587  EB          DRIV2:	EX	DE,HL
  820 D588  7E          	LD	A,(HL)
  821 D589  E6 DF       	AND	0DFH
  822 D58B  20 2F       	JR	NZ,DRIV3	; mit Argument aufgerufen!
  823 D58D  CD F0D6     	CALL	OSTR
  824 D590  4C 61 75 66 	DB	'Laufwerk:',0
  825 D59A  3E 01       	LD	A,1		; aktuell lesen
  826 D59C  CD D092     	CALL	STEUB2
  827 D59F  01 81F1     	LD	BC,LWANF	; 081F1H
  828 D5A2  ED 78       	IN	A,(C)
  829 D5A4  CD F3D5     	CALL	OCHR		; Laufwerk anzeigen
  830 D5A7  04          	INC	B		; 082F1H
  831 D5A8  ED 78       	IN	A,(C)		; aktueller User-Bereich
  832 D5AA  E6 0F       	AND	0FH
  833 D5AC  C4 F3CD     	CALL	NZ,AHEX0	; Userbereich hex anzeigen
  834 D5AF  3E 09       	LD	A,9
  835 D5B1  32 B7A0     	LD	(CURSO),A
  836 D5B4  CD F495     	CALL	INLIN		; Eingabe
  837 D5B7  D8          	RET	C		; BRK
  838 D5B8  21 0009     	LD	HL,9
  839 D5BB  19          	ADD	HL,DE
  840 D5BC  01 81F1     DRIV3:	LD	BC,LWANF	; 081F1H
  841 D5BF  7E          	LD	A,(HL)
  842 D5C0  A7          	AND	A		; leer?
  843 D5C1  C8          	RET	Z
  844 D5C2  CD F52E     	CALL	UPCASE
  845 D5C5  ED 79       	OUT	(C),A		; LW-Code
  846 D5C7  23          	INC	HL
  847 D5C8  7E          	LD	A,(HL)
  848 D5C9  A7          	AND	A		; USER mit angegeben?
  849 D5CA  3E 03       	LD	A,3		; nur LW anfordern
  850 D5CC  28 10       	JR	Z,DRIV5
  851 D5CE  EB          	EX	DE,HL
  852 D5CF  CD F4DC     	CALL	RHEX
  853 D5D2  3E 00       	LD	A,0		; USER 0, weil
  854 D5D4  38 03       	JR	C,DRIV4		; keine HEX-Zahl
  855 D5D6  3A B797     	LD	A,(NUMVX)
  856 D5D9  04          DRIV4:	INC	B		; 082F1H
  857 D5DA  ED 79       	OUT	(C),A		; USER-Nr.
  858 D5DC  3E 07       	LD	A,7		; LW+User anfordern
  859 D5DE  CD D092     DRIV5:	CALL	STEUB2		; Stack-Unwinding:
  860 D5E1  C9          	RET			; nicht in JP umwandeln!

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  66
CD45    INC

  861                   
  862 D5E2  7F7F        TYPE7F:	DW	7F7FH
  863 D5E4  54 59 50 45 	DB	'TYPE'
  864 D5E8  1F          	DB	1FH
  865 D5E9  CD D017     	CALL	DISK		; D004 bereit?
  866 D5EC  CD D068     	CALL	FNAME
  867 D5EF  D8          	RET	C		; BRK
  868 D5F0  3E 09       	LD	A,9		; read-open
  869 D5F2  CD D097     	CALL	STEUER
  870 D5F5  01 90F2     	LD	BC,FDATA+1000H	; 90F2H
  871                   	INFC			; IN F,(C)
    1 D5F8  ED 70       	 DB	0EDh,70h
  872 D5FA  06 80       	LD	B,HIGH(FDATA)	; 80F2H
  873 D5FC  20 06       	JR	NZ,TYPE2	; kein Vorblock (bei Edas-Quellen hier 00h)
  874 D5FE  3E 01       TYPE1:	LD	A,1		; read
  875 D600  CD D097     	CALL	STEUER
  876 D603  0D          	DEC	C		; 80F2H=FDATA
  877 D604  ED 78       TYPE2:	IN	A,(C)		; Zeichen
  878 D606  FE 03       	CP	3
  879 D608  CA F4CC     	JP	Z,CRLF		; CAOS-Ende
  880 D60B  FE 1A       	CP	1AH
  881 D60D  CA F4CC     	JP	Z,CRLF		; CP/M-Ende
  882 D610  FE 20       	CP	20H
  883 D612  30 1C       	JR	NC,TYPE5
  884 D614  FE 0A       	CP	LF
  885 D616  28 18       	JR	Z,TYPE5
  886 D618  FE 0D       	CP	CR
  887 D61A  28 14       	JR	Z,TYPE5
  888 D61C  FE 09       	CP	9
  889 D61E  20 0E       	JR	NZ,TYPE4
  890 D620  3E 20       TYPE3:	LD	A,' '
  891 D622  CD F3D5     	CALL	OCHR
  892 D625  3A B7A0     	LD	A,(CURSO)
  893 D628  E6 07       	AND	7
  894 D62A  20 F4       	JR	NZ,TYPE3
  895 D62C  18 05       	JR	TYPE6
  896 D62E  3E 2E       TYPE4:	LD	A,'.'		; statt Steuerzeichen anzeigen
  897 D630  CD F3D5     TYPE5:	CALL	OCHR
  898 D633  3A B7A1     TYPE6:	LD	A,(CURSO+1)
  899 D636  3C          	INC	A
  900 D637  21 B79F     	LD	HL,WINLG+1
  901 D63A  BE          	CP	(HL)		; Seite voll?
  902 D63B  20 19       	JR	NZ,TYPE9
  903 D63D  CD F3F0     TYPE7:	CALL	INTB
  904 D640  FE 03       	CP	3
  905 D642  C8          	RET	Z		; BRK
  906 D643  FE 0F       	CP	0FH
  907 D645  20 05       	JR	NZ,TYPE8
  908 D647  CD F3D5     	CALL	OCHR		; Hardcopy zulassen
  909 D64A  18 F1       	JR	TYPE7
  910 D64C  3E 0C       TYPE8:	LD	A,0CH		; CLS
  911 D64E  CD E0A0     	CALL	CRT
  912 D651  3E 0A       	LD	A,LF
  913 D653  CD E0A0     	CALL	CRT
  914 D656  04          TYPE9:	INC	B
  915 D657  20 AB       	JR	NZ,TYPE2	; weiter anzeigen
  916 D659  18 A3       	JR	TYPE1		; neuen Block lesen
  917                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  67
CD45    INC

  918 D65B  7F7F        DUMP7F:	DW	7F7FH
  919 D65D  44 55 4D 50 	DB	'DUMP'
  920 D661  1F          	DB	1FH
  921 D662  CD D017     	CALL	DISK		; D004 bereit?
  922 D665  CD D068     	CALL	FNAME
  923 D668  D8          	RET	C		; BRK
  924 D669  3E 09       	LD	A,9		; Lesen oeffnen
  925 D66B  18 10       	JR	DUMP2
  926 D66D  3E 0C       DUMP7:	LD	A,0CH		; CLS
  927 D66F  CD E0A0     	CALL	CRT		; CRT damit nicht zu Druckprotokoll!
  928 D672  3E 0A       	LD	A,LF
  929 D674  CD E0A0     	CALL	CRT
  930 D677  78          DUMP8:	LD	A,B
  931 D678  A7          	AND	A
  932 D679  20 06       	JR	NZ,DUMP3
  933 D67B  3E 01       DUMP1:	LD	A,1		; Lesen normal
  934 D67D  CD D097     DUMP2:	CALL	STEUER
  935 D680  0D          	DEC	C		; 80F2H=FDATA
  936 D681  C5          DUMP3:	PUSH	BC
  937 D682  3E 20       DUMP4:	LD	A,' '
  938 D684  CD F3D5     	CALL	OCHR
  939 D687  ED 78       	IN	A,(C)
  940 D689  CD F3C4     	CALL	AHEX
  941 D68C  04          	INC	B
  942 D68D  3E 07       	LD	A,7
  943 D68F  A0          	AND	B		; 8*Hexwert
  944 D690  20 F0       	JR	NZ,DUMP4
  945 D692  CD F0D6     	CALL	OSTR
  946 D695  20 20 20 00 	DB	'   ',0
  947 D699  C1          	POP	BC
  948 D69A  ED 78       DUMP5:	IN	A,(C)
  949 D69C  CD F751     	CALL	CSTBT
  950 D69F  04          	INC	B
  951 D6A0  3E 07       	LD	A,7
  952 D6A2  A0          	AND	B		; 8*Ascii
  953 D6A3  20 F5       	JR	NZ,DUMP5
  954 D6A5  CD F4CC     	CALL	CRLF
  955 D6A8  3A B7A1     	LD	A,(CURSO+1)
  956 D6AB  3C          	INC	A
  957 D6AC  21 B79F     	LD	HL,WINLG+1
  958 D6AF  BE          	CP	(HL)		; Seite voll?
  959 D6B0  20 C5       	JR	NZ,DUMP8
  960 D6B2  CD F3F0     DUMP6:	CALL	INTB
  961 D6B5  FE 03       	CP	3		; BRK?
  962 D6B7  C8          	RET	Z		; ja
  963 D6B8  FE 0F       	CP	0FH
  964 D6BA  20 B1       	JR	NZ,DUMP7
  965 D6BC  CD F3D5     	CALL	OCHR		; Hardcopy zulassen
  966 D6BF  18 F1       	JR	DUMP6
  967                   
  968 D6C1  49 4E 49 54 UUU:	DB	'INITIAL.UUU',0
  969 D6CD  7F7F        	DW	7F7FH
  970 D6CF  49 4E 49 54 	DB	'INIT'
  971 D6D3  1F          	DB	1FH
  972 D6D4  CD D017     	CALL	DISK		; D004 bereit?
  973 D6D7  EB          	EX	DE,HL
  974 D6D8  7E          	LD	A,(HL)		; Parameter in Kommandozeile
  975 D6D9  E6 DF       	AND	0DFH		; angegeben?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  68
CD45    INC

  976 D6DB  28 2C       	JR	Z,INIT3		; nein, Standard-Dateiname verwenden
  977 D6DD  E5          	PUSH	HL
  978 D6DE  7E          INIT1:	LD	A,(HL)		; "Mini-Fileparser"
  979 D6DF  A7          	AND	A
  980 D6E0  28 2B       	JR	Z,INIT4		; Ende Dateiname
  981 D6E2  23          	INC	HL
  982 D6E3  FE 3A       	CP	':'		; LW?
  983 D6E5  20 F7       	JR	NZ,INIT1
  984 D6E7  7E          	LD	A,(HL)
  985 D6E8  E1          	POP	HL
  986 D6E9  A7          	AND	A
  987 D6EA  20 21       	JR	NZ,INIT4	; LW & Name
  988 D6EC  01 81F1     	LD	BC,LWANF	; 81F1H
  989 D6EF  7E          	LD	A,(HL)
  990 D6F0  ED 79       	OUT	(C),A		; LW-Code
  991 D6F2  23          	INC	HL
  992 D6F3  7E          	LD	A,(HL)
  993 D6F4  FE 3A       	CP	':'
  994 D6F6  3E 03       	LD	A,3		; ohne USER
  995 D6F8  28 0C       	JR	Z,INIT2		; nur LW
  996 D6FA  EB          	EX	DE,HL
  997 D6FB  CD F4DC     	CALL	RHEX
  998 D6FE  3A B797     	LD	A,(NUMVX)
  999 D701  04          	INC	B		; 82F1H
 1000 D702  ED 79       	OUT	(C),A		; User-Bereich
 1001 D704  3E 07       	LD	A,7
 1002 D706  CD D092     INIT2:	CALL	STEUB2
 1003 D709  21 D6C1     INIT3:	LD	HL,UUU		; Dateiname INITIAL.UUU
 1004 D70C  E5          	PUSH	HL
 1005 D70D  E1          INIT4:	POP	HL		; Dateiname
 1006 D70E  CD D080     INIT5:	CALL	FNAM2
 1007 D711  11 B700     	LD	DE,CASS		; Kommando in Kassettenpuffer ablegen
 1008 D714  3E 09       	LD	A,9		; Lesen oeffnen
 1009 D716  CD D097     INIT6:	CALL	STEUER
 1010 D719  0D          	DEC	C		; 80F2H=FDATA
 1011 D71A  ED 78       INIT7:	IN	A,(C)		; Zeichen
 1012 D71C  A7          	AND	A
 1013 D71D  28 13       	JR	Z,INIT8		; 00 ignorieren
 1014 D71F  FE 03       	CP	3
 1015 D721  28 16       	JR	Z,INIT9		; CAOS-Ende
 1016 D723  FE 0A       	CP	0AH
 1017 D725  28 0B       	JR	Z,INIT8		; LF ignorieren
 1018 D727  FE 1A       	CP	1AH
 1019 D729  28 0E       	JR	Z,INIT9		; CP/M-Ende
 1020 D72B  12          	LD	(DE),A
 1021 D72C  1C          	INC	E
 1022 D72D  7B          	LD	A,E
 1023 D72E  FE 7F       	CP	7FH
 1024 D730  28 07       	JR	Z,INIT9		; Puffer voll!
 1025 D732  04          INIT8:	INC	B
 1026 D733  20 E5       	JR	NZ,INIT7	; weiter
 1027 D735  3E 01       	LD	A,1
 1028 D737  18 DD       	JR	INIT6		; neuen Block
 1029 D739  3E 00       INIT9:	LD	A,0
 1030 D73B  12          	LD	(DE),A		; Ende-Kennung anhaengen
 1031 D73C  21 B700     	LD	HL,CASS
 1032 D73F  22 B7D1     	LD	(FTAST),HL	; Aktivierung als ob es
 1033 D742  DD CB 08 F6 	SET	6,(IX+8)	; eine Funktionstaste waere

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  69
CD45    INC

 1034 D746  C9          	RET
 1035                   
 1036 D747  7F7F        	DW	7F7FH
 1037 D749  74 69 6D 65 	DB	'time',1
 1038 D74E  CD D017     	CALL	DISK		; D004 bereit?
 1039 D751  01 83F1     	LD	BC,DEPVER	; 083F1H
 1040 D754  ED 78       	IN	A,(C)
 1041 D756  FE 30       	CP	30H		; DEP ab 3.0?
 1042 D758  30 13       	JR	NC,UHR
 1043 D75A  CD F0D6     	CALL	OSTR
 1044 D75D  4B 65 69 6E 	DB	'Kein DEP 3!'
 1045 D768  07 0D 0A 00 	DB	7,CR,LF,0
 1046 D76C  C9          	RET
 1047 D76D  3E 19       UHR:	LD	A,19H		; Cursor ganz nach links
 1048 D76F  CD F3D5     	CALL	OCHR
 1049 D772  1E 02       	LD	E,2
 1050 D774  01 86F1     	LD	BC,DATE+200H
 1051 D777  ED 78       UHR1:	IN	A,(C)		; Datum aus Koppel-RAM
 1052 D779  CD F3C4     	CALL	AHEX
 1053 D77C  3E 2E       	LD	A,'.'
 1054 D77E  CD F3D5     	CALL	OCHR
 1055 D781  05          	DEC	B
 1056 D782  1D          	DEC	E
 1057 D783  20 F2       	JR	NZ,UHR1
 1058 D785  ED 78       	IN	A,(C)		; Jahr
 1059 D787  FE 78       	CP	78H
 1060 D789  3E 19       	LD	A,19H		; 1978-1999
 1061 D78B  CE 00       	ADC	A,0
 1062 D78D  27          	DAA			; 2000-2077
 1063 D78E  CD F3C4     	CALL	AHEX		; Jahrhundert
 1064 D791  ED 78       	IN	A,(C)
 1065 D793  CD F3C4     	CALL	AHEX		; Jahr
 1066 D796  CD F0D6     	CALL	OSTR
 1067 D799  20 20 00    	DB	'  ',0
 1068 D79C  1E 02       	LD	E,2
 1069 D79E  01 87F1     	LD	BC,TIME
 1070 D7A1  ED 78       UHR2:	IN	A,(C)		; Uhrzeit aus Koppel-RAM
 1071 D7A3  CD F3C4     	CALL	AHEX
 1072 D7A6  3E 3A       	LD	A,':'
 1073 D7A8  CD F3D5     	CALL	OCHR
 1074 D7AB  04          	INC	B
 1075 D7AC  1D          	DEC	E
 1076 D7AD  20 F2       	JR	NZ,UHR2
 1077 D7AF  ED 78       	IN	A,(C)
 1078 D7B1  CD F3C4     	CALL	AHEX
 1079 D7B4  3A B781     	LD	A,(ARGN)	; Parameter angegeben?
 1080 D7B7  A7          	AND	A		; =Dauerlauf?
 1081 D7B8  28 05       	JR	Z,UHR3		; nein!
 1082 D7BA  CD E388     	CALL	BRKT		; BRK?
 1083 D7BD  30 AE       	JR	NC,UHR
 1084 D7BF  C3 F4CC     UHR3:	JP	CRLF
 1085                   
 1086                   ; Quadratwurzel 16Bit A=SQR(HL)
 1087                   
 1088 D7C2  A7          SQRC:	AND	A		; CY=0
 1089 D7C3  11 FFFF     	LD	DE,0FFFFH
 1090 D7C6  13          SQ1:	INC	DE
 1091 D7C7  13          	INC	DE

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  70
CD45    INC

 1092 D7C8  ED 52       	SBC	HL,DE
 1093 D7CA  30 FA       	JR	NC,SQ1
 1094 D7CC  7B          	LD	A,E
 1095 D7CD  CB 3A       	SRL	D
 1096 D7CF  1F          	RRA			; A=RADIUS
 1097 D7D0  C3 FB57     	JP	COFF
 1098                   
 1099                   ; Multiplikation BA=C*D
 1100                   
 1101 D7D3  06 00       MULC:	LD	B,0
 1102 D7D5  1E 09       	LD	E,9
 1103 D7D7  7A          MULC1:	LD	A,D
 1104 D7D8  1F          	RRA
 1105 D7D9  1D          	DEC	E
 1106 D7DA  CA FB57     	JP	Z,COFF
 1107 D7DD  57          	LD	D,A
 1108 D7DE  78          	LD	A,B
 1109 D7DF  30 01       	JR	NC,MULC2
 1110 D7E1  81          	ADD	A,C
 1111 D7E2  1F          MULC2:	RRA
 1112 D7E3  47          	LD	B,A
 1113 D7E4  18 F1       	JR	MULC1 		; 8*
 1114                   
 1115                   ; Anzeige der CAOS-Version mit Datum
 1116                   
 1117 D7E6  7F7F        HELP7F:	DW	7F7FH
 1118 D7E8  68 65 6C 70 	DB	'help'
 1119 D7EC  01          	DB	1
 1120 D7ED  CD F0D6     	CALL	OSTR
 1121 D7F0  20 4B 43 2D 	DB	' KC-Club CAOS 4.5 '
 1122         0000      if beta
 1124                   endif
 1125                   	DATUM			; Versionsdatum
    1 D802  30 36 2E 30 	DB	'06.09.2010'	; Versionsdatum nur hier aendern!
 1126 D80C  0D 0A 00    	DB	CR,LF,0
 1127 D80F  C9          	RET
 1128                   
 1129                   ; Initialisierungstabelle fuer M001 als Centronics-Druckerschnittstelle:
 1130                   ;
 1131 D810  03          DIOINI:	DB	3
 1132 D811  06 02       	 DB	06h,2		; PIO-A Steuerwort
 1133 D813  CF          	  DB	11001111b	; Bitbetrieb
 1134 D814  00          	  DB	00000000b	; alles Ausgaenge
 1135 D815  07 02       	 DB	07h,2		; PIO-B Steuerwort
 1136 D817  CF          	  DB	11001111b	; Bitbetrieb
 1137 D818  FE          	  DB	11111110b	; Bit 0 Ausgang
 1138 D819  05 01       	 DB	05h,1		; PIO-B Daten
 1139 D81B  01          	  DB	00000001b	; Strobe passiv
 1140                   
 1141                   ; Voreingestellte Zuordnung von Joystickfunktionen zu ASCII-Tastencodes
 1142                   ; Tabelle wird bei Power-On in den IRM kopiert, Bereich A894..A89F
 1143                   ; Hinweis: Fire2 ist beim M008 die primaere oder einzige Feuertaste
 1144                   ;
 1145 D81C  02          JOYTBD:	DB	2		; Wartezyklen fuer Tastenwiederholung
 1146 D81D  0B          	DB	0Bh		; Up
 1147 D81E  0A          	DB	0Ah		; Down
 1148 D81F  0D          	DB	CR		; Fire+Fire2
 1149 D820  08          	DB	08h		; Left

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  71
CD45    INC

 1150 D821  00          	DB	0		; Up+Left
 1151 D822  00          	DB	0		; Down+Left
 1152 D823  0D          	DB	CR		; Fire
 1153 D824  09          	DB	09h		; Right
 1154 D825  00          	DB	0		; Up+Right
 1155 D826  00          	DB	0		; Down+Right
 1156 D827  20          	DB	' '		; Fire2
 1157                   
 1158                   ; IBM-Kodierungen fuer allgemeine Druckroutine PRINTC
 1159                   
 1160 D828  7B 7C 7D 7E ZIBM:	DB	7BH,7CH,7DH,7EH
 1161 D82C  5B 5C 5D    	DB	5BH,5CH,5DH
 1162 D82F  84 94 81 E1 	DB	84H,94H,81H,0E1H
 1163 D833  8E 99 9A    	DB	8EH,99H,9AH
 1164                   
 1165                   	ABSFILL	0DAB8h,<ROM-D-Ende>
    7 D836  FF FF FF FF 	  DS	0DAB8h - $,0FFh
  149                   	INCLUDE	ZSIBM.INC	; IBM-Zeichensatz
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 IBM-Zeichensatz	**
    3                   ;**					**
    4                   ;**	Adresse:  DAB8h bis DFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 28.05.2010	**
    7                   ;*****************************************
    8                   
    9 DAB8  78 60 60 60 	DB	078H, 060H, 060H, 060H, 060H, 060H, 078H, 000H	; 5BH
   10 DAC0  C0 60 30 18 	DB	0C0H, 060H, 030H, 018H, 00CH, 006H, 002H, 000H	; 5CH
   11 DAC8  78 18 18 18 	DB	078H, 018H, 018H, 018H, 018H, 018H, 078H, 000H	; 5DH
   12 DAD0  30 30 18 00 	DB	030H, 030H, 018H, 000H, 000H, 000H, 000H, 000H	; 60H
   13 DAD8  1C 30 30 E0 	DB	01CH, 030H, 030H, 0E0H, 030H, 030H, 01CH, 000H	; 7BH
   14 DAE0  18 18 18 00 	DB	018H, 018H, 018H, 000H, 018H, 018H, 018H, 000H	; 7CH
   15 DAE8  E0 30 30 1C 	DB	0E0H, 030H, 030H, 01CH, 030H, 030H, 0E0H, 000H	; 7DH
   16 DAF0  76 DC 00 00 	DB	076H, 0DCH, 000H, 000H, 000H, 000H, 000H, 000H	; 7EH
   17 DAF8  00 10 38 6C 	DB	000H, 010H, 038H, 06CH, 0C6H, 0C6H, 0FEH, 000H	; 7FH
   18                   
   19 DB00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 081H, 0FFH	; 00H
   20 DB08  7E 81 A5 81 	DB	07EH, 081H, 0A5H, 081H, 0BDH, 099H, 081H, 07EH	; 01H
   21 DB10  7E FF DB FF 	DB	07EH, 0FFH, 0DBH, 0FFH, 0C3H, 0E7H, 0FFH, 07EH	; 02H
   22 DB18  6C FE FE FE 	DB	06CH, 0FEH, 0FEH, 0FEH, 07CH, 038H, 010H, 000H	; 03H
   23 DB20  10 38 7C FE 	DB	010H, 038H, 07CH, 0FEH, 07CH, 038H, 010H, 000H	; 04H
   24 DB28  38 7C 38 FE 	DB	038H, 07CH, 038H, 0FEH, 0FEH, 07CH, 038H, 07CH	; 05H
   25 DB30  10 10 38 7C 	DB	010H, 010H, 038H, 07CH, 0FEH, 07CH, 038H, 07CH	; 06H
   26 DB38  00 00 18 3C 	DB	000H, 000H, 018H, 03CH, 03CH, 018H, 000H, 000H	; 07H
   27 DB40  FF FF E7 C3 	DB	0FFH, 0FFH, 0E7H, 0C3H, 0C3H, 0E7H, 0FFH, 0FFH	; 08H
   28 DB48  00 3C 66 42 	DB	000H, 03CH, 066H, 042H, 042H, 066H, 03CH, 000H	; 09H
   29 DB50  FF C3 99 BD 	DB	0FFH, 0C3H, 099H, 0BDH, 0BDH, 099H, 0C3H, 0FFH	; 0AH
   30 DB58  0F 07 0F 7D 	DB	00FH, 007H, 00FH, 07DH, 0CCH, 0CCH, 0CCH, 078H	; 0BH
   31 DB60  3C 66 66 66 	DB	03CH, 066H, 066H, 066H, 03CH, 018H, 07EH, 018H	; 0CH
   32 DB68  3F 33 3F 30 	DB	03FH, 033H, 03FH, 030H, 030H, 070H, 0F0H, 0E0H	; 0DH
   33 DB70  7F 63 7F 63 	DB	07FH, 063H, 07FH, 063H, 063H, 067H, 0E6H, 0C0H	; 0EH
   34 DB78  99 5A 3C E7 	DB	099H, 05AH, 03CH, 0E7H, 0E7H, 03CH, 05AH, 099H	; 0FH
   35                   
   36 DB80  80 E0 F8 FE 	DB	080H, 0E0H, 0F8H, 0FEH, 0F8H, 0E0H, 080H, 000H	; 10H
   37 DB88  02 0E 3E FE 	DB	002H, 00EH, 03EH, 0FEH, 03EH, 00EH, 002H, 000H	; 11H
   38 DB90  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 018H, 07EH, 03CH, 018H	; 12H
   39 DB98  66 66 66 66 	DB	066H, 066H, 066H, 066H, 066H, 000H, 066H, 000H	; 13H
   40 DBA0  7B DB DB 7B 	DB	07BH, 0DBH, 0DBH, 07BH, 01BH, 01BH, 01BH, 000H	; 14H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  72
ZSIBM   INC

   41 DBA8  3C 66 38 6C 	DB	03CH, 066H, 038H, 06CH, 06CH, 038H, 0CCH, 078H	; 15H
   42 DBB0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 07EH, 07EH, 07EH, 000H	; 16H
   43 DBB8  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 07EH, 03CH, 018H, 0FFH	; 17H
   44 DBC0  18 3C 7E 18 	DB	018H, 03CH, 07EH, 018H, 018H, 018H, 018H, 000H	; 18H
   45 DBC8  18 18 18 18 	DB	018H, 018H, 018H, 018H, 07EH, 03CH, 018H, 000H	; 19H
   46 DBD0  00 18 0C FE 	DB	000H, 018H, 00CH, 0FEH, 00CH, 018H, 000H, 000H	; 1AH
   47 DBD8  00 30 60 FE 	DB	000H, 030H, 060H, 0FEH, 060H, 030H, 000H, 000H	; 1BH
   48 DBE0  00 00 C0 C0 	DB	000H, 000H, 0C0H, 0C0H, 0C0H, 0FEH, 000H, 000H	; 1CH
   49 DBE8  00 24 66 FF 	DB	000H, 024H, 066H, 0FFH, 066H, 024H, 000H, 000H	; 1DH
   50 DBF0  00 18 3C 7E 	DB	000H, 018H, 03CH, 07EH, 0FFH, 0FFH, 000H, 000H	; 1EH
   51 DBF8  00 FF FF 7E 	DB	000H, 0FFH, 0FFH, 07EH, 03CH, 018H, 000H, 000H	; 1FH
   52                   
   53 DC00  78 CC C0 C0 	DB	078H, 0CCH, 0C0H, 0C0H, 0CCH, 078H, 010H, 070H	; 80H neu
   54 DC08  00 CC 00 CC 	DB	000H, 0CCH, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 81H neu
   55 DC10  1C 00 78 CC 	DB	01CH, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 82H
   56 DC18  78 84 78 0C 	DB	078H, 084H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 83H neu
   57 DC20  6C 00 78 0C 	DB	06CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 84H neu
   58 DC28  E0 00 78 0C 	DB	0E0H, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 85H neu
   59 DC30  30 30 78 0C 	DB	030H, 030H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 86H neu
   60 DC38  00 78 CC C0 	DB	000H, 078H, 0CCH, 0C0H, 0CCH, 078H, 010H, 070H	; 87H neu
   61 DC40  78 84 78 CC 	DB	078H, 084H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 88H neu
   62 DC48  CC 00 78 CC 	DB	0CCH, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 89H
   63 DC50  E0 00 78 CC 	DB	0E0H, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 8AH
   64 DC58  D8 00 70 30 	DB	0D8H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; 8BH neu
   65 DC60  70 88 70 30 	DB	070H, 088H, 070H, 030H, 030H, 030H, 078H, 000H	; 8CH neu
   66 DC68  E0 00 70 30 	DB	0E0H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; 8DH neu
   67 DC70  CC 30 78 CC 	DB	0CCH, 030H, 078H, 0CCH, 0FCH, 0CCH, 0CCH, 000H	; 8EH
   68 DC78  78 84 30 78 	DB	078H, 084H, 030H, 078H, 0CCH, 0FCH, 0CCH, 000H	; 8FH neu
   69                   
   70 DC80  1C 00 FC 60 	DB	01CH, 000H, 0FCH, 060H, 078H, 060H, 0FCH, 000H	; 90H
   71 DC88  00 00 6C 92 	DB	000H, 000H, 06CH, 092H, 09EH, 090H, 07EH, 000H	; 91H neu
   72 DC90  3E 78 D8 FE 	DB	03EH, 078H, 0D8H, 0FEH, 0D8H, 0D8H, 0DEH, 000H	; 92H neu
   73 DC98  78 84 00 78 	DB	078H, 084H, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 93H neu
   74 DCA0  00 CC 00 78 	DB	000H, 0CCH, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 94H
   75 DCA8  00 E0 00 78 	DB	000H, 0E0H, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; 95H
   76 DCB0  78 84 00 CC 	DB	078H, 084H, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 96H neu
   77 DCB8  00 E0 00 CC 	DB	000H, 0E0H, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; 97H neu
   78 DCC0  00 CC 00 CC 	DB	000H, 0CCH, 000H, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 98H
   79 DCC8  C6 38 6C C6 	DB	0C6H, 038H, 06CH, 0C6H, 0C6H, 06CH, 038H, 000H	; 99H
   80 DCD0  CC 00 CC CC 	DB	0CCH, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 078H, 000H	; 9AH
   81 DCD8  00 10 7C D6 	DB	000H, 010H, 07CH, 0D6H, 0D0H, 0D6H, 07CH, 010H	; 9BH neu
   82 DCE0  38 6C 64 F0 	DB	038H, 06CH, 064H, 0F0H, 060H, 0E6H, 0FCH, 000H	; 9CH
   83 DCE8  66 66 3C 7E 	DB	066H, 066H, 03CH, 07EH, 018H, 07EH, 018H, 018H	; 9DH
   84 DCF0  F8 CC CC FA 	DB	0F8H, 0CCH, 0CCH, 0FAH, 0C6H, 0CFH, 0C6H, 0C7H	; 9EH
   85 DCF8  0E 1B 18 3C 	DB	00EH, 01BH, 018H, 03CH, 018H, 018H, 0D8H, 070H	; 9FH
   86                   
   87 DD00  1C 00 78 0C 	DB	01CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; A0H neu
   88 DD08  38 00 70 30 	DB	038H, 000H, 070H, 030H, 030H, 030H, 078H, 000H	; A1H
   89 DD10  00 1C 00 78 	DB	000H, 01CH, 000H, 078H, 0CCH, 0CCH, 078H, 000H	; A2H
   90 DD18  00 1C 00 CC 	DB	000H, 01CH, 000H, 0CCH, 0CCH, 0CCH, 076H, 000H	; A3H neu
   91 DD20  00 F8 00 F8 	DB	000H, 0F8H, 000H, 0F8H, 0CCH, 0CCH, 0CCH, 000H	; A4H
   92 DD28  FC 00 CC EC 	DB	0FCH, 000H, 0CCH, 0ECH, 0FCH, 0DCH, 0CCH, 000H	; A5H
   93 DD30  00 3C 6C 6C 	DB	000H, 03CH, 06CH, 06CH, 03EH, 000H, 07EH, 000H	; A6H
   94 DD38  00 38 6C 6C 	DB	000H, 038H, 06CH, 06CH, 038H, 000H, 07CH, 000H	; A7H
   95 DD40  30 00 30 18 	DB	030H, 000H, 030H, 018H, 00CH, 0CCH, 078H, 000H	; A8H
   96 DD48  00 00 00 7E 	DB	000H, 000H, 000H, 07EH, 060H, 060H, 000H, 000H	; A9H
   97 DD50  00 00 00 7E 	DB	000H, 000H, 000H, 07EH, 006H, 006H, 000H, 000H	; AAH
   98 DD58  C3 C6 CC DE 	DB	0C3H, 0C6H, 0CCH, 0DEH, 033H, 066H, 0CCH, 00FH	; ABH

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  73
ZSIBM   INC

   99 DD60  C3 C6 CC DB 	DB	0C3H, 0C6H, 0CCH, 0DBH, 037H, 06FH, 0CFH, 003H	; ACH
  100 DD68  30 00 30 30 	DB	030H, 000H, 030H, 030H, 078H, 078H, 030H, 000H	; ADH
  101 DD70  00 33 66 CC 	DB	000H, 033H, 066H, 0CCH, 066H, 033H, 000H, 000H	; AEH
  102 DD78  00 CC 66 33 	DB	000H, 0CCH, 066H, 033H, 066H, 0CCH, 000H, 000H	; AFH
  103                   
  104 DD80  22 88 22 88 	DB	022H, 088H, 022H, 088H, 022H, 088H, 022H, 088H	; B0H
  105 DD88  55 AA 55 AA 	DB	055H, 0AAH, 055H, 0AAH, 055H, 0AAH, 055H, 0AAH	; B1H
  106 DD90  77 DD 77 DD 	DB	077H, 0DDH, 077H, 0DDH, 077H, 0DDH, 077H, 0DDH	; B2H neu
  107 DD98  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 018H, 018H, 018H	; B3H
  108 DDA0  18 18 18 F8 	DB	018H, 018H, 018H, 0F8H, 018H, 018H, 018H, 018H	; B4H
  109 DDA8  18 18 F8 18 	DB	018H, 018H, 0F8H, 018H, 0F8H, 018H, 018H, 018H	; B5H
  110 DDB0  36 36 36 F6 	DB	036H, 036H, 036H, 0F6H, 036H, 036H, 036H, 036H	; B6H
  111 DDB8  00 00 00 FE 	DB	000H, 000H, 000H, 0FEH, 036H, 036H, 036H, 036H	; B7H
  112 DDC0  00 00 F8 18 	DB	000H, 000H, 0F8H, 018H, 0F8H, 018H, 018H, 018H	; B8H
  113 DDC8  36 36 F6 06 	DB	036H, 036H, 0F6H, 006H, 0F6H, 036H, 036H, 036H	; B9H
  114 DDD0  36 36 36 36 	DB	036H, 036H, 036H, 036H, 036H, 036H, 036H, 036H	; BAH
  115 DDD8  00 00 FE 06 	DB	000H, 000H, 0FEH, 006H, 0F6H, 036H, 036H, 036H	; BBH
  116 DDE0  36 36 F6 06 	DB	036H, 036H, 0F6H, 006H, 0FEH, 000H, 000H, 000H	; BCH
  117 DDE8  36 36 36 FE 	DB	036H, 036H, 036H, 0FEH, 000H, 000H, 000H, 000H	; BDH
  118 DDF0  18 18 F8 18 	DB	018H, 018H, 0F8H, 018H, 0F8H, 000H, 000H, 000H	; BEH
  119 DDF8  00 00 00 F8 	DB	000H, 000H, 000H, 0F8H, 018H, 018H, 018H, 018H	; BFH
  120                   
  121 DE00  18 18 18 1F 	DB	018H, 018H, 018H, 01FH, 000H, 000H, 000H, 000H	; C0H
  122 DE08  18 18 18 FF 	DB	018H, 018H, 018H, 0FFH, 000H, 000H, 000H, 000H	; C1H
  123 DE10  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 018H, 018H, 018H, 018H	; C2H
  124 DE18  18 18 18 1F 	DB	018H, 018H, 018H, 01FH, 018H, 018H, 018H, 018H	; C3H
  125 DE20  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 000H, 000H, 000H, 000H	; C4H
  126 DE28  18 18 18 FF 	DB	018H, 018H, 018H, 0FFH, 018H, 018H, 018H, 018H	; C5H
  127 DE30  18 18 1F 18 	DB	018H, 018H, 01FH, 018H, 01FH, 018H, 018H, 018H	; C6H
  128 DE38  36 36 36 37 	DB	036H, 036H, 036H, 037H, 036H, 036H, 036H, 036H	; C7H
  129 DE40  36 36 37 30 	DB	036H, 036H, 037H, 030H, 03FH, 000H, 000H, 000H	; C8H
  130 DE48  00 00 3F 30 	DB	000H, 000H, 03FH, 030H, 037H, 036H, 036H, 036H	; C9H
  131 DE50  36 36 F7 00 	DB	036H, 036H, 0F7H, 000H, 0FFH, 000H, 000H, 000H	; CAH
  132 DE58  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0F7H, 036H, 036H, 036H	; CBH
  133 DE60  36 36 37 30 	DB	036H, 036H, 037H, 030H, 037H, 036H, 036H, 036H	; CCH
  134 DE68  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0FFH, 000H, 000H, 000H	; CDH
  135 DE70  36 36 F7 00 	DB	036H, 036H, 0F7H, 000H, 0F7H, 036H, 036H, 036H	; CEH
  136 DE78  18 18 FF 00 	DB	018H, 018H, 0FFH, 000H, 0FFH, 000H, 000H, 000H	; CFH
  137                   
  138 DE80  36 36 36 FF 	DB	036H, 036H, 036H, 0FFH, 000H, 000H, 000H, 000H	; D0H
  139 DE88  00 00 FF 00 	DB	000H, 000H, 0FFH, 000H, 0FFH, 018H, 018H, 018H	; D1H
  140 DE90  00 00 00 FF 	DB	000H, 000H, 000H, 0FFH, 036H, 036H, 036H, 036H	; D2H
  141 DE98  36 36 36 3F 	DB	036H, 036H, 036H, 03FH, 000H, 000H, 000H, 000H	; D3H
  142 DEA0  18 18 1F 18 	DB	018H, 018H, 01FH, 018H, 01FH, 000H, 000H, 000H	; D4H
  143 DEA8  00 00 1F 18 	DB	000H, 000H, 01FH, 018H, 01FH, 018H, 018H, 018H	; D5H
  144 DEB0  00 00 00 3F 	DB	000H, 000H, 000H, 03FH, 036H, 036H, 036H, 036H	; D6H
  145 DEB8  36 36 36 FF 	DB	036H, 036H, 036H, 0FFH, 036H, 036H, 036H, 036H	; D7H
  146 DEC0  18 18 FF 18 	DB	018H, 018H, 0FFH, 018H, 0FFH, 018H, 018H, 018H	; D8H
  147 DEC8  18 18 18 F8 	DB	018H, 018H, 018H, 0F8H, 000H, 000H, 000H, 000H	; D9H
  148 DED0  00 00 00 1F 	DB	000H, 000H, 000H, 01FH, 018H, 018H, 018H, 018H	; DAH
  149 DED8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH	; DBH
  150 DEE0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 0FFH, 0FFH, 0FFH, 0FFH	; DCH
  151 DEE8  F0 F0 F0 F0 	DB	0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H, 0F0H	; DDH
  152 DEF0  0F 0F 0F 0F 	DB	00FH, 00FH, 00FH, 00FH, 00FH, 00FH, 00FH, 00FH	; DEH
  153 DEF8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 000H, 000H, 000H, 000H	; DFH
  154                   
  155 DF00  00 00 76 DC 	DB	000H, 000H, 076H, 0DCH, 0CCH, 0DCH, 076H, 000H	; E0H
  156 DF08  3C 66 66 6C 	DB	03CH, 066H, 066H, 06CH, 066H, 066H, 06CH, 0F0H	; E1H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  74
ZSIBM   INC

  157 DF10  FE 62 60 60 	DB	0FEH, 062H, 060H, 060H, 060H, 060H, 0F0H, 000H	; E2H
  158 DF18  00 FE 6C 6C 	DB	000H, 0FEH, 06CH, 06CH, 06CH, 06CH, 06EH, 000H	; E3H
  159 DF20  7E 62 30 18 	DB	07EH, 062H, 030H, 018H, 030H, 062H, 07EH, 000H	; E4H
  160 DF28  00 00 7E D8 	DB	000H, 000H, 07EH, 0D8H, 0D8H, 0D8H, 070H, 000H	; E5H
  161 DF30  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 0F6H, 0C0H, 0C0H	; E6H neu
  162 DF38  00 7E D8 18 	DB	000H, 07EH, 0D8H, 018H, 018H, 018H, 018H, 000H	; E7H
  163 DF40  3C 18 3C 66 	DB	03CH, 018H, 03CH, 066H, 066H, 03CH, 018H, 03CH	; E8H
  164 DF48  38 6C C6 FE 	DB	038H, 06CH, 0C6H, 0FEH, 0C6H, 06CH, 038H, 000H	; E9H
  165 DF50  38 6C C6 C6 	DB	038H, 06CH, 0C6H, 0C6H, 06CH, 06CH, 0EEH, 000H	; EAH
  166 DF58  1C 30 18 7C 	DB	01CH, 030H, 018H, 07CH, 0CCH, 0CCH, 078H, 000H	; EBH
  167 DF60  00 6C FE 92 	DB	000H, 06CH, 0FEH, 092H, 0FEH, 06CH, 000H, 000H	; ECH neu
  168 DF68  03 7E CC DE 	DB	003H, 07EH, 0CCH, 0DEH, 0F6H, 066H, 0FCH, 080H	; EDH neu
  169 DF70  3C 60 C0 FC 	DB	03CH, 060H, 0C0H, 0FCH, 0C0H, 060H, 03CH, 000H	; EEH neu
  170 DF78  3C 66 66 66 	DB	03CH, 066H, 066H, 066H, 066H, 066H, 066H, 000H	; EFH
  171                   
  172 DF80  00 7E 00 7E 	DB	000H, 07EH, 000H, 07EH, 000H, 07EH, 000H, 000H	; F0H
  173 DF88  18 18 7E 18 	DB	018H, 018H, 07EH, 018H, 018H, 000H, 07EH, 000H	; F1H
  174 DF90  30 18 0C 18 	DB	030H, 018H, 00CH, 018H, 030H, 000H, 07EH, 000H	; F2H
  175 DF98  0C 18 30 18 	DB	00CH, 018H, 030H, 018H, 00CH, 000H, 07EH, 000H	; F3H
  176 DFA0  0E 1B 1B 18 	DB	00EH, 01BH, 01BH, 018H, 018H, 018H, 018H, 018H	; F4H
  177 DFA8  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 0D8H, 0D8H, 070H	; F5H
  178 DFB0  18 18 00 7E 	DB	018H, 018H, 000H, 07EH, 000H, 018H, 018H, 000H	; F6H
  179 DFB8  00 76 DC 00 	DB	000H, 076H, 0DCH, 000H, 076H, 0DCH, 000H, 000H	; F7H
  180 DFC0  38 6C 6C 38 	DB	038H, 06CH, 06CH, 038H, 000H, 000H, 000H, 000H	; F8H
  181 DFC8  00 00 00 18 	DB	000H, 000H, 000H, 018H, 018H, 000H, 000H, 000H	; F9H
  182 DFD0  00 00 00 00 	DB	000H, 000H, 000H, 000H, 018H, 000H, 000H, 000H	; FAH
  183 DFD8  0F 0C 0C 0C 	DB	00FH, 00CH, 00CH, 00CH, 0CCH, 06CH, 03CH, 01CH	; FBH
  184 DFE0  78 6C 6C 6C 	DB	078H, 06CH, 06CH, 06CH, 06CH, 000H, 000H, 000H	; FCH
  185 DFE8  70 18 30 60 	DB	070H, 018H, 030H, 060H, 078H, 000H, 000H, 000H	; FDH
  186 DFF0  00 00 3C 3C 	DB	000H, 000H, 03CH, 03CH, 03CH, 03CH, 000H, 000H	; FEH
  187 DFF8  FF 81 81 81 	DB	0FFH, 081H, 081H, 081H, 081H, 081H, 081H, 0FFH	; FFH
  150                   
  151                   	INCLUDE	CE45.INC	; ROM-E (E000-EDFF)
    1                   ;*****************************************
    2                   ;**	CAOS 4.5	ROM E		**
    3                   ;**					**
    4                   ;**	Adresse:  E000h bis EDFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 18.08.2010	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0E000H
   10                   
   11 E000  C3 F154     	JP	BYE		; Tasten-RESET
   12 E003  C3 E5FE     	JP	BEXP1		; BASIC-Erweiterung 1
   13 E006  C3 E612     	JP	BEXP2		; BASIC-Erweiterung 2
   14 E009  C3 EC5B     	JP	BEXP3		; BASIC-Erweiterung 3
   15 E00C  FCF5        	DW	TOKTAB		; Token-Tabelle der Erweiterungen
   16 E00E  C3 F838     BASIO:	JP	BASPV		; BASIC Programmverteiler
   17                   
   18 E011  7F7F        	DW	7F7FH
   19 E013  42 41 53 49 	DB	'BASIC'
   20 E018  11          	DB	11H
   21 E019  CD E02F     	CALL	BASON
   22 E01C  C3 C00D     	JP	PRIST		; BASIC-Kaltstart
   23                   
   24 E01F  7F7F        	DW	7F7FH
   25 E021  52 45 42 41 	DB	'REBASIC'

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  75
CE45    INC

   26 E028  11          	DB	11H
   27 E029  CD E02F     	CALL	BASON
   28 E02C  C3 C08C     	JP	SECST		; BASIC-Warmstart
   29                   
   30                   ; BASIC vorbereiten:
   31                   
   32 E02F  01 B3F3     BASON:	LD	BC,UROK		; 0B3F3H
   33 E032  ED 78       	IN	A,(C)
   34 E034  FE 05       	CP	5		; D004 KC-Betriebsart?
   35 E036  20 06       	JR	NZ,BASO1
   36 E038  CD FB4A     	CALL	CON
   37 E03B  CD D0D8     	CALL	BASEX		; DISK-Treiber aktivieren
   38 E03E  16 00       BASO1:	LD	D,0
   39 E040  3E 02       	LD	A,2
   40 E042  2E 05       	LD	L,5		; SWITCH 5 0
   41 E044  CD F0FD     	CALL	MODU		; CAOS-C aus
   42 E047  16 C1       	LD	D,0C1H
   43 E049  3E 02       	LD	A,2
   44 E04B  6F          	LD	L,A		; SWITCH 2 C1
   45 E04C  CD F0FD     	CALL	MODU		; BASIC-Ebene einschalten
   46 E04F  C3 F045     	JP	SCROFF		; IRM aus
   47                   
   48                   ; CRT-Treiber:
   49                   
   50 E052  ED 5B B7A0  PADR0:	LD	DE,(CURSO)
   51 E056  2A B79C     PADR1:	LD	HL,(WINON)
   52 E059  19          	ADD	HL,DE
   53 E05A  CB 24       	SLA	H
   54 E05C  CB 24       	SLA	H
   55 E05E  CB 24       	SLA	H
   56                   	;
   57 E060  F5          PADR:	PUSH	AF		; **34**
   58 E061  7D          	LD	A,L		; Spalte
   59 E062  6C          	LD	L,H		; Pixelzeile
   60 E063  FE 28       	CP	28H
   61 E065  30 06       	JR	NC,IAD2		; zu gross
   62 E067  F6 80       	OR	80H
   63 E069  67          	LD	H,A		; HL=Pixeladresse
   64 E06A  F1          	POP	AF
   65 E06B  A7          	AND	A		; CY=0
   66 E06C  C9          	RET
   67 E06D  F1          IAD2:	POP	AF
   68 E06E  37          	SCF			; CY=1
   69 E06F  C9          	RET
   70                   
   71                   ; Test Cursor im Fenster
   72                   
   73 E070  3A B79E     TCIF:	LD	A,(WINLG)	; **33**
   74 E073  3D          	DEC	A
   75 E074  93          	SUB	E		; Cursor-Spalte
   76 E075  D8          	RET	C
   77 E076  3A B79F     	LD	A,(WINLG+1)
   78 E079  3D          	DEC	A
   79 E07A  92          	SUB	D		; Cursor-Zeile
   80 E07B  C9          	RET
   81                   
   82 E07C  F5          DABR:	PUSH	AF		; **32**
   83 E07D  CD E070     	CALL	TCIF

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  76
CE45    INC

   84 E080  38 EB       	JR	C,IAD2
   85 E082  3A B79C     	LD	A,(WINON)
   86 E085  83          	ADD	A,E		; Cursor-Spalte
   87 E086  D5          	PUSH	DE
   88 E087  5F          	LD	E,A		; absolut
   89 E088  3A B79D     	LD	A,(WINON+1)
   90 E08B  82          	ADD	A,D		; Cursor-Zeile
   91 E08C  87          	ADD	A,A
   92 E08D  87          	ADD	A,A
   93 E08E  87          	ADD	A,A		; *8
   94 E08F  6F          	LD	L,A		; Pixelzeile
   95 E090  26 00       	LD	H,0
   96 E092  54          	LD	D,H		; D=0
   97 E093  29          	ADD	HL,HL
   98 E094  29          	ADD	HL,HL		; *4
   99 E095  19          	ADD	HL,DE		; *5, zus. *40
  100 E096  5F          	LD	E,A
  101 E097  3A B7CC     	LD	A,(VRAM+1)
  102 E09A  57          	LD	D,A
  103 E09B  19          	ADD	HL,DE
  104 E09C  D1          	POP	DE
  105 E09D  F1          	POP	AF
  106 E09E  A7          	AND	A
  107 E09F  C9          	RET
  108                   
  109 E0A0  E5          CRT:	PUSH	HL		; **00**
  110 E0A1  D5          	PUSH	DE
  111 E0A2  C5          	PUSH	BC
  112 E0A3  F5          	PUSH	AF
  113 E0A4  CD E18C     	CALL	PCHR
  114 E0A7  ED 53 B7A0  	LD	(CURSO),DE
  115 E0AB  F1          POP4:	POP	AF
  116 E0AC  C1          	POP	BC
  117 E0AD  D1          	POP	DE
  118 E0AE  E1          	POP	HL
  119 E0AF  C9          	RET
  120                   
  121                   ; Zeichen auf Grafikbildschirm sichtbar machen
  122                   ; PE:	DE, A, STBT
  123                   
  124 E0B0  E5          WPIX:	PUSH	HL
  125 E0B1  D5          	PUSH	DE
  126 E0B2  C5          	PUSH	BC
  127 E0B3  F5          	PUSH	AF
  128 E0B4  4F          	LD	C,A		; Zeichen
  129 E0B5  2A B79C     	LD	HL,(WINON)
  130 E0B8  19          	ADD	HL,DE
  131 E0B9  EB          	EX	DE,HL		; DE:absolute Cursorposition
  132 E0BA  7B          	LD	A,E
  133 E0BB  FE 28       	CP	28H
  134 E0BD  30 EC       	JR	NC,POP4		; ausserhalb!
  135 E0BF  21 B7A2     	LD	HL,STBT
  136 E0C2  CB 6E       	BIT	5,(HL)		; IBM?
  137 E0C4  20 63       	JR	NZ,WPX14
  138 E0C6  79          	LD	A,C
  139 E0C7  21 B7A6     	LD	HL,CCTL0
  140 E0CA  87          	ADD	A,A		; *2
  141 E0CB  30 02       	JR	NC,WPX04

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  77
CE45    INC

  142 E0CD  2E AA       	LD	L,LOW(CCTL2)
  143 E0CF  D6 40       WPX04:	SUB	40H
  144 E0D1  F2 E0D8     	JP	P,WPX06		; CCTL0/2
  145 E0D4  2C          	INC	L
  146 E0D5  2C          	INC	L		; CCTL1/3
  147 E0D6  EE C0       	XOR	0C0H
  148 E0D8  4E          WPX06:	LD	C,(HL)
  149 E0D9  2C          	INC	L		; BC=(CCTL)
  150 E0DA  46          	LD	B,(HL)
  151 E0DB  87          	ADD	A,A		; *4
  152 E0DC  6F          	LD	L,A
  153 E0DD  26 00       	LD	H,0
  154 E0DF  29          WPX07:	ADD	HL,HL		; *8
  155 E0E0  09          	ADD	HL,BC		; HL=Pixelmuster
  156 E0E1  7A          	LD	A,D
  157 E0E2  87          	ADD	A,A
  158 E0E3  87          	ADD	A,A
  159 E0E4  87          	ADD	A,A
  160 E0E5  53          	LD	D,E
  161 E0E6  5F          	LD	E,A
  162 E0E7  CB FA       	SET	7,D		; DE=IRM-Adresse
  163 E0E9  ED 4B B7A2  	LD	BC,(STBT)
  164 E0ED  CB 49       	BIT	1,C
  165 E0EF  20 16       	JR	NZ,WPIXNC	; Farbe AUS
  166 E0F1  CD F943     	CALL	ESC9
  167 E0F4  DD CB 01 5E 	BIT	3,(IX+1)
  168 E0F8  20 04       	JR	NZ,WPIXA	; LORES
  169 E0FA  CB 71       	BIT	6,C
  170 E0FC  20 38       	JR	NZ,WPIXH1	; HRG-Modus
  171 E0FE  78          WPIXA:	LD	A,B		; Farbe
  172 E0FF  43          	LD	B,E
  173 E100  CD E17C     	CALL	WCOLOR		; 8 Farbbytes
  174 E103  58          	LD	E,B
  175 E104  CD F943     WPIXHE:	CALL	ESC9
  176 E107  CB 41       WPIXNC:	BIT	0,C
  177 E109  20 12       	JR	NZ,WPX11	; Farbe AUS
  178 E10B  DD CB 01 5E 	BIT	3,(IX+1)
  179 E10F  20 04       	JR	NZ,WPIXB	; LORES
  180 E111  CB 71       	BIT	6,C
  181 E113  20 2C       	JR	NZ,WPIXH2	; HRG-Modus
  182 E115  CB 51       WPIXB:	BIT	2,C
  183 E117  CC E15B     	CALL	Z,WPIXEL	; normal
  184 E11A  C4 E16E     	CALL	NZ,WPIXI	; invers
  185 E11D  CB 69       WPX11:	BIT	5,C		; IBM?
  186 E11F  28 8A       	JR	Z,POP4		; nein
  187 E121  F1          	POP	AF
  188 E122  DD 77 04    	LD	(IX+4),A	; CAOS-C
  189 E125  D3 86       	OUT	(86H),A		; wie vorher
  190 E127  18 82       	JR	POP4		; POP	AF,BC,DE,HL   RET
  191                   
  192 E129  DD 7E 04    WPX14:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  193 E12C  F5          	PUSH	AF		; merken
  194                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E12D  DD CB 04    	 DB	0DDh,0CBh,4
    2 E130  FF          	 DB	7 SHL 3 OR 11000111b
  195 E131  D3 86       	OUT	(86h),A		; CAOS-C ein
  196 E133  C3 D1D8     	JP	WPIXD		; Springe zu CAOS-D-Block
  197                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  78
CE45    INC

  198                   ; Farbebene im HRG-Modus
  199 E136  78          WPIXH1:	LD	A,B
  200 E137  0F          	RRCA
  201 E138  E5          	PUSH	HL
  202 E139  D5          	PUSH	DE
  203 E13A  CD E14B     	CALL	WPHRG
  204 E13D  D1          	POP	DE
  205 E13E  E1          	POP	HL
  206 E13F  18 C3       	JR	WPIXHE
  207                   
  208                   ; Pixelebene im HRG-Modus
  209 E141  78          WPIXH2:	LD	A,B
  210 E142  E5          	PUSH	HL
  211 E143  D5          	PUSH	DE
  212 E144  CD E14B     	CALL	WPHRG
  213 E147  D1          	POP	DE
  214 E148  E1          	POP	HL
  215 E149  18 D2       	JR	WPX11
  216                   
  217                   ; Reaktion im HRG-Modus
  218 E14B  E6 09       WPHRG:	AND	00001001b	; Bits 0,3
  219 E14D  28 2D       	JR	Z,WCOLOR	; beide 0: Ebene ruecksetzen
  220 E14F  EA E17A     	JP	PE,COLFF	; beide 1: Ebene setzen
  221 E152  CB 51       	BIT	2,C
  222 E154  28 02       	JR	Z,WPHN
  223 E156  EE 09       	XOR	00001001b	; invers
  224 E158  3D          WPHN:	DEC	A
  225 E159  28 13       	JR	Z,WPIXI		; Pixel invers
  226 E15B  C5          WPIXEL:	PUSH	BC
  227 E15C  ED A0       	LDI			; 8 Pixelbytes kopieren
  228 E15E  ED A0       	LDI			; ohne Schleife - schneller!
  229 E160  ED A0       	LDI
  230 E162  ED A0       	LDI
  231 E164  ED A0       	LDI
  232 E166  ED A0       	LDI
  233 E168  ED A0       	LDI
  234 E16A  ED A0       	LDI
  235 E16C  C1          	POP	BC
  236 E16D  C9          	RET
  237                   
  238 E16E  C5          WPIXI:	PUSH	BC
  239 E16F  06 08       	LD	B,8		; 8 Pixelmuster
  240 E171  7E          WPIXI1:	LD	A,(HL)		; invers
  241 E172  2F          	CPL
  242 E173  12          	LD	(DE),A
  243 E174  23          	INC	HL
  244 E175  1C          	INC	E
  245 E176  10 F9       	DJNZ	WPIXI1
  246 E178  C1          	POP	BC
  247 E179  C9          	RET
  248                   
  249 E17A  3E FF       COLFF:	LD	A,0FFH
  250 E17C  12          WCOLOR:	LD	(DE),A		; 8 Farbbytes
  251 E17D  1C          	INC	E
  252 E17E  12          	LD	(DE),A
  253 E17F  1C          	INC	E
  254 E180  12          	LD	(DE),A
  255 E181  1C          	INC	E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  79
CE45    INC

  256 E182  12          	LD	(DE),A
  257 E183  1C          	INC	E
  258 E184  12          	LD	(DE),A
  259 E185  1C          	INC	E
  260 E186  12          	LD	(DE),A
  261 E187  1C          	INC	E
  262 E188  12          	LD	(DE),A
  263 E189  1C          	INC	E
  264 E18A  12          	LD	(DE),A
  265 E18B  C9          	RET
  266                   
  267                   ; CRT-Grundprogramm
  268                   
  269 E18C  ED 5B B7A0  PCHR:	LD	DE,(CURSO)
  270 E190  21 B7A2     	LD	HL,STBT
  271 E193  CB 66       	BIT	4,(HL)		; ESC aktiv?
  272 E195  28 22       	JR	Z,PCHR3
  273 E197  CB A6       CRT1:	RES	4,(HL)
  274 E199  FE 30       	CP	'0'
  275 E19B  D8          	RET	C
  276 E19C  FE 3A       	CP	'9'+1
  277 E19E  30 04       	JR	NC,PCHR1
  278 E1A0  D6 30       	SUB	'0'
  279 E1A2  18 0A       	JR	PCHR2
  280                   	;
  281 E1A4  FE 41       PCHR1:	CP	'A'
  282 E1A6  D8          	RET	C
  283 E1A7  CB AF       	RES	5,A
  284 E1A9  FE 5B       	CP	'Z'+1
  285 E1AB  D0          	RET	NC
  286 E1AC  D6 37       	SUB	'A'-10
  287 E1AE  21 B7DF     PCHR2:	LD	HL,L3SIZ	; Tabelle
  288 E1B1  BE          	CP	(HL)		; lang genug?
  289 E1B2  D0          	RET	NC
  290 E1B3  87          	ADD	A,A		; *2
  291 E1B4  2A B7DD     	LD	HL,(L3TAB)	; klar zum Ansprung
  292 E1B7  18 0C       	JR	PCHR4
  293                   	;
  294 E1B9  FE 20       PCHR3:	CP	20H		; Steuerfunktion?
  295 E1BB  30 18       	JR	NC,PCHR5
  296 E1BD  CB 5E       	BIT	3,(HL)		; darstellen?
  297 E1BF  20 14       	JR	NZ,PCHR5
  298 E1C1  87          	ADD	A,A		; *2
  299 E1C2  2A B7B2     	LD	HL,(CTAB)
  300 E1C5  4F          PCHR4:	LD	C,A
  301 E1C6  06 00       	LD	B,0
  302 E1C8  09          	ADD	HL,BC
  303 E1C9  7E          	LD	A,(HL)
  304 E1CA  23          	INC	HL
  305 E1CB  66          	LD	H,(HL)
  306 E1CC  6F          	LD	L,A
  307 E1CD  E9          JPHL:	JP	(HL)		; anspringen
  308                   
  309 E1CE  7B          ESC0:	LD	A,E		; Tabulator
  310 E1CF  F6 07       	OR	7		; 8er Schrittweite
  311 E1D1  3C          	INC	A
  312 E1D2  5F          	LD	E,A
  313 E1D3  18 09       	JR	CUR1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  80
CE45    INC

  314                   	;
  315 E1D5  CD E07C     PCHR5:	CALL	DABR
  316 E1D8  D8          	RET	C		; ausserhalb
  317 E1D9  77          	LD	(HL),A		; ASCII eintragen
  318 E1DA  CD E0B0     	CALL	WPIX		; darstellen
  319 E1DD  1C          CUR:	INC	E
  320 E1DE  3A B79E     CUR1:	LD	A,(WINLG)
  321 E1E1  3D          	DEC	A
  322 E1E2  BB          	CP	E
  323 E1E3  D0          	RET	NC
  324 E1E4  1E 00       NL:	LD	E,0		; NL fuer 1E
  325 E1E6  14          CUD:	INC	D
  326 E1E7  3A B79F     	LD	A,(WINLG+1)
  327 E1EA  BA          	CP	D
  328 E1EB  C0          	RET	NZ
  329 E1EC  2A B7A4     	LD	HL,(WEND)
  330 E1EF  E9          	JP	(HL)		; PAGE oder SCROLL
  331                   
  332 E1F0  2A B799     HCOPY:	LD	HL,(HCADR)	; ShCLR
  333 E1F3  E9          	JP	(HL)
  334                   
  335 E1F4  7B          CUL:	LD	A,E
  336 E1F5  A7          	AND	A
  337 E1F6  28 02       	JR	Z,CUL1
  338 E1F8  1D          	DEC	E
  339 E1F9  C9          	RET
  340                   
  341 E1FA  7A          CUL1:	LD	A,D
  342 E1FB  A7          	AND	A
  343 E1FC  C8          	RET	Z
  344 E1FD  15          	DEC	D
  345 E1FE  3A B79E     CEL:	LD	A,(WINLG)
  346 E201  3D          	DEC	A
  347 E202  5F          	LD	E,A
  348 E203  C9          	RET
  349                   
  350 E204  7A          CUU:	LD	A,D
  351 E205  A7          	AND	A
  352 E206  C8          	RET	Z
  353 E207  15          	DEC	D
  354 E208  C9          	RET
  355                   
  356 E209  21 E278     PAGEM:	LD	HL,HOMEPG	; ShCUU
  357 E20C  22 B7A4     WADR:	LD	(WEND),HL
  358 E20F  C9          	RET
  359                   
  360 E210  21 E27D     SCROL:	LD	HL,SCRLPG	; ShCUD
  361 E213  18 F7       	JR	WADR
  362                   
  363 E215  CD E1F4     CLR:	CALL	CUL
  364 E218  D5          DEL:	PUSH	DE		; Cursor retten
  365 E219  CD E07C     	CALL	DABR
  366 E21C  7E          	LD	A,(HL)
  367 E21D  A7          	AND	A		; Ende?
  368 E21E  28 29       	JR	Z,POPDE
  369 E220  E5          	PUSH	HL		; VRAM
  370 E221  D5          DEL1:	PUSH	DE		; Cursor
  371 E222  1C          	INC	E		; naechste Spalte

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  81
CE45    INC

  372 E223  CD E07C     	CALL	DABR		; raus?
  373 E226  30 08       	JR	NC,DEL2
  374 E228  1E 00       	LD	E,0		; ja, wie NL
  375 E22A  14          	INC	D
  376 E22B  CD E07C     	CALL	DABR		; raus?
  377 E22E  38 10       	JR	C,DEL3		; ja-wie Ende
  378 E230  7E          DEL2:	LD	A,(HL)
  379 E231  A7          	AND	A		; Ende?
  380 E232  28 0C       	JR	Z,DEL3
  381 E234  42          	LD	B,D
  382 E235  4B          	LD	C,E		; BC:=DE
  383 E236  D1          	POP	DE		; DE=links davon
  384 E237  E3          	EX	(SP),HL		; HL=VRAM links
  385 E238  77          	LD	(HL),A		; eintragen
  386 E239  CD E0B0     	CALL	WPIX		; zeichnen
  387 E23C  50          	LD	D,B
  388 E23D  59          	LD	E,C		; DE:=BC
  389 E23E  18 E1       	JR	DEL1		; von vorn
  390                   
  391 E240  D1          DEL3:	POP	DE
  392 E241  E1          	POP	HL
  393 E242  36 00       	LD	(HL),0
  394 E244  3E 20       	LD	A,' '
  395 E246  CD E0B0     	CALL	WPIX
  396 E249  D1          POPDE:	POP	DE
  397 E24A  C9          	RET
  398                   
  399 E24B  D5          INS:	PUSH	DE		; Cursor
  400 E24C  3E 20       	LD	A,' '
  401 E24E  CD E07C     	CALL	DABR
  402 E251  46          INS1:	LD	B,(HL)		; VRAM
  403 E252  77          	LD	(HL),A		; neues Zeichen
  404 E253  CD E0B0     	CALL	WPIX		; zeichnen
  405 E256  78          	LD	A,B
  406 E257  A7          	AND	A		; Dummy?
  407 E258  28 0E       	JR	Z,INS2
  408 E25A  1C          	INC	E		; CUR
  409 E25B  CD E07C     	CALL	DABR		; raus?
  410 E25E  30 F1       	JR	NC,INS1
  411 E260  1E 00       	LD	E,0		; wie NL
  412 E262  14          	INC	D
  413 E263  CD E07C     	CALL	DABR		; raus?
  414 E266  30 E9       	JR	NC,INS1
  415 E268  D1          INS2:	POP	DE		; wenn ja Schluss
  416 E269  C9          	RET
  417                   
  418 E26A  3A B79F     CLS:	LD	A,(WINLG+1) 	; ShHOME
  419 E26D  16 00       	LD	D,0
  420 E26F  F5          CLS1:	PUSH	AF
  421 E270  CD E28C     	CALL	CLLN
  422 E273  F1          	POP	AF
  423 E274  14          	INC	D
  424 E275  3D          	DEC	A
  425 E276  20 F7       	JR	NZ,CLS1		; A Zeilen
  426 E278  16 00       HOMEPG:	LD	D,0
  427 E27A  1E 00       CBL:	LD	E,0
  428 E27C  C9          	RET
  429                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  82
CE45    INC

  430 E27D  DD 7E 04    SCRLPG:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  431 E280  F5          	PUSH	AF		; merken
  432                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E281  DD CB 04    	 DB	0DDh,0CBh,4
    2 E284  FF          	 DB	7 SHL 3 OR 11000111b
  433 E285  D3 86       	OUT	(86h),A		; CAOS-C ein
  434 E287  CD D258     	CALL	SCRLD		; weiter im CAOS-D-Segment
  435 E28A  18 0D       	JR	CCRES
  436                   
  437 E28C  DD 7E 04    CLLN:	LD	A,(IX+4)	; CAOS-C-Schaltzustand
  438 E28F  F5          	PUSH	AF		; merken
  439                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 E290  DD CB 04    	 DB	0DDh,0CBh,4
    2 E293  FF          	 DB	7 SHL 3 OR 11000111b
  440 E294  D3 86       	OUT	(86h),A		; CAOS-C ein
  441 E296  CD D29F     	CALL	CLLND		; weiter im CAOS-D-Segment
  442 E299  F1          CCRES:	POP	AF
  443 E29A  DD 77 04    	LD	(IX+4),A	; CAOS-C
  444 E29D  D3 86       	OUT	(86h),A		; wie vorher
  445 E29F  C9          	RET
  446                   
  447 E2A0  01 0A0F     BEEP:	LD	BC,0A0FH	; B=Dauer, C=Lautstaerke
  448 E2A3  21 0030     	LD	HL,48
  449 E2A6  D5          	PUSH	DE
  450 E2A7  5C          	LD	E,H		; E=0
  451 E2A8  CD F8CA     	CALL	TON2
  452 E2AB  3E 1E       	LD	A,1EH
  453 E2AD  CD F37B     	CALL	WAIT
  454 E2B0  3E 03       	LD	A,3
  455 E2B2  D3 8C       	OUT	(CTC0),A
  456 E2B4  3E 10       	LD	A,10H
  457 E2B6  D1          	POP	DE
  458 E2B7  C3 F37B     	JP	WAIT
  459                   
  460 E2BA  01 0307     CLIK:	LD	BC,0307H	; B=Dauer, C=Lautstaerke
  461 E2BD  21 0024     	LD	HL,36
  462 E2C0  D5          	PUSH	DE
  463 E2C1  5C          	LD	E,H		; E=0
  464 E2C2  CD F8CA     	CALL	TON2
  465 E2C5  D1          	POP	DE
  466 E2C6  C9          	RET
  467                   
  468 E2C7  21 B7A3     ESC8:	LD	HL,COLOR	; Farbtausch
  469 E2CA  7E          	LD	A,(HL)
  470 E2CB  E6 07       	AND	00000111b	; Hintergrund
  471 E2CD  07          	RLCA
  472 E2CE  07          	RLCA
  473 E2CF  07          	RLCA
  474 E2D0  4F          	LD	C,A
  475 E2D1  7E          	LD	A,(HL)
  476 E2D2  E6 38       	AND	00111000b	; Vordergrund
  477 E2D4  0F          	RRCA
  478 E2D5  0F          	RRCA
  479 E2D6  0F          	RRCA
  480 E2D7  B1          	OR	C
  481 E2D8  4F          	LD	C,A
  482 E2D9  7E          	LD	A,(HL)
  483 E2DA  E6 C0       	AND	11000000b	; Attribute

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  83
CE45    INC

  484 E2DC  B1          	OR	C
  485 E2DD  77          LDMA:	LD	(HL),A		; **28**
  486 E2DE  C9          	RET
  487                   
  488 E2DF  7E          LDAM:	LD	A,(HL)		; **29**
  489 E2E0  C9          	RET
  490                   
  491 E2E1  DD 7E 08    CLICK:	LD	A,(IX+8)	; ShINS
  492 E2E4  EE 20       	XOR	20H
  493 E2E6  DD 77 08    	LD	(IX+8),A
  494 E2E9  C9          	RET
  495                   
  496                   ;	=== KBD-Treiber ===
  497                   
  498                   ;
  499                   ; ISR CTC Kanal 3 (Tastatur)
  500                   ;
  501 E2EA  FB          ISRC3:	EI
  502 E2EB  F5          	PUSH	AF
  503 E2EC  3E 23       	LD	A,23H	  	; DI,ZG256,Res
  504 E2EE  D3 8F       	OUT	(CTC3),A
  505 E2F0  DD 36 0D 00 	LD	(IX+13),0	; Zeichen tot
  506 E2F4  18 5D       	JR	TST5		; freigeben
  507                   ;
  508                   ; ISR PIO Kanal B (Tastatur)
  509                   ;
  510 E2F6  F5          ISRPB:	PUSH	AF
  511 E2F7  DB 8F       	IN	A,(CTC3)	; gemessene Zeit
  512 E2F9  F5          	PUSH	AF
  513 E2FA  3E A7       	LD	A,0A7H		; EI,ZG256,Res
  514 E2FC  D3 8F       	OUT	(CTC3),A
  515 E2FE  3E 8F       	LD	A,8FH		; Zeitkonstante
  516 E300  D3 8F       	OUT	(CTC3),A
  517 E302  F1          	POP	AF
  518 E303  FB          	EI
  519 E304  FE 14       	CP	20
  520 E306  38 4B       	JR	C,TST5		; zu lang
  521 E308  FE 78       	CP	120
  522 E30A  30 47       	JR	NC,TST5		; zu kurz
  523 E30C  FE 65       	CP	101		; Diskriminator
  524 E30E  30 04       	JR	NC,TST1
  525 E310  C6 BE       	ADD	A,190
  526 E312  30 06       	JR	NC,TST2		; Stop-Bit
  527 E314  DD CB 0C 1E TST1:	RR	(IX+12)		; Bit einschieben
  528 E318  18 39       	JR	TST5
  529 E31A  E5          TST2:	PUSH	HL
  530 E31B  D5          	PUSH	DE
  531 E31C  DD 7E 0C    	LD	A,(IX+12)
  532 E31F  1F          	RRA			; 7bit-Scancode
  533 E320  EE 01       	XOR	1		; Startbit invertieren
  534 E322  DD 6E 0E    	LD	L,(IX+14)
  535 E325  DD 66 0F    	LD	H,(IX+15)
  536 E328  16 00       	LD	D,0
  537 E32A  5F          	LD	E,A
  538 E32B  19          	ADD	HL,DE		; Position in KTAB
  539 E32C  7E          	LD	A,(HL)		; ASCII holen
  540 E32D  DD CB 08 7E 	BIT	7,(IX+8)	; CAPS aktiv?
  541 E331  20 0A       	JR	NZ,TST3		; 1=nein

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  84
CE45    INC

  542 E333  FE 40       	CP	40H
  543 E335  38 06       	JR	C,TST3
  544 E337  FE 80       	CP	80H
  545 E339  30 02       	JR	NC,TST3
  546 E33B  EE 20       	XOR	20H		; klein<=>gross
  547 E33D  57          TST3:	LD	D,A		; Code merken
  548 E33E  DD BE 0D    	CP	(IX+13)		; = letzter Code?
  549 E341  20 17       	JR	NZ,TST6		; nein
  550 E343  21 B7E0     	LD	HL,COUNT
  551 E346  CD E392     	CALL	IRMGET
  552 E349  DD BE 0A    	CP	(IX+10)		; FastRepeat?
  553 E34C  38 1C       	JR	C,TST7
  554 E34E  DD 34 0A    	INC	(IX+10)		; Zeit abwarten
  555 E351  D1          TST4:	POP	DE
  556 E352  E1          	POP	HL
  557 E353  DB 89       TST5:	IN	A,(PIOBD)	; PIO-Logik
  558 E355  D3 89       	OUT	(PIOBD),A	; freigeben
  559 E357  F1          	POP	AF
  560 E358  ED 4D       	RETI
  561                   
  562 E35A  DD 36 0A 00 TST6:	LD	(IX+10),0	; neuer Code
  563 E35E  FE 16       	CP	16H		; CAPS?
  564 E360  20 09       	JR	NZ,TST8
  565 E362  DD 7E 08    	LD	A,(IX+8)
  566 E365  EE 80       	XOR	80H		; CAPS on/off
  567 E367  DD 77 08    	LD	(IX+8),A
  568 E36A  7A          TST7:	LD	A,D		; Code
  569 E36B  DD 77 0D    TST8:	LD	(IX+13),A	; eintragen
  570 E36E  DD CB 08 C6 	SET	0,(IX+8)	; gueltig machen
  571 E372  18 DD       	JR	TST4
  572                   
  573                   ; Abfrage ohne Quittung
  574 E374  B7          KBDS:	OR	A		; **0C**
  575 E375  DD CB 08 46 	BIT	0,(IX+8)	; Code gueltig?
  576 E379  C8          	RET	Z
  577 E37A  DD 7E 0D    	LD	A,(IX+13)
  578 E37D  37          	SCF			; wenn ja
  579 E37E  C9          	RET
  580                   
  581                   ; Abfrage mit Quittung
  582 E37F  CD E374     KBDZ:	CALL	KBDS		; **0E**
  583 E382  D0          	RET	NC
  584 E383  DD CB 08 86 	RES	0,(IX+8)
  585 E387  C9          	RET
  586                   
  587                   ; Test auf BRK-Anforderung
  588 E388  CD E374     BRKT:	CALL	KBDS		; **2A**
  589 E38B  D0          	RET	NC
  590 E38C  FE 03       	CP	3
  591 E38E  37          	SCF
  592 E38F  C8          	RET	Z
  593 E390  A7          	AND	A
  594 E391  C9          	RET
  595                   
  596                   ;
  597                   ; Arbeitszelle aus IRM lesen (innerhalb eines Interrupt)
  598                   ; PE:	HL	Adresse
  599                   ; PA:	A	Inhalt

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  85
CE45    INC

  600                   ; VR:	A
  601                   ;
  602 E392  D5          IRMGET:	PUSH	DE
  603 E393  DB 88       	IN	A,(PIOAD)
  604 E395  5F          	LD	E,A		; IRM-Schaltzustand in Reg. E merken
  605 E396  CB D7       	SET	2,A		; IRM on!
  606 E398  F3          	DI			; damit Stack nicht genutzt wird!
  607 E399  D3 88       	OUT	(PIOAD),A
  608 E39B  56          	LD	D,(HL)		; Arbeitszelle lesen
  609 E39C  7B          	LD	A,E
  610 E39D  D3 88       	OUT	(PIOAD),A	; IRM wie zuvor
  611 E39F  FB          	EI
  612 E3A0  7A          	LD	A,D		; Wert nach A uebergeben
  613 E3A1  D1          	POP	DE
  614 E3A2  C9          	RET
  615                   ;
  616                   ; ISR fuer Fremdtastatur an SIO-B
  617                   ;
  618 E3A3  F5          ISRT:	PUSH	AF
  619 E3A4  E5          	PUSH	HL
  620 E3A5  D5          	PUSH	DE
  621 E3A6  C5          	PUSH	BC
  622 E3A7  21 A800     	LD	HL,V24PL	; Steckplatz M003
  623 E3AA  CD E392     	CALL	IRMGET		; aus IRM lesen, Rueckkehr mit EI
  624 E3AD  47          	LD	B,A		; Steckplatz M003 holen
  625 E3AE  0E 80       	LD	C,80H
  626 E3B0  3E 01       	LD	A,1
  627 E3B2  ED 79       	OUT	(C),A		; Modul einschalten
  628 E3B4  DB 09       	IN	A,(9)		; empfangenen Code abholen
  629 E3B6  5F          	LD	E,A		; Code in Reg. E merken
  630 E3B7  A7          	AND	A
  631 E3B8  28 0E       	JR	Z,IST2		; Code 0 (Taste losgelassen)
  632 E3BA  DD BE 0D    	CP	(IX+13)		; 2x gleicher Tastencode?
  633 E3BD  3E 00       	LD	A,0		; kein Repeat
  634 E3BF  20 07       	JR	NZ,IST2
  635 E3C1  21 B7E0     	LD	HL,COUNT	; Repeat-Counter
  636 E3C4  CD E392     	CALL	IRMGET		; aus IRM lesen
  637 E3C7  3C          	INC	A		; sofort aktivieren
  638 E3C8  DD 77 0A    IST2:	LD	(IX+10),A	; repeat setzen
  639 E3CB  7B          	LD	A,E		; gemerkten
  640 E3CC  DD 77 0D    	LD	(IX+13),A	; Code eintragen
  641 E3CF  A7          	AND	A		; Code=0 ?
  642 E3D0  28 04       	JR	Z,IST3		; ja
  643 E3D2  DD CB 08 C6 	SET	0,(IX+8)	; sonst aktivieren
  644 E3D6  26 B8       IST3:	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
  645 E3D8  68          	LD	L,B		; Steckplatz
  646 E3D9  CD E392     	CALL	IRMGET		; Schaltzustand vor ISR ermitteln
  647 E3DC  ED 79       	OUT	(C),A		; und wiederherstellen
  648 E3DE  C1          	POP	BC
  649 E3DF  18 48       	JR	IPOP3		; POP DE,HL,AF; RETI
  650                   
  651                   ;	=== Joystick-Treiber fuer M008/M021 ===
  652                   
  653 E3E1  F5          ISRJ:	PUSH	AF
  654 E3E2  DB 90       	IN	A,(90h)		; M008 PIO A Daten
  655 E3E4  FB          	EI
  656 E3E5  2F          	CPL
  657 E3E6  E5          	PUSH	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  86
CE45    INC

  658 E3E7  D5          	PUSH	DE
  659 E3E8  E6 3F       	AND	00111111b	; Achsbewegung und/oder Feuertaste?
  660 E3EA  28 42       	JR	Z,ISRJ4
  661 E3EC  FE 10       	CP	00010000b	; Feuertaste?
  662 E3EE  38 06       	JR	C,ISRJ1
  663 E3F0  E6 30       	AND	00110000b	; Ignoriere Achse: Feuertasten haben Vorrang
  664 E3F2  0F          	RRCA			; Nutze Luecken zwischen den Achsrichtungen in
  665 E3F3  0F          	RRCA			; der Tastaturcode-Tabelle fuer Feuertasten
  666 E3F4  EE 0F       	XOR	00001111b	; A=0000xx11
  667 E3F6  C5          ISRJ1:	PUSH	BC
  668 E3F7  4F          	LD	C,A		; Tabellenindex
  669 E3F8  06 00       	LD	B,0
  670 E3FA  DB 88       	IN	A,(PIOAD)
  671 E3FC  57          	LD	D,A
  672 E3FD  F6 04       	OR	00000100b	; IRM ein
  673 E3FF  F3          	DI
  674 E400  D3 88       	OUT	(PIOAD),A
  675 E402  2A B7F0     	LD	HL,(JOYTAB)	; Adresse der Codetabelle fuer Joystick
  676 E405  5E          	LD	E,(HL)		; Wartezyklen waehrend Tastenwiederholung
  677 E406  09          	ADD	HL,BC		; Tastaturcode nachschlagen
  678 E407  6E          	LD	L,(HL)
  679 E408  3A B7E0     	LD	A,(COUNT)	; Wartezyklen vor erster Wiederholung
  680 E40B  67          	LD	H,A		; (entsprechend Abfragerate der Tastatur)
  681 E40C  7A          	LD	A,D
  682 E40D  D3 88       	OUT	(PIOAD),A	; IRM-Zustand wiederherstellen
  683 E40F  FB          	EI
  684 E410  C1          	POP	BC
  685 E411  3E 4F       	LD	A,01001111b	; Byte-Eingabemodus (mit Strobe-Interrupt)
  686 E413  D3 92       	OUT	(92h),A		; M008 PIO A Steuerwort
  687 E415  7D          	LD	A,L
  688 E416  A7          	AND	A		; Tastencode zugewiesen?
  689 E417  28 10       	JR	Z,IPOP3
  690 E419  DD BE 0D    	CP	(IX+13)		; neuer Tastencode?
  691 E41C  28 28       	JR	Z,ISRJ5
  692 E41E  DD 77 0D    	LD	(IX+13),A	; Tastencode eintragen
  693 E421  AF          	XOR	A
  694 E422  DD CB 08 C6 ISRJ2:	SET	0,(IX+8)	; gueltig markieren
  695 E426  DD 77 0A    ISRJ3:	LD	(IX+10),A	; Zaehler zuruecksetzen
  696 E429  D1          IPOP3:	POP	DE
  697 E42A  E1          	POP	HL
  698 E42B  F1          	POP	AF
  699 E42C  ED 4D       	RETI
  700                   
  701 E42E  DD BE 0A    ISRJ4:	CP	(IX+10)		; vorheriger Code war neu? (A war 0)
  702 E431  3C          	INC	A
  703 E432  30 F2       	JR	NC,ISRJ3	; dann zum Entprellen einen Zyklus warten
  704 E434  21 EDD7     	LD	HL,JOYINI
  705 E437  F3          	DI
  706 E438  CD F540     	CALL	INIEA		; Ruhestellung: Strobe-Interrupt wieder aus
  707 E43B  FB          	EI
  708 E43C  AF          	XOR	A
  709 E43D  DD 77 0D    	LD	(IX+13),A	; Tastencode loeschen
  710 E440  DD CB 08 86 	RES	0,(IX+8)	; ungueltig markieren
  711 E444  18 E0       	JR	ISRJ3
  712                   
  713 E446  7C          ISRJ5:	LD	A,H		; Wartezyklen vor erster Wiederholung
  714 E447  87          	ADD	A,A		; an Abfragerate des Joysticks anpassen
  715 E448  87          	ADD	A,A		; (COUNT sollte kleiner als 64 sein)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  87
CE45    INC

  716 E449  BB          	CP	E		; weniger als waehrend Wiederholung?
  717 E44A  30 01       	JR	NC,ISRJ6
  718 E44C  7B          	LD	A,E		; Zaehlerende = max(A,E)
  719 E44D  67          ISRJ6:	LD	H,A
  720 E44E  DD 7E 0A    	LD	A,(IX+10)
  721 E451  BC          	CP	H		; Zaehlerende erreicht?
  722 E452  3C          	INC	A
  723 E453  38 D1       	JR	C,ISRJ3
  724 E455  7C          	LD	A,H		; Zaehler = Endwert - Wartezyklen
  725 E456  93          	SUB	E
  726 E457  18 C9       	JR	ISRJ2		; erneut gueltig markieren
  727                   
  728                   ; TAPE-Treiber
  729                   
  730 E459  CD FB7C     ISRI1:	CALL	DEV_0		; Kassette ist Speichermedium
  731 E45C  F3          	DI
  732 E45D  DB 88       	IN	A,(PIOAD)
  733 E45F  F6 40       	OR	01000000b	; Motor ein
  734 E461  E6 DF       	AND	11011111b	; LED aus
  735 E463  D3 88       ISRO1:	OUT	(PIOAD),A
  736 E465  FB          	EI
  737 E466  2A B7A4     	LD	HL,(WEND)
  738 E469  22 B7CF     	LD	(ZWEND),HL
  739 E46C  CD F38C     	CALL	NOUT		; kein Drucker!
  740 E46F  22 B7CD     	LD	(ZOTAB),HL
  741 E472  CD E209     	CALL	PAGEM		; Page Mode
  742 E475  3E 03       TOFF:	LD	A,3		; Ton aus
  743 E477  D3 8C       	OUT	(CTC0),A
  744 E479  D3 8D       	OUT	(CTC1),A
  745 E47B  DD CB 08 8E 	RES	1,(IX+8)
  746 E47F  18 23       	JR	CSRO2
  747                   ;
  748                   ; Abschluss Bandausgabe		**09**
  749                   ;
  750 E481  DD 36 02 FE CSRO:	LD	(IX+2),0FEH	; Nr. letzter Block
  751 E485  CD E4E9     	CALL	MBO		; Block auf Kassette ausgeben
  752 E488  2A B7CD     CSROI:	LD	HL,(ZOTAB) 	; intern
  753 E48B  22 B7B9     	LD	(OUTAB),HL
  754 E48E  2A B7CF     	LD	HL,(ZWEND)	; grosses
  755 E491  22 B7A4     	LD	(WEND),HL	; Ruecksetzen
  756 E494  CD E4D1     	CALL	CLC		; Puffer loeschen (VR: HL)
  757 E497  DB 88       	IN	A,(PIOAD)
  758 E499  E6 9F       	AND	10011111b	; Motor, LED aus
  759 E49B  D3 88       	OUT	(PIOAD),A
  760 E49D  CD F4CC     	CALL	CRLF		; VR: AF
  761 E4A0  DD CB 08 86 	RES	0,(IX+8)
  762 E4A4  DD CB 01 5E CSRO2:	BIT	3,(IX+1)	; HiRes?
  763 E4A8  28 06       	JR	Z,CSRO3
  764 E4AA  DB 89       	IN	A,(PIOBD)	; nein-
  765 E4AC  CB FF       	SET	7,A		; Blinken ein
  766 E4AE  D3 89       	OUT	(PIOBD),A
  767 E4B0  DD CB 08 4E CSRO3:	BIT	1,(IX+8)	; neuer Ton?
  768 E4B4  20 FA       	JR	NZ,CSRO3	; Ende abwarten
  769 E4B6  DB 88       	IN	A,(PIOAD)
  770 E4B8  6F          	LD	L,A		; Schaltzustand IRM merken
  771 E4B9  CB D7       	SET	2,A		; IRM on
  772 E4BB  F3          	DI			; Interrupt verbieten wegen Stacknutzung
  773 E4BC  D3 88       	OUT	(PIOAD),A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  88
CE45    INC

  774 E4BE  3A B7DB     	LD	A,(CTCMD)	; CTC2-Modus
  775 E4C1  E6 60       	AND	01100000b
  776 E4C3  F6 07       	OR	00000111b
  777 E4C5  D3 8E       	OUT	(CTC2),A	; Blinken
  778 E4C7  3A B7DC     	LD	A,(BLINK)	; ZK laden
  779 E4CA  D3 8E       	OUT	(CTC2),A
  780 E4CC  7D          	LD	A,L
  781 E4CD  D3 88       	OUT	(PIOAD),A	; IRM wie zuvor einstellen
  782 E4CF  FB          	EI			; Interrupt wieder ein
  783 E4D0  C9          	RET
  784                   ;
  785                   ; Kassettenpuffer loeschen:
  786                   ; PA:	HL = CASS
  787                   ;
  788 E4D1  21 B780     CLC:	LD	HL,CASS+80H
  789 E4D4  AF          	XOR	A
  790 E4D5  2D          CLC1:	DEC	L
  791 E4D6  77          	LD	(HL),A
  792 E4D7  20 FC       	JR	NZ,CLC1
  793 E4D9  C9          	RET
  794                   
  795                   ; Initialisierung Bandausgabe:
  796 E4DA  F3          ISRO:	DI			; **08**
  797 E4DB  DB 88       	IN	A,(PIOAD)
  798 E4DD  F6 60       	OR	01100000b	; Motor+LED ein
  799 E4DF  CD E463     	CALL	ISRO1
  800 E4E2  DD 36 02 00 	LD	(IX+2),0
  801 E4E6  01 1000     	LD	BC,4096		; langer Vorton
  802                   	; Ausgabe 1 Block
  803 E4E9  DD 34 02    MBO:	INC	(IX+2)		; **01**
  804 E4EC  3E 87       	LD	A,10000111b	; EI,ZG16,Res
  805 E4EE  F3          	DI
  806 E4EF  D3 8D       	OUT	(CTC1),A
  807 E4F1  3E 2F       	LD	A,47		; Vorton
  808 E4F3  D3 8D       	OUT	(CTC1),A
  809 E4F5  FB          	EI
  810 E4F6  57          	LD	D,A		; D=47
  811 E4F7  5F          	LD	E,A		; E=47
  812 E4F8  CD E53D     MBO1:	CALL	BITOUT		; Vorton ausgeben
  813 E4FB  ED A1       	CPI
  814 E4FD  EA E4F8     	JP	PE,MBO1		; BC mal
  815 E500  CD E53B     	CALL	ZTON		; Trennzeichen
  816 E503  DD 7E 02    	LD	A,(IX+2)
  817 E506  CD E528     	CALL	BYTOT		; Blocknummer
  818 E509  DD 6E 05    	LD	L,(IX+5)
  819 E50C  DD 66 06    	LD	H,(IX+6)	; Blockanfang
  820 E50F  06 80       	LD	B,128		; Zaehler
  821 E511  7E          BLKOT:	LD	A,(HL)
  822 E512  CD E528     	CALL	BYTOT		; 128 Datenbyte ausgeben
  823 E515  79          	LD	A,C
  824 E516  86          	ADD	A,(HL)		; Pruefsumme
  825 E517  4F          	LD	C,A		; nebenher berechnen
  826 E518  23          	INC	HL
  827 E519  10 F6       	DJNZ	BLKOT
  828 E51B  CD E528     	CALL	BYTOT		; Pruefsumme ausgeben
  829                   ;	LD	A,D		; ???
  830 E51E  CD E53D     	CALL	BITOUT		; noch ein Knacks (Endimpuls)
  831 E521  5D          	LD	E,L

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  89
CE45    INC

  832 E522  54          	LD	D,H
  833 E523  3E 03       	LD	A,3		; CTC stoppen
  834 E525  D3 8D       	OUT	(CTC1),A
  835 E527  C9          	RET
  836                   
  837                   ; Ausgabe eines Bytes auf Kassette
  838                   
  839 E528  C5          BYTOT:	PUSH	BC
  840 E529  4F          	LD	C,A
  841 E52A  06 08       	LD	B,8
  842 E52C  CB 09       BYTOUT:	RRC	C		; mit Bit 0
  843 E52E  1E 17       	LD	E,23		; beginnend
  844 E530  D4 E53D     	CALL	NC,BITOUT
  845 E533  1E 2F       	LD	E,47		; Zeitkonstanten
  846 E535  DC E53D     	CALL	C,BITOUT
  847 E538  10 F2       	DJNZ	BYTOUT		; 8*
  848 E53A  C1          	POP	BC
  849 E53B  1E 5D       ZTON:	LD	E,93		; ZK Trennzeichen
  850 E53D  CD E540     BITOUT:	CALL	HBITOT		; Aufrufen und
  851 E540  DD 72 00    HBITOT:	LD	(IX),D		; reinlaufen
  852 E543  DD 7E 00    HBIT1:	LD	A,(IX)		; Warten auf
  853 E546  A7          	AND	A		; Interrupt
  854 E547  20 FA       	JR	NZ,HBIT1
  855 E549  53          	LD	D,E
  856 E54A  C9          	RET
  857                   
  858                   ; Initialisierung Bandeingabe
  859                   
  860 E54B  CD E459     ISRI:	CALL	ISRI1		; **0A**
  861                   
  862                   ; Einen Block einlesen:
  863 E54E  3E 83       MBI:	LD	A,10000011b	; **05**
  864 E550  D3 8A       	OUT	(PIOAS),A	; EI an PIO A
  865 E552  E5          	PUSH	HL
  866 E553  D5          	PUSH	DE
  867 E554  06 16       MBI1:	LD	B,22
  868 E556  DD 36 0D 00 	LD	(IX+13),0	; Pruefsumme=0
  869 E55A  CD E5D3     MBI2:	CALL	STOP1
  870 E55D  38 F5       	JR	C,MBI1
  871 E55F  FE BA       	CP	186
  872 E561  CD E5A6     	CALL	LEDOO
  873 E564  38 EE       	JR	C,MBI1		; 16h korrekte
  874 E566  10 F2       	DJNZ	MBI2		; Schwingungen
  875 E568  06 02       MBI3:	LD	B,2		; erkennen
  876 E56A  AF          MBI4:	XOR	A
  877 E56B  CD E5D7     	CALL	STOP2		; 2 halbe Trennzeichen
  878 E56E  FE 5D       	CP	93		; erkennen
  879 E570  30 F6       	JR	NC,MBI3
  880 E572  10 F6       	DJNZ	MBI4
  881 E574  CD E5E8     	CALL	BYTIN		; Blocknummer
  882 E577  38 25       	JR	C,MBI5		; Stoerung
  883 E579  DD 77 02    	LD	(IX+2),A
  884 E57C  06 80       	LD	B,80H
  885 E57E  DD 6E 05    	LD	L,(IX+5)
  886 E581  DD 66 06    	LD	H,(IX+6)
  887 E584  CD E5E8     BLKIN:	CALL	BYTIN		; Datenbyte
  888 E587  38 15       	JR	C,MBI5		; Stoerung
  889 E589  77          	LD	(HL),A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  90
CE45    INC

  890 E58A  DD 7E 0D    	LD	A,(IX+13)
  891 E58D  86          	ADD	A,(HL)		; aufsummieren
  892 E58E  DD 77 0D    	LD	(IX+13),A
  893 E591  23          	INC	HL
  894 E592  10 F0       	DJNZ	BLKIN
  895 E594  CD E5E8     	CALL	BYTIN		; Pruefsumme
  896 E597  38 05       	JR	C,MBI5		; Stoerung
  897 E599  DD 96 0D    	SUB	(IX+13)		; gleich?
  898 E59C  C6 FF       	ADD	A,-1		; CY:=/Z
  899 E59E  D1          MBI5:	POP	DE
  900 E59F  E1          	POP	HL
  901 E5A0  F3          	DI
  902 E5A1  3E 03       	LD	A,3		; DI an PIO A
  903 E5A3  D3 8A       	OUT	(PIOAS),A
  904 E5A5  FB          	EI
  905 E5A6  DB 88       LEDOO:	IN	A,(PIOAD)	; LED ein/aus
  906 E5A8  CB EF       	SET	5,A		; je nach CY
  907 E5AA  30 02       	JR	NC,MBI6
  908 E5AC  CB AF       	RES	5,A
  909 E5AE  D3 88       MBI6:	OUT	(PIOAD),A
  910 E5B0  C9          	RET
  911                   ;
  912                   ; ISR CTC Kanal 1 (Kassette-Out)
  913                   ;
  914 E5B1  F5          ISRC1:	PUSH	AF
  915 E5B2  3E 87       	LD	A,87H
  916 E5B4  D3 8D       	OUT	(CTC1),A
  917 E5B6  DD 7E 00    	LD	A,(IX)		; Uebergabezelle
  918 E5B9  D3 8D       	OUT	(CTC1),A
  919 E5BB  DD 36 00 00 	LD	(IX),0		; Quittierung
  920 E5BF  18 0E       	JR	ISR1E
  921                   ;
  922                   ; ISR PIO Kanal A (Kassette-In)
  923                   ;
  924 E5C1  F5          ISRPA:	PUSH	AF
  925 E5C2  DB 8E       	IN	A,(CTC2)
  926 E5C4  DD 77 00    	LD	(IX),A		; Uebergabezelle
  927 E5C7  3E 07       	LD	A,7
  928 E5C9  D3 8E       	OUT	(CTC2),A
  929 E5CB  3E A3       	LD	A,0A3H
  930 E5CD  D3 8E       	OUT	(CTC2),A
  931 E5CF  F1          ISR1E:	POP	AF
  932 E5D0  FB          IRET:	EI
  933 E5D1  ED 4D       	RETI
  934                   
  935                   ; 1 Bit einlesen:
  936 E5D3  AF          STOP1:	XOR	A
  937 E5D4  CD E5D7     	CALL	STOP2		; erst aufrufen, dann reinlaufen
  938 E5D7  4F          STOP2:	LD	C,A
  939 E5D8  DD 36 00 00 	LD	(IX),0
  940 E5DC  DB 88       STOP21:	IN	A,(PIOAD)
  941 E5DE  D3 88       	OUT	(PIOAD),A	; PIO-Logik freigeben
  942 E5E0  DD 7E 00    	LD	A,(IX)		; Warten auf Interrupt
  943 E5E3  B7          	OR	A
  944 E5E4  28 F6       	JR	Z,STOP21
  945 E5E6  81          	ADD	A,C		; beide 'Zeiten' addieren
  946 E5E7  C9          	RET
  947                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  91
CE45    INC

  948                   ; Einlesen eines Bytes von Kassette
  949                   ; PA: A=Byte, CY=1: Stoerung
  950                   
  951 E5E8  11 0800     BYTIN:	LD	DE,800H
  952 E5EB  CD E5D3     TRN1:	CALL	STOP1
  953 E5EE  38 03       	JR	C,TRN2
  954 E5F0  FE BA       	CP	0BAH		; zu intolerant
  955 E5F2  D8          	RET	C
  956 E5F3  3F          TRN2:	CCF
  957 E5F4  CB 1B       	RR 	E		; Bit einschieben
  958 E5F6  15          	DEC	D
  959 E5F7  20 F2       	JR	NZ,TRN1		; 8*
  960 E5F9  CD E5D3     	CALL	STOP1		; Trennzeichen
  961 E5FC  7B          	LD	A,E		; mit CY-Rueckmeldung
  962 E5FD  C9          	RET
  963                   
  964                   ; ===== BASIC =====
  965                   
  966                   ; BASIC-Erweiterung 1: Erweiterungstoken starten
  967                   
  968 E5FE  78          BEXP1:	LD	A,B		; Nr.
  969 E5FF  D6 09       	SUB	9
  970 E601  38 44       	JR	C,SNERR1
  971 E603  FE 1D       	CP	29		; 27 ohne "DRIVE"
  972 E605  30 40       	JR	NC,SNERR1	; >28
  973 E607  07          	RLCA			; *2
  974 E608  4F          	LD	C,A
  975 E609  06 00       	LD	B,0
  976 E60B  EB          	EX	DE,HL
  977 E60C  21 FDAC     	LD	HL,TOKJP+8
  978 E60F  C3 C8B7     	JP	DLI22		; Ruecksprung zu Tokenverarbeitung
  979                   
  980                   ; BASIC-Erweiterung 2: Print-Erweiterung?
  981                   
  982 E612  7E          BEXP2:	LD	A,(HL)
  983 E613  FE DF       	CP	0DFH		; INK-Token?
  984 E615  D8          	RET	C		; <DFH
  985 E616  FE E3       	CP	0E3H		; COLOR-Token?
  986 E618  D0          	RET	NC		; >E2H
  987 E619  FE E1       	CP	0E1H		; AT-Token?
  988 E61B  CA E9E7     	JP	Z,PRAT
  989 E61E  3A 03FD     	LD	A,(PRTFLG)
  990 E621  A7          	AND	A		; PRINT-Erweiterung?
  991 E622  20 23       	JR	NZ,SNERR1
  992 E624  3C          	INC	A
  993 E625  32 03FD     	LD	(PRTFLG),A
  994 E628  E5          PREX1:	PUSH	HL
  995 E629  21 B7A3     	LD	HL,COLOR
  996 E62C  CD EBDE     	CALL	IRMRD
  997 E62F  E1          	POP	HL
  998 E630  32 037E     	LD	(COLRET),A 	; Farbe merken
  999 E633  7E          	LD	A,(HL)
 1000 E634  FE DF       	CP	0DFH		; INK?
 1001 E636  28 1A       	JR	Z,PRINK
 1002 E638  FE E2       	CP	0E2H		; COLOR?
 1003 E63A  28 0E       	JR	Z,PRCOL
 1004 E63C  CD C8BD     	CALL	TCHAR		; naechstes Zeichen holen
 1005 E63F  CD EB51     	CALL	PAPER

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  92
CE45    INC

 1006 E642  7E          PREX2:	LD	A,(HL)
 1007 E643  FE 3B       	CP	';'
 1008 E645  28 3B       	JR	Z,PREX5
 1009 E647  C3 C348     SNERR1:	JP	SNER		; SN-ERROR
 1010                   
 1011 E64A  CD C8BD     PRCOL:	CALL	TCHAR		; naechstes Zeichen holen
 1012 E64D  CD EB42     	CALL	BCOLOR
 1013 E650  18 F0       	JR	PREX2
 1014                   
 1015 E652  CD C8BD     PRINK:	CALL	TCHAR		; naechstes Zeichen holen
 1016 E655  CD EB2B     	CALL	INK
 1017 E658  7E          	LD	A,(HL)
 1018 E659  FE 3B       	CP	';'
 1019 E65B  28 25       	JR	Z,PREX5
 1020 E65D  CD C8CC     	CALL	CPSTX		; Komma?
 1021 E660  2C          	DB	','
 1022 E661  FE E0       	CP	0E0H		; PAPER?
 1023 E663  20 E2       	JR	NZ,SNERR1
 1024 E665  CD C8BD     	CALL	TCHAR		; naechstes Zeichen holen
 1025 E668  CD EB51     	CALL	PAPER
 1026 E66B  CD C8CC     	CALL	CPSTX		; Semikolon?
 1027 E66E  3B          	DB	';'
 1028 E66F  CD CB03     PREX3:	CALL	PRINT2
 1029 E672  3A 037E     	LD	A,(COLRET)	; Farbe
 1030 E675  E5          	PUSH	HL
 1031 E676  21 B7A3     	LD	HL,COLOR
 1032 E679  CD EBDA     	CALL	IRMWR		; eintragen
 1033 E67C  E1          	POP	HL
 1034 E67D  C1          	POP	BC
 1035 E67E  C9          	RET
 1036 E67F  C5          PREX4:	PUSH	BC
 1037 E680  18 A6       	JR	PREX1
 1038 E682  CD C8BD     PREX5:	CALL	TCHAR		; naechstes Zeichen holen
 1039 E685  18 E8       	JR	PREX3
 1040                   
 1041                   ; String vervielfaeltigen
 1042                   
 1043 E687  CD C8CC     STRING:	CALL	CPSTX		; Klammer auf?
 1044 E68A  28          	DB	'('
 1045 E68B  CD D421     	CALL	ARGVL1		; Wert abholen
 1046 E68E  F5          	PUSH	AF
 1047 E68F  CD C8D6     	CALL	CPCOMM		; Komma?
 1048 E692  CD CD3A     	CALL	SNALY
 1049 E695  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1050 E698  F1          	POP	AF
 1051 E699  E5          	PUSH	HL
 1052 E69A  F5          	PUSH	AF
 1053 E69B  CD D330     	CALL	LEN1		; Laenge holen
 1054 E69E  23          	INC	HL
 1055 E69F  23          	INC	HL
 1056 E6A0  5E          	LD	E,(HL)
 1057 E6A1  23          	INC	HL
 1058 E6A2  56          	LD	D,(HL)
 1059 E6A3  C1          	POP	BC
 1060 E6A4  C5          	PUSH	BC
 1061 E6A5  F5          	PUSH	AF
 1062 E6A6  D5          	PUSH	DE
 1063 E6A7  4F          	LD	C,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  93
CE45    INC

 1064 E6A8  AF          	XOR	A
 1065 E6A9  B9          	CP	C
 1066 E6AA  28 0C       	JR	Z,STR2
 1067 E6AC  B8          	CP	B
 1068 E6AD  28 09       	JR	Z,STR2
 1069 E6AF  79          	LD	A,C
 1070 E6B0  05          	DEC	B
 1071 E6B1  28 05       	JR	Z,STR2
 1072 E6B3  81          STR1:	ADD	A,C
 1073 E6B4  38 2B       	JR	C,STR5
 1074 E6B6  10 FB       	DJNZ	STR1
 1075 E6B8  47          STR2:	LD	B,A
 1076 E6B9  0E 00       	LD	C,0
 1077 E6BB  C5          	PUSH	BC
 1078 E6BC  CD D1E1     	CALL	STROP		; String-Arithmetik
 1079 E6BF  C1          	POP	BC
 1080 E6C0  C1          	POP	BC
 1081 E6C1  C5          	PUSH	BC
 1082 E6C2  CD D17E     	CALL	SADTB1
 1083 E6C5  E1          	POP	HL
 1084 E6C6  E3          	EX	(SP),HL
 1085 E6C7  7C          	LD	A,H
 1086 E6C8  E1          	POP	HL
 1087 E6C9  E3          	EX	(SP),HL
 1088 E6CA  6F          	LD	L,A
 1089 E6CB  24          	INC	H
 1090 E6CC  25          STR3:	DEC	H
 1091 E6CD  E5          	PUSH	HL
 1092 E6CE  C5          	PUSH	BC
 1093 E6CF  28 07       	JR	Z,STR4
 1094 E6D1  CD D2F2     	CALL	STRMV1
 1095 E6D4  C1          	POP	BC
 1096 E6D5  E1          	POP	HL
 1097 E6D6  18 F4       	JR	STR3
 1098                   	;
 1099 E6D8  C1          STR4:	POP	BC
 1100 E6D9  E1          	POP	HL
 1101 E6DA  D1          	POP	DE
 1102 E6DB  CD D302     	CALL	STRZS3
 1103 E6DE  C3 D1A9     	JP	SLEN3
 1104                   	;
 1105 E6E1  1E 1C       STR5:	LD	E,1CH		; ST-ERROR
 1106 E6E3  C3 C356     	JP	ERROO		; Ausgabe Fehlercode
 1107                   
 1108                   ; Neu nummerieren
 1109                   
 1110 E6E6  E5          RENUM:	PUSH	HL
 1111 E6E7  21 000A     	LD	HL,10
 1112 E6EA  22 0354     	LD	(DISTAN),HL
 1113 E6ED  2A 035F     	LD	HL,(PSTBEG)	; Start
 1114 E6F0  F5          	PUSH	AF
 1115 E6F1  E5          	PUSH	HL
 1116 E6F2  23          	INC	HL
 1117 E6F3  23          	INC	HL
 1118 E6F4  7E          	LD	A,(HL)
 1119 E6F5  23          	INC	HL
 1120 E6F6  66          	LD	H,(HL)
 1121 E6F7  6F          	LD	L,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  94
CE45    INC

 1122 E6F8  22 034E     	LD	(ANF),HL	; ZL-Nr
 1123 E6FB  22 0352     	LD	(NANF),HL
 1124 E6FE  ED 5B 03D7  	LD	DE,(SVARPT)	; Ende
 1125 E702  1B          	DEC	DE
 1126 E703  1B          	DEC	DE
 1127 E704  E1          REN01:	POP	HL
 1128 E705  E5          	PUSH	HL
 1129 E706  7E          	LD	A,(HL)
 1130 E707  23          	INC	HL
 1131 E708  66          	LD	H,(HL)
 1132 E709  6F          	LD	L,A
 1133 E70A  CD C689     	CALL	CPREG
 1134 E70D  E3          	EX	(SP),HL
 1135 E70E  20 F4       	JR	NZ,REN01
 1136 E710  D1          	POP	DE
 1137 E711  23          	INC	HL
 1138 E712  23          	INC	HL
 1139 E713  7E          	LD	A,(HL)
 1140 E714  23          	INC	HL
 1141 E715  66          	LD	H,(HL)
 1142 E716  6F          	LD	L,A
 1143 E717  22 0350     	LD	(ENDE),HL	; Zeilen-Abstand
 1144 E71A  06 04       	LD	B,4
 1145 E71C  F1          	POP	AF
 1146 E71D  21 034E     	LD	HL,ANF
 1147 E720  E3          	EX	(SP),HL
 1148 E721  28 20       REN02:	JR	Z,REN05
 1149 E723  CD C986     	CALL	DCHEX
 1150 E726  F5          	PUSH	AF
 1151 E727  7A          	LD	A,D
 1152 E728  B3          	OR	E
 1153 E729  CA C967     REN03:	JP	Z,FCER	 	; FC-ERROR
 1154 E72C  F1          	POP	AF
 1155 E72D  E3          	EX	(SP),HL
 1156 E72E  73          	LD	(HL),E
 1157 E72F  23          	INC	HL
 1158 E730  72          	LD	(HL),D
 1159 E731  23          	INC	HL
 1160 E732  28 0F       	JR	Z,REN05
 1161 E734  F5          	PUSH	AF
 1162 E735  05          	DEC	B
 1163 E736  28 07       	JR	Z,REN04
 1164 E738  F1          	POP	AF
 1165 E739  E3          	EX	(SP),HL
 1166 E73A  CD C8D6     	CALL	CPCOMM		; Komma?
 1167 E73D  18 E2       	JR	REN02
 1168                   	;
 1169 E73F  F1          REN04:	POP	AF
 1170 E740  C2 C348     	JP	NZ,SNER		; SN-ERROR
 1171 E743  2A 0350     REN05:	LD	HL,(ENDE)
 1172 E746  ED 5B 034E  	LD	DE,(ANF)	; ANFANG
 1173 E74A  CD C689     	CALL	CPREG
 1174 E74D  DA C967     REN06:	JP	C,FCER		; FC-ERROR
 1175 E750  2A 035F     	LD	HL,(PSTBEG)
 1176 E753  CD C4BE     REN07:	CALL	ZPOIT1		; naechste Zeile
 1177 E756  38 04       	JR	C,REN08
 1178 E758  28 CF       	JR	Z,REN03
 1179 E75A  18 F7       	JR	REN07

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  95
CE45    INC

 1180                   	;
 1181 E75C  E1          REN08:	POP	HL
 1182 E75D  C5          	PUSH	BC
 1183 E75E  ED 5B 0350  	LD	DE,(ENDE)
 1184 E762  21 0000     	LD	HL,0
 1185 E765  22 0350     	LD	(ENDE),HL
 1186 E768  60          REN09:	LD	H,B
 1187 E769  69          	LD	L,C
 1188 E76A  4E          	LD	C,(HL)
 1189 E76B  23          	INC	HL
 1190 E76C  46          	LD	B,(HL)
 1191 E76D  78          	LD	A,B
 1192 E76E  B1          	OR	C
 1193 E76F  28 B8       	JR	Z,REN03
 1194 E771  23          	INC	HL
 1195 E772  7E          	LD	A,(HL)
 1196 E773  23          	INC	HL
 1197 E774  66          	LD	H,(HL)
 1198 E775  6F          	LD	L,A
 1199 E776  CD C689     	CALL	CPREG
 1200 E779  2A 0350     	LD	HL,(ENDE)
 1201 E77C  23          	INC	HL
 1202 E77D  22 0350     	LD	(ENDE),HL
 1203 E780  20 E6       	JR	NZ,REN09
 1204 E782  23          	INC	HL
 1205 E783  23          	INC	HL
 1206 E784  29          	ADD	HL,HL
 1207 E785  23          	INC	HL
 1208 E786  ED 5B 03D7  	LD	DE,(SVARPT)
 1209 E78A  19          	ADD	HL,DE
 1210 E78B  38 C0       	JR	C,REN06
 1211 E78D  CD C327     	CALL	TMEMO		; genug RAM?
 1212 E790  22 03D7     	LD	(SVARPT),HL
 1213 E793  AF          	XOR	A
 1214 E794  2B          	DEC	HL
 1215 E795  77          	LD	(HL),A
 1216 E796  2B          	DEC	HL
 1217 E797  77          	LD	(HL),A
 1218 E798  1B          	DEC	DE
 1219 E799  1B          	DEC	DE
 1220 E79A  EB          	EX	DE,HL
 1221 E79B  73          	LD	(HL),E
 1222 E79C  23          	INC	HL
 1223 E79D  72          	LD	(HL),D
 1224 E79E  23          	INC	HL
 1225 E79F  3D          	DEC	A
 1226 E7A0  77          	LD	(HL),A
 1227 E7A1  23          	INC	HL
 1228 E7A2  77          	LD	(HL),A
 1229 E7A3  23          	INC	HL
 1230 E7A4  EB          	EX	DE,HL
 1231 E7A5  2A 0352     	LD	HL,(NANF)
 1232 E7A8  22 034E     	LD	(ANF),HL
 1233 E7AB  E1          REN10:	POP	HL
 1234 E7AC  4E          	LD	C,(HL)
 1235 E7AD  23          	INC	HL
 1236 E7AE  46          	LD	B,(HL)
 1237 E7AF  23          	INC	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  96
CE45    INC

 1238 E7B0  C5          	PUSH	BC
 1239 E7B1  01 034E     	LD	BC,ANF
 1240 E7B4  7E          	LD	A,(HL)
 1241 E7B5  12          	LD	(DE),A
 1242 E7B6  0A          	LD	A,(BC)
 1243 E7B7  77          	LD	(HL),A
 1244 E7B8  23          	INC	HL
 1245 E7B9  13          	INC	DE
 1246 E7BA  03          	INC	BC
 1247 E7BB  7E          	LD	A,(HL)
 1248 E7BC  12          	LD	(DE),A
 1249 E7BD  0A          	LD	A,(BC)
 1250 E7BE  77          	LD	(HL),A
 1251 E7BF  13          	INC	DE
 1252 E7C0  2A 034E     	LD	HL,(ANF)
 1253 E7C3  ED 4B 0354  	LD	BC,(DISTAN)
 1254 E7C7  09          	ADD	HL,BC
 1255 E7C8  22 034E     	LD	(ANF),HL
 1256 E7CB  2A 0350     	LD	HL,(ENDE)
 1257 E7CE  2B          	DEC	HL
 1258 E7CF  7C          	LD	A,H
 1259 E7D0  B5          	OR	L
 1260 E7D1  22 0350     	LD	(ENDE),HL
 1261 E7D4  20 D5       	JR	NZ,REN10
 1262 E7D6  12          	LD	(DE),A
 1263 E7D7  E1          	POP	HL
 1264 E7D8  2A 035F     	LD	HL,(PSTBEG)
 1265 E7DB  E5          	PUSH	HL
 1266 E7DC  E1          REN11:	POP	HL
 1267 E7DD  4E          	LD	C,(HL)
 1268 E7DE  23          	INC	HL
 1269 E7DF  46          	LD	B,(HL)
 1270 E7E0  23          	INC	HL
 1271 E7E1  C5          	PUSH	BC
 1272 E7E2  7E          	LD	A,(HL)
 1273 E7E3  23          	INC	HL
 1274 E7E4  A6          	AND	(HL)
 1275 E7E5  3C          	INC	A
 1276 E7E6  28 26       	JR	Z,REN15
 1277 E7E8  23          REN12:	INC	HL
 1278 E7E9  7E          REN13:	LD	A,(HL)
 1279 E7EA  B7          	OR	A
 1280 E7EB  28 EF       	JR	Z,REN11
 1281 E7ED  FE 88       	CP	88H		; GOTO
 1282 E7EF  28 2A       	JR	Z,REN16
 1283 E7F1  FE 8C       	CP	8CH		; GOSUB
 1284 E7F3  28 26       	JR	Z,REN16
 1285 E7F5  FE 8B       	CP	8BH		; RESTORE
 1286 E7F7  28 08       	JR	Z,REN14
 1287 E7F9  FE D4       	CP	0D4H		; ELSE
 1288 E7FB  28 04       	JR	Z,REN14
 1289 E7FD  FE A9       	CP	0A9H		; THEN
 1290 E7FF  20 E7       	JR	NZ,REN12
 1291 E801  CD C987     REN14:	CALL	DCHEX1
 1292 E804  7B          	LD	A,E
 1293 E805  B2          	OR	D
 1294 E806  C4 E82F     	CALL	NZ,RNUP1 	; Vergleich mit Tabelle
 1295 E809  C4 E861     	CALL	NZ,RNUP2	; Zahl aendern

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  97
CE45    INC

 1296 E80C  18 DB       	JR	REN13
 1297                   	;
 1298 E80E  2B          REN15:	DEC	HL
 1299 E80F  22 03D7     	LD	(SVARPT),HL
 1300 E812  2B          	DEC	HL
 1301 E813  77          	LD	(HL),A
 1302 E814  2B          	DEC	HL
 1303 E815  77          	LD	(HL),A
 1304 E816  E1          	POP	HL
 1305 E817  E1          	POP	HL
 1306 E818  C3 C48A     	JP	LIN10		; Zeile neu einsortieren
 1307                   	;
 1308 E81B  CD C987     REN16:	CALL	DCHEX1
 1309 E81E  7B          	LD	A,E
 1310 E81F  B2          	OR	D
 1311 E820  28 C7       	JR	Z,REN13
 1312 E822  CD E82F     	CALL	RNUP1
 1313 E825  C4 E861     	CALL	NZ,RNUP2
 1314 E828  7E          	LD	A,(HL)
 1315 E829  FE 2C       	CP	2CH
 1316 E82B  20 BC       	JR	NZ,REN13
 1317 E82D  18 EC       	JR	REN16
 1318                   
 1319 E82F  E5          RNUP1:	PUSH	HL
 1320 E830  D5          	PUSH	DE
 1321 E831  11 FFFF     	LD	DE,-1
 1322 E834  CD C4BB     	CALL	ZPOIT		; naechste Zeile
 1323 E837  D1          	POP	DE
 1324 E838  03          	INC	BC
 1325 E839  03          	INC	BC
 1326 E83A  03          	INC	BC
 1327 E83B  03          	INC	BC
 1328 E83C  60          	LD	H,B
 1329 E83D  69          	LD	L,C
 1330 E83E  ED 4B 0352  	LD	BC,(NANF)
 1331 E842  7E          RUP11:	LD	A,(HL)
 1332 E843  23          	INC	HL
 1333 E844  E5          	PUSH	HL
 1334 E845  B6          	OR	(HL)
 1335 E846  28 16       	JR	Z,RUP13
 1336 E848  7E          	LD	A,(HL)
 1337 E849  2B          	DEC	HL
 1338 E84A  6E          	LD	L,(HL)
 1339 E84B  67          	LD	H,A
 1340 E84C  CD C689     	CALL	CPREG
 1341 E84F  28 0A       	JR	Z,RUP12
 1342 E851  2A 0354     	LD	HL,(DISTAN)
 1343 E854  09          	ADD	HL,BC
 1344 E855  44          	LD	B,H
 1345 E856  4D          	LD	C,L
 1346 E857  E1          	POP	HL
 1347 E858  23          	INC	HL
 1348 E859  18 E7       	JR	RUP11
 1349                   	;
 1350 E85B  3E FF       RUP12:	LD	A,0FFH
 1351 E85D  B7          	OR	A
 1352 E85E  E1          RUP13:	POP	HL
 1353 E85F  E1          	POP	HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  98
CE45    INC

 1354 E860  C9          	RET
 1355                   
 1356 E861  C5          RNUP2:	PUSH	BC
 1357 E862  EB          	EX	DE,HL
 1358 E863  2A 03D7     	LD	HL,(SVARPT)
 1359 E866  ED 52       	SBC	HL,DE
 1360 E868  E5          	PUSH	HL
 1361 E869  C1          RUP21:	POP	BC
 1362 E86A  62          	LD	H,D
 1363 E86B  6B          	LD	L,E
 1364 E86C  1B          	DEC	DE
 1365 E86D  1A          	LD	A,(DE)
 1366 E86E  FE 2C       	CP	','
 1367 E870  28 0B       	JR	Z,RUP22
 1368 E872  FE 3A       	CP	':'
 1369 E874  30 07       	JR	NC,RUP22
 1370 E876  C5          	PUSH	BC
 1371 E877  D5          	PUSH	DE
 1372 E878  ED B0       	LDIR
 1373 E87A  D1          	POP	DE
 1374 E87B  18 EC       	JR	RUP21
 1375                   	;
 1376 E87D  EB          RUP22:	EX	DE,HL
 1377 E87E  D1          	POP	DE
 1378 E87F  E5          	PUSH	HL
 1379 E880  C5          	PUSH	BC
 1380 E881  AF          	XOR	A
 1381 E882  06 98       	LD	B,98H
 1382 E884  CD D6AE     	CALL	SGN1
 1383 E887  CD D834     	CALL	NUMKON
 1384 E88A  C1          	POP	BC
 1385 E88B  D1          	POP	DE
 1386 E88C  23          	INC	HL
 1387 E88D  13          	INC	DE
 1388 E88E  7E          RUP23:	LD	A,(HL)
 1389 E88F  B7          	OR	A
 1390 E890  28 0F       	JR	Z,RUP24
 1391 E892  C5          	PUSH	BC
 1392 E893  E5          	PUSH	HL
 1393 E894  EB          	EX	DE,HL
 1394 E895  09          	ADD	HL,BC
 1395 E896  54          	LD	D,H
 1396 E897  5D          	LD	E,L
 1397 E898  2B          	DEC	HL
 1398 E899  ED B8       	LDDR
 1399 E89B  E1          	POP	HL
 1400 E89C  ED A0       	LDI
 1401 E89E  C1          	POP	BC
 1402 E89F  18 ED       	JR	RUP23
 1403                   	;
 1404 E8A1  D5          RUP24:	PUSH	DE
 1405 E8A2  ED 5B 035F  	LD	DE,(PSTBEG)
 1406 E8A6  CD C493     	CALL	LIN11
 1407 E8A9  23          RUP25:	INC	HL
 1408 E8AA  7E          	LD	A,(HL)
 1409 E8AB  23          	INC	HL
 1410 E8AC  B6          	OR	(HL)
 1411 E8AD  20 FA       	JR	NZ,RUP25

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  99
CE45    INC

 1412 E8AF  EB          	EX	DE,HL
 1413 E8B0  73          	LD	(HL),E
 1414 E8B1  23          	INC	HL
 1415 E8B2  72          	LD	(HL),D
 1416 E8B3  13          	INC	DE
 1417 E8B4  13          	INC	DE
 1418 E8B5  ED 53 03D7  	LD	(SVARPT),DE
 1419 E8B9  E1          	POP	HL
 1420 E8BA  54          	LD	D,H
 1421 E8BB  5D          	LD	E,L
 1422 E8BC  7E          RUP26:	LD	A,(HL)
 1423 E8BD  B7          	OR	A
 1424 E8BE  23          	INC	HL
 1425 E8BF  20 FB       	JR	NZ,RUP26
 1426 E8C1  C1          	POP	BC
 1427 E8C2  E3          	EX	(SP),HL
 1428 E8C3  C5          	PUSH	BC
 1429 E8C4  EB          	EX	DE,HL
 1430 E8C5  C9          	RET
 1431                   
 1432                   ; Zeile(n) loeschen
 1433                   
 1434 E8C6  C8          DELETE:	RET	Z
 1435 E8C7  CD C986     	CALL	DCHEX
 1436 E8CA  CA C442     	JP	Z,LIN13		; Zeiger auf folgende Zeilennummer stellen
 1437 E8CD  CD C8D6     	CALL	CPCOMM		; Komma?
 1438 E8D0  D5          	PUSH	DE
 1439 E8D1  CD C986     	CALL	DCHEX
 1440 E8D4  E1          	POP	HL
 1441 E8D5  C0          	RET	NZ
 1442 E8D6  EB          	EX	DE,HL
 1443 E8D7  E5          	PUSH	HL
 1444 E8D8  CD C4BB     	CALL	ZPOIT		; naechste Zeile
 1445 E8DB  30 0A       	JR	NC,DELET1	; UL-ERROR
 1446 E8DD  D1          	POP	DE
 1447 E8DE  F5          	PUSH	AF
 1448 E8DF  C5          	PUSH	BC
 1449 E8E0  CD C4BE     	CALL	ZPOIT1
 1450 E8E3  C1          	POP	BC
 1451 E8E4  DA C450     	JP	C,LIN6		; einsortieren
 1452 E8E7  C3 C44D     DELET1:	JP	ULER		; UL-ERROR
 1453                   
 1454                   ; Programm unterbrechen
 1455                   
 1456 E8EA  CD C8BE     PAUSE:	CALL	TCHAR1		; mit oder ohne Paramater?
 1457 E8ED  20 0F       	JR	NZ,PAUS2
 1458 E8EF  CD E374     PAUS1:	CALL	KBDS
 1459 E8F2  30 FB       	JR	NC,PAUS1
 1460 E8F4  FE 03       	CP	3		; BRK?
 1461 E8F6  C8          	RET	Z
 1462 E8F7  FE 0A       	CP	LF		; CUU?
 1463 E8F9  20 F4       	JR	NZ,PAUS1
 1464 E8FB  C3 DDE4     	JP	CI		; Eingabe ASCII
 1465                   	;
 1466 E8FE  CD D421     PAUS2:	CALL	ARGVL1		; Wert abholen
 1467 E901  4F          	LD	C,A
 1468 E902  3E 10       PAUS3:	LD	A,16		; 16*6ms = 96 Millisekunden
 1469 E904  1E 14       	LD	E,14H		; WAIT

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 100
CE45    INC

 1470 E906  CD F033     	CALL	PV5
 1471 E909  CD E374     	CALL	KBDS
 1472 E90C  30 0A       	JR	NC,PAUS4
 1473 E90E  FE 03       	CP	3		; BRK?
 1474 E910  C8          	RET	Z
 1475 E911  FE 0A       	CP	LF		; CUU?
 1476 E913  20 03       	JR	NZ,PAUS4
 1477 E915  C3 DDE4     	JP	CI		; Eingabe ASCII
 1478                   	;
 1479 E918  0D          PAUS4:	DEC	C		; Zaehler verringern
 1480 E919  20 E7       	JR	NZ,PAUS3	; weiter warten
 1481 E91B  C9          	RET
 1482                   
 1483                   ; Signalton
 1484                   
 1485 E91C  06 01       BBEEP:	LD	B,1		; ohne Angabe 1x
 1486 E91E  CD C8BE     	CALL	TCHAR1
 1487 E921  28 04       	JR	Z,BBP1
 1488 E923  CD D421     	CALL	ARGVL1		; Wert abholen
 1489 E926  47          	LD	B,A		; Anzahl
 1490 E927  3E 07       BBP1:	LD	A,7		; Beep
 1491 E929  1E 00       	LD	E,0		; CRT
 1492 E92B  CD F033     	CALL	PV5
 1493 E92E  10 F7       	DJNZ	BBP1
 1494 E930  C9          	RET
 1495                   
 1496                   ; Fenster einstellen
 1497                   
 1498 E931  CD C8BE     WINDOW:	CALL	TCHAR1		; Parameter angegeben?
 1499 E934  28 65       	JR	Z,WINDO1	; nein, dann volles Fenster einstellen
 1500 E936  E5          	PUSH	HL
 1501 E937  CD D421     	CALL	ARGVL1		; Wert abholen
 1502 E93A  E3          	EX	(SP),HL
 1503 E93B  21 B9F6     	LD	HL,WNDFN+90	; in Fenster 9
 1504 E93E  CD EBDA     	CALL	IRMWR		; erstellen
 1505 E941  23          	INC	HL
 1506 E942  E3          	EX	(SP),HL
 1507 E943  CD C8D6     	CALL	CPCOMM		; Komma?
 1508 E946  CD D421     	CALL	ARGVL1		; Wert abholen
 1509 E949  E3          	EX	(SP),HL
 1510 E94A  CD EBDA     	CALL	IRMWR
 1511 E94D  23          	INC	HL
 1512 E94E  E3          	EX	(SP),HL
 1513 E94F  CD C8D6     	CALL	CPCOMM		; Komma?
 1514 E952  CD D421     	CALL	ARGVL1		; Wert abholen
 1515 E955  E3          	EX	(SP),HL
 1516 E956  CD EBDA     	CALL	IRMWR
 1517 E959  E3          	EX	(SP),HL
 1518 E95A  CD C8D6     	CALL	CPCOMM		; Komma?
 1519 E95D  CD D421     	CALL	ARGVL1		; Wert abholen
 1520 E960  E3          	EX	(SP),HL
 1521 E961  57          	LD	D,A
 1522 E962  CD F08A     	CALL	IRMON
 1523 E965  FE 28       	CP	28H
 1524 E967  30 4D       	JR	NC,WINERR
 1525 E969  3A B9F8     	LD	A,(WNDFN+92)
 1526 E96C  5F          	LD	E,A
 1527 E96D  FE 28       	CP	28H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 101
CE45    INC

 1528 E96F  30 45       	JR	NC,WINERR
 1529 E971  7A          	LD	A,D
 1530 E972  93          	SUB	E
 1531 E973  38 41       	JR	C,WINERR
 1532 E975  3C          	INC	A
 1533 E976  32 B79E     	LD	(WINLG),A
 1534 E979  7B          	LD	A,E
 1535 E97A  32 B79C     	LD	(WINON),A
 1536 E97D  3A B9F7     	LD	A,(WNDFN+91)
 1537 E980  FE 20       	CP	20H
 1538 E982  30 32       	JR	NC,WINERR
 1539 E984  57          	LD	D,A
 1540 E985  3A B9F6     	LD	A,(WNDFN+90)
 1541 E988  FE 20       	CP	20H
 1542 E98A  30 2A       	JR	NC,WINERR
 1543 E98C  5F          	LD	E,A
 1544 E98D  7A          	LD	A,D
 1545 E98E  93          	SUB	E
 1546 E98F  38 25       	JR	C,WINERR
 1547 E991  3C          	INC	A
 1548 E992  32 B79F     	LD	(WINLG+1),A
 1549 E995  7B          	LD	A,E
 1550 E996  32 B79D     	LD	(WINON+1),A
 1551 E999  18 10       	JR	WINDO2
 1552                   	;
 1553 E99B  E5          WINDO1:	PUSH	HL
 1554 E99C  CD F08A     	CALL	IRMON
 1555 E99F  21 0100     	LD	HL,100H		; Standardfenstergoesse bei BASIC:
 1556 E9A2  22 B79C     	LD	(WINON),HL	; 30 Zeilen, 40 Zeichen breit
 1557 E9A5  21 1E28     	LD	HL,1E28H	; (oben und unten eine Zeile ungenutzt)
 1558 E9A8  22 B79E     	LD	(WINLG),HL
 1559 E9AB  21 0000     WINDO2:	LD	HL,0
 1560 E9AE  22 B7A0     	LD	(CURSO),HL
 1561 E9B1  CD F0A7     	CALL	IRMOF
 1562 E9B4  E1          	POP	HL
 1563 E9B5  C9          	RET
 1564                   	;
 1565 E9B6  CD F0A7     WINERR:	CALL	IRMOF
 1566 E9B9  C3 C348     SNERR2:	JP	SNER		; SN-ERROR
 1567                   
 1568                   ; MC-Programm laden:
 1569                   
 1570 E9BC  E5          BLOAD:	PUSH	HL
 1571 E9BD  21 B781     	LD	HL,ARGN
 1572 E9C0  AF          	XOR	A
 1573 E9C1  CD EBDA     	CALL	IRMWR		; ARGN=0
 1574 E9C4  E1          	POP	HL
 1575 E9C5  1E 10       	LD	E,10H		; LOAD
 1576 E9C7  C3 F033     	JP	PV5
 1577                   
 1578                   ; in IRM schreiben (8000h bis BFFFh):
 1579                   
 1580 E9CA  CD C96C     VPOKE:	CALL	EPRVL4
 1581 E9CD  D5          	PUSH	DE
 1582 E9CE  CD C8D6     	CALL	CPCOMM		; Komma?
 1583 E9D1  CD D421     	CALL	ARGVL1		; Wert abholen
 1584 E9D4  E3          	EX	(SP),HL
 1585 E9D5  11 8000     	LD	DE,8000H	; IRM-Offset

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 102
CE45    INC

 1586 E9D8  19          	ADD	HL,DE
 1587 E9D9  38 DE       	JR	C,SNERR2	; < 8000h
 1588 E9DB  57          	LD	D,A
 1589 E9DC  3E BF       	LD	A,0BFH
 1590 E9DE  BC          	CP	H
 1591 E9DF  38 D8       	JR	C,SNERR2	; > BFFFh
 1592 E9E1  7A          	LD	A,D
 1593 E9E2  CD EBDA     	CALL	IRMWR		; schreiben
 1594 E9E5  E1          	POP	HL
 1595 E9E6  C9          	RET
 1596                   
 1597                   ; alte Variante von BORDER bis CAOS 4.4
 1598                   ; schaltet RAM-8 (vermutlich nicht gewollt?)
 1599                   ;
 1600                   ;BORDER:
 1601                   ;	CALL	ARGVL1	; Wert abholen
 1602                   ;	RRCA
 1603                   ;	RRCA
 1604                   ;	RRCA
 1605                   ;	AND	60H	; Auswahl
 1606                   ;	LD	C,A
 1607                   ;	LD	B,9FH	; Maske
 1608                   ;	JP	TONB
 1609                   
 1610                   ; PRINT AT:
 1611                   
 1612 E9E7  3A 03FD     PRAT:	LD	A,(PRTFLG)
 1613 E9EA  CB 4F       	BIT	1,A
 1614 E9EC  CB CF       	SET	1,A
 1615 E9EE  32 03FD     	LD	(PRTFLG),A
 1616 E9F1  20 C6       	JR	NZ,SNERR2
 1617 E9F3  D5          	PUSH	DE
 1618 E9F4  E5          	PUSH	HL
 1619 E9F5  CD F08A     	CALL	IRMON
 1620 E9F8  21 B79C     	LD	HL,WINON
 1621 E9FB  22 B9F6     	LD	(WNDFN+90),HL
 1622 E9FE  11 B9EC     	LD	DE,WNDFN+80
 1623 EA01  01 0006     	LD	BC,6
 1624 EA04  ED B0       	LDIR			; Fenster retten
 1625 EA06  21 0000     	LD	HL,0		; Fenster gross
 1626 EA09  22 B79C     	LD	(WINON),HL
 1627 EA0C  21 2028     	LD	HL,2028H
 1628 EA0F  22 B79E     	LD	(WINLG),HL
 1629 EA12  CD F0A7     	CALL	IRMOF
 1630 EA15  E1          	POP	HL
 1631 EA16  CD EA47     	CALL	LOCAT
 1632 EA19  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1633 EA1C  CD C8CC     	CALL	CPSTX		; Semikolon?
 1634 EA1F  3B          	DB	';'
 1635 EA20  7E          	LD	A,(HL)
 1636 EA21  FE DF       	CP	0DFH
 1637 EA23  38 1D       	JR	C,PRAT2		; <DFH
 1638 EA25  FE E3       	CP	0E3H
 1639 EA27  30 19       	JR	NC,PRAT2	; >E2H
 1640 EA29  CD E67F     	CALL	PREX4		; INK, PAPER, COLOR
 1641 EA2C  E5          PRAT1:	PUSH	HL
 1642 EA2D  CD F08A     	CALL	IRMON
 1643 EA30  21 B9EC     	LD	HL,WNDFN+80

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 103
CE45    INC

 1644 EA33  11 B79C     	LD	DE,WINON
 1645 EA36  01 0006     	LD	BC,6
 1646 EA39  ED B0       	LDIR			; Fenster regenerieren
 1647 EA3B  CD F0A7     	CALL	IRMOF
 1648 EA3E  E1          	POP	HL
 1649 EA3F  D1          	POP	DE
 1650 EA40  C1          	POP	BC
 1651 EA41  C9          	RET
 1652                   	;
 1653 EA42  CD CB03     PRAT2:	CALL	PRINT2
 1654 EA45  18 E5       	JR	PRAT1
 1655                   
 1656                   ; Cursor positionieren:
 1657                   
 1658 EA47  CD C8BD     LOCAT:	CALL	TCHAR		; naechstes Zeichen holen
 1659 EA4A  CD C8CC     	CALL	CPSTX		; Klammer auf?
 1660 EA4D  28          	DB	'('
 1661 EA4E  CD D421     LOCATE:	CALL	ARGVL1		; Wert abholen
 1662 EA51  57          	LD	D,A
 1663 EA52  E5          	PUSH	HL
 1664 EA53  21 B79F     	LD	HL,WINLG+1
 1665 EA56  CD EBDE     	CALL	IRMRD
 1666 EA59  E1          	POP	HL
 1667 EA5A  3D          	DEC	A
 1668 EA5B  BA          	CP	D
 1669 EA5C  38 3F       	JR	C,SNERR3
 1670 EA5E  CD C8D6     	CALL	CPCOMM		; Komma?
 1671 EA61  D5          	PUSH	DE
 1672 EA62  CD D421     	CALL	ARGVL1		; Wert abholen
 1673 EA65  D1          	POP	DE
 1674 EA66  4F          	LD	C,A
 1675 EA67  E5          	PUSH	HL
 1676 EA68  21 B79E     	LD	HL,WINLG
 1677 EA6B  CD EBDE     	CALL	IRMRD
 1678 EA6E  E1          	POP	HL
 1679 EA6F  3D          	DEC	A
 1680 EA70  B9          	CP	C
 1681 EA71  38 2A       	JR	C,SNERR3
 1682 EA73  79          	LD	A,C
 1683 EA74  E5          	PUSH	HL
 1684 EA75  21 B7A0     	LD	HL,CURSO
 1685 EA78  CD EBDA     	CALL	IRMWR
 1686 EA7B  7A          	LD	A,D
 1687 EA7C  23          	INC	HL
 1688 EA7D  CD EBDA     LOC1:	CALL	IRMWR
 1689 EA80  E1          	POP	HL
 1690 EA81  C9          	RET
 1691                   
 1692                   ; Eingabe eines Zeichens:
 1693                   
 1694 EA82  E5          INKEY:	PUSH	HL
 1695 EA83  CD E374     	CALL	KBDS
 1696 EA86  30 0F       	JR	NC,INKEY3
 1697 EA88  3E 01       	LD	A,1
 1698 EA8A  CD D17B     	CALL	STADTB
 1699 EA8D  CD DDE4     	CALL	CI		; Eingabe ASCII
 1700 EA90  2A 03C2     INKEY1:	LD	HL,(STRDAT+2)
 1701 EA93  77          	LD	(HL),A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 104
CE45    INC

 1702 EA94  C3 D1A9     INKEY2:	JP	SLEN3
 1703                   	;
 1704 EA97  AF          INKEY3:	XOR	A
 1705 EA98  CD D17B     	CALL	STADTB
 1706 EA9B  18 F7       	JR	INKEY2
 1707                   
 1708 EA9D  C3 C348     SNERR3:	JP	SNER		; SN-ERROR
 1709                   
 1710                   ; Tonausgabe:
 1711                   
 1712 EAA0  CD D421     SOUND:	CALL	ARGVL1		; 1. Wert abholen
 1713 EAA3  E5          	PUSH	HL
 1714 EAA4  21 B782     	LD	HL,ARG1		; Argumente hier ablegen
 1715 EAA7  06 04       	LD	B,4		; 4 Argumente holen
 1716 EAA9  CD EBDA     SOUND1:	CALL	IRMWR		; Argument einschreiben
 1717 EAAC  23          	INC	HL
 1718 EAAD  E3          	EX	(SP),HL		; Umschaltung auf Programmzeiger
 1719 EAAE  05          	DEC	B
 1720 EAAF  28 0B       	JR	Z,SOUND2	; fertig mit 4 Werten
 1721 EAB1  C5          	PUSH	BC
 1722 EAB2  CD C8D6     	CALL	CPCOMM		; Komma?
 1723 EAB5  CD D421     	CALL	ARGVL1		; 2. bis 4. Wert abholen
 1724 EAB8  C1          	POP	BC
 1725 EAB9  E3          	EX	(SP),HL		; Umschaltung auf ARG-Zeiger
 1726 EABA  18 ED       	JR	SOUND1
 1727                   	;
 1728 EABC  CD C8BE     SOUND2:	CALL	TCHAR1		; weiterer Parameter?
 1729 EABF  28 1C       	JR	Z,SOUND3
 1730 EAC1  CD C8D6     	CALL	CPCOMM		; Komma?
 1731 EAC4  CD D421     	CALL	ARGVL1		; optionalen 5. Wert abholen
 1732 EAC7  E3          	EX	(SP),HL
 1733 EAC8  CD EBDA     	CALL	IRMWR
 1734 EACB  23          	INC	HL
 1735 EACC  E3          	EX	(SP),HL
 1736 EACD  CD C8BE     	CALL	TCHAR1		; weiterer Parameter?
 1737 EAD0  28 0B       	JR	Z,SOUND3
 1738 EAD2  CD C8D6     	CALL	CPCOMM		; Komma?
 1739 EAD5  CD D421     	CALL	ARGVL1		; optionalen 6. Wert abholen
 1740 EAD8  E3          	EX	(SP),HL
 1741 EAD9  CD EBDA     	CALL	IRMWR
 1742 EADC  E3          	EX	(SP),HL
 1743 EADD  1E 35       SOUND3:	LD	E,35H		; UP-Nr. fuer TON
 1744 EADF  C1          	POP	BC		; Stack bereinigen
 1745 EAE0  C3 F033     	JP	PV5		; Tonausgabe aufrufen
 1746                   
 1747                   ; Punkt setzen:
 1748                   
 1749 EAE3  06 01       PSET:	LD	B,1		; setzen
 1750 EAE5  C5          POINT:	PUSH	BC
 1751 EAE6  CD C96C     	CALL	EPRVL4
 1752 EAE9  E5          	PUSH	HL
 1753 EAEA  7B          	LD	A,E
 1754 EAEB  21 B7D3     	LD	HL,HOR
 1755 EAEE  CD EBDA     	CALL	IRMWR		; X-Koordinate (low)
 1756 EAF1  7A          	LD	A,D
 1757 EAF2  23          	INC	HL
 1758 EAF3  CD EBDA     	CALL	IRMWR		; X-Koordinate (high)
 1759 EAF6  E3          	EX	(SP),HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 105
CE45    INC

 1760 EAF7  CD C8D6     	CALL	CPCOMM		; Komma?
 1761 EAFA  CD D421     	CALL	ARGVL1		; Wert abholen
 1762 EAFD  E3          	EX	(SP),HL
 1763 EAFE  23          	INC	HL
 1764 EAFF  CD EBDA     	CALL	IRMWR		; Y-Koordinate
 1765 EB02  E1          	POP	HL
 1766 EB03  CD EB17     	CALL	GFARB
 1767 EB06  1E 30       	LD	E,30H		; UP-Nr. 30H fuer PUSE
 1768 EB08  C1          	POP	BC
 1769 EB09  05          	DEC	B
 1770 EB0A  28 01       	JR	Z,POINT2
 1771 EB0C  1D          	DEC	E		; UP-Nr. 2FH fuer PUDE
 1772 EB0D  CD F033     POINT2:	CALL	PV5
 1773 EB10  38 5B       	JR	C,FCERR		; FC-ERROR	(bisher SN-ERROR)
 1774 EB12  C9          	RET
 1775                   
 1776                   ; Punkt loeschen:
 1777                   
 1778 EB13  06 00       PRESET:	LD	B,0		; loeschen
 1779 EB15  18 CE       	JR	POINT
 1780                   
 1781                   ; Grafikfarbe einstellen:
 1782                   
 1783 EB17  CD C8BE     GFARB:	CALL	TCHAR1
 1784 EB1A  C8          	RET	Z
 1785 EB1B  CD C8D6     	CALL	CPCOMM		; Komma?
 1786 EB1E  CD D421     	CALL	ARGVL1		; Wert abholen
 1787 EB21  E5          	PUSH	HL
 1788 EB22  21 B7D6     	LD	HL,FARB		; Grafik-Farbe
 1789 EB25  17          	RLA
 1790 EB26  17          	RLA
 1791 EB27  17          	RLA
 1792 EB28  C3 EA7D     	JP	LOC1		; in IRM schreiben
 1793                   
 1794                   ; Vordergrundfarbe einstellen:
 1795                   
 1796 EB2B  CD D421     INK:	CALL	ARGVL1		; Wert abholen
 1797 EB2E  FE 20       	CP	32
 1798 EB30  30 3B       	JR	NC,FCERR	; FC-ERROR	(bisher SN-ERROR)
 1799 EB32  87          	ADD	A,A
 1800 EB33  87          	ADD	A,A
 1801 EB34  87          	ADD	A,A
 1802 EB35  57          	LD	D,A
 1803 EB36  E5          	PUSH	HL
 1804 EB37  21 B7A3     	LD	HL,COLOR
 1805 EB3A  CD EBDE     	CALL	IRMRD
 1806 EB3D  E1          	POP	HL
 1807 EB3E  E6 07       	AND	7
 1808 EB40  18 21       	JR	COL2
 1809                   
 1810                   ; Vordergrund- und Hintergrundfarbe einstellen:
 1811                   
 1812 EB42  CD C8BE     BCOLOR:	CALL	TCHAR1
 1813 EB45  28 26       	JR	Z,FCERR		; FC-ERROR	(bisher SN-ERROR)
 1814 EB47  CD EB2B     	CALL	INK		; Vordergrund
 1815 EB4A  CD C8BE     	CALL	TCHAR1
 1816 EB4D  C8          	RET	Z
 1817 EB4E  CD C8D6     	CALL	CPCOMM		; Komma?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 106
CE45    INC

 1818                   ;	JR	PAPER		; Hintergrund
 1819                   
 1820                   ; Hintergrundfarbe einstellen:
 1821                   
 1822 EB51  CD D421     PAPER:	CALL	ARGVL1		; Wert abholen
 1823 EB54  FE 08       COL1:	CP	8
 1824 EB56  30 15       	JR	NC,FCERR	; FC-ERROR	(bisher SN-ERROR)
 1825 EB58  57          	LD	D,A
 1826 EB59  E5          	PUSH	HL
 1827 EB5A  21 B7A3     	LD	HL,COLOR
 1828 EB5D  CD EBDE     	CALL	IRMRD
 1829 EB60  E1          	POP	HL
 1830 EB61  E6 F8       	AND	0F8H
 1831 EB63  B2          COL2:	OR	D
 1832 EB64  E5          	PUSH	HL
 1833 EB65  21 B7A3     	LD	HL,COLOR
 1834 EB68  CD EBDA     	CALL	IRMWR		; neuer Farbwert
 1835 EB6B  E1          	POP	HL
 1836 EB6C  C9          	RET
 1837                   	;
 1838 EB6D  C3 C967     FCERR:	JP	FCER		; FC-ERROR
 1839                   
 1840                   ; String1 in String2 suchen
 1841                   
 1842 EB70  CD CD36     INSTR:	CALL	SNALY6		; Klammer auf?
 1843 EB73  CD C8D6     	CALL	CPCOMM		; Komma?
 1844 EB76  E5          	PUSH	HL
 1845 EB77  CD D330     	CALL	LEN1		; Laenge holen
 1846 EB7A  28 F1       	JR	Z,FCERR		; FC-ERROR
 1847 EB7C  47          	LD	B,A
 1848 EB7D  23          	INC	HL
 1849 EB7E  23          	INC	HL
 1850 EB7F  5E          	LD	E,(HL)
 1851 EB80  23          	INC	HL
 1852 EB81  56          	LD	D,(HL)
 1853 EB82  E1          	POP	HL
 1854 EB83  D5          	PUSH	DE
 1855 EB84  C5          	PUSH	BC
 1856 EB85  CD CD3A     	CALL	SNALY
 1857 EB88  CD C8DB     	CALL	CPBRGT		; Klammer zu?
 1858 EB8B  C1          	POP	BC
 1859 EB8C  D1          	POP	DE
 1860 EB8D  E5          	PUSH	HL
 1861 EB8E  D5          	PUSH	DE
 1862 EB8F  C5          	PUSH	BC
 1863 EB90  CD D330     	CALL	LEN1		; Laenge holen
 1864 EB93  28 D8       	JR	Z,FCERR		; FC-ERROR
 1865 EB95  23          	INC	HL
 1866 EB96  23          	INC	HL
 1867 EB97  4E          	LD	C,(HL)
 1868 EB98  23          	INC	HL
 1869 EB99  66          	LD	H,(HL)
 1870 EB9A  69          	LD	L,C
 1871 EB9B  C1          	POP	BC
 1872 EB9C  4F          	LD	C,A
 1873 EB9D  D1          	POP	DE
 1874 EB9E  E5          	PUSH	HL
 1875 EB9F  C5          INSTR0:	PUSH	BC

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 107
CE45    INC

 1876 EBA0  D5          	PUSH	DE
 1877 EBA1  1A          	LD	A,(DE)
 1878 EBA2  BE          INSTR1:	CP	(HL)
 1879 EBA3  28 0F       	JR	Z,INSTR5
 1880 EBA5  23          	INC	HL
 1881 EBA6  0D          	DEC	C
 1882 EBA7  20 F9       	JR	NZ,INSTR1
 1883 EBA9  AF          INSTR2:	XOR	A
 1884 EBAA  E1          	POP	HL
 1885 EBAB  E1          	POP	HL
 1886 EBAC  E1          	POP	HL
 1887 EBAD  11 CDF3     INSTR3:	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 1888 EBB0  D5          	PUSH	DE
 1889 EBB1  C3 D0C0     	JP	POS1
 1890                   	;
 1891 EBB4  23          INSTR5:	INC	HL
 1892 EBB5  E5          	PUSH	HL
 1893 EBB6  2B          	DEC	HL
 1894 EBB7  23          INSTR6:	INC	HL
 1895 EBB8  0D          	DEC	C
 1896 EBB9  28 0E       	JR	Z,INSTR7
 1897 EBBB  13          	INC	DE
 1898 EBBC  05          	DEC	B
 1899 EBBD  28 11       	JR	Z,INSTR8
 1900 EBBF  1A          	LD	A,(DE)
 1901 EBC0  BE          	CP	(HL)
 1902 EBC1  28 F4       	JR	Z,INSTR6
 1903 EBC3  E1          	POP	HL
 1904 EBC4  D1          	POP	DE
 1905 EBC5  C1          	POP	BC
 1906 EBC6  0D          	DEC	C
 1907 EBC7  18 D6       	JR	INSTR0
 1908                   	;
 1909 EBC9  13          INSTR7:	INC	DE
 1910 EBCA  05          	DEC	B
 1911 EBCB  E1          	POP	HL
 1912 EBCC  20 DB       	JR	NZ,INSTR2
 1913 EBCE  18 01       	JR	INSTR9
 1914                   	;
 1915 EBD0  E1          INSTR8:	POP	HL
 1916 EBD1  D1          INSTR9:	POP	DE
 1917 EBD2  D1          	POP	DE
 1918 EBD3  D1          	POP	DE
 1919 EBD4  A7          	AND	A
 1920 EBD5  ED 52       	SBC	HL,DE
 1921 EBD7  7D          	LD	A,L
 1922 EBD8  18 D3       	JR	INSTR3
 1923                   
 1924                   ; Byte in IRM schreiben:
 1925                   
 1926 EBDA  1E 28       IRMWR:	LD	E,28H		; UP-Nr. fuer LDMA
 1927 EBDC  18 0D       	JR	JPV5
 1928                   
 1929                   ; Byte aus IRM lesen:
 1930                   
 1931 EBDE  1E 29       IRMRD:	LD	E,29H		; UP-Nr. fuer LDAM
 1932 EBE0  18 09       	JR	JPV5
 1933                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 108
CE45    INC

 1934                   ; F-Taste belegen:
 1935                   
 1936 EBE2  CD D421     BKEY:	CALL	ARGVL1		; Wert abholen
 1937 EBE5  FE 10       	CP	16		; F0 ... F15 zugelassen
 1938 EBE7  30 6F       	JR	NC,SNERR4
 1939 EBE9  1E 39       	LD	E,39H		; UP-Nr. fuer KEY
 1940 EBEB  C3 F033     JPV5:	JP	PV5
 1941                   
 1942                   ; F-Tasten auflisten:
 1943                   
 1944 EBEE              KEYLIST:
 1945 EBEE  1E 3A       	LD	E,3AH		; UP-Nr. fuer KEYLI
 1946 EBF0  18 F9       	JR	JPV5
 1947                   
 1948                   ; Module schalten:
 1949                   
 1950 EBF2  CD D421     SWITCH:	CALL	ARGVL1		; Wert abholen
 1951 EBF5  F5          	PUSH	AF
 1952 EBF6  CD C8D6     	CALL	CPCOMM		; Komma?
 1953 EBF9  CD D421     	CALL	ARGVL1		; Wert abholen
 1954 EBFC  57          	LD	D,A		; Steuerbyte
 1955 EBFD  F1          	POP	AF
 1956 EBFE  E5          	PUSH	HL
 1957 EBFF  6F          	LD	L,A		; Steckplatz
 1958 EC00  3E 02       	LD	A,2		; schalten
 1959 EC02  1E 26       	LD	E,26H		; UP-Nr. fuer MODU
 1960 EC04  CD F033     	CALL	PV5
 1961 EC07  E1          	POP	HL
 1962 EC08  C9          	RET
 1963                   
 1964                   ; Testen, ob Bildpunkt gesetzt ist:
 1965                   
 1966 EC09  CD CDE1     PTEST:	CALL	SNLY14		; Syntax-Check '('
 1967 EC0C  E3          	EX	(SP),HL
 1968 EC0D  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 1969 EC10  D5          	PUSH	DE
 1970 EC11  CD C96F     	CALL	EPRVL3
 1971 EC14  E5          	PUSH	HL
 1972 EC15  7B          	LD	A,E
 1973 EC16  21 B7D3     	LD	HL,HOR		; nur X-Koordinate eintragen
 1974 EC19  CD EBDA     	CALL	IRMWR
 1975 EC1C  7A          	LD	A,D
 1976 EC1D  23          	INC	HL		; Y-Koordinate
 1977 EC1E  CD EBDA     	CALL	IRMWR
 1978 EC21  1E 2F       	LD	E,2FH		; UP-Nr. fuer PUDE
 1979 EC23  CD F033     	CALL	PV5
 1980 EC26  DA C967     	JP	C,FCER		; ausserhalb -> FC-ERROR
 1981 EC29  06 00       	LD	B,0
 1982 EC2B  28 0C       	JR	Z,PTST1		; war geloescht
 1983 EC2D  23          	INC	HL
 1984 EC2E  23          	INC	HL
 1985 EC2F  CD EBDA     	CALL	IRMWR		; Grafikfarbe
 1986 EC32  1E 30       	LD	E,30H		; UP-Nr. fuer PUSE
 1987 EC34  CD F033     	CALL	PV5		; Punkt wieder setzen
 1988 EC37  06 01       	LD	B,1
 1989 EC39  78          PTST1:	LD	A,B		; Rueckgabewert
 1990 EC3A  18 65       	JR	JHPOS		; POP HL, JP POS1
 1991                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 109
CE45    INC

 1992                   ; IRM lesen (8000h bis BFFFh):
 1993                   
 1994 EC3C  CD CDE1     VPEEK:	CALL	SNLY14		; Syntax-Check '('
 1995 EC3F  E3          	EX	(SP),HL
 1996 EC40  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 1997 EC43  D5          	PUSH	DE
 1998 EC44  CD C96F     	CALL	EPRVL3
 1999 EC47  E5          	PUSH	HL
 2000 EC48  21 8000     	LD	HL,8000H	; IRM-Offset
 2001 EC4B  19          	ADD	HL,DE
 2002 EC4C  38 0A       	JR	C,SNERR4	; < 8000h
 2003 EC4E  3E BF       	LD	A,0BFH
 2004 EC50  BC          	CP	H
 2005 EC51  38 05       	JR	C,SNERR4	; > BFFFh
 2006 EC53  CD EBDE     	CALL	IRMRD
 2007 EC56  18 49       	JR	JHPOS		; POP HL, JP POS1
 2008                   
 2009 EC58  C3 C348     SNERR4:	JP	SNER		; SN-ERROR
 2010                   
 2011                   ; BASIC-Erweiterung 3: Funktionen
 2012                   
 2013 EC5B  79          BEXP3:	LD	A,C
 2014 EC5C  FE 62       	CP	62H
 2015 EC5E  28 DC       	JR	Z,VPEEK
 2016 EC60  FE 6E       	CP	6EH
 2017 EC62  28 A5       	JR	Z,PTEST
 2018 EC64  FE 7C       	CP	7CH
 2019 EC66  28 1A       	JR	Z,CSRLN
 2020 EC68  FE 76       	CP	76H
 2021 EC6A  28 39       	JR	Z,VGET
 2022 EC6C  D6 3E       	SUB	3EH
 2023 EC6E  38 E8       	JR	C,SNERR4
 2024 EC70  FE 07       	CP	7
 2025 EC72  30 E4       	JR	NC,SNERR4
 2026 EC74  EB          	EX	DE,HL
 2027 EC75  01 FDA4     	LD	BC,TOKJP	; Token-Adresstabelle
 2028 EC78  E1          	POP	HL
 2029 EC79  6F          	LD	L,A
 2030 EC7A  09          	ADD	HL,BC
 2031 EC7B  4E          	LD	C,(HL)
 2032 EC7C  23          	INC	HL
 2033 EC7D  66          	LD	H,(HL)
 2034 EC7E  69          	LD	L,C
 2035 EC7F  E5          	PUSH	HL		; Routine
 2036 EC80  EB          	EX	DE,HL		; anspringen
 2037 EC81  C9          	RET
 2038                   
 2039                   ; aktuelle Zeilennummer holen:
 2040                   
 2041 EC82  CD CDE1     CSRLN:	CALL	SNLY14		; Syntax-Check '('
 2042 EC85  E3          	EX	(SP),HL
 2043 EC86  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2044 EC89  D5          	PUSH	DE
 2045 EC8A  CD D424     	CALL	ARGVL2
 2046 EC8D  E5          	PUSH	HL
 2047 EC8E  A7          	AND	A		; Fenster beruecksichtigen?
 2048 EC8F  3E 00       	LD	A,0
 2049 EC91  20 06       	JR	NZ,CSRLN1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 110
CE45    INC

 2050 EC93  21 B79D     	LD	HL,WINON+1
 2051 EC96  CD EBDE     	CALL	IRMRD
 2052 EC99  47          CSRLN1:	LD	B,A
 2053 EC9A  21 B7A1     	LD	HL,CURSO+1
 2054 EC9D  CD EBDE     	CALL	IRMRD
 2055 ECA0  80          	ADD	A,B		; aktuelle Zeile
 2056 ECA1  E1          JHPOS:	POP	HL
 2057 ECA2  C3 D0C0     CSRLN2:	JP	POS1
 2058                   
 2059                   ; Zeichen von Bildschirm zurueck lesen
 2060                   
 2061 ECA5  E3          VGET:	EX	(SP),HL
 2062 ECA6  3E 01       	LD	A,1
 2063 ECA8  CD D17B     	CALL	STADTB
 2064 ECAB  CD F08A     	CALL	IRMON
 2065 ECAE  ED 5B B7A0  	LD	DE,(CURSO)
 2066 ECB2  CD E07C     	CALL	DABR
 2067 ECB5  7E          	LD	A,(HL)
 2068 ECB6  CD F0A7     	CALL	IRMOF
 2069 ECB9  C3 EA90     	JP	INKEY1		; als Zeichen zurueckgeben
 2070                   
 2071                   ; Kanal schliessen:
 2072                   
 2073 ECBC  0E 00       CLOSE:	LD	C,0
 2074 ECBE  7E          	LD	A,(HL)
 2075 ECBF  FE 49       	CP	'I'		; Eingabe?
 2076 ECC1  28 05       	JR	Z,CLOS1
 2077 ECC3  0C          	INC	C
 2078 ECC4  FE 4F       	CP	'O'		; Ausgabe?
 2079 ECC6  20 90       	JR	NZ,SNERR4
 2080 ECC8  C5          CLOS1:	PUSH	BC
 2081 ECC9  23          	INC	HL
 2082 ECCA  7E          	LD	A,(HL)
 2083 ECCB  FE 23       	CP	'#'
 2084 ECCD  20 89       CLOS2:	JR	NZ,SNERR4	; SN-ERROR
 2085 ECCF  23          	INC	HL
 2086 ECD0  CD D421     	CALL	ARGVL1		; Wert abholen
 2087 ECD3  E6 03       	AND	3		; 4 Geraete
 2088 ECD5  C1          	POP	BC
 2089 ECD6  C8          	RET	Z		; Console -> nichts tun
 2090 ECD7  E5          	PUSH	HL
 2091 ECD8  17          	RLA			; *2
 2092 ECD9  81          	ADD	A,C		; Ein-/Ausgabe
 2093 ECDA  F5          	PUSH	AF
 2094 ECDB  3D          	DEC	A
 2095 ECDC  47          	LD	B,A
 2096 ECDD  3E FF       	LD	A,-1
 2097 ECDF  17          CLOS3:	RLA			; Bit platzieren
 2098 ECE0  10 FD       	DJNZ	CLOS3
 2099 ECE2  21 0307     	LD	HL,IOCHNL	; E/A-Flag
 2100 ECE5  A6          	AND	(HL)		; Bit loeschen
 2101 ECE6  77          	LD	(HL),A
 2102 ECE7  F1          	POP	AF
 2103 ECE8  E1          	POP	HL
 2104 ECE9  CB F7       	SET	6,A		; close
 2105 ECEB  D5          	PUSH	DE
 2106 ECEC  5F          	LD	E,A
 2107 ECED  16 03       	LD	D,3		; BRK-Code

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 111
CE45    INC

 2108 ECEF  CD E00E     	CALL	BASIO		; Kanal schliessen
 2109 ECF2  D1          	POP	DE
 2110 ECF3  C9          	RET
 2111                   
 2112                   ; BASIC-Erweiterung JOYST(i)
 2113                   ; kompatibel zum KC 87 mit einem Joystick
 2114                   ;
 2115 ECF4  CD CDE1     JOYST:	CALL	SNLY14		; Syntax-Check '('
 2116 ECF7  E5          	PUSH	HL
 2117 ECF8  11 CDF3     	LD	DE,SNLY16	; Rueckkehr zu Syntax-Check ')'
 2118 ECFB  D5          	PUSH	DE
 2119 ECFC  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 2120 ECFF  7B          	LD	A,E
 2121 ED00  3D          	DEC	A
 2122 ED01  B2          	OR	D		; Argument gleich 1?
 2123 ED02  3E 00       	LD	A,0
 2124 ED04  20 9C       	JR	NZ,CSRLN2	; nein: Rueckgabewert 0
 2125 ED06  DB 90       	IN	A,(90h)		; M008 PIO A Daten
 2126 ED08  2F          	CPL
 2127 ED09  57          	LD	D,A
 2128 ED0A  E6 0F       	AND	00001111b	; nur Richtungsbits, CY=0
 2129 ED0C  1F          	RRA
 2130 ED0D  30 02       	JR	NC,JOYST1
 2131 ED0F  F6 10       	OR	00010000b	; <Up> auf Bit 3, CY=0
 2132 ED11  1F          JOYST1:	RRA
 2133 ED12  30 02       	JR	NC,JOYST2
 2134 ED14  F6 04       	OR	00000100b	; <Down> auf Bit 2
 2135 ED16  5F          JOYST2:	LD	E,A
 2136 ED17  3E 30       	LD	A,00110000b	; Feuertasten
 2137 ED19  A2          	AND	D
 2138 ED1A  B3          	OR	E
 2139 ED1B  18 85       	JR	CSRLN2		; Rueckgabewert in A
 2140                   
 2141                   ; Zufallsgenerator:
 2142                   
 2143 ED1D  ED 5F       RANDOM:	LD	A,R
 2144 ED1F  32 031D     	LD	(RNDVR3+2),A
 2145 ED22  C9          	RET
 2146                   
 2147                   ; Kanal oeffnen:
 2148                   
 2149 ED23  7E          OPEN:	LD	A,(HL)
 2150 ED24  23          	INC	HL
 2151 ED25  FE 49       	CP	'I'		; Eingabe?
 2152 ED27  28 19       	JR	Z,OPEN1
 2153 ED29  FE 4F       	CP	'O'		; Ausgabe?
 2154 ED2B  20 A0       	JR	NZ,CLOS2	; SN-ERROR
 2155 ED2D  CD DE25     	CALL	OUTCHL		; Kanal-Ausgabe
 2156 ED30  CD DDC8     	CALL	TESTCO
 2157 ED33  C8          	RET	Z
 2158 ED34  3E D5       	LD	A,0D5H		; *.UUU
 2159 ED36  CD DCB2     	CALL	CASS1		; Dateiname aufbereiten
 2160 ED39  21 03EA     	LD	HL,INTPRB	; Druckpuffer=Dateiname
 2161 ED3C  AF          	XOR	A
 2162 ED3D  CD DDD5     	CALL	CO		; Ausgabe eines Zeichens
 2163 ED40  E1          	POP	HL
 2164 ED41  C9          	RET
 2165                   	;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 112
CE45    INC

 2166 ED42  CD DE5F     OPEN1:	CALL	INCHNL		; Kanal-Eingabe
 2167 ED45  3A 0309     	LD	A,(ININD)	; IN-Index
 2168 ED48  E6 03       	AND	3
 2169 ED4A  C8          	RET	Z
 2170 ED4B  3E D5       	LD	A,0D5H		; *.UUU
 2171 ED4D  CD DCB2     	CALL	CASS1		; Dateiname aufbereiten
 2172 ED50  21 03EA     	LD	HL,INTPRB	; Druckpuffer=Dateiname
 2173 ED53  CD DDE4     	CALL	CI		; Eingabe eines Zeichens
 2174 ED56  E1          	POP	HL
 2175 ED57  C9          	RET
 2176                   
 2177                   ; Linie zeichnen:
 2178                   
 2179 ED58  01 043E     BLINE:	LD	BC,43EH		; 4 Parameter, LINE
 2180 ED5B  18 03       	JR	GRAPH
 2181                   
 2182                   ; Kreis zeichnen:
 2183                   
 2184 ED5D  01 033F     CIRCLE:	LD	BC,33FH		; 3 Parameter, CIRCLE
 2185 ED60  C5          GRAPH:	PUSH	BC
 2186 ED61  CD C96C     	CALL	EPRVL4
 2187 ED64  C1          	POP	BC
 2188 ED65  C5          	PUSH	BC
 2189 ED66  E5          	PUSH	HL
 2190 ED67  21 B782     	LD	HL,ARG1
 2191 ED6A  7B          GRAPH1:	LD	A,E
 2192 ED6B  CD EBDA     	CALL	IRMWR		; Ablage der Parameter
 2193 ED6E  23          	INC	HL
 2194 ED6F  7A          	LD	A,D
 2195 ED70  CD EBDA     	CALL	IRMWR
 2196 ED73  23          	INC	HL
 2197 ED74  05          	DEC	B
 2198 ED75  28 0C       	JR	Z,GRAPH2	; fertig
 2199 ED77  E3          	EX	(SP),HL
 2200 ED78  C5          	PUSH	BC
 2201 ED79  CD C8D6     	CALL	CPCOMM		; Komma?
 2202 ED7C  CD C96C     	CALL	EPRVL4		; naechsten Wert
 2203 ED7F  C1          	POP	BC
 2204 ED80  E3          	EX	(SP),HL
 2205 ED81  18 E7       	JR	GRAPH1
 2206                   	;
 2207 ED83  E1          GRAPH2:	POP	HL
 2208 ED84  CD EB17     	CALL	GFARB
 2209 ED87  D1          	POP	DE
 2210 ED88  C3 F033     	JP	PV5
 2211                   
 2212                   ; Laufwerk wechseln
 2213                   ;	Aufruf: DRIVE Lw[,User]
 2214                   ;	Lw = Laufwerk 0..15 fuer A: bis P:
 2215                   ;	User = 0..31 (2. Parameter optional)
 2216                   
 2217 ED8B  01 B3F3     BDRIVE:	LD	BC,UROK		; 0B3F3H
 2218 ED8E  ED 78       	IN	A,(C)
 2219 ED90  FE 05       	CP	5		; D004 KC-Betriebsart?
 2220 ED92  20 3F       	JR	NZ,BDR2		; nein -> SN-ERROR
 2221 ED94  01 83F1     	LD	BC,DEPVER	; 083F1H
 2222 ED97  ED 78       	IN	A,(C)
 2223 ED99  FE 20       	CP	20H		; DEP ab 2.0?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 113
CE45    INC

 2224 ED9B  38 36       	JR	C,BDR2		; nein -> SN-ERROR
 2225 ED9D  CD D421     	CALL	ARGVL1		; Wert holen
 2226 EDA0  FE 10       	CP	16
 2227 EDA2  30 2F       	JR	NC,BDR2		; Laufwerk > 15
 2228 EDA4  C6 41       	ADD	A,'A'		; in A..P konvertieren
 2229 EDA6  01 81F1     	LD	BC,LWANF
 2230 EDA9  ED 79       	OUT	(C),A		; LW-Anforderung
 2231 EDAB  CD C8BE     	CALL	TCHAR1		; weiterer Parameter?
 2232 EDAE  3E 03       	LD	A,3		; nur LW-Wechsel
 2233 EDB0  28 11       	JR	Z,BDR1
 2234 EDB2  CD C8D6     	CALL	CPCOMM		; Komma?
 2235 EDB5  CD D421     	CALL	ARGVL1		; optionalen 2. Wert holen
 2236 EDB8  FE 20       	CP	32
 2237 EDBA  30 17       	JR	NC,BDR2		; USER > 31
 2238 EDBC  01 82F1     	LD	BC,UANF
 2239 EDBF  ED 79       	OUT	(C),A		; USER-Anforderung
 2240 EDC1  3E 07       	LD	A,7		; Laufwerk+USER wechseln
 2241 EDC3  CD F08A     BDR1:	CALL	IRMON		; IRM ein
 2242 EDC6  CD FB4A     	CALL	CON		; CAOS-C ein
 2243 EDC9  CD D5DE     	CALL	DRIV5		; ueber Steuerbyte 2 anfordern
 2244 EDCC  CD FB57     	CALL	COFF		; CAOS-C aus
 2245 EDCF  CD F0A7     	CALL	IRMOF		; IRM aus
 2246 EDD2  C9          	RET
 2247 EDD3  C3 C348     BDR2:	JP	SNER		; SN-ERROR
 2248                   
 2249                   ; Initialisierungstabelle fuer M021:
 2250                   
 2251 EDD6  03          CENINI:	DB	3
 2252                   
 2253 EDD7  92 05       JOYINI:	 DB	92h,5		; PIO-A Steuerwort
 2254 EDD9  E0          	  DB	0E0h		; Interruptvektor
 2255 EDDA  CF          	  DB	11001111b	; Einzelbit-Steuermodus
 2256 EDDB  7F          	  DB	01111111b	; Bit 7 Ausgabe
 2257 EDDC  97          	  DB	10010111b	; Interrupt bei jeder Bitaenderung
 2258 EDDD  C0          	  DB	11000000b	; Ueberwache Bits 0..5
 2259                   
 2260 EDDE  93 02       	 DB	93h,2		; PIO-B Steuerwort
 2261 EDE0  CF          	  DB	11001111b	; Bitbetrieb
 2262 EDE1  00          	  DB	00000000b	; alles Ausgaenge
 2263                   
 2264 EDE2  90 01       	 DB	90h,1		; PIO-A Daten
 2265 EDE4  80          	  DB	10000000b	; Strobe passiv
 2266                   
 2267                   ; Tabelle der ESC-Funktionen:
 2268                   
 2269 EDE5  E1CE        ESCTAB:	DW	ESC0		; Tabulator
 2270 EDE7  F913        	DW	ESC1		; Anz0	Zugr0
 2271 EDE9  F918        	DW	ESC2		; 1	1
 2272 EDEB  F91D        	DW	ESC3		; 0	1
 2273 EDED  F922        	DW	ESC4		; 1	0
 2274 EDEF  F0F5        	DW	ESC5		; MODUL
 2275 EDF1  F82F        	DW	ESC6		; SYSTEM
 2276 EDF3  F93A        	DW	ESC7		; PixInvers o/o
 2277 EDF5  E2C7        	DW	ESC8		; ColSwap o/o
 2278 EDF7  F943        	DW	ESC9		; Farbebene o/o
 2279 EDF9  F94B        	DW	ESCA		; HiRes o/o
 2280 EDFB  F961        	DW	ESCB		; HRG o/o
 2281 EDFD  F968        	DW	ESCC		; IBM/CAOS

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 114
CE45    INC

 2282                   
 2283                   	ABSFILL	0EDFFh,<ROM-E-Ende>
 2284                   
 2285 EDFF              VERSION:
 2286 EDFF  45          	DB	45H		; CAOS-Version
  152                   	INCLUDE ZSGROSS.INC	; Zeichensatz Grossbuchstaben
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 Zeichensatz Gross	**
    3                   ;**					**
    4                   ;**	Adresse:  EE00h bis EFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 13.05.2010	**
    7                   ;*****************************************
    8                   
    9 EE00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 000H, 000H	; 20H
   10 EE08  30 78 78 30 	DB	030H, 078H, 078H, 030H, 030H, 000H, 030H, 000H	; 21H
   11 EE10  77 33 66 00 	DB	077H, 033H, 066H, 000H, 000H, 000H, 000H, 000H	; 22H
   12 EE18  36 36 FE 6C 	DB	036H, 036H, 0FEH, 06CH, 0FEH, 0D8H, 0D8H, 000H	; 23H
   13 EE20  18 3E 6C 3E 	DB	018H, 03EH, 06CH, 03EH, 01BH, 01BH, 07EH, 018H	; 24H
   14 EE28  00 C6 CC 18 	DB	000H, 0C6H, 0CCH, 018H, 030H, 066H, 0C6H, 000H	; 25H
   15 EE30  38 6C 38 76 	DB	038H, 06CH, 038H, 076H, 0DCH, 0CCH, 076H, 000H	; 26H
   16 EE38  1C 0C 18 00 	DB	01CH, 00CH, 018H, 000H, 000H, 000H, 000H, 000H	; 27H
   17 EE40  18 30 60 60 	DB	018H, 030H, 060H, 060H, 060H, 030H, 018H, 000H	; 28H
   18 EE48  60 30 18 18 	DB	060H, 030H, 018H, 018H, 018H, 030H, 060H, 000H	; 29H
   19 EE50  00 66 3C FF 	DB	000H, 066H, 03CH, 0FFH, 03CH, 066H, 000H, 000H	; 2AH
   20 EE58  00 30 30 FC 	DB	000H, 030H, 030H, 0FCH, 030H, 030H, 000H, 000H	; 2BH
   21 EE60  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 01CH, 00CH, 018H	; 2CH
   22 EE68  00 00 00 FE 	DB	000H, 000H, 000H, 0FEH, 000H, 000H, 000H, 000H	; 2DH
   23 EE70  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 030H, 030H, 000H	; 2EH
   24 EE78  06 0C 18 30 	DB	006H, 00CH, 018H, 030H, 060H, 0C0H, 080H, 000H	; 2FH
   25                   
   26 EE80  7C C6 CE DE 	DB	07CH, 0C6H, 0CEH, 0DEH, 0F6H, 0E6H, 07CH, 000H	; 30H
   27 EE88  30 70 30 30 	DB	030H, 070H, 030H, 030H, 030H, 030H, 0FCH, 000H	; 31H
   28 EE90  78 CC 0C 38 	DB	078H, 0CCH, 00CH, 038H, 060H, 0CCH, 0FCH, 000H	; 32H
   29 EE98  FC 18 30 78 	DB	0FCH, 018H, 030H, 078H, 00CH, 0CCH, 078H, 000H	; 33H
   30 EEA0  1C 3C 6C CC 	DB	01CH, 03CH, 06CH, 0CCH, 0FEH, 00CH, 01EH, 000H	; 34H
   31 EEA8  FC C0 F8 0C 	DB	0FCH, 0C0H, 0F8H, 00CH, 00CH, 0CCH, 078H, 000H	; 35H
   32 EEB0  38 60 C0 F8 	DB	038H, 060H, 0C0H, 0F8H, 0CCH, 0CCH, 078H, 000H	; 36H
   33 EEB8  FC CC 0C 18 	DB	0FCH, 0CCH, 00CH, 018H, 030H, 030H, 030H, 000H	; 37H
   34 EEC0  78 CC CC 78 	DB	078H, 0CCH, 0CCH, 078H, 0CCH, 0CCH, 078H, 000H	; 38H
   35 EEC8  78 CC CC 7C 	DB	078H, 0CCH, 0CCH, 07CH, 00CH, 018H, 070H, 000H	; 39H
   36 EED0  00 00 30 30 	DB	000H, 000H, 030H, 030H, 000H, 030H, 030H, 000H	; 3AH
   37 EED8  00 00 30 30 	DB	000H, 000H, 030H, 030H, 000H, 030H, 030H, 060H	; 3BH
   38 EEE0  18 30 60 C0 	DB	018H, 030H, 060H, 0C0H, 060H, 030H, 018H, 000H	; 3CH
   39 EEE8  00 00 FC 00 	DB	000H, 000H, 0FCH, 000H, 0FCH, 000H, 000H, 000H	; 3DH
   40 EEF0  60 30 18 0C 	DB	060H, 030H, 018H, 00CH, 018H, 030H, 060H, 000H	; 3EH
   41 EEF8  78 CC 0C 18 	DB	078H, 0CCH, 00CH, 018H, 030H, 000H, 030H, 000H	; 3FH
   42                   
   43 EF00  7C C6 DE D6 	DB	07CH, 0C6H, 0DEH, 0D6H, 0DEH, 0C0H, 078H, 000H	; 40H neu
   44 EF08  30 78 CC CC 	DB	030H, 078H, 0CCH, 0CCH, 0FCH, 0CCH, 0CCH, 000H	; 41H
   45 EF10  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 066H, 066H, 0FCH, 000H	; 42H
   46 EF18  3C 66 C0 C0 	DB	03CH, 066H, 0C0H, 0C0H, 0C0H, 066H, 03CH, 000H	; 43H
   47 EF20  F8 6C 66 66 	DB	0F8H, 06CH, 066H, 066H, 066H, 06CH, 0F8H, 000H	; 44H
   48 EF28  FE 62 68 78 	DB	0FEH, 062H, 068H, 078H, 068H, 062H, 0FEH, 000H	; 45H
   49 EF30  FE 62 68 78 	DB	0FEH, 062H, 068H, 078H, 068H, 060H, 0F0H, 000H	; 46H
   50 EF38  3C 66 C0 C0 	DB	03CH, 066H, 0C0H, 0C0H, 0CEH, 066H, 03CH, 000H	; 47H
   51 EF40  CC CC CC FC 	DB	0CCH, 0CCH, 0CCH, 0FCH, 0CCH, 0CCH, 0CCH, 000H	; 48H
   52 EF48  78 30 30 30 	DB	078H, 030H, 030H, 030H, 030H, 030H, 078H, 000H	; 49H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 115
ZSGROSS INC

   53 EF50  1E 0C 0C 0C 	DB	01EH, 00CH, 00CH, 00CH, 0CCH, 0CCH, 078H, 000H	; 4AH
   54 EF58  E6 66 6C 70 	DB	0E6H, 066H, 06CH, 070H, 06CH, 066H, 0E6H, 000H	; 4BH
   55 EF60  F0 60 60 60 	DB	0F0H, 060H, 060H, 060H, 062H, 066H, 0FEH, 000H	; 4CH
   56 EF68  C6 EE FE D6 	DB	0C6H, 0EEH, 0FEH, 0D6H, 0C6H, 0C6H, 0C6H, 000H	; 4DH
   57 EF70  C6 E6 F6 DE 	DB	0C6H, 0E6H, 0F6H, 0DEH, 0CEH, 0C6H, 0C6H, 000H	; 4EH
   58 EF78  38 6C C6 C6 	DB	038H, 06CH, 0C6H, 0C6H, 0C6H, 06CH, 038H, 000H	; 4FH
   59                   
   60 EF80  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 060H, 060H, 0F0H, 000H	; 50H
   61 EF88  78 CC CC CC 	DB	078H, 0CCH, 0CCH, 0CCH, 0DCH, 078H, 01CH, 000H	; 51H
   62 EF90  FC 66 66 7C 	DB	0FCH, 066H, 066H, 07CH, 06CH, 066H, 0E6H, 000H	; 52H
   63 EF98  7C C6 F0 3C 	DB	07CH, 0C6H, 0F0H, 03CH, 00EH, 0C6H, 07CH, 000H	; 53H
   64 EFA0  FC B4 30 30 	DB	0FCH, 0B4H, 030H, 030H, 030H, 030H, 078H, 000H	; 54H
   65 EFA8  CC CC CC CC 	DB	0CCH, 0CCH, 0CCH, 0CCH, 0CCH, 0CCH, 078H, 000H	; 55H
   66 EFB0  CC CC CC 78 	DB	0CCH, 0CCH, 0CCH, 078H, 078H, 030H, 030H, 000H	; 56H
   67 EFB8  C6 C6 C6 D6 	DB	0C6H, 0C6H, 0C6H, 0D6H, 0FEH, 0EEH, 0C6H, 000H	; 57H
   68 EFC0  C6 C6 6C 38 	DB	0C6H, 0C6H, 06CH, 038H, 06CH, 0C6H, 0C6H, 000H	; 58H
   69 EFC8  CC CC CC 78 	DB	0CCH, 0CCH, 0CCH, 078H, 030H, 030H, 078H, 000H	; 59H
   70 EFD0  FE C6 8C 18 	DB	0FEH, 0C6H, 08CH, 018H, 032H, 066H, 0FEH, 000H	; 5AH
   71 EFD8  FF FF FF FF 	DB	0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH, 0FFH	; 5BH
   72 EFE0  18 18 18 18 	DB	018H, 018H, 018H, 018H, 018H, 018H, 018H, 000H	; 5CH
   73 EFE8  00 FE 06 06 	DB	000H, 0FEH, 006H, 006H, 000H, 000H, 000H, 000H	; 5DH
   74 EFF0  10 38 6C C6 	DB	010H, 038H, 06CH, 0C6H, 000H, 000H, 000H, 000H	; 5EH
   75 EFF8  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 000H, 0FFH	; 5FH
  153                   
  154                   	INCLUDE	CF45.INC	; ROM-F (F000-FDFF)
    1                   ;*****************************************
    2                   ;**	CAOS 4.5	ROM F		**
    3                   ;**					**
    4                   ;**	Adresse:  F000h bis FDFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 26.08.2010	**
    7                   ;*****************************************
    8                   
    9                   ;	ORG	0F000H
   10                   
   11 F000  C3 F14D     	JP	PWRON
   12 F003  C3 F057     	JP	PV1		; DEFB nr
   13 F006  C3 F073     	JP	PV2		; (ARGC)=nr
   14 F009  C3 F087     	JP	PV3		; E=nr
   15 F00C  C3 F03F     	JP	PV4		; E=nr, IRM e/a
   16 F00F  C3 F0BE     	JP	RCALL		; DEFW offset
   17 F012  C3 F154     	JP	BYE		; JUMP-Einsprung
   18 F015  C3 F033     	JP	PV5		; E=nr, IRM/Stack
   19 F018  C3 F08A     	JP	IRMON
   20 F01B  C3 F0A7     	JP	IRMOF
   21 F01E  C3 F02A     	JP	PV6		; (ARGC)=nr
   22 F021  CD FB4A     JDISK:	CALL	CON
   23 F024  CD D000     	CALL	JDISC		; DISK-Verteiler
   24 F027  C3 FB57     	JP	COFF
   25                   
   26 F02A  C5          PV6:	PUSH	BC
   27 F02B  CD F08A     	CALL	IRMON
   28 F02E  CD F073     	CALL	PV2
   29 F031  18 07       	JR	PV51
   30                   
   31 F033  C5          PV5:	PUSH	BC
   32 F034  CD F08A     	CALL	IRMON
   33 F037  CD F087     	CALL	PV3

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 116
CF45    INC

   34 F03A  CD F0A7     PV51:	CALL	IRMOF
   35 F03D  C1          	POP	BC
   36 F03E  C9          	RET
   37                   
   38 F03F  CD F04E     PV4:	CALL	SCRON
   39 F042  CD F087     	CALL	PV3
   40 F045  F5          SCROFF:	PUSH	AF
   41 F046  DB 88       	IN	A,(PIOAD)
   42 F048  E6 FB       	AND	11111011b	; IRM aus
   43 F04A  D3 88       	OUT	(PIOAD),A
   44 F04C  F1          	POP	AF
   45 F04D  C9          	RET
   46                   
   47 F04E  F5          SCRON:	PUSH	AF
   48 F04F  DB 88       	IN	A,(PIOAD)
   49 F051  F6 04       	OR	00000100b	; IRM ein
   50 F053  D3 88       	OUT	(PIOAD),A
   51 F055  F1          	POP	AF
   52 F056  C9          	RET
   53                   
   54 F057  F3          PV1:	DI
   55 F058  E5          	PUSH	HL
   56 F059  E1          	POP	HL
   57 F05A  E1          	POP	HL
   58 F05B  23          	INC	HL		; nr uebergehen
   59 F05C  E5          	PUSH	HL
   60 F05D  2B          	DEC	HL		; (HL)=nr
   61 F05E  3B          	DEC	SP
   62 F05F  3B          	DEC	SP
   63 F060  FB          	EI
   64 F061  F5          	PUSH	AF
   65 F062  D5          	PUSH	DE
   66 F063  5E          	LD	E,(HL)
   67 F064  16 00       PV22:	LD	D,0
   68 F066  2A B7B0     	LD	HL,(SUTAB)
   69 F069  19          	ADD	HL,DE
   70 F06A  19          	ADD	HL,DE		; HL=Pos. in Tab
   71 F06B  5E          	LD	E,(HL)
   72 F06C  23          	INC	HL
   73 F06D  56          	LD	D,(HL)
   74 F06E  EB          	EX	DE,HL
   75 F06F  D1          	POP	DE
   76 F070  F1          	POP	AF
   77 F071  E3          EXRT:	EX	(SP),HL
   78 F072  C9          	RET			; UP anspringen
   79                   
   80 F073  A7          PV2:	AND	A		; VR: F
   81 F074  E5          PV21:	PUSH	HL
   82 F075  D5          	PUSH	DE
   83 F076  C5          	PUSH	BC
   84 F077  E5          	PUSH	HL
   85 F078  21 F3EC     	LD	HL,POP3		; Returnadresse
   86 F07B  E3          	EX	(SP),HL		; kellern
   87 F07C  E5          	PUSH	HL
   88 F07D  F5          	PUSH	AF
   89 F07E  D5          	PUSH	DE
   90 F07F  38 E3       	JR	C,PV22		; falls PV3
   91 F081  3A B780     	LD	A,(ARGC)	; sonst E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 117
CF45    INC

   92 F084  5F          	LD	E,A		; beschaffen
   93 F085  18 DD       	JR	PV22
   94                   
   95 F087  37          PV3:	SCF			; VR: F
   96 F088  18 EA       	JR	PV21
   97                   
   98 F08A  C1          IRMON:	POP	BC		; Rueckkehradresse
   99 F08B  FD E5       	PUSH	IY
  100 F08D  FD 21 0000  	LD	IY,0		; SP in IY merken
  101 F091  FD 39       	ADD	IY,SP		; (kein UP veraendert IY!)
  102 F093  F3          	DI
  103 F094  DD 77 0B    	LD	(IX+11),A
  104 F097  DB 88       	IN	A,(PIOAD)
  105 F099  F6 24       	OR	00100100b	; IRM+LED ein
  106 F09B  D3 88       	OUT	(PIOAD),A
  107 F09D  ED 7B B7AE  	LD	SP,(SYSP)
  108 F0A1  FB          	EI
  109 F0A2  DD 7E 0B    	LD	A,(IX+11)
  110 F0A5  C5          	PUSH	BC
  111 F0A6  C9          	RET			; wie JP (BC)
  112                   
  113 F0A7  C1          IRMOF:	POP	BC		; analog IRMON
  114 F0A8  DD 77 0B    	LD	(IX+11),A
  115 F0AB  DB 88       	IN	A,(PIOAD)
  116 F0AD  CB 97       	RES	2,A		; IRM+LED aus
  117 F0AF  CB AF       	RES	5,A		; (F unveraendert)
  118 F0B1  F3          	DI
  119 F0B2  D3 88       	OUT	(PIOAD),A
  120 F0B4  FD F9       	LD	SP,IY
  121 F0B6  FB          	EI
  122 F0B7  DD 7E 0B    	LD	A,(IX+11)
  123 F0BA  FD E1       	POP	IY
  124 F0BC  C5          	PUSH	BC
  125 F0BD  C9          	RET
  126                   
  127                   ; Relativer UP-Aufruf ohne Registerzerstoerung:
  128                   
  129 F0BE  E3          RCALL:	EX	(SP),HL
  130 F0BF  D5          	PUSH	DE
  131 F0C0  5E          	LD	E,(HL)
  132 F0C1  23          	INC	HL
  133 F0C2  56          	LD	D,(HL)		; DE=Offset
  134 F0C3  23          	INC	HL
  135 F0C4  EB          	EX	DE,HL
  136 F0C5  19          	ADD	HL,DE		; addieren
  137 F0C6  E3          	EX	(SP),HL		; Zieladresse
  138 F0C7  EB          	EX	DE,HL		; DE von Stack
  139 F0C8  F3          	DI
  140 F0C9  33          	INC	SP
  141 F0CA  33          	INC	SP
  142 F0CB  E3          	EX	(SP),HL		; HL von Stack
  143 F0CC  3B          	DEC	SP
  144 F0CD  3B          	DEC	SP
  145 F0CE  FB          	EI
  146 F0CF  C9          	RET			; Ziel anspringen
  147                   
  148 F0D0  DD 7E 02    BNROST:	LD	A,(IX+2)	; Blocknummer
  149 F0D3  CD F3C4     AHOSTR:	CALL	AHEX		; RG A und folg. ZK

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 118
CF45    INC

  150 F0D6  E3          OSTR:	EX	(SP),HL		; **23**
  151 F0D7  7E          OSTR1:	LD	A,(HL)		; ausgeben
  152 F0D8  23          	INC	HL
  153 F0D9  A7          	AND	A		; bis NUL-Byte
  154 F0DA  28 95       	JR	Z,EXRT
  155 F0DC  CD F3D5     	CALL	OCHR
  156 F0DF  18 F6       	JR	OSTR1
  157                   
  158                   ; Module listen, lesen, schalten:
  159                   
  160 F0E1  7F7F        SWI7F:	DW	7F7FH
  161 F0E3  53 57 49 54 	DB	'SWITCH'
  162 F0E9  01          	DB	1
  163 F0EA  A7          	AND	A		; Argumente?
  164 F0EB  28 08       	JR	Z,ESC5
  165 F0ED  CD FB4A     	CALL	CON
  166 F0F0  CD C2D3     	CALL	SWIC		; lesen/schalten
  167 F0F3  18 0E       	JR	MCOFF
  168                   
  169 F0F5  CD FB4A     ESC5:	CALL	CON
  170 F0F8  CD C203     	CALL	MODULC		; Module listen
  171 F0FB  18 06       	JR	MCOFF
  172                   
  173                   ; Module lesen und Schalten
  174 F0FD  CD FB4A     MODU:	CALL	CON		; **26**
  175 F100  CD C307     	CALL	MODUC
  176 F103  C3 FB57     MCOFF:	JP	COFF
  177                   
  178                   ; Betriebssystem wechseln:
  179                   
  180 F106  7F7F        JUMP7F:	DW	7F7FH
  181 F108  4A 55 4D 50 	DB	'JUMP'
  182 F10C  03          	DB	3
  183 F10D  7D          	LD	A,L
  184 F10E  47          JUMP:	LD	B,A		; **27**
  185 F10F  0E 80       	LD	C,80H
  186 F111  ED 78       	IN	A,(C)
  187 F113  3C          	INC	A		; Kennbyte FF?
  188 F114  20 13       	JR	NZ,JUM0
  189 F116  CD F0D6     	CALL	OSTR
  190 F119  4B 65 69 6E 	DB	'Kein Modul!'
  191 F124  07 0D 0A 00 	DB	7,CR,LF,0
  192 F128  C9          	RET
  193 F129  C5          JUM0:	PUSH	BC
  194 F12A  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
  195 F12C  06 07       	LD	B,7		; ab Platz 7!
  196 F12E  04          JUM1:	INC	B
  197 F12F  28 0D       	JR	Z,JUM2		; bis FF
  198 F131  ED 78       	IN	A,(C)
  199 F133  2F          	CPL
  200 F134  E6 70       	AND	70H		; Speichermodul?
  201 F136  20 F6       	JR	NZ,JUM1
  202 F138  ED 79       	OUT	(C),A		; aus
  203 F13A  68          	LD	L,B
  204 F13B  77          	LD	(HL),A
  205 F13C  18 F0       	JR	JUM1
  206                   	;
  207 F13E  C1          JUM2:	POP	BC

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 119
CF45    INC

  208 F13F  3E FF       	LD	A,0FFH		; Ausgabe FF
  209 F141  68          	LD	L,B
  210 F142  77          	LD	(HL),A		; Eintrag
  211 F143  F3          	DI
  212 F144  ED 79       	OUT	(C),A		; einschalten
  213 F146  DB 88       	IN	A,(PIOAD)
  214 F148  E6 7E       	AND	01111110b
  215 F14A  C3 B7B4     	JP	BJUMP		; in IRM
  216                   
  217                   ; Einschalt-Initialisierung:
  218                   
  219 F14D  3E E3       PWRON:	LD	A,0E3H		; RAM4 WR einschalten,
  220 F14F  D3 86       	OUT	(86H),A		; und CAOS-C ein
  221 F151  C3 C061     	JP	PWRONC		; Programm im ROM-C weiter abarbeiten ...
  222                   ;
  223                   ; Tasten-RESET:
  224                   ;
  225 F154  31 01C4     BYE:	LD	SP,01C4H	; System-Stackpointer
  226 F157  3E E3       	LD	A,0E3H		; RAM4 WR einschalten,
  227 F159  D3 86       	OUT	(86H),A		; und CAOS-C ein
  228 F15B  CD C0A1     	CALL	SYSI		; Systeminitialisierung
  229 F15E  CD C95C     PWR4:	CALL	V24INI		; M003 suchen und initialisieren
  230 F161  CD FB57     	CALL	COFF		; CAOS-C ausschalten (Standard)
  231 F164  01 0880     	LD	BC,880H		; auf Steckplatz 8
  232 F167  ED 78       	IN	A,(C)		; ROM-Modul mit Strukturbyte
  233 F169  3D          	DEC	A		; 01 vorhanden?
  234 F16A  20 14       	JR	NZ,PWR6		; nein!
  235 F16C  3E 43       	LD	A,43H
  236 F16E  ED 79       	OUT	(C),A		; einschalten auf Adresse 4000H
  237 F170  32 B808     	LD	(MODST+8),A	; Schaltzustand eintragen
  238 F173  DD 7E 04    	LD	A,(IX+4)
  239 F176  E6 FC       	AND	0FCH		; internen RAM4 ausschalten
  240 F178  DD 77 04    	LD	(IX+4),A
  241 F17B  D3 86       	OUT	(86H),A
  242 F17D  C3 4000     	JP	4000H		; Adresse 4000h im Modul anspringen
  243                   	;
  244 F180  06 FC       PWR6:	LD	B,0FCH
  245 F182  ED 78       	IN	A,(C)
  246 F184  FE A7       	CP	0A7H		; Floppy vorhanden?
  247 F186  20 39       	JR	NZ,PWR7		; nein
  248 F188  ED 79       	OUT	(C),A		; einschalten mit Steuerbyte A7H
  249 F18A  01 B3F3     	LD	BC,UROK		; 0B3F3H
  250 F18D  ED 78       	IN	A,(C)		; Betriebsart ermitteln
  251 F18F  3D          	DEC	A
  252 F190  28 2F       	JR	Z,PWR7		; CP/M-Betriebsart erkannt
  253 F192  FE 04       	CP	4
  254 F194  28 2B       	JR	Z,PWR7		; CAOS-Betriebsart erkannt
  255 F196  CD F0D6     	CALL	OSTR
  256 F199  0C 0A       	DB	0CH,LF
  257 F19B  41 75 74 6F 	DB	'Autostart Floppy'
  258 F1AB  0D 0A 00    	DB	CR,LF,0
  259 F1AE  06 00       	LD	B,0
  260 F1B0  CD E388     PWR5:	CALL	BRKT		; BRK-Taste gedrueckt?
  261 F1B3  38 0C       	JR	C,PWR7		; ja, dann kein Floppy-Autostart
  262 F1B5  10 F9       	DJNZ	PWR5		; 256-mal abfragen
  263 F1B7  3E 01       	LD	A,1
  264 F1B9  32 B781     	LD	(ARGN),A	; 1 Parameter fuer JUMP FC vorgeben
  265 F1BC  3E FC       	LD	A,0FCH

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 120
CF45    INC

  266 F1BE  CD F10E     	CALL	JUMP		; Startversuch
  267 F1C1  AF          PWR7:	XOR	A
  268 F1C2  32 B781     	LD	(ARGN),A	; MENU ohne Parameter ausfuehren!
  269 F1C5  18 08       	JR	MEN0
  270                   ;
  271 F1C7  7F7F        	DW	7F7FH
  272 F1C9  4D 45 4E 55 	DB	'MENU'
  273 F1CD  01          	DB	1
  274 F1CE  E1          	POP	HL		; Stack clear
  275 F1CF  CD F0D6     MEN0:	CALL	OSTR
  276 F1D2  0C 0A       	DB	0CH,LF
  277 F1D4  2A 20 4B 43 	DB	'* KC-CAOS 4.5 '
  278         0000      if beta
  280                   endif
  281 F1E2  2A 00       	DB	'*',0
  282 F1E4  2A B781     MENU:	LD	HL,(ARGN)	; **46**
  283 F1E7  1E 00       	LD	E,0		; Parameter zum Testen in E bereithalten
  284 F1E9  2D          	DEC	L		; ARGN=1?
  285 F1EA  20 01       	JR	NZ,men9		; nein, E=0 verwenden
  286 F1EC  5C          	LD	E,H		; E=ARG1
  287 F1ED  21 C000     men9:	LD	HL,0C000H
  288 F1F0  4D          	LD	C,L
  289 F1F1  45          	LD	B,L		; BC=0
  290 F1F2  CD F4CC     MEN1:	CALL	CRLF
  291 F1F5  3E 02       MEN2:	LD	A,2		; CLLN
  292 F1F7  CD F3A6     	CALL	OPRCHR		; Prompt ausgeben
  293 F1FA  CD E388     	CALL	BRKT
  294 F1FD  38 62       	JR	C,LOOP2		; Break
  295 F1FF  DD 7E 09    	LD	A,(IX+9)
  296 F202  ED B1       MEN4:	CPIR
  297 F204  E2 F261     	JP	PO,LOOP2	; ausgesucht
  298 F207  ED A1       	CPI
  299 F209  E2 F261     	JP	PO,LOOP2	; ausgesucht
  300 F20C  20 F4       	JR	NZ,MEN4		; 2mal!
  301 F20E  7E          MEN5:	LD	A,(HL)
  302 F20F  FE 20       	CP	20h		; Epilog (0..1Fh)?
  303 F211  38 27       	JR	C,MEN7
  304 F213  CB 43       	bit	0,e		; versteckte Menueworte anzeigen?
  305 F215  28 06       	jr	z,men8		; nein
  306 F217  FE 7B       	CP	'z'+1		; <= 'z'?
  307 F219  30 DA       	JR	NC,MEN2		; groesser als 'z'
  308 F21B  18 10       	jr	men6
  309                   	;
  310 F21D  FE 30       men8:	CP	'0'		; >= '0' und
  311 F21F  38 D4       	JR	C,MEN2		; kleiner als '0'
  312 F221  FE 5B       	CP	'Z'+1		; <= 'Z'?
  313 F223  30 D0       	JR	NC,MEN2		; groesser als 'Z'
  314 F225  FE 41       	CP	'A'		; >= 'A' oder
  315 F227  30 04       	JR	NC,MEN6		; groesser als 'A'
  316 F229  FE 3B       	CP	':'+1		; <= ':'?
  317 F22B  30 C8       	JR	NC,MEN2		; groesser als ':'
  318 F22D  CD F3D5     MEN6:	CALL	OCHR
  319 F230  23          	INC	HL
  320 F231  0B          	DEC	BC
  321 F232  79          	LD	A,C
  322 F233  B0          	OR	B
  323 F234  20 D8       	JR	NZ,MEN5
  324 F236  3E 02       	LD	A,2		; CLLN

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 121
CF45    INC

  325 F238  18 24       	JR	LOOP1		; ausgesucht
  326 F23A  CB 4B       MEN7:	bit	1,e
  327 F23C  28 B4       	jr	z,men1		; keine Adressen anzeigen
  328 F23E  3A B79E     	ld	a,(winlg)
  329 F241  FE 0F       	cp	15		; Fensterbreite fuer Adressen ausreichend?
  330 F243  38 AD       	jr	c,men1		; nein, dann nicht anzeigen!
  331 F245  3E 0B       	ld	a,11
  332 F247  32 B7A0     	ld	(curso),a	; Spalte fuer Adressanzeige
  333 F24A  23          	inc	hl
  334 F24B  CD F3B4     	call	hlhx		; Startadresse anzeigen
  335 F24E  2B          	dec	hl
  336 F24F  18 A1       	JR	MEN1
  337                   
  338                   ; Eingabeschleife:
  339 F251  DB 88       LOOP:	IN	A,(PIOAD)	; **12**
  340 F253  E6 DF       	AND	11011111b	; LED aus
  341 F255  F6 04       	OR	00000100b	; IRM ein
  342 F257  D3 88       	OUT	(PIOAD),A
  343 F259  CD FB57     	CALL	COFF
  344 F25C  3E 0D       	LD	A,CR		; Zeilenanfang
  345 F25E  CD F3A6     LOOP1:	CALL	OPRCHR		; Prompt ausgeben
  346 F261  CD F266     LOOP2:	CALL	INPUT
  347 F264  18 EB       	JR	LOOP
  348                   
  349                   ; Menuekommandoroutine
  350 F266  CD F495     INPUT:	CALL	INLIN
  351 F269  30 0B       	JR	NC,INP1
  352 F26B  3E 0B       	LD	A,0BH		; bei BRK
  353 F26D  CD E0A0     	CALL	CRT		; Cursor hoch
  354 F270  3E 02       	LD	A,2		; und
  355 F272  CD E0A0     	CALL	CRT		; Zeile loeschen
  356 F275  C9          	RET
  357 F276  13          INP1:	INC	DE		; Zeichen danach
  358 F277  1A          	LD	A,(DE)
  359 F278  E6 DF       	AND	0DFH		; leer?
  360 F27A  C8          	RET	Z
  361 F27B  CD F343     	CALL	MSUCH		; Suche ab C000H
  362 F27E  38 46       	JR	C,INP5		; gefunden
  363 F280  3A B805     	LD	A,(MODST+5)
  364 F283  E6 01       	AND	1
  365 F285  20 0A       	JR	NZ,INP2		; CAOS-C war an
  366 F287  CD FB4A     	CALL	CON
  367 F28A  06 20       	LD	B,20H
  368 F28C  CD F345     	CALL	MS1
  369 F28F  38 35       	JR	C,INP5		; gefunden
  370 F291  D5          INP2:	PUSH	DE
  371 F292  3A B802     	LD	A,(MODST+2)
  372 F295  5F          	LD	E,A		; ROM-C merken
  373 F296  16 D1       	LD	D,0D1H		; BASIC nicht mit
  374 F298  3E 02       INP3:	LD	A,2
  375 F29A  6F          	LD	L,A
  376 F29B  CD F0FD     	CALL	MODU		; ROMC-Ebene ein
  377                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 F29E  DD CB 04    	 DB	0DDh,0CBh,4
    2 F2A1  BF          	 DB	7 SHL 3 OR 10000111b
  378 F2A2  D3 86       	OUT	(86H),A		; CAOSC aus!
  379 F2A4  EB          	EX	DE,HL
  380 F2A5  E3          	EX	(SP),HL		; DE=Suchkette

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 122
CF45    INC

  381 F2A6  EB          	EX	DE,HL
  382 F2A7  06 20       	LD	B,20H
  383 F2A9  CD F345     	CALL	MS1		; Menuewort?
  384 F2AC  38 13       	JR	C,INP4		; gefunden
  385 F2AE  EB          	EX	DE,HL
  386 F2AF  E3          	EX	(SP),HL		; DE=Schaltzustand
  387 F2B0  EB          	EX	DE,HL
  388 F2B1  3E 10       	LD	A,10H
  389 F2B3  82          	ADD	A,D
  390 F2B4  57          	LD	D,A
  391 F2B5  30 E1       	JR	NC,INP3		; naechste Ebene
  392 F2B7  53          	LD	D,E
  393 F2B8  3E 02       	LD	A,2
  394 F2BA  6F          	LD	L,A
  395 F2BB  CD F0FD     	CALL	MODU		; ROMC wie zuvor
  396 F2BE  D1          	POP	DE
  397 F2BF  18 2C       	JR	ERR1		; invalid command
  398                   	;
  399 F2C1  F1          INP4:	POP	AF		; Schaltzustand
  400 F2C2  AF          	XOR	A		; ROMC vergessen
  401 F2C3  32 B805     	LD	(MODST+5),A
  402 F2C6  7E          INP5:	LD	A,(HL)		; Epilog
  403 F2C7  23          	INC	HL
  404 F2C8  E5          	PUSH	HL
  405 F2C9  FE 1F       	CP	1FH
  406 F2CB  C8          	RET	Z		; ohne arg!
  407 F2CC  F5          	PUSH	AF
  408 F2CD  CD F511     	CALL	GARG		; Arg's erfassen
  409 F2D0  C1          	POP	BC
  410 F2D1  38 4E       	JR	C,ERR4		; bad args
  411 F2D3  3A B781     	LD	A,(ARGN)
  412 F2D6  48          	LD	C,B
  413 F2D7  CB A0       	RES	4,B
  414 F2D9  CB 28       	SRA	B
  415 F2DB  B8          	CP	B
  416 F2DC  38 35       	JR	C,ERR3		; zu wenig arg
  417 F2DE  28 04       	JR	Z,INP6
  418 F2E0  CB 61       	BIT	4,C
  419 F2E2  20 21       	JR	NZ,ERR2		; zu viele arg
  420 F2E4  CB 41       INP6:	BIT	0,C
  421 F2E6  CD F5DD     	CALL	LARG		; Arg's laden
  422 F2E9  C0          	RET	NZ		; mit IRM on
  423 F2EA  C3 F045     	JP	SCROFF		; mit IRM off
  424                   
  425 F2ED  CD F0D6     ERR1:	CALL	OSTR
  426 F2F0  46 61 6C 73 	DB	'Falsches Kommando',7,0
  427 F303  18 3B       	JR	ERRCR
  428 F305  CD F0D6     ERR2:	CALL	OSTR
  429 F308  5A 75 20 76 	DB	'Zu viele',0
  430 F311  18 1D       	JR	ERRA
  431 F313  CD F0D6     ERR3:	CALL	OSTR
  432 F316  5A 75 20 77 	DB	'Zu wenig',0
  433 F31F  18 0F       	JR	ERRA
  434 F321  CD F0D6     ERR4:	CALL	OSTR
  435 F324  46 65 68 6C 	DB	'Fehlerhafte',0
  436 F330  E1          ERRA:	POP	HL		; Stack clear
  437 F331  CD F0D6     	CALL	OSTR
  438 F334  20 41 72 67 	DB	' Argumente',7,0

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 123
CF45    INC

  439 F340  C3 F4CC     ERRCR:	JP	CRLF
  440                   
  441 F343  06 00       MSUCH:	LD	B,0
  442 F345  21 C000     MS1:	LD	HL,0C000H	; Standard-Suchbeginn
  443 F348  4D          	LD	C,L
  444 F349  DD 7E 09    ZS0:	LD	A,(IX+9)	; Prologbyte
  445 F34C  ED B1       ZSUCH:	CPIR			; **1D**
  446 F34E  37          	SCF
  447 F34F  3F          	CCF			; CY=0
  448 F350  E0          	RET	PO		; Prolog nicht gefunden
  449 F351  ED A1       	CPI
  450 F353  20 F7       	JR	NZ,ZSUCH
  451 F355  F5          	PUSH	AF
  452 F356  D5          	PUSH	DE		; Beginn der Vergleichskette retten
  453 F357  1A          ZS1:	LD	A,(DE)		; Zeichen von Vergleichskette
  454 F358  13          	INC	DE
  455 F359  FE 21       	CP	21H
  456 F35B  38 0D       	JR	C,ZS3		; Kettenende bei Vergleichskette erkannt
  457 F35D  CB 6E       	BIT	5,(HL)		; Grossbuchstabe im Speicher?
  458 F35F  CC F52E     	CALL	Z,UPCASE	; dann Zeichen von Vergleichskette upcasen
  459 F362  ED A1       	CPI
  460 F364  28 F1       	JR	Z,ZS1		; stimmt ueberein
  461 F366  D1          ZS2:	POP	DE		; wieder zu Begenn der Vergleichskette
  462 F367  F1          	POP	AF		; und verwendetes Prologbyte restaurieren
  463 F368  18 E2       	JR	ZSUCH		; Suche fortsetzen
  464                   	;
  465 F36A  7E          ZS3:	LD	A,(HL)		; Zeichen aus Speicher weiter testen
  466 F36B  FE 20       	CP	20H		; bis Epilogbyte (0..1Fh) kommt
  467 F36D  38 08       	JR	C,ZS4		; Epilog gefunden
  468                   ;	JR	Z,ZS2		; SPC (war in CAOS 4.3 und 4.4 nicht zugelassen)
  469 F36F  FE 80       	CP	80H
  470 F371  30 F3       	JR	NC,ZS2		; Zeichen ab 80H nicht zugelassen
  471 F373  23          	INC	HL
  472 F374  0B          	DEC	BC		; Befehl am 11.04.2010 ergaenzt
  473 F375  18 F3       	JR	ZS3
  474                   	;
  475 F377  F1          ZS4:	POP	AF
  476 F378  F1          	POP	AF
  477 F379  37          	SCF			; CY=1 fuer gefunden
  478 F37A  C9          	RET
  479                   
  480 F37B  47          WAIT:	LD	B,A		; **14**
  481 F37C  AF          	XOR	A
  482 F37D  CD F383     WAIT1:	CALL	WTUP
  483 F380  10 FB       	DJNZ	WAIT1
  484 F382  C9          	RET
  485                   
  486 F383  3D          WTUP:	DEC	A		; UP fuer WAIT
  487 F384  C8          	RET	Z
  488 F385  F5          	PUSH	AF
  489 F386  F1          	POP	AF
  490 F387  18 FA       	JR	WTUP
  491                   
  492 F389  CD F399     NORM:	CALL	NIN		; **13**
  493 F38C  21 FB8B     NOUT:	LD	HL,ZEI0		; **20**
  494 F38F  E5          SOUT:	PUSH	HL		; **1E**
  495 F390  2A B7B9     	LD	HL,(OUTAB)
  496 F393  E3          	EX	(SP),HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 124
CF45    INC

  497 F394  22 B7B9     	LD	(OUTAB),HL
  498 F397  E1          	POP	HL
  499 F398  C9          	RET
  500                   
  501 F399  21 FB8F     NIN:	LD	HL,ZEI4		; **21**
  502 F39C  E5          SIN:	PUSH	HL		; **1F**
  503 F39D  2A B7BB     	LD	HL,(INTAB)
  504 F3A0  E3          	EX	(SP),HL
  505 F3A1  22 B7BB     	LD	(INTAB),HL
  506 F3A4  E1          	POP	HL
  507 F3A5  C9          	RET
  508                   
  509                   ; Steuerzeichen und Prompt ausgeben
  510                   ; PE: A=Steuerzeichen
  511 F3A6  CD E0A0     OPRCHR:	CALL	CRT
  512 F3A9  3A B7EC     	LD	A,(PROMPT)
  513 F3AC  FE 20       	CP	' '
  514 F3AE  30 02       	JR	NC,OPRCH1
  515 F3B0  3E 25       	LD	A,'%'		; Standard
  516 F3B2  18 21       OPRCH1:	JR	OCHR		; Prompt
  517                   
  518 F3B4  7C          HLHX:	LD	A,H		; **1A**
  519 F3B5  CD F3C4     	CALL	AHEX
  520 F3B8  7D          	LD	A,L
  521 F3B9  CD F3C4     AHSPC:	CALL	AHEX
  522 F3BC  3E 20       SPACE:	LD	A,20H		; **2B**
  523 F3BE  18 15       	JR	OCHR
  524                   
  525 F3C0  3E 10       HOME:	LD	A,10H		; **2D**
  526 F3C2  18 11       	JR	OCHR
  527                   
  528 F3C4  F5          AHEX:	PUSH	AF		; **1C**
  529 F3C5  0F          	RRCA			; Tetradentausch
  530 F3C6  0F          	RRCA
  531 F3C7  0F          	RRCA
  532 F3C8  0F          	RRCA
  533 F3C9  CD F3CD     	CALL	AHEX0		; erst aufrufen,
  534 F3CC  F1          	POP	AF		; dann reinlaufen
  535 F3CD  E6 0F       AHEX0:	AND	0FH		; Maske
  536 F3CF  C6 90       	ADD	A,90H		; uebliche
  537 F3D1  27          	DAA			; Routine
  538 F3D2  CE 40       	ADC	A,40H		; fuer die
  539 F3D4  27          	DAA			; Hexausgabe
  540                   	;
  541 F3D5  E5          OCHR:	PUSH	HL		; **24**
  542 F3D6  2A B7B9     	LD	HL,(OUTAB)
  543 F3D9  D5          INTA1:	PUSH	DE		; siehe auch PV1
  544 F3DA  C5          	PUSH	BC		; (sehr aehnlich)
  545 F3DB  5E          	LD	E,(HL)
  546 F3DC  16 00       	LD	D,0
  547 F3DE  2A B7B0     	LD	HL,(SUTAB)
  548 F3E1  F5          	PUSH	AF
  549 F3E2  19          	ADD	HL,DE
  550 F3E3  19          	ADD	HL,DE
  551 F3E4  F1          	POP	AF
  552 F3E5  5E          	LD	E,(HL)
  553 F3E6  23          	INC	HL
  554 F3E7  56          	LD	D,(HL)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 125
CF45    INC

  555 F3E8  EB          	EX	DE,HL
  556 F3E9  CD E1CD     	CALL	JPHL
  557 F3EC  C1          POP3:	POP	BC		; auch fuer PV2
  558 F3ED  D1          	POP	DE		; bis PV6!
  559 F3EE  E1          	POP	HL
  560 F3EF  C9          	RET
  561                   
  562 F3F0  E5          INTB:	PUSH	HL		; **16**
  563 F3F1  2A B7BB     	LD	HL,(INTAB)
  564 F3F4  18 E3       	JR	INTA1
  565                   
  566 F3F6  E5          KBD:	PUSH	HL		; **04**
  567 F3F7  D5          	PUSH	DE
  568 F3F8  C5          	PUSH	BC
  569 F3F9  DD CB 08 76 KBD1:	BIT	6,(IX+8)	; F-Taste aktiv?
  570 F3FD  20 5C       	JR	NZ,KBD9		; ja
  571 F3FF  1E 00       KBD2:	LD	E,0
  572 F401  CD F7BE     KBD3:	CALL	CUCP		; blinken
  573 F404  1C          	INC	E		; e/a-Merker
  574 F405  06 0F       	LD	B,0FH		; F00h mal
  575 F407  CD E37F     KBD4:	CALL	KBDZ		; abfragen
  576 F40A  38 07       	JR	C,KBD5
  577 F40C  0B          	DEC	BC
  578 F40D  78          	LD	A,B
  579 F40E  B1          	OR	C
  580 F40F  20 F6       	JR	NZ,KBD4		; dann Cursor
  581 F411  18 EE       	JR	KBD3		; wieder weg usw.
  582                   	;
  583 F413  CB 43       KBD5:	BIT	0,E		; gerade ein?
  584 F415  C4 F7BE     	CALL	NZ,CUCP		; ja - wegnehmen
  585 F418  57          	LD	D,A
  586 F419  DD CB 08 6E 	BIT	5,(IX+8)	; Click ein?
  587 F41D  C4 E2BA     	CALL	NZ,CLIK
  588 F420  7A          	LD	A,D
  589 F421  21 B7A2     	LD	HL,STBT
  590 F424  CB 66       	BIT	4,(HL)		; ESC aktiv?
  591 F426  28 0D       	JR	Z,KBD6
  592 F428  ED 5B B7A0  	LD	DE,(CURSO)
  593 F42C  CD E197     	CALL	CRT1		; ESC ausfuehren
  594 F42F  ED 53 B7A0  	LD	(CURSO),DE
  595 F433  18 CA       	JR	KBD2
  596                   	;
  597 F435  FE 1B       KBD6:	CP	ESC
  598 F437  20 04       	JR	NZ,KBD7
  599 F439  CB E6       	SET	4,(HL)		; ESC merken
  600 F43B  18 C2       KBD2J:	JR	KBD2
  601                   	;
  602 F43D  FE F1       KBD7:	CP	0F1H		; F-Taste?
  603 F43F  38 AB       	JR	C,POP3
  604 F441  E6 0F       	AND	0FH
  605 F443  47          	LD	B,A
  606 F444  21 B900     	LD	HL,0B900H
  607 F447  7E          KBD8:	LD	A,(HL)
  608 F448  2C          	INC	L
  609 F449  28 B4       	JR	Z,KBD2		; Speicherende
  610 F44B  A7          	AND	A
  611 F44C  20 F9       	JR	NZ,KBD8		; Position im Puffer
  612 F44E  10 F7       	DJNZ	KBD8		; auszaehlen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 126
CF45    INC

  613 F450  7D          	LD	A,L
  614 F451  FE 9C       	CP	9CH
  615 F453  30 AA       	JR	NC,KBD2		; Speicherende
  616 F455  DD CB 08 F6 	SET	6,(IX+8)	; F-Taste aktiv
  617 F459  18 08       	JR	KBD10
  618                   	;
  619 F45B  CD E388     KBD9:	CALL	BRKT		; Abbruch?
  620 F45E  38 1A       	JR	C,KBD12
  621 F460  2A B7D1     	LD	HL,(FTAST)	; Zeiger auf
  622 F463  7E          KBD10:	LD	A,(HL)		; naechstes CHR
  623 F464  FE 1B       	CP	ESC
  624 F466  20 0B       	JR	NZ,KBD11
  625 F468  23          	INC	HL
  626 F469  22 B7D1     	LD	(FTAST),HL
  627 F46C  21 B7A2     	LD	HL,STBT
  628 F46F  CB E6       	SET	4,(HL)		; ESC merken
  629 F471  18 86       KBD1J:	JR	KBD1
  630                   	;
  631 F473  23          KBD11:	INC	HL
  632 F474  22 B7D1     	LD	(FTAST),HL	; Zeiger retten
  633 F477  A7          	AND	A		; NUL-Ende?
  634 F478  20 06       	JR	NZ,KBD13
  635 F47A  DD CB 08 B6 KBD12:	RES	6,(IX+8)	; ja - inaktiv
  636 F47E  18 BB       	JR	KBD2J
  637                   	;
  638 F480  21 B7A2     KBD13:	LD	HL,STBT
  639 F483  CB 66       	BIT	4,(HL)
  640 F485  CA F3EC     	JP	Z,POP3
  641 F488  ED 5B B7A0  	LD	DE,(CURSO)
  642 F48C  CD E197     	CALL	CRT1		; ESC ausfuehren
  643 F48F  ED 53 B7A0  	LD	(CURSO),DE
  644 F493  18 DC       	JR	KBD1J
  645                   
  646 F495  CD F3F0     INLIN:	CALL	INTB		; **17**
  647 F498  CD F3D5     	CALL	OCHR
  648 F49B  FE 03       	CP	3		; BRK?
  649 F49D  37          	SCF
  650 F49E  28 04       	JR	Z,INLI1
  651 F4A0  FE 0D       	CP	CR		; ENTER?
  652 F4A2  20 F1       	JR	NZ,INLIN
  653 F4A4  F5          INLI1:	PUSH	AF
  654 F4A5  CD F4CC     	CALL	CRLF		; PA: A=0
  655 F4A8  ED 5B B7A0  	LD	DE,(CURSO)
  656 F4AC  BA          	CP	D		; Zeile 1 durch PAGE-Mode?
  657 F4AD  20 04       	JR	NZ,INLI2
  658 F4AF  3A B79F     	LD	A,(WINLG+1)
  659 F4B2  57          	LD	D,A		; D korrigieren
  660 F4B3  15          INLI2:	DEC	D		; Zeile drueber
  661 F4B4  E5          	PUSH	HL
  662 F4B5  CD E07C     	CALL	DABR
  663 F4B8  EB          	EX	DE,HL
  664 F4B9  E1          	POP	HL		; PA: DE
  665 F4BA  F1          	POP	AF		; PA: CY=BRK
  666 F4BB  C9          NOOP:	RET
  667                   ;
  668                   ; Sprung zu einer Adresse mit Registeruebergabe
  669                   ; Syntax: %go ADR [HL] [DE] [BC]
  670                   ;

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 127
CF45    INC

  671 F4BC  7F7F        GO7F:	DW	7F7FH
  672 F4BE  67 6F       	DB	'go'
  673 F4C0  03          	DB	3		; mindestens 1 Argument erforderlich
  674 F4C1  E9          	JP	(HL)		; ohne Registeruebergabe
  675                   ;
  676                   ; fuer CAOS 4.6: (Code noch 1 Byte zu lang))
  677                   ;
  678                   ;	PUSH	HL		; Adresse auf den Stack
  679                   ;	EX	DE,HL		; ARG2 von DE nach HL
  680                   ;	LD	D,B
  681                   ;	LD	E,C		; ARG3 von BC nach DE
  682                   ;	LD	BC,(ARG4)
  683                   ;	LD	A,(ARG5)
  684                   ;	RET
  685                   
  686 F4C2  CD F0D6     ERRM:	CALL	OSTR		; **17**
  687 F4C5  45 52 52 4F 	DB	'ERROR',7,0
  688                   	;
  689 F4CC  CD F0D6     CRLF:	CALL	OSTR		; **2C**
  690 F4CF  0D 0A 00    	DB	CR,LF,0
  691 F4D2  C9          	RET
  692                   
  693 F4D3  CD F4D6     HLDE:	CALL	HLDE1		; **1B**
  694 F4D6  CD F3B4     HLDE1:	CALL	HLHX
  695 F4D9  EB          	EX	DE,HL
  696 F4DA  C9          	RET
  697                   
  698 F4DB  13          RHEX0:	INC	DE
  699 F4DC  1A          RHEX:	LD	A,(DE)		; **18**
  700 F4DD  FE 20       	CP	' '		; Trennzeichen
  701 F4DF  28 FA       	JR	Z,RHEX0		; uebergehen
  702 F4E1  AF          	XOR	A
  703 F4E2  21 B798     	LD	HL,NUMVX+1
  704 F4E5  77          	LD	(HL),A
  705 F4E6  2B          	DEC	HL		; HL=NUMVX
  706 F4E7  77          	LD	(HL),A
  707 F4E8  2B          	DEC	HL		; HL=NUMNX
  708 F4E9  77          	LD	(HL),A		; alles auf 0 setzen
  709 F4EA  1A          RH1:	LD	A,(DE)
  710 F4EB  B7          	OR	A		; Ende-Dummy?
  711 F4EC  C8          	RET	Z
  712 F4ED  FE 20       	CP	' '		; Ende-Space?
  713 F4EF  C8          	RET	Z
  714 F4F0  D6 30       	SUB	'0'
  715 F4F2  D8          	RET	C
  716 F4F3  FE 0A       	CP	10
  717 F4F5  38 0B       	JR	C,RH2
  718 F4F7  D6 07       	SUB	7
  719 F4F9  E6 DF       	AND	11011111b	; klein -> gross
  720 F4FB  FE 0A       	CP	0Ah
  721 F4FD  D8          	RET	C
  722 F4FE  FE 10       	CP	10h
  723 F500  3F          	CCF
  724 F501  D8          	RET	C
  725 F502  13          RH2:	INC	DE
  726 F503  34          	INC	(HL)		; NUMNX erhoehen
  727 F504  23          	INC	HL
  728 F505  ED 6F       	RLD			; Tetrade

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 128
CF45    INC

  729 F507  23          	INC	HL		; durchschieben
  730 F508  ED 6F       	RLD
  731 F50A  2B          	DEC	HL
  732 F50B  2B          	DEC	HL
  733 F50C  28 DC       	JR	Z,RH1		; RLD setzt auch Z-Flag!
  734 F50E  1B          	DEC	DE
  735 F50F  37          	SCF			; Fehler: Zahl zu gross
  736 F510  C9          	RET
  737                   
  738                   ; Bis zu 10 Argumente erfassen:
  739 F511  01 B781     GARG:	LD	BC,ARGN		; **22**
  740 F514  AF          	XOR	A
  741 F515  02          	LD	(BC),A		; (ARGN)=0
  742 F516  CD F4DC     GARG1:	CALL	RHEX
  743 F519  D8          	RET	C		; Fehler
  744 F51A  7E          	LD	A,(HL)
  745 F51B  B7          	OR	A		; Ende-Dummy?
  746 F51C  C8          	RET	Z
  747 F51D  23          	INC	HL
  748 F51E  03          	INC	BC
  749 F51F  7E          	LD	A,(HL)		; LOW(NUMVX)
  750 F520  02          	LD	(BC),A		; LOW(Argument)
  751 F521  23          	INC	HL
  752 F522  03          	INC	BC
  753 F523  7E          	LD	A,(HL)		; HIGH(NUMVX)
  754 F524  02          	LD	(BC),A		; HIGH(Argument)
  755 F525  2E 81       	LD	L,LOW(ARGN)	; HL=ARGN
  756 F527  34          	INC	(HL)
  757 F528  7E          	LD	A,(HL)
  758 F529  C6 F5       	ADD	A,-11		; 10 Argumente?
  759 F52B  30 E9       	JR	NC,GARG1
  760 F52D  C9          	RET			; Fehler: zu viele
  761                   
  762                   ; Kleinbuchstaben in A in Grossbuchstaben umwandeln:
  763 F52E  FE 61       UPCASE:	CP	'a'
  764 F530  D8          	RET	C
  765 F531  FE 7B       	CP	'z' + 1
  766 F533  D0          	RET	NC
  767 F534  E6 DF       	AND	11011111b
  768 F536  C9          	RET
  769                   
  770 F537  DD 36 05 00 KPUFF:	LD	(IX+5),LOW(CASS)
  771 F53B  DD 36 06 B7 	LD	(IX+6),HIGH(CASS)
  772 F53F  C9          	RET
  773                   
  774 F540  C5          INIEA:	PUSH	BC		; **43**
  775 F541  4E          	LD	C,(HL)		; erstes Byte: Portadresse
  776 F542  23          	INC	HL
  777 F543  46          	LD	B,(HL)		; zweites Byte: Anzahl
  778 F544  23          	INC	HL
  779 F545  ED B3       	OTIR
  780 F547  C1          	POP	BC
  781 F548  C9          	RET
  782                   
  783 F549  56          INIMEX:	LD	D,(HL)		; Anzahl Kanaele
  784 F54A  23          	INC	HL
  785 F54B  CD F540     INIMX1:	CALL	INIEA
  786 F54E  15          	DEC	D

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 129
CF45    INC

  787 F54F  20 FA       	JR	NZ,INIMX1
  788 F551  C9          	RET
  789                   
  790 F552  F3          INIME:	DI			;**44**
  791 F553  CD F54B     	CALL	INIMX1
  792 F556  FB          	EI
  793 F557  C9          	RET
  794                   
  795 F558  7F7F        SAVE7F:	DW	7F7FH
  796 F55A  53 41 56 45 	DB	'SAVE'
  797 F55E  05          	DB	5
  798 F55F  CD F0D6     	CALL	OSTR
  799 F562  4E 61 6D 65 	DB	'Name :',0
  800 F569  CD F495     	CALL	INLIN
  801 F56C  D8          	RET	C		; BRK
  802 F56D  21 0006     	LD	HL,6
  803 F570  19          	ADD	HL,DE		; Beginn Name
  804                   	;
  805 F571  11 B700     SAVE:	LD	DE,CASS		; **36**
  806 F574  01 000B     	LD	BC,11
  807 F577  ED B0       	LDIR			; Name in Puffer kopieren
  808 F579  AF          	XOR	A
  809 F57A  12          	LD	(DE),A
  810 F57B  21 B781     	LD	HL,ARGN		; alle Argumente inklusive ARGN
  811 F57E  1E 10       	LD	E,10H
  812 F580  0E 15       	LD	C,15H
  813 F582  ED B0       	LDIR			; in den Puffer kopieren
  814 F584  CD F537     	CALL	KPUFF		; Standard-Puffer setzen
  815 F587  CD E4DA     	CALL	ISRO		; Vorblock ausgeben
  816 F58A  2A B784     	LD	HL,(ARG2)	; Endadresse+1
  817 F58D  ED 5B B782  	LD	DE,(ARG1)	; Anfangsadresse
  818 F591  A7          	AND	A
  819 F592  ED 52       	SBC	HL,DE		; Anzahl Datenbytes
  820 F594  E5          	push	hl		; Anzahl auf Stack 
  821 F595  2A B782     SAV1:	LD	HL,(ARG1)	; Adresse fuer aktuellen Block
  822 F598  11 B700     	LD	DE,CASS
  823 F59B  01 0080     	LD	BC,128
  824 F59E  3A B801     	LD	A,(MODST+1)
  825 F5A1  E6 01       	AND	1
  826 F5A3  20 0F       	JR	NZ,SAV3		; IRM ein
  827 F5A5  41          	LD	B,C
  828 F5A6  CD F045     SAV2:	CALL	SCROFF
  829 F5A9  7E          	LD	A,(HL)		; vom RAM
  830 F5AA  CD F04E     	CALL	SCRON
  831 F5AD  12          	LD	(DE),A		; in den Puffer
  832 F5AE  23          	INC	HL
  833 F5AF  13          	INC	DE
  834 F5B0  10 F4       	DJNZ	SAV2
  835 F5B2  18 02       	JR	SAV4
  836 F5B4  ED B0       SAV3:	LDIR			; kopieren
  837 F5B6  22 B782     SAV4:	LD	(ARG1),HL	; Adresse fuer naechsten Block eintragen
  838 F5B9  E1          	pop	hl		; Anzahl
  839 F5BA  CD F0D6     	CALL	OSTR
  840 F5BD  02 00       	DB	2,0		; CLLN
  841 F5BF  CD F0D0     	CALL	BNROST		; Blocknummer ausgeben
  842 F5C2  00          	DB	0
  843 F5C3  CD E388     	CALL	BRKT
  844 F5C6  DA E488     	JP	C,CSROI		; BRK

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 130
CF45    INC

  845 F5C9  01 00A0     	LD	BC,160		; kurzer Vorton
  846 F5CC  11 0080     	ld	de,128		; Anzahl - 128
  847 F5CF  ED 52       	sbc	hl,de		; Ende erreicht?
  848 F5D1  CA E481     	jp	z,csro		; ja, genau das Blockende
  849 F5D4  DA E481     	jp	c,csro		; ja, letzter Block mit weniger Bytes
  850 F5D7  E5          	push	hl		; restliche Anzahl
  851 F5D8  CD E4E9     	CALL	MBO		; Datenblock ausgeben
  852 F5DB  18 B8       	JR	SAV1
  853                   
  854 F5DD  ED 4B B786  LARG:	LD	BC,(ARG3)	; **15**
  855 F5E1  ED 5B B784  	LD	DE,(ARG2)
  856 F5E5  2A B782     	LD	HL,(ARG1)
  857 F5E8  3A B781     	LD	A,(ARGN)
  858 F5EB  C9          	RET
  859                   
  860                   ; LOAD-Unterprogramm
  861                   ; PA: CY=1 BRK gedrueckt
  862 F5EC  DD 34 03    LUP:	INC	(IX+3)		; erwarteter Block
  863 F5EF  CD E54E     LUP1:	CALL	MBI
  864 F5F2  30 20       	JR	NC,LUP3
  865 F5F4  CD F0D6     	CALL	OSTR
  866 F5F7  09 09 09 20 	DB	9,9,9,' ',0
  867 F5FC  CD F0D0     	CALL	BNROST
  868 F5FF  20 3F       	DB	' ?'		; fehlerhaft
  869 F601  1E 00       	DB	1EH,0
  870 F603  DD 7E 03    	LD	A,(IX+3)
  871 F606  3D          	DEC	A		; Block 01 erwartet?
  872 F607  28 E6       	JR	Z,LUP1
  873 F609  CD F3F6     	CALL	KBD		; nein
  874 F60C  FE 03       	CP	3		; BRK?
  875 F60E  37          	SCF
  876 F60F  C8          	RET	Z
  877 F610  FE 0A       	CP	LF		; CUD?
  878 F612  20 DB       	JR	NZ,LUP1
  879 F614  DD 7E 02    LUP3:	LD	A,(IX+2)
  880 F617  DD 46 03    	LD	B,(IX+3)
  881 F61A  05          	DEC	B		; Block 01 erwartet?
  882 F61B  28 17       	JR	Z,LUP6
  883 F61D  04          	INC	B
  884 F61E  B8          	CP	B		; richtige Blocknummer?
  885 F61F  28 0B       	JR	Z,LUP5
  886 F621  3C          	INC	A		; Block FF?
  887 F622  28 08       	JR	Z,LUP5
  888 F624  CD F0D0     LUP4:	CALL	BNROST
  889 F627  2A          	DB	'*'		; falsche Blocknummer
  890 F628  19 00       	DB	19H,0
  891 F62A  18 C3       	JR	LUP1
  892                   
  893 F62C  CD F0D0     LUP5:	CALL	BNROST
  894 F62F  3E 20       	DB	'> '		; korrekter Block
  895 F631  19 00       	DB	19H,0
  896 F633  C9          	RET
  897                   
  898 F634  3D          LUP6:	DEC	A		; Block 01?
  899 F635  20 ED       	JR	NZ,LUP4
  900 F637  CD F4CC     	CALL	CRLF		; keine Blocknummer,
  901 F63A  21 B700     	LD	HL,CASS
  902 F63D  06 0B       	LD	B,11		; sondern den Namen

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 131
CF45    INC

  903 F63F  7E          LUP7:	LD	A,(HL)		; ausgeben
  904 F640  23          	INC	HL
  905 F641  CD E0A0     	CALL	CRT
  906 F644  10 F9       	DJNZ	LUP7
  907 F646  C3 F3BC     	JP	SPACE
  908                   
  909 F649  CD F0D6     NOMC:	CALL	OSTR
  910 F64C  4B 65 69 6E 	DB	'Keine MC-Datei!',0
  911 F65C  C3 E488     CLJP:	JP	CSROI
  912                   
  913 F65F  7F7F        VERI7F:	DW	7F7FH
  914 F661  56 45 52 49 	DB	'VERIFY'
  915 F667  01          	DB	1
  916 F668  DD 36 07 00 VERIF:	LD	(IX+7),0	; **11**
  917 F66C  18 16       	JR	LOAD1
  918                   
  919 F66E  7F7F        LOAD7F:	DW	7F7FH
  920 F670  4C 4F 41 44 	DB	'LOAD'
  921 F674  01          	DB	1
  922 F675  DD 36 07 01 LOAD:	LD	(IX+7),1	; **10**
  923 F679  3A B781     	LD	A,(ARGN)
  924 F67C  FE 02       	CP	2
  925 F67E  38 04       	JR	C,LOAD1		; Autostart?
  926 F680  DD CB 07 CE 	SET	1,(IX+7)	; unterdruecken
  927 F684  CD E459     LOAD1:	CALL	ISRI1
  928 F687  CD F537     	CALL	KPUFF		; Standard setzen
  929 F68A  DD 36 03 00 	LD	(IX+3),0
  930 F68E  CD F5EC     	CALL	LUP
  931 F691  38 C9       LOAD2:	JR	C,CLJP		; BRK
  932 F693  DD CB 07 46 	BIT	0,(IX+7)
  933 F697  28 4E       	JR	Z,LOAD5		; Verify
  934 F699  2E 10       	LD	L,10H
  935 F69B  7E          	LD	A,(HL)		; Anzahl der Argumente
  936 F69C  07          	RLCA
  937 F69D  07          	RLCA			; nach Bits 2..4
  938 F69E  DD AE 07    	XOR	(IX+7)
  939 F6A1  E6 1C       	AND	00011100b	; Bits 0..1 und 5..7 zuruecksetzen
  940 F6A3  DD AE 07    	XOR	(IX+7)		; a = (a XOR b) XOR b fuer Bits 2..4
  941 F6A6  DD 77 07    	LD	(IX+7),A
  942 F6A9  7E          	LD	A,(HL)		; Anzahl der Argumente
  943 F6AA  D6 02       	SUB	2
  944 F6AC  FE 09       	CP	9		; MC?
  945 F6AE  30 99       	JR	NC,NOMC
  946 F6B0  ED 4B B715  	LD	BC,(CASS+15H)
  947 F6B4  C5          	PUSH	BC
  948 F6B5  ED 5B B713  	LD	DE,(CASS+13H)
  949 F6B9  2A B711     	LD	HL,(CASS+11H)
  950 F6BC  3A B781     	LD	A,(ARGN)
  951 F6BF  A7          	AND	A		; Ladeoffset?
  952 F6C0  28 11       	JR	Z,LOAD3		; nein
  953 F6C2  ED 4B B782  	LD	BC,(ARG1)
  954 F6C6  09          	ADD	HL,BC		; Anfangsadresse und Endadresse
  955 F6C7  EB          	EX	DE,HL		; umrechnen
  956 F6C8  09          	ADD	HL,BC
  957 F6C9  EB          	EX	DE,HL
  958 F6CA  DD CB 07 66 	BIT	4,(IX+7)	; 4 bis 7 Argumente?
  959 F6CE  20 03       	JR	NZ,LOAD3
  960 F6D0  E3          	EX	(SP),HL

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 132
CF45    INC

  961 F6D1  09          	ADD	HL,BC		; Startadresse umrechnen
  962 F6D2  E3          	EX	(SP),HL
  963 F6D3  CD F4D3     LOAD3:	CALL	HLDE		; Anfangsadresse und Endadresse ausgeben
  964 F6D6  3A B710     	LD	A,(CASS+10H)
  965 F6D9  FE 03       	CP	3
  966 F6DB  38 05       	JR	C,LOAD4		; keine Startadresse
  967 F6DD  E3          	EX	(SP),HL
  968 F6DE  CD F3B4     	CALL	HLHX		; Startadresse ausgeben
  969 F6E1  E3          	EX	(SP),HL
  970 F6E2  C1          LOAD4:	POP	BC		; Startadresse merken
  971 F6E3  ED 43 B786  	LD	(ARG3),BC
  972 F6E7  CD F4CC     LOAD5:	CALL	CRLF
  973 F6EA  EB          	EX	DE,HL		; DE = Ladeadresse
  974                   	; Load-Hauptschleife
  975 F6EB  CD F5EC     LOAD6:	CALL	LUP
  976 F6EE  38 A1       	JR	C,LOAD2		; BRK
  977 F6F0  DD CB 07 46 	BIT	0,(IX+7)
  978 F6F4  28 28       	JR	Z,LOAD11	; Verify
  979 F6F6  E5          	PUSH	HL
  980 F6F7  ED 52       	SBC	HL,DE
  981 F6F9  01 0080     	LD	BC,128
  982 F6FC  ED 42       	SBC	HL,BC
  983 F6FE  09          	ADD	HL,BC
  984 F6FF  30 01       	JR	NC,LOAD7
  985 F701  4D          	LD	C,L		; restliche Anzahl
  986 F702  21 B700     LOAD7:	LD	HL,CASS
  987 F705  3A B801     	LD	A,(MODST+1)
  988 F708  E6 01       	AND	1
  989 F70A  20 0F       	JR	NZ,LOAD9	; IRM ein
  990 F70C  41          	LD	B,C
  991 F70D  7E          LOAD8:	LD	A,(HL)		; aus dem Puffer
  992 F70E  CD F045     	CALL	SCROFF
  993 F711  12          	LD	(DE),A		; in den RAM
  994 F712  23          	INC	HL
  995 F713  13          	INC	DE
  996 F714  CD F04E     	CALL	SCRON
  997 F717  10 F4       	DJNZ	LOAD8
  998 F719  18 02       	JR	LOAD10
  999 F71B  ED B0       LOAD9:	LDIR			; kopieren
 1000 F71D  E1          LOAD10:	POP	HL
 1001 F71E  DD 34 02    LOAD11:	INC	(IX+2)		; Blocknummer FF?
 1002 F721  20 C8       	JR	NZ,LOAD6
 1003                   	;
 1004 F723  CD E488     CSRI:	CALL	CSROI		; **0B**
 1005 F726  DD 7E 07    	LD	A,(IX+7)
 1006 F729  E6 03       	AND	3
 1007 F72B  3D          	DEC	A
 1008 F72C  C0          	RET	NZ		; kein Start
 1009 F72D  DD 7E 07    	LD	A,(IX+7)
 1010 F730  E6 1C       	AND	1CH
 1011 F732  FE 0C       	CP	0CH
 1012 F734  DD 36 07 00 	LD	(IX+7),0	; Befehl fehlte in CAOS 4.3!
 1013 F738  D8          	RET	C		; keine Startadresse
 1014 F739  2A B786     	LD	HL,(ARG3)	; Startadresse
 1015 F73C  E9          	JP	(HL)		; anspringen
 1016                   
 1017 F73D  7F7F        	DW	7F7FH
 1018 F73F  43 4F 4C 4F 	DB	'COLOR'

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 133
CF45    INC

 1019 F744  01          	DB	1
 1020 F745  CD FB4A     	CALL	CON
 1021 F748  C3 C4D4     	JP	COLRC
 1022                   
 1023 F74B  CD FB4A     COLR:	CALL	CON		; **0F**
 1024 F74E  C3 C4EE     	JP	SETCO
 1025                   
 1026 F751  E5          CSTBT:	PUSH	HL		; **42**
 1027 F752  21 B7A2     	LD	HL,STBT
 1028 F755  CB DE       	SET	3,(HL)
 1029 F757  CD F3D5     	CALL	OCHR		; Steuerzeichen
 1030 F75A  CB 9E       	RES	3,(HL)		; darstellen
 1031 F75C  E1          	POP	HL
 1032 F75D  C9          	RET
 1033                   
 1034 F75E  7F7F        	DW	7F7FH
 1035 F760  44 49 53 50 	DB	'DISPLAY'
 1036 F767  03          	DB	3
 1037 F768  CD FB4A     DISP:	CALL	CON		; **3B**
 1038 F76B  CD C769     	CALL	DISPC
 1039 F76E  18 0F       	JR	JCOFF
 1040                   
 1041 F770  7F7F        	DW	7F7FH
 1042 F772  4D 4F 44 49 	DB	'MODIFY'
 1043 F778  03          	DB	3
 1044 F779  CD FB4A     MODI:	CALL	CON		; **2E**
 1045 F77C  CD C79A     	CALL	MODIC
 1046 F77F  C3 FB57     JCOFF:	JP	COFF
 1047                   
 1048 F782  7F7F        WIND7F:	DW	7F7FH
 1049 F784  57 49 4E 44 	DB	'WINDOW'
 1050 F78A  01          	DB	1
 1051 F78B  CD FB4A     	CALL	CON
 1052 F78E  CD C509     	CALL	WINDC
 1053 F791  18 EC       	JR	JCOFF
 1054                   
 1055 F793  CD FB4A     WININ:	CALL	CON		; **3C**
 1056 F796  CD C568     	CALL	WININC
 1057 F799  18 E4       	JR	JCOFF
 1058                   
 1059 F79B  CD FB4A     WINAK:	CALL	CON		; **3D**
 1060 F79E  CD C538     	CALL	WINAKC
 1061 F7A1  18 DC       	JR	JCOFF
 1062                   ;
 1063 F7A3  7F7F        KEY7F:	DW	7F7FH
 1064 F7A5  4B 45 59    	DB	'KEY'
 1065 F7A8  01          	DB	1
 1066 F7A9  FE 01       	CP	1
 1067 F7AB  30 08       	JR	NC,KEYL
 1068 F7AD  CD FB4A     KEYLI:	CALL	CON		; **3A**
 1069 F7B0  CD C48A     	CALL	KEYLIC		; Keylist
 1070 F7B3  18 CA       	JR	JCOFF
 1071                   
 1072 F7B5  7D          KEYL:	LD	A,L		; Nummer
 1073 F7B6  CD FB4A     KEY:	CALL	CON		; **39**
 1074 F7B9  CD C3DE     	CALL	KEYC
 1075 F7BC  18 C1       	JR	JCOFF
 1076                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 134
CF45    INC

 1077                   ; Komplement des Cursors
 1078 F7BE  D5          CUCP:	PUSH	DE		; **25**
 1079 F7BF  F5          	PUSH	AF
 1080 F7C0  E5          	PUSH	HL
 1081 F7C1  CD E052     	CALL	PADR0
 1082 F7C4  38 22       	JR	C,CUCP3		; ausserhalb
 1083 F7C6  E5          	PUSH	HL
 1084 F7C7  CD E07C     	CALL	DABR
 1085 F7CA  7E          	LD	A,(HL)
 1086 F7CB  E1          	POP	HL
 1087 F7CC  A7          	AND	A		; Dummy?
 1088 F7CD  20 0A       	JR	NZ,CUCP1
 1089 F7CF  3E 06       	LD	A,6		; vorletzte
 1090 F7D1  B5          	OR	L		; Cursorzeile
 1091 F7D2  6F          	LD	L,A
 1092 F7D3  7E          	LD	A,(HL)
 1093 F7D4  EE 7F       	XOR	7FH		; Strichcursor
 1094 F7D6  77          	LD	(HL),A
 1095 F7D7  18 0F       	JR	CUCP3
 1096 F7D9  C5          CUCP1:	PUSH	BC
 1097 F7DA  ED 5B B7EE  	LD	DE,(CUMUST)	; Muster
 1098 F7DE  06 08       	LD	B,8		; Zeichenhoehe
 1099 F7E0  1A          CUCP2:	LD	A,(DE)
 1100 F7E1  AE          	XOR	(HL)		; verknuepfen
 1101 F7E2  77          	LD	(HL),A
 1102 F7E3  13          	INC	DE
 1103 F7E4  2C          	INC	L
 1104 F7E5  10 F9       	DJNZ	CUCP2		; 8-mal
 1105 F7E7  C1          	POP	BC
 1106 F7E8  E1          CUCP3:	POP	HL
 1107 F7E9  F1          	POP	AF
 1108 F7EA  D1          	POP	DE
 1109 F7EB  C9          	RET
 1110                   
 1111 F7EC  CD FB4A     PUSE:	CALL	CON		; **30**
 1112 F7EF  CD C61B     	CALL	PUSEC		; Punkt setzen
 1113 F7F2  18 41       	JR	COF
 1114                   
 1115 F7F4  CD FB4A     PUDE:	CALL	CON		; **2F**
 1116 F7F7  CD C6F5     	CALL	PUDEC		; Punkt loeschen
 1117 F7FA  18 39       	JR	COF
 1118                   
 1119 F7FC  CD FB4A     CIRCL:	CALL	CON		; **3F**
 1120 F7FF  CD C627     	CALL	CIRCLC		; Kreis
 1121 F802  18 31       	JR	COF
 1122                   
 1123 F804  CD FB4A     LINE:	CALL	CON		; **3E**
 1124 F807  CD C59E     	CALL	LINEC		; Linie
 1125 F80A  18 29       	JR	COF
 1126                   
 1127 F80C  CD FB4A     MBOUT:	CALL	CON		; **38**
 1128 F80F  CD CCDA     	CALL	MBOC		; Byte ausgeben
 1129 F812  18 21       	JR	COF
 1130                   
 1131 F814  CD FB4A     MBIN:	CALL	CON		; **37**
 1132 F817  CD CD53     	CALL	MBIC		; Byte einlesen
 1133 F81A  18 19       	JR	COF
 1134                   

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 135
CF45    INC

 1135                   ; Sprung zu ?IO ERROR
 1136 F81C  CD FB57     JIOERR:	CALL	COFF
 1137 F81F  2A B7C9     	LD	HL,(IOERR)
 1138 F822  CD F0A7     	CALL	IRMOF
 1139 F825  E9          	JP	(HL)
 1140                   
 1141 F826  7F7F        SYS7F:	DW	7F7FH
 1142 F828  53 59 53 54 	DB	'SYSTEM'
 1143 F82E  11          	DB	11H
 1144 F82F  CD FB4A     ESC6:	CALL	CON
 1145 F832  CD C155     	CALL	SYSTC
 1146 F835  C3 FB57     COF:	JP	COFF
 1147                   
 1148                   ; BASIC-I/O-Verteiler
 1149 F838  E5          BASPV:	PUSH	HL
 1150 F839  C5          	PUSH	BC
 1151 F83A  CD F08A     	CALL	IRMON
 1152 F83D  CB 6B       	BIT	5,E
 1153 F83F  20 4C       	JR	NZ,BASBYE	; BYE
 1154 F841  D5          	PUSH	DE
 1155 F842  23          	INC	HL
 1156 F843  23          	INC	HL
 1157 F844  CB 7B       	BIT	7,E
 1158 F846  20 3A       	JR	NZ,BSA2
 1159 F848  E5          	PUSH	HL
 1160 F849  7B          	LD	A,E
 1161 F84A  E6 07       	AND	7
 1162 F84C  21 FDF0     	LD	HL,BUPTAB
 1163 F84F  85          	ADD	A,L
 1164 F850  6F          	LD	L,A
 1165 F851  7A          	LD	A,D		; Parameter
 1166 F852  53          	LD	D,E		; Steuerbyte
 1167 F853  5E          	LD	E,(HL)		; UP-Nummer
 1168 F854  E1          	POP	HL		; Dateiname
 1169 F855  CD F087     	CALL	PV3		; Aufruf
 1170 F858  D1          	POP	DE
 1171 F859  57          	LD	D,A		; Ausgabeparameter
 1172 F85A  7B          	LD	A,E
 1173 F85B  E6 4F       	AND	4FH
 1174 F85D  EE 43       	XOR	43H
 1175 F85F  20 18       	JR	NZ,BSA1
 1176 F861  CD F0D6     	CALL	OSTR
 1177 F864  56 45 52 49 	DB	'VERIFY ?(Y):',0
 1178 F871  CD F3F6     	CALL	KBD
 1179 F874  FE 59       	CP	'Y'
 1180 F876  CC F668     	CALL	Z,VERIF
 1181 F879  7A          BSA1:	LD	A,D
 1182 F87A  CB 9B       	RES	3,E
 1183 F87C  CD F0A7     	CALL	IRMOF
 1184 F87F  C1          	POP	BC
 1185 F880  E1          	POP	HL
 1186 F881  C9          	RET
 1187                   
 1188 F882  CD E374     BSA2:	CALL	KBDS
 1189 F885  D1          	POP	DE
 1190 F886  57          	LD	D,A
 1191 F887  30 F0       	JR	NC,BSA1
 1192 F889  CB BB       	RES	7,E

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 136
CF45    INC

 1193 F88B  18 EC       	JR	BSA1
 1194                   
 1195 F88D  3A 035E     BASBYE:	LD	A,(DATFLG)	; geschuetzt?
 1196 F890  A7          	AND	A
 1197 F891  28 09       	JR	Z,BASB1
 1198 F893  CD F0A7     	CALL	IRMOF
 1199 F896  CD C641     	CALL	0C641H		; NEW
 1200 F899  CD F08A     	CALL	IRMON
 1201 F89C  16 00       BASB1:	LD	D,0
 1202 F89E  3E 02       	LD	A,2		; BASIC-ROM
 1203 F8A0  6F          	LD	L,A		; abschalten
 1204 F8A1  CD F0FD     	CALL	MODU
 1205 F8A4  2A B7B0     	LD	HL,(SUTAB)
 1206 F8A7  11 0268     	LD	DE,SUBAS
 1207 F8AA  A7          	AND	A
 1208 F8AB  ED 52       	SBC	HL,DE		; BASEX aktiv?
 1209 F8AD  20 06       	JR	NZ,BASB2
 1210 F8AF  2A 0201     	LD	HL,(SUSP)
 1211 F8B2  22 B7B0     	LD	(SUTAB),HL
 1212 F8B5  C3 F251     BASB2:	JP	LOOP
 1213                   
 1214 F8B8  CD F3D5     ZKOUT0:	CALL	OCHR
 1215 F8BB  7E          ZKOUT:	LD	A,(HL)		; **45**
 1216 F8BC  23          	INC	HL
 1217 F8BD  A7          	AND	A
 1218 F8BE  20 F8       	JR	NZ,ZKOUT0
 1219 F8C0  C9          	RET
 1220                   
 1221 F8C1  CD F5DD     TON:	CALL	LARG		; **35**
 1222 F8C4  DD CB 08 4E TON1:	BIT	1,(IX+8)	; noch alter Ton
 1223 F8C8  20 FA       	JR	NZ,TON1
 1224 F8CA  C5          TON2:	PUSH	BC
 1225 F8CB  0E 8C       	LD	C,CTC0
 1226 F8CD  CD F8F7     	CALL	TON4		; starten
 1227 F8D0  0C          	INC	C		; CTC1
 1228 F8D1  EB          	EX	DE,HL
 1229 F8D2  CD F8F7     	CALL	TON4		; starten
 1230 F8D5  C1          	POP	BC
 1231 F8D6  79          	LD	A,C		; Lautstaerke
 1232 F8D7  E6 1E       	AND	00011110b	; maskieren
 1233 F8D9  EE 9F       	XOR	10011111b	; Komplement da nullaktiv
 1234 F8DB  4F          	LD	C,A
 1235 F8DC  78          	LD	A,B
 1236 F8DD  A7          	AND	A		; Dauerton?
 1237 F8DE  F3          	DI
 1238 F8DF  28 0D       	JR	Z,TON3
 1239 F8E1  CB B9       	RES	7,C		; nein, Blinkaus
 1240 F8E3  DD CB 08 CE 	SET	1,(IX+8)	; neuer Ton
 1241 F8E7  3E C7       	LD	A,11000111b	; EI,Zaehler 50Hz
 1242 F8E9  D3 8E       	OUT	(CTC2),A	; CTC2
 1243 F8EB  78          	LD	A,B		; Dauer
 1244 F8EC  D3 8E       	OUT	(CTC2),A
 1245 F8EE  DB 89       TON3:	IN	A,(PIOBD)
 1246 F8F0  E6 60       	AND	01100000b	; RAM8 maskieren
 1247 F8F2  B1          	OR	C
 1248 F8F3  D3 89       	OUT	(PIOBD),A	; Lautstaerke ausgeben
 1249 F8F5  FB          	EI
 1250 F8F6  C9          	RET

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 137
CF45    INC

 1251                   
 1252                   ; CTC (C) programmieren mit HL:
 1253 F8F7  7D          TON4:	LD	A,L
 1254 F8F8  A7          	AND	A		; Ton?
 1255 F8F9  2E 03       	LD	L,00000011b
 1256 F8FB  28 0D       	JR	Z,TON6		; kein Ton
 1257 F8FD  6F          	LD	L,A
 1258 F8FE  3E 01       	LD	A,00000001b
 1259 F900  A4          	AND	H		; Vorteiler
 1260 F901  0F          	RRCA			; nach Bit 5 rotieren
 1261 F902  0F          	RRCA
 1262 F903  0F          	RRCA
 1263 F904  F6 07       	OR	00000111b	; Zeitgeber
 1264 F906  F3          	DI
 1265 F907  ED 79       	OUT	(C),A
 1266 F909  FB          	EI			; Interrupts wieder ein nach zweitem OUT
 1267 F90A  ED 69       TON6:	OUT	(C),L
 1268 F90C  C9          	RET
 1269                   
 1270                   ; ESC-Funktionen:
 1271                   
 1272 F90D  21 B7A2     ESCPRG:	LD	HL,STBT		; ShSTOP
 1273 F910  CB E6       	SET	4,(HL)		; Kennung, dass ESC-Funktion folgt
 1274 F912  C9          	RET
 1275                   
 1276 F913  01 B200     ESC1:	LD	BC,0B200H
 1277 F916  18 0D       	JR	ESCVR
 1278                   
 1279 F918  01 AD05     ESC2:	LD	BC,0AD05H
 1280 F91B  18 08       	JR	ESCVR
 1281                   
 1282 F91D  01 AD04     ESC3:	LD	BC,0AD04H
 1283 F920  18 03       	JR	ESCVR
 1284                   
 1285 F922  01 B201     ESC4:	LD	BC,0B201H
 1286 F925  60          ESCVR:	LD	H,B
 1287 F926  2E 00       	LD	L,0
 1288 F928  22 B7CB     	LD	(VRAM),HL
 1289 F92B  06 FA       	LD	B,0FAH
 1290 F92D  78          AXO84:	LD	A,B		; AND/XOR/OUT84
 1291 F92E  F3          	DI
 1292 F92F  DD A6 01    	AND	(IX+1)
 1293 F932  A9          	XOR	C
 1294 F933  DD 77 01    OUT84:	LD	(IX+1),A
 1295 F936  D3 84       	OUT	(84H),A
 1296 F938  FB          	EI
 1297 F939  C9          	RET
 1298                   
 1299 F93A  0E 04       ESC7:	LD	C,00000100b	; Invers-Bit
 1300 F93C  21 B7A2     XORSTB:	LD	HL,STBT
 1301 F93F  7E          	LD	A,(HL)
 1302 F940  A9          	XOR	C
 1303 F941  77          	LD	(HL),A
 1304 F942  C9          	RET
 1305                   
 1306 F943  F3          ESC9:	DI
 1307 F944  DD 7E 01    	LD	A,(IX+1)	; VR: A
 1308 F947  EE 02       	XOR	2

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 138
CF45    INC

 1309 F949  18 E8       	JR	OUT84		; BC unveraendert
 1310                   
 1311 F94B  21 B7A2     ESCA:	LD	HL,STBT
 1312 F94E  CB B6       	RES	6,(HL)		; HRG aus
 1313 F950  01 FF08     ESCAB:	LD	BC,0FF08h
 1314 F953  CD F92D     	CALL	AXO84
 1315 F956  A1          	AND	C
 1316 F957  80          	ADD	A,B		; CY = Bit 3
 1317 F958  F3          	DI
 1318 F959  DB 89       	IN	A,(PIOBD)
 1319 F95B  17          	RLA			; als Bit 0 einschieben
 1320 F95C  0F          	RRCA			; auf Bit 7 rotieren
 1321 F95D  D3 89       	OUT	(PIOBD),A
 1322 F95F  FB          	EI
 1323 F960  C9          	RET
 1324                   
 1325 F961  21 B7A2     ESCB:	LD	HL,STBT
 1326 F964  CB F6       	SET	6,(HL)		; HRG ein
 1327 F966  18 E8       	JR	ESCAB
 1328                   
 1329 F968  0E 20       ESCC:	LD	C,00100000b	; IBM <-> CAOS
 1330 F96A  18 D0       	JR	XORSTB
 1331                   
 1332                   ; Druckerinitialisierung V.24 oder Centronics:
 1333 F96C  7F7F        LST7F:	DW	7F7Fh
 1334 F96E  4C 53 54 44 	DB	'LSTDEV'
 1335 F974  01          	DB	1
 1336 F975  CD FB4A     V24OUT:	CALL	CON		; **47**
 1337 F978  CD C810     	CALL	LSTC
 1338 F97B  C3 FB57     COF1:	JP	COFF
 1339                   
 1340                   ; Reaktion auf ShCLR:
 1341 F97E  F5          HCPGM:	PUSH	AF
 1342 F97F  DD 7E 04    	LD	A,(IX+4)	; CAOS-C merken
 1343 F982  F5          	PUSH	AF
 1344                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 F983  DD CB 04    	 DB	0DDh,0CBh,4
    2 F986  FF          	 DB	7 SHL 3 OR 11000111b
 1345 F987  D3 86       	OUT	(86h),A		; CAOS-C on
 1346 F989  CD C9CE     	CALL	HCPGMC
 1347 F98C  F1          	POP	AF
 1348 F98D  DD 77 04    	LD	(IX+4),A	; wie vorher
 1349 F990  D3 86       	OUT	(86h),A
 1350 F992  F1          	POP	AF
 1351 F993  C9          	RET
 1352                   
 1353                   ; Duplexroutine
 1354 F994  7F7F        V24D7F:	DW	7F7FH
 1355 F996  56 32 34 44 	DB	'V24DUP'
 1356 F99C  01          	DB	1
 1357 F99D  CD FB4A     V24DUP:	CALL	CON		; **48**
 1358 F9A0  CD C8F1     	CALL	V24DC
 1359 F9A3  DC F4C2     	CALL	C,ERRM
 1360 F9A6  18 D3       	JR	COF1
 1361                   
 1362                   ; Druckroutine mit Protokoll
 1363 F9A8  CD E0A0     ECHO:	CALL	CRT
 1364 F9AB  DD CB 04 7E PRINT:	BIT	7,(IX+4)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 139
CF45    INC

 1365 F9AF  20 08       	JR	NZ,PR1		; CAOSC on!
 1366 F9B1  E5          	PUSH	HL
 1367 F9B2  21 FB57     	LD	HL,COFF		; nach PRINTC
 1368 F9B5  E3          	EX	(SP),HL		; wieder aus
 1369 F9B6  CD FB4A     	CALL	CON
 1370 F9B9  C3 C97E     PR1:	JP	PRINTC		; drucken
 1371                   
 1372                   ; Druckroutine fuer M001:
 1373                   ;
 1374                   ; PE:	A	Zeichen
 1375                   ; VR:	F
 1376                   ;
 1377 F9BC  C5          M001PR:	PUSH	BC
 1378 F9BD  0E 05       	LD	C,05h
 1379 F9BF  ED 40       CBUSY1:	IN	B,(C)
 1380 F9C1  CB 50       	BIT	2,B		; BUSY?
 1381 F9C3  20 FA       	JR	NZ,CBUSY1
 1382 F9C5  06 01       	LD	B,00000001b
 1383 F9C7  F3          	DI
 1384 F9C8  D3 04       	OUT	(04h),A		; Daten
 1385 F9CA  18 0E       	JR	CSTROB
 1386                   
 1387                   ; Druckroutine fuer M021:
 1388                   ;
 1389                   ; PE:	A	Zeichen
 1390                   ; VR:	F
 1391                   ;
 1392 F9CC  C5          M021PR:	PUSH	BC
 1393 F9CD  0E 90       	LD	C,90h
 1394 F9CF  ED 40       CBUSY2:	IN	B,(C)
 1395 F9D1  CB 70       	BIT	6,B		; BUSY?
 1396 F9D3  20 FA       	JR	NZ,CBUSY2
 1397 F9D5  06 80       	LD	B,10000000b
 1398 F9D7  F3          	DI
 1399 F9D8  D3 91       	OUT	(91h),A		; Daten
 1400 F9DA              CSTROB:	OUTC0			; OUT (C),0
    1 F9DA  ED 71       	 DB	0EDh,71h
 1401 F9DC  FB          	EI			; (erst nach naechstem Befehl)
 1402 F9DD  ED 41       	OUT	(C),B		; Strobe-Impuls
 1403 F9DF  C1          	POP	BC
 1404 F9E0  C9          	RET
 1405                   
 1406                   ; Druckroutine fuer V.24:
 1407                   ;
 1408                   ; PE:	A	Zeichen
 1409                   ; VR:	-
 1410                   ;
 1411 F9E1  C5          V24PR:	PUSH	BC
 1412 F9E2  F5          	PUSH	AF
 1413 F9E3  CD FA3E     	CALL	LCSO
 1414 F9E6  C6 0A       V24PR0:	ADD	A,0Ah		; SIO-Steuerport
 1415 F9E8  4F          	LD	C,A
 1416 F9E9  ED 78       V24PR1:	IN	A,(C)
 1417 F9EB  E6 04       	AND	00000100b	; bereit?
 1418 F9ED  20 06       	JR	NZ,V24PR2
 1419 F9EF  3C          	INC	A		; A=1
 1420 F9F0  CD F37B     	CALL	WAIT		; nein: warten (wofuer?)
 1421 F9F3  18 F4       	JR	V24PR1

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 140
CF45    INC

 1422 F9F5  0D          V24PR2:	DEC	C		; SIO-Datenport
 1423 F9F6  0D          	DEC	C
 1424 F9F7  F1          	POP	AF
 1425 F9F8  ED 79       	OUT	(C),A		; Ausgabe
 1426 F9FA  C1          	POP	BC
 1427 F9FB  C9          	RET
 1428                   
 1429                   ; Ausgabe V.24-Duplex:
 1430                   ;
 1431                   ; PE:	A	Zeichen
 1432                   ; VR:	-
 1433                   ;
 1434 F9FC  C5          V24OT:	PUSH	BC
 1435 F9FD  F5          	PUSH	AF
 1436 F9FE  CD FA46     	CALL	LCSOD		; Adresse holen
 1437 FA01  18 E3       	JR	V24PR0
 1438                   
 1439                   ; Eingabe V.24-Duplex (Interrupt):
 1440                   ;
 1441                   ; PA:	A	Zeichen
 1442                   ;	CY	Status (1 = BRK, 0 = Zeichen gueltig)
 1443                   ; VR:	AF
 1444                   ;
 1445 FA03  3E EE       V24I:	LD	A,11101110b	; Steuerbyte fuer Interrupt-Betrieb
 1446 FA05  18 03       	JR	V24IN0
 1447                   
 1448                   ; Eingabe V.24-Duplex (Polling):
 1449                   ;
 1450                   ; PA:	A	Zeichen
 1451                   ;	CY	Status (1 = BRK, 0 = Zeichen gueltig)
 1452                   ; VR:	AF
 1453                   ;
 1454 FA07  3A B7E8     V24IN:	LD	A,(HCPZ2)
 1455 FA0A  C5          V24IN0:	PUSH	BC
 1456 FA0B  D5          	PUSH	DE
 1457 FA0C  57          	LD	D,A		; Steuerbyte
 1458 FA0D  E6 04       	AND	00000100b	; Kanal A oder B?
 1459 FA0F  0F          	RRCA
 1460 FA10  0F          	RRCA
 1461 FA11  C6 0A       	ADD	A,0Ah		; SIO-Steuerport
 1462 FA13  4F          	LD	C,A
 1463 FA14  3E 68       	LD	A,01101000b	; Sendeeinstellungen
 1464 FA16  A2          	AND	D
 1465 FA17  5F          	LD	E,A
 1466 FA18  ED 78       V24IN1:	IN	A,(C)
 1467 FA1A  E6 01       	AND	00000001b	; CY=0, Daten abholbereit?
 1468 FA1C  3E 05       	LD	A,5		; WR5 auswaehlen
 1469 FA1E  F3          	DI			; Interrupts waehrend I/O-Sequenz sperren
 1470 FA1F  ED 79       	OUT	(C),A
 1471 FA21  20 0B       	JR	NZ,V24IN2
 1472 FA23  3E 82       	LD	A,10000010b	; DTR+RTS ein
 1473 FA25  B3          	OR	E
 1474 FA26  ED 79       	OUT	(C),A		; Senderfreigabe
 1475 FA28  FB          	EI
 1476 FA29  CD E388     	CALL	BRKT
 1477 FA2C  30 EA       	JR	NC,V24IN1
 1478 FA2E  ED 59       V24IN2:	OUT	(C),E		; DTR+RTS aus: Sender sperren
 1479 FA30  FB          	EI

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 141
CF45    INC

 1480 FA31  38 08       	JR	C,V24IN3
 1481 FA33  0D          	DEC	C		; SIO-Datenport auswaehlen
 1482 FA34  0D          	DEC	C
 1483 FA35  ED 40       	IN	B,(C)
 1484 FA37  3E 7F       	LD	A,01111111b	; Maske fuer 7 Bit
 1485 FA39  B2          	OR	D
 1486 FA3A  A0          	AND	B		; maskieren, CY=0
 1487 FA3B  D1          V24IN3:	POP	DE
 1488 FA3C  C1          	POP	BC
 1489 FA3D  C9          	RET
 1490                   
 1491                   ; SIO-Offset fuer V24OUT
 1492                   ; PA: A (SIO-Offset)
 1493                   ; VR: AF
 1494 FA3E  3A B7E1     LCSO:	LD	A,(HCPZ)
 1495 FA41  E6 04       LCSO1:	AND	00000100b	; Kanal A oder B?
 1496 FA43  0F          	RRCA
 1497 FA44  0F          	RRCA
 1498 FA45  C9          	RET
 1499                   
 1500                   ; SIO-Offset fuer V24DUP
 1501 FA46  3A B7E8     LCSOD:	LD	A,(HCPZ2)
 1502 FA49  18 F6       	JR	LCSO1
 1503                   
 1504                   ;
 1505                   ; ISR SIO B (Empfangsinterrupt)
 1506                   ; fuer MC-Load, MC-Start, Umschaltung auf Fremdtastatur
 1507                   ;
 1508 FA4B  E5          ISRSB:	PUSH	HL
 1509 FA4C  D5          	PUSH	DE
 1510 FA4D  C5          	PUSH	BC
 1511 FA4E  F5          	PUSH	AF
 1512 FA4F  21 A800     	LD	HL,V24PL	; Steckplatz M003
 1513 FA52  CD E392     	CALL	IRMGET		; aus IRM lesen (Rueckkehr mit EI)
 1514 FA55  47          	LD	B,A		; Steckplatz M003 holen
 1515 FA56  0E 80       	LD	C,80h
 1516 FA58  3E 01       	LD	A,1
 1517 FA5A  ED 79       	OUT	(C),A		; Modul einschalten
 1518 FA5C  D9          	EXX			; auf Zweitregistersatz wechseln
 1519 FA5D  D5          	 PUSH	DE		; DE' sichern
 1520 FA5E  C5          	 PUSH	BC		; BC' sichern
 1521 FA5F  DB 88       	 IN	A,(PIOAD)
 1522 FA61  47          	 LD	B,A		; Schaltzustand IRM in Register B' merken
 1523 FA62  DD 4E 04    	 LD	C,(IX+4)	; Schaltzustand CAOS-C  in Reg. C' merken
 1524                   	 SETIXA	7,4		; SET 7,(IX+4),A
    1 FA65  DD CB 04    	 DB	0DDh,0CBh,4
    2 FA68  FF          	 DB	7 SHL 3 OR 11000111b
 1525 FA69  D3 86       	 OUT	(86h),A		; CAOS-C einschalten
 1526 FA6B  D9          	EXX
 1527 FA6C  21 CCD1     	LD	HL,V24POL
 1528 FA6F  F3          	DI
 1529 FA70  DB 09       	IN	A,(9)		; empfangenes Zeichen von SIO abholen
 1530 FA72  CD F540     	CALL	INIEA		; DTR off
 1531 FA75  CD E5D0     	CALL	IRET		; EI; RETI
 1532                   
 1533 FA78  FE 0D       	CP	CR		; Fremdtastatur?
 1534 FA7A  28 2D       	JR	Z,ISB2
 1535 FA7C  FE 1B       	CP	ESC		; MC-Programm?

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 142
CF45    INC

 1536 FA7E  20 0A       	JR	NZ,ISB1
 1537                   
 1538 FA80  CD FA03     	CALL	V24I		; Folgezeichen nach ESC abholen
 1539 FA83  D6 54       	SUB	'T'		; ESC-T ?
 1540 FA85  28 2E       	JR	Z,ISB4		; -> MC laden
 1541 FA87  3D          	DEC	A		; ESC-U ?
 1542 FA88  28 74       	JR	Z,ISB6		; -> MC starten
 1543                   
 1544 FA8A  26 B8       ISB1:	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
 1545 FA8C  68          	LD	L,B		; Steckplatz
 1546 FA8D  CD E392     	CALL	IRMGET		; Schaltzustand vor ISR ermitteln
 1547 FA90  21 CCC4     	LD	HL,V24INT	; SIO Kanal B wieder auf Interrupt einstellen
 1548 FA93  0E 80       	LD	C,80h
 1549 FA95  F3          	DI
 1550 FA96  CD F540     	CALL	INIEA		; initialisieren
 1551 FA99  ED 79       	OUT	(C),A		; M003-Schaltzustand wiederherstellen
 1552 FA9B  FB          	EI
 1553 FA9C  D9          	EXX
 1554 FA9D  79          	 LD	A,C
 1555 FA9E  DD 77 04    	 LD	(IX+4),A
 1556 FAA1  D3 86       	 OUT	(86h),A		; CAOS-C wie vor Interrupt
 1557 FAA3  C1          	 POP	BC		; BC' regenerieren
 1558 FAA4  D1          	 POP	DE		; DE' regenerieren
 1559 FAA5  D9          	EXX
 1560 FAA6  C3 E0AB     	JP	POP4		; POP	AF,BC,DE,HL   RET
 1561                   
 1562 FAA9  F3          ISB2:	DI
 1563 FAAA  DD 36 F2 A3 	LD	(IX-14),LOW(ISRT)	; neue Tastatur-ISR fuer SIO-B in
 1564 FAAE  DD 36 F3 E3 	LD	(IX-13),HIGH(ISRT)	; Interrupttabelle 01E2H+01E3H
 1565 FAB2  FB          	EI
 1566 FAB3  18 D5       	JR	ISB1
 1567                   ;
 1568                   ; MC laden (ESC-T, Adresse, Anzahl, Daten):
 1569                   ;
 1570 FAB5  21 B801     ISB4:	LD	HL,MODST+1	; IRM = internes Modul 1
 1571 FAB8  CD E392     	CALL	IRMGET		; Modulsteuerwort holen
 1572 FABB  E6 01       	AND	1
 1573 FABD  07          	RLCA			; auf Bit 2 rotieren
 1574 FABE  07          	RLCA
 1575 FABF  D9          	EXX			; auf Zweitregistersatz wechseln
 1576 FAC0  57          	 LD	D,A
 1577 FAC1  3E 7B       	 LD	A,01111011b	; USER-C aus
 1578 FAC3  A0          	 AND	B		; gemerkte Schaltzustaende
 1579 FAC4  B2          	 OR	D		; gewuenschter IRM-Schaltzustand
 1580 FAC5  57          	 LD	D,A
 1581 FAC6  D9          	EXX
 1582                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FAC7  DD CB 04    	 DB	0DDh,0CBh,4
    2 FACA  BF          	 DB	7 SHL 3 OR 10000111b
 1583 FACB  D3 86       	OUT	(86h),A		; CAOS-C ausschalten
 1584 FACD  CD FA03     	CALL	V24I
 1585 FAD0  6F          	LD	L,A		; HL = Adresse
 1586 FAD1  CD FA03     	CALL	V24I
 1587 FAD4  67          	LD	H,A
 1588 FAD5  CD FA03     	CALL	V24I
 1589 FAD8  5F          	LD	E,A		; DE = Anzahl Bytes
 1590 FAD9  CD FA03     	CALL	V24I
 1591 FADC  57          	LD	D,A

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 143
CF45    INC

 1592 FADD  CD FA03     ISB5:	CALL	V24I
 1593 FAE0  38 14       	JR	C,ISB8		; Break
 1594 FAE2  4F          	LD	C,A		; C = Datenbyte
 1595 FAE3  D9          	EXX
 1596 FAE4  7A          	 LD	A,D		; logischer IRM-Schaltzustand
 1597 FAE5  D9          	EXX
 1598 FAE6  F3          	DI
 1599 FAE7  D3 88       	OUT	(PIOAD),A	; USER-C aus und IRM schalten
 1600 FAE9  71          	LD	(HL),C		; Daten in Speicher poken
 1601 FAEA  D9          	EXX
 1602 FAEB  78          	 LD	A,B		; gemerkter IRM-Schaltzustand
 1603 FAEC  D3 88       	 OUT	(PIOAD),A	; USER-C und IRM wiederherstellen
 1604 FAEE  FB          	 EI
 1605 FAEF  D9          	EXX
 1606 FAF0  23          	INC	HL
 1607 FAF1  1B          	DEC	DE		; Zaehler verringern
 1608 FAF2  7B          	LD	A,E
 1609 FAF3  B2          	OR	D		; bis Anzahl=0
 1610 FAF4  20 E7       	JR	NZ,ISB5
 1611 FAF6              ISB8:	SETIXA	7,4		; SET 7,(IX+4),A
    1 FAF6  DD CB 04    	 DB	0DDh,0CBh,4
    2 FAF9  FF          	 DB	7 SHL 3 OR 11000111b
 1612 FAFA  D3 86       	OUT	(86h),A		; CAOS-C einschalten
 1613 FAFC  18 8C       	JR	ISB1
 1614                   ;
 1615                   ; MC starten (ESC-U, Adresse):
 1616                   ;
 1617 FAFE  CD FA03     ISB6:	CALL	V24I
 1618 FB01  5F          	LD	E,A		; DE = Startadresse
 1619 FB02  CD FA03     	CALL	V24I
 1620 FB05  57          	LD	D,A
 1621 FB06  21 CCC4     	LD	HL,V24INT	; SIO Kanal B wieder auf Interrupt einstellen
 1622 FB09  D9          	EXX
 1623 FB0A  78          	 LD	A,B		; gemerkter IRM-Schaltzustand
 1624 FB0B  D9          	EXX
 1625 FB0C  F6 04       	OR	00000100b	; IRM einschalten
 1626 FB0E  F3          	DI
 1627 FB0F  CD F540     	CALL	INIEA		; uminitialisieren
 1628 FB12  D3 88       	OUT	(PIOAD),A	; IRM schalten
 1629                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FB14  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB17  BF          	 DB	7 SHL 3 OR 10000111b
 1630 FB18  D3 86       	OUT	(86h),A		; CAOS-C ausschalten
 1631 FB1A  ED 7B B7AE  	LD	SP,(SYSP)
 1632 FB1E  26 B8       	LD	H,HIGH(MODST)	; Modulsteuerwortspeicher
 1633 FB20  68          	LD	L,B		; Steckplatz
 1634 FB21  7E          	LD	A,(HL)		; M003-Schaltzustand vor ISR ermitteln
 1635 FB22  ED 79       	OUT	(C),A		; und wiederherstellen
 1636 FB24  FB          	EI
 1637 FB25  21 F251     	LD	HL,LOOP		; Rueckkehradresse nach Programmaufruf
 1638 FB28  E5          	PUSH	HL
 1639 FB29  EB          	EX	DE,HL
 1640 FB2A  E9          	JP	(HL)		; Programm jetzt starten
 1641                   
 1642                   ; fuer MODIC, FLOAD
 1643 FB2B  CD FB57     LDMAE:	CALL	COFF
 1644 FB2E  F5          	PUSH	AF
 1645 FB2F  3A B801     	LD	A,(MODST+1)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 144
CF45    INC

 1646 FB32  E6 01       	AND	1		; IRM off?
 1647 FB34  CC F045     	CALL	Z,SCROFF
 1648 FB37  F1          	POP	AF
 1649 FB38  77          	LD	(HL),A		; Byte eintragen
 1650 FB39  18 0F       	JR	CON
 1651                   
 1652                   ; Datenbyte holen (fuer DISPC, MODIC, FSAVE, view)
 1653 FB3B  CD FB57     LDAME:	CALL	COFF		; CAOS-C aus
 1654 FB3E  3A B801     	LD	A,(MODST+1)
 1655 FB41  E6 01       	AND	1		; IRM aus?
 1656 FB43  CC F045     	CALL	Z,SCROFF
 1657 FB46  7E          	LD	A,(HL)		; Byte holen
 1658 FB47  CD F04E     	CALL	SCRON
 1659                   ;	JP	CON		; reinlaufen...
 1660                   
 1661                   ; CAOS-ROM-C einschalten:
 1662 FB4A  F5          CON:	PUSH	AF
 1663                   	SETIXA	7,4		; SET 7,(IX+4),A
    1 FB4B  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB4E  FF          	 DB	7 SHL 3 OR 11000111b
 1664 FB4F  18 12       	JR	CSW
 1665                   
 1666 FB51  CD FB4A     SIXD:	CALL	CON		; **31**
 1667 FB54  CD C0DA     	CALL	SIXC
 1668                   ;	JP	COFF		; reinlaufen...
 1669                   
 1670                   ; CAOS-ROM-C ausschalten falls erforderlich:
 1671 FB57  F5          COFF:	PUSH	AF
 1672 FB58  3A B805     	LD	A,(MODST+5)	; Schaltzustand Moduladresse 5
 1673 FB5B  E6 01       	AND	1
 1674 FB5D  20 06       	JR	NZ,CNSW		; bleibt ein!
 1675                   	RESIXA	7,4		; RES 7,(IX+4),A
    1 FB5F  DD CB 04    	 DB	0DDh,0CBh,4
    2 FB62  BF          	 DB	7 SHL 3 OR 10000111b
 1676 FB63  D3 86       CSW:	OUT	(86h),A
 1677 FB65  F1          CNSW:	POP	AF
 1678 FB66  C9          	RET
 1679                   
 1680 FB67  CD FB4A     MULT:	CALL	CON		; **41**
 1681 FB6A  C3 D7D3     	JP	MULC		; BA=D*C
 1682                   
 1683 FB6D  CD FB4A     SQR:	CALL	CON		; **40**
 1684 FB70  C3 D7C2     	JP	SQRC
 1685                   ;
 1686                   ; ISR fuer CTC2: Tonlaenge
 1687                   ;
 1688 FB73  F5          ISRC2:	PUSH	AF
 1689 FB74  E5          	PUSH	HL
 1690 FB75  CD E475     	CALL	TOFF		; kehrt mit EI zurueck
 1691 FB78  E1          	POP	HL
 1692 FB79  F1          	POP	AF
 1693 FB7A  ED 4D       	RETI
 1694                   
 1695                   ; Geraetecode in Bits 2-4 (IX+8) eintragen
 1696                   ; PE:	A	Geraetecode 0...7
 1697                   ;		0 = Kassette
 1698                   ;		1 = Diskette
 1699                   ;		2 = USB (M052)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 145
CF45    INC

 1700                   ;		3 = Netzwerk (M052)
 1701                   ;		4-7 nicht benutzt
 1702                   ; VR:	AF
 1703                   
 1704 FB7C  AF          DEV_0:	XOR	A		; Kassette = Standardmedium
 1705 FB7D  07          SETDEV:	RLCA
 1706 FB7E  07          	RLCA			; nach Bits 2..4
 1707 FB7F  DD AE 08    	XOR	(IX+8)
 1708 FB82  E6 1C       	AND	00011100b	; Bits 0..1 und 5..7 zuruecksetzen
 1709 FB84  DD AE 08    	XOR	(IX+8)		; a = (a XOR b) XOR b fuer Bits 2..4
 1710 FB87  DD 77 08    	LD	(IX+8),A
 1711 FB8A  C9          	RET
 1712                   ;
 1713                   ; Zeigertabelle fuer Unterprogramme
 1714                   ;
 1715 FB8B  00          ZEI0:	DB	0	; CRT
 1716 FB8C  38          	DB	38H	; MBOUT
 1717 FB8D  02          ZEI2:	DB	2	; UOUT1
 1718 FB8E  03          ZEI3:	DB	3	; UOUT2
 1719 FB8F  04          ZEI4:	DB	4	; KBD
 1720 FB90  37          	DB	37H	; MBIN
 1721 FB91  06          	DB	6	; UIN1
 1722 FB92  07          	DB	7	; UIN2
 1723                   ;
 1724                   ; Unterprogrammtabelle:
 1725                   ;
 1726 FB93  E0A0        SUTB:	DW	CRT	; 00
 1727 FB95  E4E9        	DW	MBO	; 01
 1728 FB97  B7BD        	DW	UOUT1	; 02
 1729 FB99  B7C3        	DW	UOUT2	; 03
 1730 FB9B  F3F6        	DW	KBD	; 04
 1731 FB9D  E54E        	DW	MBI	; 05
 1732 FB9F  B7C0        	DW	UIN1	; 06
 1733 FBA1  B7C6        	DW	UIN2	; 07
 1734 FBA3  E4DA        	DW	ISRO	; 08
 1735 FBA5  E481        	DW	CSRO	; 09
 1736 FBA7  E54B        	DW	ISRI	; 0A
 1737 FBA9  F723        	DW	CSRI	; 0B
 1738 FBAB  E374        	DW	KBDS	; 0C
 1739 FBAD  F154        	DW	BYE	; 0D
 1740 FBAF  E37F        	DW	KBDZ	; 0E
 1741 FBB1  F74B        	DW	COLR	; 0F
 1742 FBB3  F675        	DW	LOAD	; 10
 1743 FBB5  F668        	DW	VERIF	; 11
 1744 FBB7  F251        	DW	LOOP	; 12
 1745 FBB9  F389        	DW	NORM	; 13
 1746 FBBB  F37B        	DW	WAIT	; 14
 1747 FBBD  F5DD        	DW	LARG	; 15
 1748 FBBF  F3F0        	DW	INTB	; 16
 1749 FBC1  F495        	DW	INLIN	; 17
 1750 FBC3  F4DC        	DW	RHEX	; 18
 1751 FBC5  F4C2        	DW	ERRM	; 19
 1752 FBC7  F3B4        	DW	HLHX	; 1A
 1753 FBC9  F4D3        	DW	HLDE	; 1B
 1754 FBCB  F3C4        	DW	AHEX	; 1C
 1755 FBCD  F34C        	DW	ZSUCH	; 1D
 1756 FBCF  F38F        	DW	SOUT	; 1E
 1757 FBD1  F39C        	DW	SIN	; 1F

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 146
CF45    INC

 1758 FBD3  F38C        	DW	NOUT	; 20
 1759 FBD5  F399        	DW	NIN	; 21
 1760 FBD7  F511        	DW	GARG	; 22
 1761 FBD9  F0D6        	DW	OSTR	; 23
 1762 FBDB  F3D5        	DW	OCHR	; 24
 1763 FBDD  F7BE        	DW	CUCP	; 25
 1764 FBDF  F0FD        	DW	MODU	; 26
 1765 FBE1  F10E        	DW	JUMP	; 27
 1766 FBE3  E2DD        	DW	LDMA	; 28
 1767 FBE5  E2DF        	DW	LDAM	; 29
 1768 FBE7  E388        	DW	BRKT	; 2A
 1769 FBE9  F3BC        	DW	SPACE	; 2B
 1770 FBEB  F4CC        	DW	CRLF	; 2C
 1771 FBED  F3C0        	DW	HOME	; 2D
 1772 FBEF  F779        	DW	MODI	; 2E
 1773 FBF1  F7F4        	DW	PUDE	; 2F
 1774 FBF3  F7EC        	DW	PUSE	; 30
 1775 FBF5  FB51        	DW	SIXD	; 31
 1776 FBF7  E07C        	DW	DABR	; 32
 1777 FBF9  E070        	DW	TCIF	; 33
 1778 FBFB  E060        	DW	PADR	; 34
 1779 FBFD  F8C1        	DW	TON	; 35
 1780 FBFF  F571        	DW	SAVE	; 36
 1781 FC01  F814        	DW	MBIN	; 37
 1782 FC03  F80C        	DW	MBOUT	; 38
 1783 FC05  F7B6        	DW	KEY	; 39
 1784 FC07  F7AD        	DW	KEYLI	; 3A
 1785 FC09  F768        	DW	DISP	; 3B
 1786 FC0B  F793        	DW	WININ	; 3C
 1787 FC0D  F79B        	DW	WINAK	; 3D
 1788 FC0F  F804        	DW	LINE	; 3E
 1789 FC11  F7FC        	DW	CIRCL	; 3F
 1790 FC13  FB6D        	DW	SQR	; 40
 1791 FC15  FB67        	DW	MULT	; 41
 1792 FC17  F751        	DW	CSTBT	; 42
 1793 FC19  F540        	DW	INIEA	; 43
 1794 FC1B  F552        	DW	INIME	; 44
 1795 FC1D  F8BB        	DW	ZKOUT	; 45
 1796 FC1F  F1E4        	DW	MENU	; 46
 1797 FC21  F975        	DW	V24OUT	; 47
 1798 FC23  F99D        	DW	V24DUP	; 48
 1799                   ;
 1800                   ; Tastaturcodetabelle:
 1801                   ;
 1802 FC25  57 77       KTAB:	DB	'Ww'
 1803 FC27  41 61       	DB	'Aa'
 1804 FC29  32 22       	DB	'2"'
 1805 FC2B  08 19       	DB	8,19H		; CUL
 1806 FC2D  10 0C       	DB	10H,0CH		; HOME
 1807 FC2F  2D 3D       	DB	'-='
 1808 FC31  F2 F8       	DB	0F2H,0F8H	; F2
 1809 FC33  59 79       	DB	'Yy'
 1810 FC35  45 65       	DB	'Ee'
 1811 FC37  53 73       	DB	'Ss'
 1812 FC39  33 23       	DB	'3#'
 1813 FC3B  5E 5D       	DB	'^]'
 1814 FC3D  01 0F       	DB	1,0FH		; CLR
 1815 FC3F  3A 2A       	DB	':*'

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 147
CF45    INC

 1816 FC41  F3 F9       	DB	0F3H,0F9H	; F3
 1817 FC43  58 78       	DB	'Xx'
 1818 FC45  54 74       	DB	'Tt'
 1819 FC47  46 66       	DB	'Ff'
 1820 FC49  35 25       	DB	'5%'
 1821 FC4B  50 70       	DB	'Pp'
 1822 FC4D  1F 02       	DB	1FH,2		; DEL
 1823 FC4F  30 40       	DB	'0',40H
 1824 FC51  F5 FB       	DB	0F5H,0FBH	; F5
 1825 FC53  56 76       	DB	'Vv'
 1826 FC55  55 75       	DB	'Uu'
 1827 FC57  48 68       	DB	'Hh'
 1828 FC59  37 27       	DB	'7',27H
 1829 FC5B  4F 6F       	DB	'Oo'
 1830 FC5D  1A 14       	DB	1AH,14H		; INS
 1831 FC5F  39 29       	DB	'9)'
 1832 FC61  03 04       	DB	3,4		; BRK
 1833 FC63  4E 6E       	DB	'Nn'
 1834 FC65  49 69       	DB	'Ii'
 1835 FC67  4A 6A       	DB	'Jj'
 1836 FC69  38 28       	DB	'8('
 1837 FC6B  20 5B       	DB	' ['		; SPC
 1838 FC6D  4B 6B       	DB	'Kk'
 1839 FC6F  2C 3C       	DB	',<'
 1840 FC71  13 1B       	DB	13H,ESC		; STOP
 1841 FC73  4D 6D       	DB	'Mm'
 1842 FC75  5A 7A       	DB	'Zz'
 1843 FC77  47 67       	DB	'Gg'
 1844 FC79  36 26       	DB	'6&'
 1845 FC7B  1C 1D       	DB	1CH,1DH		; LIST/RUN
 1846 FC7D  4C 6C       	DB	'Ll'
 1847 FC7F  2E 3E       	DB	'.>'
 1848 FC81  F6 FC       	DB	0F6H,0FCH	; F6
 1849 FC83  42 62       	DB	'Bb'
 1850 FC85  52 72       	DB	'Rr'
 1851 FC87  44 64       	DB	'Dd'
 1852 FC89  34 24       	DB	'4$'
 1853 FC8B  5F 5C       	DB	'_\'
 1854 FC8D  2B 3B       	DB	'+;'
 1855 FC8F  2F 3F       	DB	'/?'
 1856 FC91  F4 FA       	DB	0F4H,0FAH	; F4
 1857 FC93  43 63       	DB	'Cc'
 1858 FC95  51 71       	DB	'Qq'
 1859 FC97  16 05       	DB	16H,5		; CAPS
 1860 FC99  31 21       	DB	'1!'
 1861 FC9B  0A 12       	DB	LF,12H		; CUD
 1862 FC9D  0B 11       	DB	0BH,11H		; CUU
 1863 FC9F  09 18       	DB	09H,18H		; CUR
 1864 FCA1  F1 F7       	DB	0F1H,0F7H	; F1
 1865 FCA3  0D 0E       	DB	CR,0EH		; ENTER
 1866                   ;
 1867                   ; Interrupttabelle:
 1868                   ;
 1869 FCA5  E3E1        ISRTAB:	DW	ISRJ	; (IX-16) M008 PIO A: Joystick
 1870 FCA7  FA4B        	DW	ISRSB	; (IX-14) M003 SIO B: V.24-Empfang
 1871 FCA9  E5C1        	DW	ISRPA	; (IX-12) PIO A: Kassette
 1872 FCAB  E2F6        	DW	ISRPB	; (IX-10) PIO B: Tastatur
 1873 FCAD  E5D0        	DW	IRET	; (IX-8)  CTC 0: frei (TEMO Schrittbetrieb)

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 148
CF45    INC

 1874 FCAF  E5B1        	DW	ISRC1	; (IX-6)  CTC 1: Kassette
 1875 FCB1  FB73        	DW	ISRC2	; (IX-4)  CTC 2: Tondauer
 1876 FCB3  E2EA        	DW	ISRC3	; (IX-2)  CTC 3: Tastatur
 1877                   ;
 1878                   ; Steuercodetabelle:
 1879                   ;
 1880 FCB5  F4BB        CRTTAB:	DW	NOOP	; 00
 1881 FCB7  E215        	DW	CLR	; 01
 1882 FCB9  E28C        	DW	CLLN	; 02
 1883 FCBB  F4BB        	DW	NOOP	; 03=BRK
 1884 FCBD  F4BB        	DW	NOOP	; 04=Sh-BRK
 1885 FCBF  E1CE        	DW	ESC0	; 05=TAB
 1886 FCC1  F4BB        	DW	NOOP	; 06
 1887 FCC3  E2A0        	DW	BEEP	; 07
 1888 FCC5  E1F4        	DW	CUL	; 08
 1889 FCC7  E1DD        	DW	CUR	; 09
 1890 FCC9  E1E6        	DW	CUD	; 0A
 1891 FCCB  E204        	DW	CUU	; 0B
 1892 FCCD  E26A        	DW	CLS	; 0C
 1893 FCCF  E27A        	DW	CBL	; 0D=Enter
 1894 FCD1  F4BB        	DW	NOOP	; 0E=Sh-Enter
 1895 FCD3  E1F0        	DW	HCOPY	; 0F
 1896 FCD5  E278        	DW	HOMEPG	; 10
 1897 FCD7  E209        	DW	PAGEM	; 11
 1898 FCD9  E210        	DW	SCROL	; 12
 1899 FCDB  F4BB        	DW	NOOP	; 13=STOP
 1900 FCDD  E2E1        	DW	CLICK	; 14
 1901 FCDF  F4BB        	DW	NOOP	; 15
 1902 FCE1  F4BB        	DW	NOOP	; 16=CAPS
 1903 FCE3  F4BB        	DW	NOOP	; 17
 1904 FCE5  E1FE        	DW	CEL	; 18
 1905 FCE7  E27A        	DW	CBL	; 19
 1906 FCE9  E24B        	DW	INS	; 1A
 1907 FCEB  F90D        	DW	ESCPRG	; 1B
 1908 FCED  F4BB        	DW	NOOP	; 1C=LIST
 1909 FCEF  F4BB        	DW	NOOP	; 1D=RUN
 1910 FCF1  E1E4        	DW	NL	; 1E=CONT
 1911 FCF3  E218        	DW	DEL	; 1F
 1912                   ;
 1913                   ; BASIC-Token	(Bit 7 im 1. Byte gesetzt!)
 1914                   ;
 1915 FCF5              TOKTAB:	TOKEN	INKEY$		; D5
    1 FCF5  C9          	  DB	'I' + Y
    1 FCF6  4E          	  DB	'N' + Y
    1 FCF7  4B          	  DB	'K' + Y
    1 FCF8  45          	  DB	'E' + Y
    1 FCF9  59          	  DB	'Y' + Y
    1 FCFA  24          	  DB	'$' + Y
 1916                   	TOKEN	JOYST		; D6
    1 FCFB  CA          	  DB	'J' + Y
    1 FCFC  4F          	  DB	'O' + Y
    1 FCFD  59          	  DB	'Y' + Y
    1 FCFE  53          	  DB	'S' + Y
    1 FCFF  54          	  DB	'T' + Y
 1917                   	TOKEN	STRING$		; D7
    1 FD00  D3          	  DB	'S' + Y
    1 FD01  54          	  DB	'T' + Y
    1 FD02  52          	  DB	'R' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 149
CF45    INC

    1 FD03  49          	  DB	'I' + Y
    1 FD04  4E          	  DB	'N' + Y
    1 FD05  47          	  DB	'G' + Y
    1 FD06  24          	  DB	'$' + Y
 1918                   	TOKEN	INSTR		; D8
    1 FD07  C9          	  DB	'I' + Y
    1 FD08  4E          	  DB	'N' + Y
    1 FD09  53          	  DB	'S' + Y
    1 FD0A  54          	  DB	'T' + Y
    1 FD0B  52          	  DB	'R' + Y
 1919                   	TOKEN	RENUMBER	; D9
    1 FD0C  D2          	  DB	'R' + Y
    1 FD0D  45          	  DB	'E' + Y
    1 FD0E  4E          	  DB	'N' + Y
    1 FD0F  55          	  DB	'U' + Y
    1 FD10  4D          	  DB	'M' + Y
    1 FD11  42          	  DB	'B' + Y
    1 FD12  45          	  DB	'E' + Y
    1 FD13  52          	  DB	'R' + Y
 1920                   	TOKEN	DELETE		; DA
    1 FD14  C4          	  DB	'D' + Y
    1 FD15  45          	  DB	'E' + Y
    1 FD16  4C          	  DB	'L' + Y
    1 FD17  45          	  DB	'E' + Y
    1 FD18  54          	  DB	'T' + Y
    1 FD19  45          	  DB	'E' + Y
 1921                   	TOKEN	PAUSE		; DB
    1 FD1A  D0          	  DB	'P' + Y
    1 FD1B  41          	  DB	'A' + Y
    1 FD1C  55          	  DB	'U' + Y
    1 FD1D  53          	  DB	'S' + Y
    1 FD1E  45          	  DB	'E' + Y
 1922                   	TOKEN	BEEP		; DC
    1 FD1F  C2          	  DB	'B' + Y
    1 FD20  45          	  DB	'E' + Y
    1 FD21  45          	  DB	'E' + Y
    1 FD22  50          	  DB	'P' + Y
 1923                   	TOKEN	WINDOW		; DD
    1 FD23  D7          	  DB	'W' + Y
    1 FD24  49          	  DB	'I' + Y
    1 FD25  4E          	  DB	'N' + Y
    1 FD26  44          	  DB	'D' + Y
    1 FD27  4F          	  DB	'O' + Y
    1 FD28  57          	  DB	'W' + Y
 1924                   	TOKEN	BORDER		; DE
    1 FD29  C2          	  DB	'B' + Y
    1 FD2A  4F          	  DB	'O' + Y
    1 FD2B  52          	  DB	'R' + Y
    1 FD2C  44          	  DB	'D' + Y
    1 FD2D  45          	  DB	'E' + Y
    1 FD2E  52          	  DB	'R' + Y
 1925                   	TOKEN	INK		; DF
    1 FD2F  C9          	  DB	'I' + Y
    1 FD30  4E          	  DB	'N' + Y
    1 FD31  4B          	  DB	'K' + Y
 1926                   	TOKEN	PAPER		; E0
    1 FD32  D0          	  DB	'P' + Y
    1 FD33  41          	  DB	'A' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 150
CF45    INC

    1 FD34  50          	  DB	'P' + Y
    1 FD35  45          	  DB	'E' + Y
    1 FD36  52          	  DB	'R' + Y
 1927                   	TOKEN	AT		; E1
    1 FD37  C1          	  DB	'A' + Y
    1 FD38  54          	  DB	'T' + Y
 1928                   	TOKEN	COLOR		; E2
    1 FD39  C3          	  DB	'C' + Y
    1 FD3A  4F          	  DB	'O' + Y
    1 FD3B  4C          	  DB	'L' + Y
    1 FD3C  4F          	  DB	'O' + Y
    1 FD3D  52          	  DB	'R' + Y
 1929                   	TOKEN	SOUND		; E3
    1 FD3E  D3          	  DB	'S' + Y
    1 FD3F  4F          	  DB	'O' + Y
    1 FD40  55          	  DB	'U' + Y
    1 FD41  4E          	  DB	'N' + Y
    1 FD42  44          	  DB	'D' + Y
 1930                   	TOKEN	PSET		; E4
    1 FD43  D0          	  DB	'P' + Y
    1 FD44  53          	  DB	'S' + Y
    1 FD45  45          	  DB	'E' + Y
    1 FD46  54          	  DB	'T' + Y
 1931                   	TOKEN	PRESET		; E5
    1 FD47  D0          	  DB	'P' + Y
    1 FD48  52          	  DB	'R' + Y
    1 FD49  45          	  DB	'E' + Y
    1 FD4A  53          	  DB	'S' + Y
    1 FD4B  45          	  DB	'E' + Y
    1 FD4C  54          	  DB	'T' + Y
 1932                   	TOKEN	BLOAD		; E6
    1 FD4D  C2          	  DB	'B' + Y
    1 FD4E  4C          	  DB	'L' + Y
    1 FD4F  4F          	  DB	'O' + Y
    1 FD50  41          	  DB	'A' + Y
    1 FD51  44          	  DB	'D' + Y
 1933                   	TOKEN	VPEEK		; E7
    1 FD52  D6          	  DB	'V' + Y
    1 FD53  50          	  DB	'P' + Y
    1 FD54  45          	  DB	'E' + Y
    1 FD55  45          	  DB	'E' + Y
    1 FD56  4B          	  DB	'K' + Y
 1934                   	TOKEN	VPOKE		; E8
    1 FD57  D6          	  DB	'V' + Y
    1 FD58  50          	  DB	'P' + Y
    1 FD59  4F          	  DB	'O' + Y
    1 FD5A  4B          	  DB	'K' + Y
    1 FD5B  45          	  DB	'E' + Y
 1935                   	TOKEN	LOCATE		; E9
    1 FD5C  CC          	  DB	'L' + Y
    1 FD5D  4F          	  DB	'O' + Y
    1 FD5E  43          	  DB	'C' + Y
    1 FD5F  41          	  DB	'A' + Y
    1 FD60  54          	  DB	'T' + Y
    1 FD61  45          	  DB	'E' + Y
 1936                   	TOKEN	KEYLIST		; EA
    1 FD62  CB          	  DB	'K' + Y
    1 FD63  45          	  DB	'E' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 151
CF45    INC

    1 FD64  59          	  DB	'Y' + Y
    1 FD65  4C          	  DB	'L' + Y
    1 FD66  49          	  DB	'I' + Y
    1 FD67  53          	  DB	'S' + Y
    1 FD68  54          	  DB	'T' + Y
 1937                   	TOKEN	KEY		; EB
    1 FD69  CB          	  DB	'K' + Y
    1 FD6A  45          	  DB	'E' + Y
    1 FD6B  59          	  DB	'Y' + Y
 1938                   	TOKEN	SWITCH		; EC
    1 FD6C  D3          	  DB	'S' + Y
    1 FD6D  57          	  DB	'W' + Y
    1 FD6E  49          	  DB	'I' + Y
    1 FD6F  54          	  DB	'T' + Y
    1 FD70  43          	  DB	'C' + Y
    1 FD71  48          	  DB	'H' + Y
 1939                   	TOKEN	PTEST		; ED
    1 FD72  D0          	  DB	'P' + Y
    1 FD73  54          	  DB	'T' + Y
    1 FD74  45          	  DB	'E' + Y
    1 FD75  53          	  DB	'S' + Y
    1 FD76  54          	  DB	'T' + Y
 1940                   	TOKEN	CLOSE		; EE
    1 FD77  C3          	  DB	'C' + Y
    1 FD78  4C          	  DB	'L' + Y
    1 FD79  4F          	  DB	'O' + Y
    1 FD7A  53          	  DB	'S' + Y
    1 FD7B  45          	  DB	'E' + Y
 1941                   	TOKEN	OPEN		; EF
    1 FD7C  CF          	  DB	'O' + Y
    1 FD7D  50          	  DB	'P' + Y
    1 FD7E  45          	  DB	'E' + Y
    1 FD7F  4E          	  DB	'N' + Y
 1942                   	TOKEN	RANDOMIZE	; F0
    1 FD80  D2          	  DB	'R' + Y
    1 FD81  41          	  DB	'A' + Y
    1 FD82  4E          	  DB	'N' + Y
    1 FD83  44          	  DB	'D' + Y
    1 FD84  4F          	  DB	'O' + Y
    1 FD85  4D          	  DB	'M' + Y
    1 FD86  49          	  DB	'I' + Y
    1 FD87  5A          	  DB	'Z' + Y
    1 FD88  45          	  DB	'E' + Y
 1943                   	TOKEN	VGET$		; F1
    1 FD89  D6          	  DB	'V' + Y
    1 FD8A  47          	  DB	'G' + Y
    1 FD8B  45          	  DB	'E' + Y
    1 FD8C  54          	  DB	'T' + Y
    1 FD8D  24          	  DB	'$' + Y
 1944                   	TOKEN	LINE		; F2
    1 FD8E  CC          	  DB	'L' + Y
    1 FD8F  49          	  DB	'I' + Y
    1 FD90  4E          	  DB	'N' + Y
    1 FD91  45          	  DB	'E' + Y
 1945                   	TOKEN	CIRCLE		; F3
    1 FD92  C3          	  DB	'C' + Y
    1 FD93  49          	  DB	'I' + Y
    1 FD94  52          	  DB	'R' + Y

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 152
CF45    INC

    1 FD95  43          	  DB	'C' + Y
    1 FD96  4C          	  DB	'L' + Y
    1 FD97  45          	  DB	'E' + Y
 1946                   	TOKEN	CSRLIN		; F4
    1 FD98  C3          	  DB	'C' + Y
    1 FD99  53          	  DB	'S' + Y
    1 FD9A  52          	  DB	'R' + Y
    1 FD9B  4C          	  DB	'L' + Y
    1 FD9C  49          	  DB	'I' + Y
    1 FD9D  4E          	  DB	'N' + Y
 1947                   	TOKEN	DRIVE		; F5
    1 FD9E  C4          	  DB	'D' + Y
    1 FD9F  52          	  DB	'R' + Y
    1 FDA0  49          	  DB	'I' + Y
    1 FDA1  56          	  DB	'V' + Y
    1 FDA2  45          	  DB	'E' + Y
 1948 FDA3  80          	DB	80H		; Ende-Kennung
 1949                   ;
 1950                   ; Sprungtabelle fuer BASIC-Token
 1951                   ;
 1952 FDA4  EA82        TOKJP:	DW	INKEY
 1953 FDA6  ECF4        	DW	JOYST
 1954 FDA8  E687        	DW	STRING
 1955 FDAA  EB70        	DW	INSTR
 1956 FDAC  E6E6        	DW	RENUM
 1957 FDAE  E8C6        	DW	DELETE
 1958 FDB0  E8EA        	DW	PAUSE
 1959 FDB2  E91C        	DW	BBEEP
 1960 FDB4  E931        	DW	WINDOW
 1961 FDB6  D421        	DW	0D421H		; BORDER
 1962 FDB8  EB2B        	DW	INK
 1963 FDBA  EB51        	DW	PAPER
 1964 FDBC  C348        	DW	SNER		; AT
 1965 FDBE  EB42        	DW	BCOLOR
 1966 FDC0  EAA0        	DW	SOUND
 1967 FDC2  EAE3        	DW	PSET
 1968 FDC4  EB13        	DW	PRESET
 1969 FDC6  E9BC        	DW	BLOAD
 1970 FDC8  C348        	DW	SNER		; VPEEK
 1971 FDCA  E9CA        	DW	VPOKE
 1972 FDCC  EA4E        	DW	LOCATE
 1973 FDCE  EBEE        	DW	KEYLIST
 1974 FDD0  EBE2        	DW	BKEY
 1975 FDD2  EBF2        	DW	SWITCH
 1976 FDD4  C348        	DW	SNER		; PTEST
 1977 FDD6  ECBC        	DW	CLOSE
 1978 FDD8  ED23        	DW	OPEN
 1979 FDDA  ED1D        	DW	RANDOM
 1980 FDDC  C348        	DW	SNER		; VGET
 1981 FDDE  ED58        	DW	BLINE
 1982 FDE0  ED5D        	DW	CIRCLE
 1983 FDE2  C348        	DW	SNER		; CSRLIN
 1984 FDE4  ED8B        	DW	BDRIVE		; Laufwerk wechseln
 1985                   
 1986                   	ABSFILL	0FDF0h,<ROM-F-Ende>
    7 FDE6  FF FF FF FF 	  DS	0FDF0h - $,0FFh
 1987                   
 1988                   ; High-Byte der Adresse muss konstant sein!

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 153
CF45    INC

 1989 FDF0  16          BUPTAB:	DB	16H		; INTB #0
 1990 FDF1  24          	DB	24H		; OCHR
 1991 FDF2  37          	DB	37H		; MBIN #1
 1992 FDF3  38          	DB	38H		; MBOUT
 1993 FDF4  06          	DB	06H		; USIN1 #2
 1994 FDF5  02          	DB	02H		; UOT1
 1995 FDF6  07          	DB	07H		; USIN2	#3
 1996 FDF7  03          	DB	03H		; UOT2
 1997                   
 1998                   ; Adresse FDF8h fest - wird von anderen Programmen (z.B. TEMO) miz genutzt!
 1999 FDF8  80 40 20 10 BITTAB:	DB	80H,40H,20H,10H,8,4,2,1
  155                   	INCLUDE	ZSKLEIN.INC	; Zeichensatz Kleinbuchstaben
    1                   ;*****************************************
    2                   ;**	CAOS 4.5 Zeichensatz Klein	**
    3                   ;**					**
    4                   ;**	Adresse:  FE00h bis FFFFh	**
    5                   ;**					**
    6                   ;**	letzte Aenderung: 13.05.2010	**
    7                   ;*****************************************
    8                   
    9 FE00  00 00 00 00 	DB	000H, 000H, 000H, 000H, 000H, 000H, 081H, 0FFH	; 00H
   10 FE08  00 00 22 72 	DB	000H, 000H, 022H, 072H, 022H, 03EH, 000H, 000H	; 01H
   11 FE10  00 00 12 32 	DB	000H, 000H, 012H, 032H, 07EH, 032H, 012H, 000H	; 02H
   12 FE18  7E 81 B9 A5 	DB	07EH, 081H, 0B9H, 0A5H, 0B9H, 0A5H, 0B9H, 081H	; 03H
   13 FE20  55 FF 55 FF 	DB	055H, 0FFH, 055H, 0FFH, 055H, 0FFH, 055H, 0FFH	; 04H
   14 FE28  AA AA AA AA 	DB	0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH, 0AAH	; 05H
   15 FE30  FF 00 FF 00 	DB	0FFH, 000H, 0FFH, 000H, 0FFH, 000H, 0FFH, 000H	; 06H
   16 FE38  00 00 3C 42 	DB	000H, 000H, 03CH, 042H, 042H, 07EH, 000H, 000H	; 07H
   17 FE40  00 10 30 7E 	DB	000H, 010H, 030H, 07EH, 030H, 010H, 000H, 000H	; 08H
   18 FE48  00 08 0C 7E 	DB	000H, 008H, 00CH, 07EH, 00CH, 008H, 000H, 000H	; 09H
   19 FE50  00 10 10 10 	DB	000H, 010H, 010H, 010H, 07CH, 038H, 010H, 000H	; 0AH
   20 FE58  08 1C 3E 08 	DB	008H, 01CH, 03EH, 008H, 008H, 008H, 008H, 000H	; 0BH
   21 FE60  38 30 28 08 	DB	038H, 030H, 028H, 008H, 008H, 008H, 03EH, 000H	; 0CH
   22 FE68  00 00 12 32 	DB	000H, 000H, 012H, 032H, 07EH, 030H, 010H, 000H	; 0DH
   23 FE70  AA 55 AA 55 	DB	0AAH, 055H, 0AAH, 055H, 0AAH, 055H, 0AAH, 055H	; 0EH
   24 FE78  3E 7C 7C 3E 	DB	03EH, 07CH, 07CH, 03EH, 03EH, 07CH, 0F8H, 0F8H	; 0FH
   25                   
   26 FE80  38 30 28 04 	DB	038H, 030H, 028H, 004H, 004H, 004H, 004H, 000H	; 10H
   27 FE88  7F 08 1C 3E 	DB	07FH, 008H, 01CH, 03EH, 008H, 008H, 008H, 000H	; 11H neu
   28 FE90  00 08 08 08 	DB	000H, 008H, 008H, 008H, 03EH, 01CH, 008H, 07FH	; 12H neu
   29 FE98  7E 81 9D A1 	DB	07EH, 081H, 09DH, 0A1H, 0B9H, 085H, 085H, 0B9H	; 13H
   30 FEA0  00 3C 42 5A 	DB	000H, 03CH, 042H, 05AH, 05AH, 042H, 03CH, 000H	; 14H
   31 FEA8  88 44 22 11 	DB	088H, 044H, 022H, 011H, 088H, 044H, 022H, 011H	; 15H
   32 FEB0  00 7F 22 72 	DB	000H, 07FH, 022H, 072H, 027H, 022H, 07FH, 000H	; 16H
   33 FEB8  11 22 44 88 	DB	011H, 022H, 044H, 088H, 011H, 022H, 044H, 088H	; 17H
   34 FEC0  00 01 09 0D 	DB	000H, 001H, 009H, 00DH, 07FH, 00DH, 009H, 001H	; 18H
   35 FEC8  00 80 90 B0 	DB	000H, 080H, 090H, 0B0H, 0FEH, 0B0H, 090H, 080H	; 19H neu
   36 FED0  00 08 7C 06 	DB	000H, 008H, 07CH, 006H, 07CH, 008H, 000H, 000H	; 1AH
   37 FED8  CC CC 33 33 	DB	0CCH, 0CCH, 033H, 033H, 0CCH, 0CCH, 033H, 033H	; 1BH
   38 FEE0  7E 81 A1 A1 	DB	07EH, 081H, 0A1H, 0A1H, 0A1H, 0A1H, 0BDH, 081H	; 1CH
   39 FEE8  7E 81 B9 A5 	DB	07EH, 081H, 0B9H, 0A5H, 0B9H, 0A5H, 0A5H, 081H	; 1DH
   40 FEF0  7E 81 99 A1 	DB	07EH, 081H, 099H, 0A1H, 0A1H, 0A1H, 099H, 081H	; 1EH
   41 FEF8  00 10 3E 60 	DB	000H, 010H, 03EH, 060H, 03EH, 010H, 000H, 000H	; 1FH
   42                   
   43 FF00  3C 42 99 A1 	DB	03CH, 042H, 099H, 0A1H, 0A1H, 099H, 042H, 03CH	; 60H
   44 FF08  00 00 78 0C 	DB	000H, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 61H
   45 FF10  E0 60 7C 66 	DB	0E0H, 060H, 07CH, 066H, 066H, 066H, 0DCH, 000H	; 62H
   46 FF18  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0C0H, 0CCH, 078H, 000H	; 63H

SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page 154
ZSKLEIN INC

   47 FF20  1C 0C 7C CC 	DB	01CH, 00CH, 07CH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 64H
   48 FF28  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0FCH, 0C0H, 078H, 000H	; 65H
   49 FF30  38 6C 60 F0 	DB	038H, 06CH, 060H, 0F0H, 060H, 060H, 0F0H, 000H	; 66H
   50 FF38  00 00 76 CC 	DB	000H, 000H, 076H, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 67H
   51 FF40  E0 60 6C 76 	DB	0E0H, 060H, 06CH, 076H, 066H, 066H, 0E6H, 000H	; 68H
   52 FF48  30 00 70 30 	DB	030H, 000H, 070H, 030H, 030H, 030H, 0FCH, 000H	; 69H
   53 FF50  0C 00 1C 0C 	DB	00CH, 000H, 01CH, 00CH, 00CH, 0CCH, 0CCH, 078H	; 6AH
   54 FF58  E0 60 66 6C 	DB	0E0H, 060H, 066H, 06CH, 078H, 06CH, 0E6H, 000H	; 6BH
   55 FF60  70 30 30 30 	DB	070H, 030H, 030H, 030H, 030H, 030H, 0FCH, 000H	; 6CH
   56 FF68  00 00 CC FE 	DB	000H, 000H, 0CCH, 0FEH, 0FEH, 0D6H, 0C6H, 000H	; 6DH
   57 FF70  00 00 F8 CC 	DB	000H, 000H, 0F8H, 0CCH, 0CCH, 0CCH, 0CCH, 000H	; 6EH
   58 FF78  00 00 78 CC 	DB	000H, 000H, 078H, 0CCH, 0CCH, 0CCH, 078H, 000H	; 6FH
   59                   
   60 FF80  00 00 DC 66 	DB	000H, 000H, 0DCH, 066H, 066H, 07CH, 060H, 0F0H	; 70H
   61 FF88  00 00 76 CC 	DB	000H, 000H, 076H, 0CCH, 0CCH, 07CH, 00CH, 01EH	; 71H
   62 FF90  00 00 DC 76 	DB	000H, 000H, 0DCH, 076H, 066H, 060H, 0F0H, 000H	; 72H
   63 FF98  00 00 7C C0 	DB	000H, 000H, 07CH, 0C0H, 078H, 00CH, 0F8H, 000H	; 73H
   64 FFA0  10 30 7C 30 	DB	010H, 030H, 07CH, 030H, 030H, 034H, 018H, 000H	; 74H
   65 FFA8  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 75H
   66 FFB0  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 078H, 030H, 000H	; 76H
   67 FFB8  00 00 C6 D6 	DB	000H, 000H, 0C6H, 0D6H, 0FEH, 0FEH, 06CH, 000H	; 77H
   68 FFC0  00 00 C6 6C 	DB	000H, 000H, 0C6H, 06CH, 038H, 06CH, 0C6H, 000H	; 78H
   69 FFC8  00 00 CC CC 	DB	000H, 000H, 0CCH, 0CCH, 0CCH, 07CH, 00CH, 0F8H	; 79H
   70 FFD0  00 00 FC 98 	DB	000H, 000H, 0FCH, 098H, 030H, 064H, 0FCH, 000H	; 7AH
   71 FFD8  6C 00 78 0C 	DB	06CH, 000H, 078H, 00CH, 07CH, 0CCH, 076H, 000H	; 7BH
   72 FFE0  CC 00 78 CC 	DB	0CCH, 000H, 078H, 0CCH, 0CCH, 0CCH, 078H, 000H	; 7CH
   73 FFE8  CC 00 CC CC 	DB	0CCH, 000H, 0CCH, 0CCH, 0CCH, 0CCH, 076H, 000H	; 7DH
   74 FFF0  3C 66 66 6C 	DB	03CH, 066H, 066H, 06CH, 066H, 066H, 06CH, 0F0H	; 7EH
   75 FFF8  FF 81 81 81 	DB	0FFH, 081H, 081H, 081H, 081H, 081H, 081H, 0FFH	; 7FH
  156                   
  157                   	.DEPHASE
  158                   
  159                   	END
 0 Error(s) Detected.
 16512 Absolute Bytes. 1159 Symbols Detected.

, 000H	; 75H
   66 FFB0  00 00 CC CC 	DB	000H, 
